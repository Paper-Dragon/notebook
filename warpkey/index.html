<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WARP Key Tool - By wanghaoyu.com.cn</title>
  <meta name="description" content="WARP Key Tool - 一个简单的WARP Key生成工具，由wanghaoyu.com.cn提供">
  <meta name="keywords" content="WARP Key,WARP Key Tool,WARP Key Generator,wanghaoyu.com.cn">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    /* 玻璃拟态 */
    .glass{
      background:rgba(255,255,255,.25);
      backdrop-filter:blur(16px);
      -webkit-backdrop-filter:blur(16px);
      border:1px solid rgba(255,255,255,.18);
    }
    .dark .glass{
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.1);
    }
    /* 自定义滚动条 */
    ::-webkit-scrollbar{width:6px;height:6px}
    ::-webkit-scrollbar-thumb{@apply bg-slate-400 dark:bg-slate-600 rounded-full}
    /* 让骨架屏动画更柔和 */
    .shine{
      background:linear-gradient(90deg,#f0f0f0 40%,#e0e0e0 50%,#f0f0f0 60%);
      background-size:200% 100%;
      animation:shine 1.2s infinite;
    }
    @keyframes shine{to{background-position:-200% 0}}
    .dark .shine{
      background:linear-gradient(90deg,#1f2937 40%,#374151 50%,#1f2937 60%);
    }
  </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors">
  <div id="app">
    <!-- 顶部栏 -->
    <header class="sticky top-0 z-20 glass shadow-sm">
      <div class="max-w-7xl mx-auto px-4 flex items-center justify-between h-16">
        <div class="flex items-center gap-3">
          <img src="https://cdn.jsdelivr.net/gh/twitter/twemoji@14/assets/svg/1f310.svg" class="w-7 h-7" alt="🌐">
          <span class="font-bold text-xl tracking-tight">WARP Key</span>
        </div>

        <nav class="hidden md:flex items-center gap-2">
          <button v-for="m in menus" :key="m.key" @click="mode = m.key"
                  :class="mode===m.key?'bg-sky-500 text-white':'hover:bg-slate-200/60 dark:hover:bg-slate-700/60'"
                  class="px-3 py-1.5 rounded-lg text-sm transition">
            {{ t(m.label) }}
          </button>
        </nav>

        <div class="flex items-center gap-3">
          <button @click="toggleDark()" class="p-2 rounded-lg hover:bg-slate-200/60 dark:hover:bg-slate-700/60 transition" :title="isDark ? 'Light' : 'Dark'">
            <span v-html="isDark?'☀️':'🌙'"></span>
          </button>
          <button @click="switchLang()" class="px-2 py-1 rounded-lg hover:bg-slate-200/60 dark:hover:bg-slate-700/60 text-sm transition">
            {{ locale==='en'?'中文':'EN' }}
          </button>
        </div>
      </div>
    </header>

    <!-- 主内容 -->
    <main class="max-w-7xl mx-auto px-4 py-6">
      <!-- 关于页 -->
      <div v-if="mode==='about'" class="glass rounded-2xl p-6 shadow">
        <h1 class="text-2xl font-bold mb-4">{{ t('aboutTitle') }}</h1>
        <p class="mb-2">{{ t('aboutDesc') }}</p>
        <p class="text-sm text-slate-500 dark:text-slate-400">
          {{ t('update') }}: {{ lastUpdate }}
        </p>
      </div>

      <!-- 密钥列表 -->
      <div v-else>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold">{{ t('keyList') }}</h2>
          <button @click="loadKeys()" class="px-3 py-1.5 rounded-lg glass hover:shadow-md transition text-sm">
            ↻ {{ t('refresh') }}
          </button>
        </div>

        <!-- 过渡区域：骨架屏 ↔ 真实卡片 -->
        <transition name="fade" mode="out-in">
          <div v-if="loading" key="skeleton" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            <div v-for="i in 6" :key="i" class="glass rounded-xl p-4">
              <div class="h-6 rounded shine"></div>
            </div>
          </div>

          <div v-else key="list" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            <div v-for="(k, i) in keys" :key="i"
                 @click="copy(k.key)"
                 class="glass rounded-xl p-4 cursor-pointer hover:shadow-lg hover:scale-[1.02] transition relative group">
              <div class="text-sm font-mono break-all pr-8">{{ k.key }}</div>
              <button class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition text-slate-500 hover:text-sky-500" title="Copy">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
              </button>
            </div>
          </div>
        </transition>

        <div v-if="!keys.length && !loading" class="text-center py-12 text-slate-500">
          {{ t('noData') }}
        </div>
      </div>
    </main>

    <!-- 底部 -->
    <footer class="text-center text-xs text-slate-400 py-6">
      MIT © 2025 WARP Key Tools By <a href="https://github.com/nas-tool" target="_blank" class="underline hover:text-sky-500">NAS Tool</a> |
      <a href="https://github.com/nas-tool/warpkey" target="_blank" class="underline hover:text-sky-500">GitHub</a>
    </footer>

    <!-- 复制提示 -->
    <transition enter-active-class="transition" leave-active-class="transition">
      <div v-if="copied" class="fixed bottom-6 left-1/2 -translate-x-1/2 glass px-4 py-2 rounded-full text-sm shadow">
        ✅ {{ t('copied') }}
      </div>
    </transition>
  </div>

  <script>
    const messages = {
      en: {
        full: 'Full Version',
        lite: 'Lite Version',
        about: 'About',
        keyList: 'Available Keys',
        refresh: 'Refresh',
        noData: 'No keys yet',
        copied: 'Copied to clipboard!',
        aboutTitle: 'About',
        aboutDesc: 'This project automatically collects Cloudflare WARP keys from Telegram and pushes them to GitHub every hour.',
        update: 'Last GitHub Actions run'
      },
      zh: {
        full: '完整版',
        lite: '精简版',
        about: '关于',
        keyList: '可用密钥',
        refresh: '刷新',
        noData: '暂无密钥',
        copied: '已复制到剪贴板！',
        aboutTitle: '关于',
        aboutDesc: '本项目每小时自动从 Telegram 收集 Cloudflare WARP 密钥并推送至 GitHub。',
        update: '最后一次 GitHub Actions 运行'
      }
    }

    const { createApp, ref, onMounted, watch } = Vue

    createApp({
      setup () {
        const locale = ref(localStorage.getItem('lang') || 'en')
        const isDark = ref(localStorage.getItem('dark') === 'true')
        const mode = ref('lite')
        const keys = ref([])
        const loading = ref(false)
        const copied = ref(false)
        const lastUpdate = ref('')

        const menus = [
          { key: 'lite', label: 'lite' },
          { key: 'full', label: 'full' },
          { key: 'about', label: 'about' }
        ]

        const t = k => messages[locale.value][k]

        const toggleDark = () => {
          isDark.value = !isDark.value
          localStorage.setItem('dark', isDark.value)
          isDark.value
            ? document.documentElement.classList.add('dark')
            : document.documentElement.classList.remove('dark')
        }

        const switchLang = () => {
          locale.value = locale.value === 'en' ? 'zh' : 'en'
          localStorage.setItem('lang', locale.value)
        }

        /* 获取 Actions 最后一次成功运行时间 */
        const fetchLastUpdate = async () => {
          try {
            const { data } = await axios.get('https://api.github.com/repos/nas-tool/warpkey/actions/runs?per_page=1&status=success')
            const date = data.workflow_runs[0]?.updated_at || ''
            lastUpdate.value = date
              ? new Date(date).toLocaleString(locale.value === 'zh' ? 'zh-CN' : 'en-US')
              : 'N/A'
          } catch {
            lastUpdate.value = 'N/A'
          }
        }

        const loadKeys = async () => {
          loading.value = true
          try {
            const { data } = await axios.get(
              `https://ghproxy.cfd/https://raw.githubusercontent.com/nas-tool/warpkey/main/data/${mode.value}`
            )
            keys.value = data.trim().split('\n').filter(Boolean).map(k => ({ key: k }))
          } catch {
            keys.value = []
          } finally {
            loading.value = false
          }
        }

        const copy = async text => {
          try {
            await navigator.clipboard.writeText(text)
            copied.value = true
            setTimeout(() => copied.value = false, 1500)
          } catch {}
        }

        watch(mode, () => mode.value !== 'about' && loadKeys())

        onMounted(() => {
          isDark.value && document.documentElement.classList.add('dark')
          fetchLastUpdate()
          mode.value !== 'about' && loadKeys()
        })

        return { locale, isDark, mode, keys, loading, copied, lastUpdate, menus, t, toggleDark, switchLang, loadKeys, copy }
      }
    }).mount('#app')
  </script>

  <!-- 过渡动画 -->
  <style>
    .fade-enter-active, .fade-leave-active {
      transition: opacity .3s;
    }
    .fade-enter-from, .fade-leave-to {
      opacity: 0;
    }
  </style>
</body>
</html>