import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{aj as a,ao as e,am as t}from"./app-VCODrprF.js";const l={};function n(h,i){return t(),a("div",null,i[0]||(i[0]=[e(`<h1 id="gitlab备份和恢复" tabindex="-1"><a class="header-anchor" href="#gitlab备份和恢复"><span>Gitlab备份和恢复</span></a></h1><h2 id="配置备份" tabindex="-1"><a class="header-anchor" href="#配置备份"><span>配置备份</span></a></h2><blockquote><p>参考链接 https://docs.gitlab.com/omnibus/settings/backups.html</p></blockquote><p>编辑用户根目录的 cron 表</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> crontab</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> root</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>备份etc配置文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">15</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 04</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2-6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  gitlab-ctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> backup-etc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">### &amp;&amp; cd /etc/gitlab/config_backup &amp;&amp; cp $(ls -t | head -n1) /secret/gitlab/backups/ #异地备份</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置恢复" tabindex="-1"><a class="header-anchor" href="#配置恢复"><span>配置恢复</span></a></h2><p>解压压缩包到gitlab目录</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/etc/gitlab</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="数据备份" tabindex="-1"><a class="header-anchor" href="#数据备份"><span>数据备份</span></a></h2><blockquote><p>参考链接</p><ul><li><a href="https://docs.gitlab.com/ee/raketasks/backup_gitlab.html" target="_blank" rel="noopener noreferrer">备份 GitLab </a></li></ul></blockquote><h3 id="手动备份" tabindex="-1"><a class="header-anchor" href="#手动备份"><span>手动备份</span></a></h3><h4 id="运行命令" tabindex="-1"><a class="header-anchor" href="#运行命令"><span>运行命令：</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gitlab-backup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="自动备份" tabindex="-1"><a class="header-anchor" href="#自动备份"><span>自动备份</span></a></h3><p>编辑crontab配置:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo su -</span></span>
<span class="line"><span>crontab -e</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在配置文件中添加：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>0 2 * * * /opt/gitlab/bin/gitlab-backup create CRON=1 # 每天2点进行自动备份</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="详细配置" tabindex="-1"><a class="header-anchor" href="#详细配置"><span>详细配置</span></a></h4><h5 id="限制备份的存活日期" tabindex="-1"><a class="header-anchor" href="#限制备份的存活日期"><span>限制备份的存活日期</span></a></h5><div class="language-r line-numbers-mode" data-highlighter="shiki" data-ext="r" data-title="r" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">gitlab_rails[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;backup_keep_time&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] = </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">604800</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #  7 days</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="数据保存目录" tabindex="-1"><a class="header-anchor" href="#数据保存目录"><span>数据保存目录</span></a></h5><div class="language-r line-numbers-mode" data-highlighter="shiki" data-ext="r" data-title="r" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">gitlab_rails[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;backup_path&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] = </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/var/opt/gitlab/backups&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="备份文件权限" tabindex="-1"><a class="header-anchor" href="#备份文件权限"><span>备份文件权限</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gitlab_rails[</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&#39;backup_archive_permissions&#39;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0644</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="使用gitaly创建和恢复仓库的备份" tabindex="-1"><a class="header-anchor" href="#使用gitaly创建和恢复仓库的备份"><span>使用Gitaly创建和恢复仓库的备份</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>gitlab_rails[&#39;backup_gitaly_backup_path&#39;] = /opt/gitlab/embedded/bin/gitaly-backup</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="异地备份" tabindex="-1"><a class="header-anchor" href="#异地备份"><span>异地备份</span></a></h5><p>xxxx</p><h2 id="数据恢复" tabindex="-1"><a class="header-anchor" href="#数据恢复"><span>数据恢复</span></a></h2><h3 id="准备好压缩包-例如" tabindex="-1"><a class="header-anchor" href="#准备好压缩包-例如"><span>准备好压缩包，例如</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/var/opt/gitlab/backups/xxxxxxxxxxxxxxxxxxxxxxxxx-ce_gitlab_backup.tar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="暂停puma和sidekiq" tabindex="-1"><a class="header-anchor" href="#暂停puma和sidekiq"><span>暂停puma和sidekiq</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo gitlab-ctl stop puma</span></span>
<span class="line"><span>sudo gitlab-ctl stop sidekiq</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="恢复" tabindex="-1"><a class="header-anchor" href="#恢复"><span>恢复</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>gitlab-backup restore BACKUP=xxxxxxxxxxxxxxxxxxxxxxxxx-ce</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="重启服务" tabindex="-1"><a class="header-anchor" href="#重启服务"><span>重启服务</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo gitlab-ctl restart</span></span>
<span class="line"><span>sudo gitlab-ctl status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,40)]))}const p=s(l,[["render",n],["__file","Gitlab备份和恢复.html.vue"]]),k=JSON.parse('{"path":"/note-book/Gitlab/Gitlab%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D.html","title":"Gitlab备份和恢复","lang":"zh-CN","frontmatter":{"description":"Gitlab备份和恢复 配置备份 参考链接 https://docs.gitlab.com/omnibus/settings/backups.html 编辑用户根目录的 cron 表 备份etc配置文件 配置恢复 解压压缩包到gitlab目录 数据备份 参考链接 备份 GitLab 手动备份 运行命令： 自动备份 编辑crontab配置: 在配置文件中...","head":[["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/Gitlab/Gitlab%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"Gitlab备份和恢复"}],["meta",{"property":"og:description","content":"Gitlab备份和恢复 配置备份 参考链接 https://docs.gitlab.com/omnibus/settings/backups.html 编辑用户根目录的 cron 表 备份etc配置文件 配置恢复 解压压缩包到gitlab目录 数据备份 参考链接 备份 GitLab 手动备份 运行命令： 自动备份 编辑crontab配置: 在配置文件中..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-08-13T15:08:38.000Z"}],["meta",{"property":"article:modified_time","content":"2023-08-13T15:08:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Gitlab备份和恢复\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-08-13T15:08:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"PaperDragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"]]},"headers":[{"level":2,"title":"配置备份","slug":"配置备份","link":"#配置备份","children":[]},{"level":2,"title":"配置恢复","slug":"配置恢复","link":"#配置恢复","children":[]},{"level":2,"title":"数据备份","slug":"数据备份","link":"#数据备份","children":[{"level":3,"title":"手动备份","slug":"手动备份","link":"#手动备份","children":[]},{"level":3,"title":"自动备份","slug":"自动备份","link":"#自动备份","children":[]}]},{"level":2,"title":"数据恢复","slug":"数据恢复","link":"#数据恢复","children":[{"level":3,"title":"准备好压缩包，例如","slug":"准备好压缩包-例如","link":"#准备好压缩包-例如","children":[]},{"level":3,"title":"暂停puma和sidekiq","slug":"暂停puma和sidekiq","link":"#暂停puma和sidekiq","children":[]},{"level":3,"title":"恢复","slug":"恢复","link":"#恢复","children":[]},{"level":3,"title":"重启服务","slug":"重启服务","link":"#重启服务","children":[]}]}],"git":{"createdTime":1691939318000,"updatedTime":1691939318000,"contributors":[{"name":"PaperDragon","email":"2678885646@qq.com","commits":1}]},"readingTime":{"minutes":0.83,"words":249},"filePathRelative":"note-book/Gitlab/Gitlab备份和恢复.md","localizedDate":"2023年8月13日","excerpt":"\\n<h2>配置备份</h2>\\n<blockquote>\\n<p>参考链接 https://docs.gitlab.com/omnibus/settings/backups.html</p>\\n</blockquote>\\n<p>编辑用户根目录的 cron 表</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> crontab</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -e</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> -u</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> root</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{p as comp,k as data};
