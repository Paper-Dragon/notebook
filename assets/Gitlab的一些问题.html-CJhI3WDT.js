import{a as i,c as e,g as a,o as n}from"./app-C8MLRTk7.js";const t={};function l(r,s){return n(),e("div",null,[...s[0]||(s[0]=[a(`<h1 id="第一次使用gitlab登陆网页没有提示更改密码" tabindex="-1"><a class="header-anchor" href="#第一次使用gitlab登陆网页没有提示更改密码"><span>第一次使用gitlab登陆网页没有提示更改密码</span></a></h1><p>破案了,新版本从命令行看：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/gitlab/init_xxx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>以下是更改的方法：：</p><p>进入 GitLab 控制台</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">gitlab-rails</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> console</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> production</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>执行命令： user = User.where(id: 1).first，此 user 则表示 root 用户</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> User.where</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.first</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>执行命令：user.password = &#39;secret_pass’修改密码， user.password_confirmation = ‘secret_pass’ 确认密码</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">user.password</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;secret_pass’</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">user.password_confirmation = ‘secret_pass’</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>执行命令： user.save!</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">user.save!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>执行命令： exit</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">exit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="warning-redis-unable-to-open-supervise-ok-file-does-not-exist" tabindex="-1"><a class="header-anchor" href="#warning-redis-unable-to-open-supervise-ok-file-does-not-exist"><span>warning: redis: unable to open supervise/ok: file does not exist</span></a></h1><p>gitlab启动报warning: redis: unable to open supervise/ok: file does not exist；解决如下： 1、按住CTRL+C强制结束； 2、运行：sudo systemctl restart gitlab-runsvdir； 3、再次执行：sudo gitlab-ctl reconfigure</p><h1 id="gitlab执行gitlab-ctl-reconfigure-后卡在bruby-block-wait-for-logrotate-service-socket-action-run解决方案。" tabindex="-1"><a class="header-anchor" href="#gitlab执行gitlab-ctl-reconfigure-后卡在bruby-block-wait-for-logrotate-service-socket-action-run解决方案。"><span>gitlab执行gitlab-ctl reconfigure 后卡在bruby_block[wait for logrotate service socket] action run解决方案。</span></a></h1><ul><li><p>新打开一个窗口</p></li><li><p>执行systemctl restart gitlab-runsvdir命令</p></li></ul><p>解决方案: 在另外开启一个终端启动如下命令</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/gitlab/embedded/bin/runsvdir-start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者在当前的终端窗口中后台执行上述命令</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nohup</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/gitlab/embedded/bin/runsvdir-start</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后再执行</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gitlab-ctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reconfigure</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="gitlab-未启动-systemctl-start-gitlab-runsvdir-service-无反应" tabindex="-1"><a class="header-anchor" href="#gitlab-未启动-systemctl-start-gitlab-runsvdir-service-无反应"><span>GitLab 未启动 systemctl start gitlab-runsvdir.service 无反应</span></a></h1><p>重启了一台服务器，发现配置的 GitLab 没有启动。手动启动<code>sudo gitlab-ctl start</code>提示一堆<code>runsv not running</code>的信息。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo gitlab-ctl start</span></span>
<span class="line"><span>fail: alertmanager: runsv not running</span></span>
<span class="line"><span>fail: gitaly: runsv not running</span></span>
<span class="line"><span>fail: gitlab-exporter: runsv not running</span></span>
<span class="line"><span>fail: gitlab-workhorse: runsv not running</span></span>
<span class="line"><span>fail: grafana: runsv not running</span></span>
<span class="line"><span>fail: logrotate: runsv not running</span></span>
<span class="line"><span>fail: nginx: runsv not running</span></span>
<span class="line"><span>fail: node-exporter: runsv not running</span></span>
<span class="line"><span>fail: postgres-exporter: runsv not running</span></span>
<span class="line"><span>fail: postgresql: runsv not running</span></span>
<span class="line"><span>fail: prometheus: runsv not running</span></span>
<span class="line"><span>fail: puma: runsv not running</span></span>
<span class="line"><span>fail: redis: runsv not running</span></span>
<span class="line"><span>fail: redis-exporter: runsv not running</span></span>
<span class="line"><span>fail: sidekiq: runsv not running</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后手工重启<code>runsv</code>服务：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo systemctl start gitlab-runsvdir.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>结果一直停在这个地方，没有输出也不退出，感觉像在等待什么东西。在网上搜索<a href="https://clay-atlas.com/us/blog/2022/07/15/solved-gitlab-cannot-startup-and-freeze-at-systemctl-start-gitlab-runsvdir-service/" target="_blank" rel="noopener noreferrer">答案</a>之后，定位在一个叫做 plymouth-quit-wait.service 的启动服务，该服务未被正确启动，从而把别的任务都堵死了。用<code>sudo systemctl list-jobs</code>可以查看正在启动的任务：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo systemctl list-jobs</span></span>
<span class="line"><span>JOB UNIT                                 TYPE  STATE</span></span>
<span class="line"><span>232 watchdog.service                     start waiting</span></span>
<span class="line"><span>61  setvtrgb.service                     start waiting</span></span>
<span class="line"><span>2   multi-user.target                    start waiting</span></span>
<span class="line"><span>206 gitlab-runsvdir.service              start waiting</span></span>
<span class="line"><span>136 system-getty.slice                   start waiting</span></span>
<span class="line"><span>214 systemd-update-utmp-runlevel.service start waiting</span></span>
<span class="line"><span>225 ureadahead-stop.timer                start waiting</span></span>
<span class="line"><span>141 plymouth-quit-wait.service           start running</span></span>
<span class="line"><span>1   graphical.target                     start waiting</span></span>
<span class="line"><span></span></span>
<span class="line"><span>9 jobs listed.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以手工杀死这个任务：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo systemctl stop plymouth-quit-wait.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>接下来就没有正在启动的任务了：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo systemctl list-jobs</span></span>
<span class="line"><span>No jobs running.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后可以正常启动 gitlab-runsvdir.service 和 gitlab ：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>$ sudo systemctl start gitlab-runsvdir.service</span></span>
<span class="line"><span>$ sudo gitlab-ctl start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>从这个案例也可以看出，所有不能正常启动的服务，都可以到<code>systemctl list-jobs</code>这里看启动状态，查看异常任务。</p><p>现在还有最后一个问题， plymouth-quit-wait.service 是做什么用的，可以随便 stop 吗，为什么它会造成这个结果？</p><p><a href="https://askubuntu.com/questions/1119167/slow-boot-issue-due-to-plymouth-quit-wait-service-ubuntu-18-04" target="_blank" rel="noopener noreferrer">Slow boot issue due to plymouth-quit-wait.service + ubuntu 18.04</a>对作用有一些解释。但未能解释为什么 plymouth-quit-wait.service 会堵塞启动（而且 stop 之后就能跑通）。</p>`,40)])])}const p=i(t,[["render",l]]),h=JSON.parse(`{"path":"/note-book/Gitlab/Gitlab%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98.html","title":"第一次使用gitlab登陆网页没有提示更改密码","lang":"zh-CN","frontmatter":{"description":"第一次使用gitlab登陆网页没有提示更改密码 破案了,新版本从命令行看： 以下是更改的方法：： 进入 GitLab 控制台 执行命令： user = User.where(id: 1).first，此 user 则表示 root 用户 执行命令：user.password = 'secret_pass’修改密码， user.password_conf...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"第一次使用gitlab登陆网页没有提示更改密码\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-01T09:17:48.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Paper-Dragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"],["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/Gitlab/Gitlab%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"第一次使用gitlab登陆网页没有提示更改密码"}],["meta",{"property":"og:description","content":"第一次使用gitlab登陆网页没有提示更改密码 破案了,新版本从命令行看： 以下是更改的方法：： 进入 GitLab 控制台 执行命令： user = User.where(id: 1).first，此 user 则表示 root 用户 执行命令：user.password = 'secret_pass’修改密码， user.password_conf..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-01T09:17:48.000Z"}],["meta",{"property":"article:modified_time","content":"2024-11-01T09:17:48.000Z"}]]},"git":{"createdTime":1691939318000,"updatedTime":1730452668000,"contributors":[{"name":"Paper-Dragon","username":"Paper-Dragon","email":"2678885646@qq.com","commits":2,"url":"https://github.com/Paper-Dragon"},{"name":"PaperDragon-SH","username":"PaperDragon-SH","email":"2678885646@qq.com","commits":1,"url":"https://github.com/PaperDragon-SH"}],"changelog":[{"hash":"4da58de251aeb3c5bdea89f9fadbe162dc46a9ba","time":1730452668000,"email":"2678885646@qq.com","author":"PaperDragon-SH","message":"optimize"},{"hash":"a5adc200de5d1e11126b2844ab5a404726111ecb","time":1727010472000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"fixed markdown"},{"hash":"392a519398b2e846f316619fbe831e100164de7c","time":1691939318000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"Create The Worid!"}]},"readingTime":{"minutes":2.51,"words":752},"filePathRelative":"note-book/Gitlab/Gitlab的一些问题.md","excerpt":"\\n<p>破案了,新版本从命令行看：</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-bash\\"><span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">cat</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> /etc/gitlab/init_xxx</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{p as comp,h as data};
