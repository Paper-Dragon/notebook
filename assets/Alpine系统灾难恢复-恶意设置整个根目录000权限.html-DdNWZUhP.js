import{ah as n,ai as a,ar as i,am as e}from"./app-Z5zCgxXA.js";const l="/assets/image-20240525150720593-CWHPqZnM.png",p="/assets/image-20240525152119629-CWT8h6ib.png",d={};function c(r,s){return e(),a("div",null,s[0]||(s[0]=[i(`<h1 id="alpine的apk数据库解释" tabindex="-1"><a class="header-anchor" href="#alpine的apk数据库解释"><span>Alpine的apk数据库解释</span></a></h1><blockquote><p>apk对于已安装文件用于跟踪已安装的软件包以及这些软件包对系统所做的修改。</p><p>该文件位于/lib/apk/db/installed</p></blockquote><h2 id="文件示例" tabindex="-1"><a class="header-anchor" href="#文件示例"><span>文件示例</span></a></h2><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>localhost:/lib/apk/db# head -50 installed</span></span>
<span class="line"><span>C:Q1uFrSebP91NTnM7BIHm3YcRY7ih0=</span></span>
<span class="line"><span>P:alpine-base</span></span>
<span class="line"><span>V:3.20.0-r0</span></span>
<span class="line"><span>A:x86_64</span></span>
<span class="line"><span>S:1492</span></span>
<span class="line"><span>I:4096</span></span>
<span class="line"><span>T:Meta package for minimal alpine base</span></span>
<span class="line"><span>U:https://alpinelinux.org</span></span>
<span class="line"><span>L:MIT</span></span>
<span class="line"><span>o:alpine-base</span></span>
<span class="line"><span>m:Natanael Copa &lt;ncopa@alpinelinux.org&gt;</span></span>
<span class="line"><span>t:1716371157</span></span>
<span class="line"><span>c:1402388a3a746e9961791846350e35f1d4d4618d</span></span>
<span class="line"><span>D:alpine-baselayout alpine-conf alpine-release apk-tools busybox busybox-mdev-openrc busybox-openrc busybox-suid musl-utils openrc</span></span>
<span class="line"><span></span></span>
<span class="line"><span>C:Q1qKcZ+j23xssAXmgQhkOO8dHnbWw=</span></span>
<span class="line"><span>P:alpine-baselayout</span></span>
<span class="line"><span>V:3.6.5-r0</span></span>
<span class="line"><span>A:x86_64</span></span>
<span class="line"><span>S:8515</span></span>
<span class="line"><span>I:315392</span></span>
<span class="line"><span>T:Alpine base dir structure and init scripts</span></span>
<span class="line"><span>U:https://git.alpinelinux.org/cgit/aports/tree/main/alpine-baselayout</span></span>
<span class="line"><span>L:GPL-2.0-only</span></span>
<span class="line"><span>o:alpine-baselayout</span></span>
<span class="line"><span>m:Natanael Copa &lt;ncopa@alpinelinux.org&gt;</span></span>
<span class="line"><span>t:1714981135</span></span>
<span class="line"><span>c:66187892e05b03a41d08e9acabd19b7576a1c875</span></span>
<span class="line"><span>D:alpine-baselayout-data=3.6.5-r0 /bin/sh</span></span>
<span class="line"><span>r:alpine-baselayout</span></span>
<span class="line"><span>q:1000</span></span>
<span class="line"><span>F:dev</span></span>
<span class="line"><span>F:dev/pts</span></span>
<span class="line"><span>F:dev/shm</span></span>
<span class="line"><span>F:etc</span></span>
<span class="line"><span>R:motd</span></span>
<span class="line"><span>Z:Q1SLkS9hBidUbPwwrw+XR0Whv3ww8=</span></span>
<span class="line"><span>F:etc/crontabs</span></span>
<span class="line"><span>R:root</span></span>
<span class="line"><span>a:0:0:600</span></span>
<span class="line"><span>Z:Q1vfk1apUWI4yLJGhhNRd0kJixfvY=</span></span>
<span class="line"><span>F:etc/modprobe.d</span></span>
<span class="line"><span>R:aliases.conf</span></span>
<span class="line"><span>Z:Q1WUbh6TBYNVK7e4Y+uUvLs/7viqk=</span></span>
<span class="line"><span>R:blacklist.conf</span></span>
<span class="line"><span>Z:Q14TdgFHkTdt3uQC+NBtrntOnm9n4=</span></span>
<span class="line"><span>R:i386.conf</span></span>
<span class="line"><span>Z:Q1pnay/njn6ol9cCssL7KiZZ8etlc=</span></span>
<span class="line"><span>R:kms.conf</span></span>
<span class="line"><span>Z:Q1ynbLn3GYDpvajba/ldp1niayeog=</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>目录结构</p><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>localhost:/lib/apk/db# ls -lh</span></span>
<span class="line"><span>total 504K</span></span>
<span class="line"><span>-rw-r--r--    1 root     root      467.9K May 25 14:51 installed</span></span>
<span class="line"><span>-rw-------    1 root     root           0 May 25 13:35 lock</span></span>
<span class="line"><span>-rw-r--r--    1 root     root       30.0K May 25 14:51 scripts.tar</span></span>
<span class="line"><span>-rw-r--r--    1 root     root         438 May 25 14:51 triggers</span></span>
<span class="line"><span>localhost:/lib/apk/db# tree .</span></span>
<span class="line"><span>.</span></span>
<span class="line"><span>├── installed</span></span>
<span class="line"><span>├── lock</span></span>
<span class="line"><span>├── scripts.tar</span></span>
<span class="line"><span>└── triggers</span></span>
<span class="line"><span></span></span>
<span class="line"><span>0 directories, 4 files</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="解释说明" tabindex="-1"><a class="header-anchor" href="#解释说明"><span>解释说明</span></a></h2><blockquote><p>在源码中的定义</p><p>https://gitlab.alpinelinux.org/alpine/apk-tools/-/blob/ff7c8f6ee9dfa2add57b88dc271f6711030e72a0/src/database.c#L937</p></blockquote><ul><li>r: - 替换此软件包的软件包，以空格分隔的列表</li><li>q: - 替换优先级，整数，可选</li><li>s: - 存储库标签，可选，如果软件包已标记到世界文件中的存储库，则会设置此字段（例如：linux@testing）</li><li>f: - 指示损坏项，以空格分隔（f=文件，s=脚本，x=扩展属性，S=文件哈希）</li></ul><p>以下字段重复出现，并且在组中包含对系统所做的一组更改。</p><p>ACL行被指定为uid、冒号、gid、冒号和模式。</p><ul><li>F: - 软件包创建的目录名称，重复</li><li>M: - 目录ACL，仅当与默认值0:0:0755不同时</li><li>R: - 文件名，相对于前面的目录名称</li><li>a: - 文件ACL</li><li>Z: - 文件校验和，如果软件包中的校验和不是none，则Q1前缀表示这将是以base64格式的SHA1哈希</li></ul><p>更清晰的格式</p><p><img src="`+l+'" alt="image-20240525150720593"></p><p><img src="'+p+'" alt="image-20240525152119629"></p><p>在某个目录下的某个文件应该具有a开头的权限。</p><h2 id="用途" tabindex="-1"><a class="header-anchor" href="#用途"><span>用途</span></a></h2><p>如果是被恶意执行了下面的命令可以提取这个数据库文件进行恢复。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>使用liveos引导进入临时系统</li><li>挂载root目录</li><li>设置整个root目录777的权限，把问题转化为从000权限到恢复777权限</li><li>chroot进入系统</li><li>书写脚本，功能是提取apk数据库并且设置权限，这里权限恢复了90%</li><li>设置特殊权限的文件 <code>apk audit</code>里面的文件，手动设置正确权限</li><li>重启后系统即可正常工作</li></ul>',20)]))}const v=n(d,[["render",c]]),o=JSON.parse('{"path":"/note-book/OperaSystems/Alpine/Alpine%E7%B3%BB%E7%BB%9F%E7%81%BE%E9%9A%BE%E6%81%A2%E5%A4%8D-%E6%81%B6%E6%84%8F%E8%AE%BE%E7%BD%AE%E6%95%B4%E4%B8%AA%E6%A0%B9%E7%9B%AE%E5%BD%95000%E6%9D%83%E9%99%90.html","title":"Alpine的apk数据库解释","lang":"zh-CN","frontmatter":{"description":"Alpine的apk数据库解释 apk对于已安装文件用于跟踪已安装的软件包以及这些软件包对系统所做的修改。 该文件位于/lib/apk/db/installed 文件示例 目录结构 解释说明 在源码中的定义 https://gitlab.alpinelinux.org/alpine/apk-tools/-/blob/ff7c8f6ee9dfa2add5...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Alpine的apk数据库解释\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-25T07:27:46.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Paper-Dragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"],["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/OperaSystems/Alpine/Alpine%E7%B3%BB%E7%BB%9F%E7%81%BE%E9%9A%BE%E6%81%A2%E5%A4%8D-%E6%81%B6%E6%84%8F%E8%AE%BE%E7%BD%AE%E6%95%B4%E4%B8%AA%E6%A0%B9%E7%9B%AE%E5%BD%95000%E6%9D%83%E9%99%90.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"Alpine的apk数据库解释"}],["meta",{"property":"og:description","content":"Alpine的apk数据库解释 apk对于已安装文件用于跟踪已安装的软件包以及这些软件包对系统所做的修改。 该文件位于/lib/apk/db/installed 文件示例 目录结构 解释说明 在源码中的定义 https://gitlab.alpinelinux.org/alpine/apk-tools/-/blob/ff7c8f6ee9dfa2add5..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-25T07:27:46.000Z"}],["meta",{"property":"article:modified_time","content":"2024-05-25T07:27:46.000Z"}]]},"git":{"createdTime":1716622066000,"updatedTime":1716622066000,"contributors":[{"name":"Paper-Dragon","username":"Paper-Dragon","email":"2678885646@qq.com","commits":1,"url":"https://github.com/Paper-Dragon"}],"changelog":[{"hash":"8e5606ed046b96800aa24583495371d165d6fac9","time":1716622066000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"Alpine系统灾难恢复-恶意设置整个根目录000权限.md"}]},"readingTime":{"minutes":2.44,"words":732},"filePathRelative":"note-book/OperaSystems/Alpine/Alpine系统灾难恢复-恶意设置整个根目录000权限.md","excerpt":"\\n<blockquote>\\n<p>apk对于已安装文件用于跟踪已安装的软件包以及这些软件包对系统所做的修改。</p>\\n<p>该文件位于/lib/apk/db/installed</p>\\n</blockquote>\\n<h2>文件示例</h2>\\n<div class=\\"language-txt line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"txt\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>localhost:/lib/apk/db# head -50 installed</span></span>\\n<span class=\\"line\\"><span>C:Q1uFrSebP91NTnM7BIHm3YcRY7ih0=</span></span>\\n<span class=\\"line\\"><span>P:alpine-base</span></span>\\n<span class=\\"line\\"><span>V:3.20.0-r0</span></span>\\n<span class=\\"line\\"><span>A:x86_64</span></span>\\n<span class=\\"line\\"><span>S:1492</span></span>\\n<span class=\\"line\\"><span>I:4096</span></span>\\n<span class=\\"line\\"><span>T:Meta package for minimal alpine base</span></span>\\n<span class=\\"line\\"><span>U:https://alpinelinux.org</span></span>\\n<span class=\\"line\\"><span>L:MIT</span></span>\\n<span class=\\"line\\"><span>o:alpine-base</span></span>\\n<span class=\\"line\\"><span>m:Natanael Copa &lt;ncopa@alpinelinux.org&gt;</span></span>\\n<span class=\\"line\\"><span>t:1716371157</span></span>\\n<span class=\\"line\\"><span>c:1402388a3a746e9961791846350e35f1d4d4618d</span></span>\\n<span class=\\"line\\"><span>D:alpine-baselayout alpine-conf alpine-release apk-tools busybox busybox-mdev-openrc busybox-openrc busybox-suid musl-utils openrc</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>C:Q1qKcZ+j23xssAXmgQhkOO8dHnbWw=</span></span>\\n<span class=\\"line\\"><span>P:alpine-baselayout</span></span>\\n<span class=\\"line\\"><span>V:3.6.5-r0</span></span>\\n<span class=\\"line\\"><span>A:x86_64</span></span>\\n<span class=\\"line\\"><span>S:8515</span></span>\\n<span class=\\"line\\"><span>I:315392</span></span>\\n<span class=\\"line\\"><span>T:Alpine base dir structure and init scripts</span></span>\\n<span class=\\"line\\"><span>U:https://git.alpinelinux.org/cgit/aports/tree/main/alpine-baselayout</span></span>\\n<span class=\\"line\\"><span>L:GPL-2.0-only</span></span>\\n<span class=\\"line\\"><span>o:alpine-baselayout</span></span>\\n<span class=\\"line\\"><span>m:Natanael Copa &lt;ncopa@alpinelinux.org&gt;</span></span>\\n<span class=\\"line\\"><span>t:1714981135</span></span>\\n<span class=\\"line\\"><span>c:66187892e05b03a41d08e9acabd19b7576a1c875</span></span>\\n<span class=\\"line\\"><span>D:alpine-baselayout-data=3.6.5-r0 /bin/sh</span></span>\\n<span class=\\"line\\"><span>r:alpine-baselayout</span></span>\\n<span class=\\"line\\"><span>q:1000</span></span>\\n<span class=\\"line\\"><span>F:dev</span></span>\\n<span class=\\"line\\"><span>F:dev/pts</span></span>\\n<span class=\\"line\\"><span>F:dev/shm</span></span>\\n<span class=\\"line\\"><span>F:etc</span></span>\\n<span class=\\"line\\"><span>R:motd</span></span>\\n<span class=\\"line\\"><span>Z:Q1SLkS9hBidUbPwwrw+XR0Whv3ww8=</span></span>\\n<span class=\\"line\\"><span>F:etc/crontabs</span></span>\\n<span class=\\"line\\"><span>R:root</span></span>\\n<span class=\\"line\\"><span>a:0:0:600</span></span>\\n<span class=\\"line\\"><span>Z:Q1vfk1apUWI4yLJGhhNRd0kJixfvY=</span></span>\\n<span class=\\"line\\"><span>F:etc/modprobe.d</span></span>\\n<span class=\\"line\\"><span>R:aliases.conf</span></span>\\n<span class=\\"line\\"><span>Z:Q1WUbh6TBYNVK7e4Y+uUvLs/7viqk=</span></span>\\n<span class=\\"line\\"><span>R:blacklist.conf</span></span>\\n<span class=\\"line\\"><span>Z:Q14TdgFHkTdt3uQC+NBtrntOnm9n4=</span></span>\\n<span class=\\"line\\"><span>R:i386.conf</span></span>\\n<span class=\\"line\\"><span>Z:Q1pnay/njn6ol9cCssL7KiZZ8etlc=</span></span>\\n<span class=\\"line\\"><span>R:kms.conf</span></span>\\n<span class=\\"line\\"><span>Z:Q1ynbLn3GYDpvajba/ldp1niayeog=</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{v as comp,o as data};
