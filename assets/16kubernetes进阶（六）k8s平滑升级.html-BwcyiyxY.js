import{a as s,c as n,g as i,o as a}from"./app-BnyB4w0Z.js";const r="/assets/1034759-20191128181938447-420585628-16918406289031-CQfLJTjC.png",t="/assets/1034759-20191128181520668-1713984935-16918406309003-B14f-_Ce.png",l="/assets/1034759-20191128182818349-1528346077-16918406327685-CFGdrkyV.png",p="/assets/1034759-20191128183109611-326242097-16918406347237-DWqR_c6r.png",d="/assets/1034759-20191128183955698-809875028-16918406363549-e9LyWtA1.png",c="/assets/1034759-20191128184043612-695283976-169184063867511-DWUCuAe6.png",o={};function h(g,e){return a(),n("div",null,[...e[0]||(e[0]=[i('<h1 id="kubernetes进阶-六-k8s平滑升级" tabindex="-1"><a class="header-anchor" href="#kubernetes进阶-六-k8s平滑升级"><span>kubernetes进阶（六）k8s平滑升级</span></a></h1><p>当我们遇到K8S有漏洞的时候，或者为了满足需求，有时候可能会需要升级或者降级版本，</p><p>为了减少对业务的影响，尽量选择在业务低谷的时候来升级：</p><p>首先准备好文件：我这里选择的是内网文件服务器上下载的，请自行下载所需的k8s源文件：3</p><p>这里演示更换一个节点：7-21</p><p>查看版本：将7-21更换成1.15.2</p><p><img src="'+r+`" alt="img"></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># cd /opt/src</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># wget http://192.168.1.60:8080/day1/kubernetes-server-linux-amd64-v1.15.2.tar.gz</span></span>
<span class="line"><span># tar -zxf kubernetes-server-linux-amd64-v1.15.2.tar.gz</span></span>
<span class="line"><span># cd .. </span></span>
<span class="line"><span># cp -r kubernetes /opt/kubernetes-v1.15.2</span></span>
<span class="line"><span># cd kubernetes-v1.15.2/</span></span>
<span class="line"><span># rm -rf kubernetes-src.tar.gz</span></span>
<span class="line"><span># cd server/bin/ </span></span>
<span class="line"><span># rm -rf *.tar</span></span>
<span class="line"><span># rm -rf *tag</span></span>
<span class="line"><span># mkdir cert conf</span></span>
<span class="line"><span># cp /opt/kubernetes-v1.15.4/server/bin/cert/* ./cert/</span></span>
<span class="line"><span># cp /opt/kubernetes-v1.15.4/server/bin/conf/* ./conf/</span></span>
<span class="line"><span># cp /opt/kubernetes-v1.15.4/server/bin/*.sh /opt/kubernetes-v1.15.2/server/bin/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在nginx上摘除api-server的四层负载：7-11，7-12</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># vi /etc/nginx/nginx.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>把我们要升级的apiserver节点注释掉：</p><p><img src="`+t+`" alt="img"></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># nginx -t</span></span>
<span class="line"><span># nginx -s reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>准备好后，摘除node，先看下哪个node上跑的pod少：我们这里一样多，那我们就搞7-21，</p><p><img src="`+l+'" alt="img"></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># kubectl delete node hdss7-21.host.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+p+`" alt="img"></p><p>我们的coredns已经从node7-21迁移到了7-22上，接下来我们更换软连接：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># rm -rf kubernetes</span></span>
<span class="line"><span># ln -s /opt/kubernetes-v1.15.2 /opt/kubernetes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后重启使用supervisor重启服务：生产上记得一个一个重启，我们这里为了方便，直接重启所有：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span># supervisorctl restart all</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+d+'" alt="img"></p><p>启动成功后，查看版本：</p><p><img src="'+c+'" alt="img"></p><p>可以看到node版本已经从1.15.4变更为了1.15.2，并且kubelet已经自动帮我们把节点加入到了集群，然后打开nginx负载，即可。</p>',26)])])}const k=s(o,[["render",h]]),u=JSON.parse('{"path":"/note-book/Kubernetes/16kubernetes%E8%BF%9B%E9%98%B6%EF%BC%88%E5%85%AD%EF%BC%89k8s%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7.html","title":"kubernetes进阶（六）k8s平滑升级","lang":"zh-CN","frontmatter":{"description":"kubernetes进阶（六）k8s平滑升级 当我们遇到K8S有漏洞的时候，或者为了满足需求，有时候可能会需要升级或者降级版本， 为了减少对业务的影响，尽量选择在业务低谷的时候来升级： 首先准备好文件：我这里选择的是内网文件服务器上下载的，请自行下载所需的k8s源文件：3 这里演示更换一个节点：7-21 查看版本：将7-21更换成1.15.2 img ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"kubernetes进阶（六）k8s平滑升级\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2026-01-29T05:47:01.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Paper-Dragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"],["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/Kubernetes/16kubernetes%E8%BF%9B%E9%98%B6%EF%BC%88%E5%85%AD%EF%BC%89k8s%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"kubernetes进阶（六）k8s平滑升级"}],["meta",{"property":"og:description","content":"kubernetes进阶（六）k8s平滑升级 当我们遇到K8S有漏洞的时候，或者为了满足需求，有时候可能会需要升级或者降级版本， 为了减少对业务的影响，尽量选择在业务低谷的时候来升级： 首先准备好文件：我这里选择的是内网文件服务器上下载的，请自行下载所需的k8s源文件：3 这里演示更换一个节点：7-21 查看版本：将7-21更换成1.15.2 img ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-01-29T05:47:01.000Z"}],["meta",{"property":"article:modified_time","content":"2026-01-29T05:47:01.000Z"}]]},"git":{"createdTime":1769665621000,"updatedTime":1769665621000,"contributors":[{"name":"Paper-Dragon","username":"Paper-Dragon","email":"2678885646@qq.com","commits":1,"url":"https://github.com/Paper-Dragon"}],"changelog":[{"hash":"a829cd938cdf675cffedf6e9971e16de5125d01d","time":1769665621000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"chore: linearize history — single root commit"}]},"readingTime":{"minutes":1.57,"words":472},"filePathRelative":"note-book/Kubernetes/16kubernetes进阶（六）k8s平滑升级.md","excerpt":"\\n<p>当我们遇到K8S有漏洞的时候，或者为了满足需求，有时候可能会需要升级或者降级版本，</p>\\n<p>为了减少对业务的影响，尽量选择在业务低谷的时候来升级：</p>\\n<p>首先准备好文件：我这里选择的是内网文件服务器上下载的，请自行下载所需的k8s源文件：3</p>\\n<p>这里演示更换一个节点：7-21</p>\\n<p>查看版本：将7-21更换成1.15.2</p>\\n<p></p>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-\\"><span class=\\"line\\"><span># cd /opt/src</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{k as comp,u as data};
