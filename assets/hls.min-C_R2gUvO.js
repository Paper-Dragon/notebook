import{g as gd}from"./commonjsHelpers-CqkleIqs.js";function vd(tr,ai){for(var er=0;er<ai.length;er++){const Ae=ai[er];if(typeof Ae!="string"&&!Array.isArray(Ae)){for(const Le in Ae)if(Le!=="default"&&!(Le in tr)){const Ue=Object.getOwnPropertyDescriptor(Ae,Le);Ue&&Object.defineProperty(tr,Le,Ue.get?Ue:{enumerable:!0,get:()=>Ae[Le]})}}}return Object.freeze(Object.defineProperty(tr,Symbol.toStringTag,{value:"Module"}))}var Rn={exports:{}},bo;function md(){return bo||(bo=1,(function(tr,ai){(function er(Ae){var Le;Le=function(){function Ue(a,s){for(var r=0;r<s.length;r++){var t=s[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,Dn(t.key),t)}}function yt(a,s,r){return s&&Ue(a.prototype,s),r&&Ue(a,r),Object.defineProperty(a,"prototype",{writable:!1}),a}function _o(a,s,r){return(s=Dn(s))in a?Object.defineProperty(a,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[s]=r,a}function mt(){return mt=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var t in r)({}).hasOwnProperty.call(r,t)&&(a[t]=r[t])}return a},mt.apply(null,arguments)}function si(a){return si=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},si(a)}function ut(a,s){a.prototype=Object.create(s.prototype),a.prototype.constructor=a,rr(a,s)}function kn(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(kn=function(){return!!a})()}function bn(a,s){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);s&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.push.apply(r,t)}return r}function ft(a){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?bn(Object(r),!0).forEach((function(t){_o(a,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):bn(Object(r)).forEach((function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(r,t))}))}return a}function rr(a,s){return rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,t){return r.__proto__=t,r},rr(a,s)}function Dn(a){var s=(function(r,t){if(typeof r!="object"||!r)return r;var e=r[Symbol.toPrimitive];if(e!==void 0){var i=e.call(r,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)})(a,"string");return typeof s=="symbol"?s:s+""}function Be(a){var s=typeof Map=="function"?new Map:void 0;return Be=function(r){if(r===null||!(function(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}})(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(r))return s.get(r);s.set(r,t)}function t(){return(function(e,i,n){if(kn())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,i);var l=new(e.bind.apply(e,o));return n&&rr(l,n.prototype),l})(r,arguments,si(this).constructor)}return t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),rr(t,r)},Be(a)}function Po(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var _n,Pn,Cn={exports:{}},Co=(_n||(_n=1,(function(a){var s=Object.prototype.hasOwnProperty,r="~";function t(){}function e(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function i(l,u,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var c=new e(d,h||l,f),g=r?r+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],c]:l._events[g].push(c):(l._events[g]=c,l._eventsCount++),l}function n(l,u){--l._eventsCount==0?l._events=new t:delete l._events[u]}function o(){this._events=new t,this._eventsCount=0}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(r=!1)),o.prototype.eventNames=function(){var l,u,d=[];if(this._eventsCount===0)return d;for(u in l=this._events)s.call(l,u)&&d.push(r?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(l)):d},o.prototype.listeners=function(l){var u=r?r+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,c=new Array(f);h<f;h++)c[h]=d[h].fn;return c},o.prototype.listenerCount=function(l){var u=r?r+l:l,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,u,d,h,f,c){var g=r?r+l:l;if(!this._events[g])return!1;var v,m,p=this._events[g],E=arguments.length;if(p.fn){switch(p.once&&this.removeListener(l,p.fn,void 0,!0),E){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,u),!0;case 3:return p.fn.call(p.context,u,d),!0;case 4:return p.fn.call(p.context,u,d,h),!0;case 5:return p.fn.call(p.context,u,d,h,f),!0;case 6:return p.fn.call(p.context,u,d,h,f,c),!0}for(m=1,v=new Array(E-1);m<E;m++)v[m-1]=arguments[m];p.fn.apply(p.context,v)}else{var T,S=p.length;for(m=0;m<S;m++)switch(p[m].once&&this.removeListener(l,p[m].fn,void 0,!0),E){case 1:p[m].fn.call(p[m].context);break;case 2:p[m].fn.call(p[m].context,u);break;case 3:p[m].fn.call(p[m].context,u,d);break;case 4:p[m].fn.call(p[m].context,u,d,h);break;default:if(!v)for(T=1,v=new Array(E-1);T<E;T++)v[T-1]=arguments[T];p[m].fn.apply(p[m].context,v)}}return!0},o.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},o.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},o.prototype.removeListener=function(l,u,d,h){var f=r?r+l:l;if(!this._events[f])return this;if(!u)return n(this,f),this;var c=this._events[f];if(c.fn)c.fn!==u||h&&!c.once||d&&c.context!==d||n(this,f);else{for(var g=0,v=[],m=c.length;g<m;g++)(c[g].fn!==u||h&&!c[g].once||d&&c[g].context!==d)&&v.push(c[g]);v.length?this._events[f]=v.length===1?v[0]:v:n(this,f)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=r?r+l:l,this._events[u]&&n(this,u)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,a.exports=o})(Cn)),Cn.exports),yr=Po(Co),wn={exports:{}},oi=(Pn||(Pn=1,(function(a,s){var r,t,e,i,n;r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,e=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n={buildAbsoluteURL:function(o,l,u){if(u=u||{},o=o.trim(),!(l=l.trim())){if(!u.alwaysNormalize)return o;var d=n.parseURL(o);if(!d)throw new Error("Error trying to parse base URL.");return d.path=n.normalizePath(d.path),n.buildURLFromParts(d)}var h=n.parseURL(l);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=n.normalizePath(h.path),n.buildURLFromParts(h)):l;var f=n.parseURL(o);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var c=t.exec(f.path);f.netLoc=c[1],f.path=c[2]}f.netLoc&&!f.path&&(f.path="/");var g={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=f.netLoc,h.path[0]!=="/"))if(h.path){var v=f.path,m=v.substring(0,v.lastIndexOf("/")+1)+h.path;g.path=n.normalizePath(m)}else g.path=f.path,h.params||(g.params=f.params,h.query||(g.query=f.query));return g.path===null&&(g.path=u.alwaysNormalize?n.normalizePath(h.path):h.path),n.buildURLFromParts(g)},parseURL:function(o){var l=r.exec(o);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(e,"");o.length!==(o=o.replace(i,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}},a.exports=n})(wn)),wn.exports),B=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},wo=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=Oo},Oo=Number.MAX_SAFE_INTEGER||9007199254740991,K=(function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a})({}),_=(function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",a.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",a.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.ASSET_LIST_LOAD_ERROR="assetListLoadError",a.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",a.ASSET_LIST_PARSING_ERROR="assetListParsingError",a.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.ATTACH_MEDIA_ERROR="attachMediaError",a.UNKNOWN="unknown",a})({}),y=(function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.MEDIA_ENDED="hlsMediaEnded",a.STALL_RESOLVED="hlsStallResolved",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFERED_TO_END="hlsBufferedToEnd",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a.ASSET_LIST_LOADING="hlsAssetListLoading",a.ASSET_LIST_LOADED="hlsAssetListLoaded",a.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",a.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",a.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",a.INTERSTITIAL_STARTED="hlsInterstitialStarted",a.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",a.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",a.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",a.INTERSTITIAL_ENDED="hlsInterstitialEnded",a.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",a.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",a.EVENT_CUE_ENTER="hlsEventCueEnter",a})({}),Ie="manifest",me="level",ne="audioTrack",oe="subtitleTrack",Z="main",Kt="audio",te="subtitle",Ge=(function(){function a(r,t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=r,this.alpha_=r?Math.exp(Math.log(.5)/r):0,this.estimate_=t,this.totalWeight_=e}var s=a.prototype;return s.sample=function(r,t){var e=Math.pow(this.alpha_,r);this.estimate_=t*(1-e)+e*this.estimate_,this.totalWeight_+=r},s.getTotalWeight=function(){return this.totalWeight_},s.getEstimate=function(){if(this.alpha_){var r=1-Math.pow(this.alpha_,this.totalWeight_);if(r)return this.estimate_/r}return this.estimate_},a})(),xo=(function(){function a(r,t,e,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ge(r),this.fast_=new Ge(t),this.defaultTTFB_=i,this.ttfb_=new Ge(r)}var s=a.prototype;return s.update=function(r,t){var e=this.slow_,i=this.fast_,n=this.ttfb_;e.halfLife!==r&&(this.slow_=new Ge(r,e.getEstimate(),e.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Ge(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==r&&(this.ttfb_=new Ge(r,n.getEstimate(),n.getTotalWeight()))},s.sample=function(r,t){var e=(r=Math.max(r,this.minDelayMs_))/1e3,i=8*t/e;this.fast_.sample(e,i),this.slow_.sample(e,i)},s.sampleTTFB=function(r){var t=r/1e3,e=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(e,Math.max(r,5))},s.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},s.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},s.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},s.destroy=function(){},yt(a,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])})(),ee=function(a,s){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var r="["+a+"]:";this.trace=Re,this.debug=s.debug.bind(null,r),this.log=s.log.bind(null,r),this.warn=s.warn.bind(null,r),this.info=s.info.bind(null,r),this.error=s.error.bind(null,r)},Re=function(){},Mo={trace:Re,debug:Re,log:Re,warn:Re,info:Re,error:Re};function li(){return mt({},Mo)}function On(a,s,r){return s[a]?s[a].bind(s):(function(t,e){var i=self.console[t];return i?i.bind(self.console,(e?"["+e+"] ":"")+"["+t+"] >"):Re})(a,r)}var ui=li();function xn(a,s,r){var t=li();if(typeof console=="object"&&a===!0||typeof a=="object"){var e=["debug","log","info","warn","error"];e.forEach((function(i){t[i]=On(i,a,r)}));try{t.log('Debug logs enabled for "'+s+'" in hls.js version 1.6.12')}catch{return li()}e.forEach((function(i){ui[i]=On(i,a)}))}else mt(ui,t);return t}var ct=ui;function ke(a){if(a===void 0&&(a=!0),typeof self<"u")return(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Mn(a,s){var r=Object.keys(a),t=Object.keys(s),e=r.length,i=t.length;return!e||!i||e===i&&!r.some((function(n){return t.indexOf(n)===-1}))}function Xt(a,s){if(s===void 0&&(s=!1),typeof TextDecoder<"u"){var r=new TextDecoder("utf-8").decode(a);if(s){var t=r.indexOf("\0");return t!==-1?r.substring(0,t):r}return r.replace(/\0/g,"")}for(var e,i,n,o=a.length,l="",u=0;u<o;){if((e=a[u++])===0&&s)return l;if(e!==0&&e!==3)switch(e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(e);break;case 12:case 13:i=a[u++],l+=String.fromCharCode((31&e)<<6|63&i);break;case 14:i=a[u++],n=a[u++],l+=String.fromCharCode((15&e)<<12|(63&i)<<6|(63&n)<<0)}}return l}function Vt(a){for(var s="",r=0;r<a.length;r++){var t=a[r].toString(16);t.length<2&&(t="0"+t),s+=t}return s}function Fn(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var di=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},zt="audio",ae="video",hi="audiovideo",Nn=(function(){function a(r){var t,e,i;this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof r=="string"&&(r={url:r}),this.base=r,(i=Un(t=this,e="stats"))&&(i.enumerable=!0,Object.defineProperty(t,e,i))}var s=a.prototype;return s.setByteRange=function(r,t){var e,i=r.split("@",2);e=i.length===1?t?.byteRangeEndOffset||0:parseInt(i[1]),this._byteRange=[e,parseInt(i[0])+e]},s.clearElementaryStreamInfo=function(){var r=this.elementaryStreams;r[zt]=null,r[ae]=null,r[hi]=null},yt(a,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){var r;return this._streams===null&&(this._streams=((r={})[zt]=null,r[ae]=null,r[hi]=null,r)),this._streams},set:function(r){this._streams=r}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new di),this._stats},set:function(r){this._stats=r}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=oi.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}])})();function wt(a){return a.sn!=="initSegment"}var fi=(function(a){function s(t,e){var i;return(i=a.call(this,e)||this)._decryptdata=null,i._programDateTime=null,i._ref=null,i._bitrate=void 0,i.rawProgramDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.playlistOffset=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.urlId=0,i.type=t,i}ut(s,a);var r=s.prototype;return r.addStart=function(t){this.setStart(this.start+t)},r.setStart=function(t){this.start=t,this._ref&&(this._ref.start=t)},r.setDuration=function(t){this.duration=t,this._ref&&(this._ref.duration=t)},r.setKeyFormat=function(t){if(this.levelkeys){var e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}},r.abortRequests=function(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()},r.setElementaryStreamInfo=function(t,e,i,n,o,l){l===void 0&&(l=!1);var u=this.elementaryStreams,d=u[t];d?(d.startPTS=Math.min(d.startPTS,e),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,n),d.endDTS=Math.max(d.endDTS,o)):u[t]={startPTS:e,endPTS:i,startDTS:n,endDTS:o,partial:l}},yt(s,[{key:"byteLength",get:function(){if(this.hasStats){var t=this.stats.total;if(t)return t}if(this.byteRange.length){var e=this.byteRange[0],i=this.byteRange[1];if(B(e)&&B(i))return i-e}return null}},{key:"bitrate",get:function(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null},set:function(t){this._bitrate=t}},{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var e=Object.keys(this.levelkeys);if(e.length===1){var i=this._decryptdata=this.levelkeys[e[0]]||null;if(i)return i.getDecryptData(this.sn)}}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var t=B(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var e,i=Object.keys(this.levelkeys),n=i.length;if(n>1||n===1&&(e=this.levelkeys[i[0]])!=null&&e.encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(t){B(t)?this._programDateTime=t:this._programDateTime=this.rawProgramDateTime=null}},{key:"ref",get:function(){return wt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])})(Nn),Fo=(function(a){function s(r,t,e,i,n){var o;(o=a.call(this,e)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.duration=r.decimalFloatingPoint("DURATION"),o.gap=r.bool("GAP"),o.independent=r.bool("INDEPENDENT"),o.relurl=r.enumeratedString("URI"),o.fragment=t,o.index=i;var l=r.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,n),n&&(o.fragOffset=n.fragOffset+n.duration),o}return ut(s,a),yt(s,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}])})(Nn);function Un(a,s){var r=Object.getPrototypeOf(a);if(r){var t=Object.getOwnPropertyDescriptor(r,s);return t||Un(r,s)}}var Bn=Math.pow(2,32)-1,No=[].push,Gn={video:1,audio:2,id3:3,text:4};function Mt(a){return String.fromCharCode.apply(null,a)}function Kn(a,s){var r=a[s]<<8|a[s+1];return r<0?65536+r:r}function z(a,s){var r=Hn(a,s);return r<0?4294967296+r:r}function Vn(a,s){var r=z(a,s);return r*=Math.pow(2,32),r+=z(a,s+4)}function Hn(a,s){return a[s]<<24|a[s+1]<<16|a[s+2]<<8|a[s+3]}function J(a,s){var r=[];if(!s.length)return r;for(var t=a.byteLength,e=0;e<t;){var i=z(a,e),n=i>1?e+i:t;if(Mt(a.subarray(e+4,e+8))===s[0])if(s.length===1)r.push(a.subarray(e+8,n));else{var o=J(a.subarray(e+8,n),s.slice(1));o.length&&No.apply(r,o)}e=n}return r}function Uo(a){var s=[],r=a[0],t=8,e=z(a,t);t+=4;var i=0,n=0;r===0?(i=z(a,t),n=z(a,t+4),t+=8):(i=Vn(a,t),n=Vn(a,t+8),t+=16),t+=2;var o=a.length+n,l=Kn(a,t);t+=2;for(var u=0;u<l;u++){var d=t,h=z(a,d);d+=4;var f=2147483647&h;if((2147483648&h)>>>31==1)return ct.warn("SIDX has hierarchical references (not supported)"),null;var c=z(a,d);d+=4,s.push({referenceSize:f,subsegmentDuration:c,info:{duration:c/e,start:o,end:o+f-1}}),o+=f,t=d+=4}return{earliestPresentationTime:i,timescale:e,version:r,referencesCount:l,references:s}}function Yn(a){for(var s=[],r=J(a,["moov","trak"]),t=0;t<r.length;t++){var e=r[t],i=J(e,["tkhd"])[0];if(i){var n=i[0],o=z(i,n===0?12:20),l=J(e,["mdia","mdhd"])[0];if(l){var u=z(l,(n=l[0])===0?12:20),d=J(e,["mdia","hdlr"])[0];if(d){var h=Mt(d.subarray(8,12)),f={soun:zt,vide:ae}[h],c=Bo(J(e,["mdia","minf","stbl","stsd"])[0]);f?(s[o]={timescale:u,type:f,stsd:c},s[f]=ft({timescale:u,id:o},c)):s[o]={timescale:u,type:h,stsd:c}}}}}return J(a,["moov","mvex","trex"]).forEach((function(g){var v=z(g,4),m=s[v];m&&(m.default={duration:z(g,12),flags:z(g,20)})})),s}function Bo(a){var s,r=a.subarray(8),t=r.subarray(86),e=Mt(r.subarray(4,8)),i=e,n=e==="enca"||e==="encv";if(n){var o=J(r,[e])[0];J(o.subarray(e==="enca"?28:78),["sinf"]).forEach((function(V){var Tt=J(V,["schm"])[0];if(Tt){var Q=Mt(Tt.subarray(4,8));if(Q==="cbcs"||Q==="cenc"){var nt=J(V,["frma"])[0];nt&&(i=Mt(nt))}}}))}var l=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":var u=J(t,["avcC"])[0];u&&u.length>3&&(i+="."+Tr(u[1])+Tr(u[2])+Tr(u[3]),s=Er(l==="avc1"?"dva1":"dvav",t));break;case"mp4a":var d=J(r,[e])[0],h=J(d.subarray(28),["esds"])[0];if(h&&h.length>7){var f=4;if(h[f++]!==3)break;f=ci(h,f),f+=2;var c=h[f++];if(128&c&&(f+=2),64&c&&(f+=h[f++]),h[f++]!==4)break;f=ci(h,f);var g=h[f++];if(g!==64||(i+="."+Tr(g),f+=12,h[f++]!==5))break;f=ci(h,f);var v=h[f++],m=(248&v)>>3;m===31&&(m+=1+((7&v)<<3)+((224&h[f])>>5)),i+="."+m}break;case"hvc1":case"hev1":var p=J(t,["hvcC"])[0];if(p&&p.length>12){var E=p[1],T=["","A","B","C"][E>>6],S=31&E,R=z(p,2),A=(32&E)>>5?"H":"L",L=p[12],b=p.subarray(6,12);i+="."+T+S,i+="."+(function(V){for(var Tt=0,Q=0;Q<32;Q++)Tt|=(V>>Q&1)<<31-Q;return Tt>>>0})(R).toString(16).toUpperCase(),i+="."+A+L;for(var k="",I=b.length;I--;){var D=b[I];(D||k)&&(k="."+D.toString(16).toUpperCase()+k)}i+=k}s=Er(l=="hev1"?"dvhe":"dvh1",t);break;case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":i=Er(i,t)||i;break;case"vp09":var P=J(t,["vpcC"])[0];if(P&&P.length>6){var M=P[4],O=P[5],w=P[6]>>4&15;i+="."+le(M)+"."+le(O)+"."+le(w)}break;case"av01":var F=J(t,["av1C"])[0];if(F&&F.length>2){var x=F[1]>>>5,N=31&F[1],H=F[2]>>>7?"H":"M",U=(64&F[2])>>6,G=(32&F[2])>>5,X=x===2&&U?G?12:10:U?10:8,$=(16&F[2])>>4,Y=(8&F[2])>>3,dt=(4&F[2])>>2,rt=3&F[2];i+="."+x+"."+le(N)+H+"."+le(X)+"."+$+"."+Y+dt+rt+"."+le(1)+"."+le(1)+"."+le(1)+".0",s=Er("dav1",t)}}return{codec:i,encrypted:n,supplemental:s}}function Er(a,s){var r=J(s,["dvvC"]),t=r.length?r[0]:J(s,["dvcC"])[0];if(t){var e=t[2]>>1&127,i=t[2]<<5&32|t[3]>>3&31;return a+"."+le(e)+"."+le(i)}}function ci(a,s){for(var r=s+5;128&a[s++]&&s<r;);return s}function Tr(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function le(a){return(a<10?"0":"")+a}function Wn(a){var s=J(a,["schm"])[0];if(s){var r=Mt(s.subarray(4,8));if(r==="cbcs"||r==="cenc")return J(a,["schi","tenc"])[0]}return null}function re(a,s){var r=new Uint8Array(a.length+s.length);return r.set(a),r.set(s,a.length),r}function jn(a,s){var r=[],t=s.samples,e=s.timescale,i=s.id,n=!1;return J(t,["moof"]).map((function(o){var l=o.byteOffset-8;J(o,["traf"]).map((function(u){var d=J(u,["tfdt"]).map((function(h){var f=h[0],c=z(h,4);return f===1&&(c*=Math.pow(2,32),c+=z(h,8)),c/e}))[0];return d!==void 0&&(a=d),J(u,["tfhd"]).map((function(h){var f=z(h,4),c=16777215&z(h,0),g=0,v=(16&c)!=0,m=0,p=(32&c)!=0,E=8;f===i&&((1&c)!=0&&(E+=8),(2&c)!=0&&(E+=4),(8&c)!=0&&(g=z(h,E),E+=4),v&&(m=z(h,E),E+=4),p&&(E+=4),s.type==="video"&&(n=Sr(s.codec)),J(u,["trun"]).map((function(T){var S=T[0],R=16777215&z(T,0),A=(1&R)!=0,L=0,b=(4&R)!=0,k=(256&R)!=0,I=0,D=(512&R)!=0,P=0,M=(1024&R)!=0,O=(2048&R)!=0,w=0,F=z(T,4),x=8;A&&(L=z(T,x),x+=4),b&&(x+=4);for(var N=L+l,H=0;H<F;H++){if(k?(I=z(T,x),x+=4):I=g,D?(P=z(T,x),x+=4):P=m,M&&(x+=4),O&&(w=S===0?z(T,x):Hn(T,x),x+=4),s.type===ae)for(var U=0;U<P;){var G=z(t,N);Go(n,t[N+=4])&&gi(t.subarray(N,N+G),n?2:1,a+w/e,r),N+=G,U+=G+4}a+=I/e}})))}))}))})),r}function Sr(a){if(!a)return!1;var s=a.substring(0,4);return s==="hvc1"||s==="hev1"||s==="dvh1"||s==="dvhe"}function Go(a,s){if(a){var r=s>>1&63;return r===39||r===40}return(31&s)==6}function gi(a,s,r,t){var e=qn(a),i=0;i+=s;for(var n=0,o=0,l=0;i<e.length;){n=0;do{if(i>=e.length)break;n+=l=e[i++]}while(l===255);o=0;do{if(i>=e.length)break;o+=l=e[i++]}while(l===255);var u=e.length-i,d=i;if(o<u)i+=o;else if(o>u){ct.error("Malformed SEI payload. "+o+" is too small, only "+u+" bytes left to parse.");break}if(n===4){if(e[d++]===181){var h=Kn(e,d);if(d+=2,h===49){var f=z(e,d);if(d+=4,f===1195456820){var c=e[d++];if(c===3){var g=e[d++],v=64&g,m=v?2+3*(31&g):0,p=new Uint8Array(m);if(v){p[0]=g;for(var E=1;E<m;E++)p[E]=e[d++]}t.push({type:c,payloadType:n,pts:r,bytes:p})}}}}}else if(n===5&&o>16){for(var T=[],S=0;S<16;S++){var R=e[d++].toString(16);T.push(R.length==1?"0"+R:R),S!==3&&S!==5&&S!==7&&S!==9||T.push("-")}for(var A=o-16,L=new Uint8Array(A),b=0;b<A;b++)L[b]=e[d++];t.push({payloadType:n,pts:r,uuid:T.join(""),userData:Xt(L),userDataBytes:L})}}}function qn(a){for(var s=a.byteLength,r=[],t=1;t<s-2;)a[t]===0&&a[t+1]===0&&a[t+2]===3?(r.push(t+2),t+=2):t++;if(r.length===0)return a;var e=s-r.length,i=new Uint8Array(e),n=0;for(t=0;t<e;n++,t++)n===r[0]&&(n++,r.shift()),i[t]=a[n];return i}function Ko(a,s,r){if(a.byteLength!==16)throw new RangeError("Invalid system id");var t,e;t=new Uint8Array,e=new Uint8Array;var i=new Uint8Array(4);return r.byteLength>0&&new DataView(i.buffer).setUint32(0,r.byteLength,!1),(function(n){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];for(var d=l.length,h=8,f=d;f--;)h+=l[f].byteLength;var c=new Uint8Array(h);for(c[0]=h>>24&255,c[1]=h>>16&255,c[2]=h>>8&255,c[3]=255&h,c.set(n,4),f=0,h=8;f<d;f++)c.set(l[f],h),h+=l[f].byteLength;return c})([112,115,115,104],new Uint8Array([0,0,0,0]),a,e,t,i,r)}function Vo(a){var s=a.getUint32(0),r=a.byteOffset,t=a.byteLength;if(t<s)return{offset:r,size:t};if(a.getUint32(4)!==1886614376)return{offset:r,size:s};var e=a.getUint32(8)>>>24;if(e!==0&&e!==1)return{offset:r,size:s};var i=a.buffer,n=Vt(new Uint8Array(i,r+12,16)),o=null,l=0;if(e===0)l=28;else{var u=a.getUint32(28);if(!u||t<32+16*u)return{offset:r,size:s};o=[];for(var d=0;d<u;d++)o.push(new Uint8Array(i,r+32+16*d,16));l=32+16*u}if(!l)return{offset:r,size:s};var h=a.getUint32(l);return s-32<h?{offset:r,size:s}:{version:e,systemId:n,kids:o,data:new Uint8Array(i,r+l+4,h),offset:r,size:s}}var Xn=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},Ke={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function vi(a,s){var r=Ke[s];return!!r&&!!r[a.slice(0,4)]}function ir(a,s,r){return r===void 0&&(r=!0),!a.split(",").some((function(t){return!mi(t,s,r)}))}function mi(a,s,r){var t;r===void 0&&(r=!0);var e=ke(r);return(t=e?.isTypeSupported(nr(a,s)))!=null&&t}function nr(a,s){return s+"/mp4;codecs="+a}function zn(a){if(a){var s=a.substring(0,4);return Ke.video[s]}return 2}function Ar(a){var s=Xn();return a.split(",").reduce((function(r,t){var e=s&&Sr(t)?9:Ke.video[t];return e?(2*e+r)/(r?3:2):(Ke.audio[t]+r)/(r?2:1)}),0)}var pi={},Ho=/flac|opus|mp4a\.40\.34/i;function Lr(a,s){return s===void 0&&(s=!0),a.replace(Ho,(function(r){return(function(t,e){if(e===void 0&&(e=!0),pi[t])return pi[t];for(var i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[t],n=0;n<i.length;n++){var o;if(mi(i[n],"audio",e))return pi[t]=i[n],i[n];if(i[n]==="mp3"&&(o=ke(e))!=null&&o.isTypeSupported("audio/mpeg"))return""}return t})(r.toLowerCase(),s)}))}function Ir(a,s){if(a&&(a.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(a)!==-1)&&(Qn(a,"audio")||Qn(a,"video")))return a;if(s){var r=s.split(",");if(r.length>1){if(a){for(var t=r.length;t--;)if(r[t].substring(0,4)===a.substring(0,4))return r[t]}return r[0]}}return s||a}function Qn(a,s){return vi(a,s)&&mi(a,s)}function Yo(a){if(a.startsWith("av01.")){for(var s=a.split("."),r=["0","111","01","01","01","0"],t=s.length;t>4&&t<10;t++)s[t]=r[t-4];return s.join(".")}return a}function $n(a){var s=ke(a)||{isTypeSupported:function(){return!1}};return{mpeg:s.isTypeSupported("audio/mpeg"),mp3:s.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:s.isTypeSupported('audio/mp4; codecs="ac-3"')}}function yi(a){return a.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var Wo={supported:!1,smooth:!1,powerEfficient:!1},Zn={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Jn(a,s){return{supported:!1,configurations:s,decodingInfoResults:[Wo],error:a}}function ta(a,s,r,t){t===void 0&&(t={});var e=a.videoCodec;if(!e&&!a.audioCodec||!r)return Promise.resolve(Zn);for(var i=[],n=(function(g){var v,m=(v=g.videoCodec)==null?void 0:v.split(","),p=ea(g),E=g.width||640,T=g.height||480,S=g.frameRate||30,R=g.videoRange.toLowerCase();return m?m.map((function(A){var L={contentType:nr(Yo(A),"video"),width:E,height:T,bitrate:p,framerate:S};return R!=="sdr"&&(L.transferFunction=R),L})):[]})(a),o=n.length,l=(function(g,v,m){var p,E=(p=g.audioCodec)==null?void 0:p.split(","),T=ea(g);return E&&g.audioGroups?g.audioGroups.reduce((function(S,R){var A,L=R?(A=v.groups[R])==null?void 0:A.tracks:null;return L?L.reduce((function(b,k){if(k.groupId===R){var I=parseFloat(k.channels||"");E.forEach((function(D){var P={contentType:nr(D,"audio"),bitrate:m?jo(D,T):T};I&&(P.channels=""+I),b.push(P)}))}return b}),S):S}),[]):[]})(a,s,o>0),u=l.length,d=o||1*u||1;d--;){var h={type:"media-source"};if(o&&(h.video=n[d%o]),u){h.audio=l[d%u];var f=h.audio.bitrate;h.video&&f&&(h.video.bitrate-=f)}i.push(h)}if(e){var c=navigator.userAgent;if(e.split(",").some((function(g){return Sr(g)}))&&Xn())return Promise.resolve(Jn(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: ("+c+")"),i))}return Promise.all(i.map((function(g){var v,m,p,E,T=(m="",p=(v=g).audio,(E=v.video)&&(m+=yi(E.contentType)+"_r"+E.height+"x"+E.width+"f"+Math.ceil(E.framerate)+(E.transferFunction||"sd")+"_"+Math.ceil(E.bitrate/1e5)),p&&(m+=(E?"_":"")+yi(p.contentType)+"_c"+p.channels),m);return t[T]||(t[T]=r.decodingInfo(g))}))).then((function(g){return{supported:!g.some((function(v){return!v.supported})),configurations:i,decodingInfoResults:g}})).catch((function(g){return{supported:!1,configurations:i,decodingInfoResults:[],error:g}}))}function jo(a,s){if(s<=1)return 1;var r=128e3;return a==="ec-3"?r=768e3:a==="ac-3"&&(r=64e4),Math.min(s/2,r)}function ea(a){return 1e3*Math.ceil(Math.max(.9*a.bitrate,a.averageBitrate)/1e3)||1}var Ei=["NONE","TYPE-0","TYPE-1",null],Rr=["SDR","PQ","HLG"],ra="",qo="YES",Xo="v2";function ia(a){var s=a.canSkipUntil,r=a.canSkipDateRanges,t=a.age;return s&&t<s/2?r?Xo:qo:ra}var na=(function(){function a(s,r,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=s,this.part=r,this.skip=t}return a.prototype.addDirectives=function(s){var r=new self.URL(s);return this.msn!==void 0&&r.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&r.searchParams.set("_HLS_part",this.part.toString()),this.skip&&r.searchParams.set("_HLS_skip",this.skip),r.href},a})(),ar=(function(){function a(r){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[r.url],this._attrs=[r.attrs],this.bitrate=r.bitrate,r.details&&(this.details=r.details),this.id=r.id||0,this.name=r.name,this.width=r.width||0,this.height=r.height||0,this.frameRate=r.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=r.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=r.audioCodec,this.videoCodec=r.videoCodec,this.codecSet=[r.videoCodec,r.audioCodec].filter((function(i){return!!i})).map((function(i){return i.substring(0,4)})).join(","),"supplemental"in r){var t;this.supplemental=r.supplemental;var e=(t=r.supplemental)==null?void 0:t.videoCodec;e&&e!==r.videoCodec&&(this.codecSet+=","+e.substring(0,4))}this.addGroupId("audio",r.attrs.AUDIO),this.addGroupId("text",r.attrs.SUBTITLES)}var s=a.prototype;return s.hasAudioGroup=function(r){return aa(this._audioGroups,r)},s.hasSubtitleGroup=function(r){return aa(this._subtitleGroups,r)},s.addGroupId=function(r,t){if(t){if(r==="audio"){var e=this._audioGroups;e||(e=this._audioGroups=[]),e.indexOf(t)===-1&&e.push(t)}else if(r==="text"){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}},s.addFallback=function(){},yt(a,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(r){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var r;return(r=this.audioGroups)==null?void 0:r[0]}},{key:"textGroupId",get:function(){var r;return(r=this.subtitleGroups)==null?void 0:r[0]}}])})();function aa(a,s){return!(!s||!a)&&a.indexOf(s)!==-1}function zo(a,s){var r=!1,t=[];if(a&&(r=a!=="SDR",t=[a]),s){var e=(t=s.allowedVideoRanges||Rr.slice(0)).join("")!=="SDR"&&!s.videoCodec;(r=s.preferHDR!==void 0?s.preferHDR:e&&(function(){if(typeof matchMedia=="function"){var i=matchMedia("(dynamic-range: high)"),n=matchMedia("bad query");if(i.media!==n.media)return i.matches===!0}return!1})())||(t=["SDR"])}return{preferHDR:r,allowedVideoRanges:t}}var Et=function(a,s){return JSON.stringify(a,(function(r){var t=new WeakSet;return function(e,i){if(r&&(i=r(e,i)),typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}})(s))};function ue(a,s){ct.log('[abr] start candidates with "'+a+'" ignored because '+s)}function sa(a){return a.reduce((function(s,r){var t=s.groups[r.groupId];t||(t=s.groups[r.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),t.tracks.push(r);var e=r.channels||"2";return t.channels[e]=(t.channels[e]||0)+1,t.hasDefault=t.hasDefault||r.default,t.hasAutoSelect=t.hasAutoSelect||r.autoselect,t.hasDefault&&(s.hasDefaultAudio=!0),t.hasAutoSelect&&(s.hasAutoSelectAudio=!0),s}),{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function oa(a){if(!a)return a;var s=a;return{lang:s.lang,assocLang:s.assocLang,characteristics:s.characteristics,channels:s.channels,audioCodec:s.audioCodec}}function de(a,s,r){if("attrs"in a){var t=s.indexOf(a);if(t!==-1)return t}for(var e=0;e<s.length;e++)if(_e(a,s[e],r))return e;return-1}function _e(a,s,r){var t,e,i=a.groupId,n=a.name,o=a.lang,l=a.assocLang,u=a.default,d=a.forced;return(i===void 0||s.groupId===i)&&(n===void 0||s.name===n)&&(o===void 0||(t=o,(e=s.lang)===void 0&&(e="--"),t.length===e.length?t===e:t.startsWith(e)||e.startsWith(t)))&&(o===void 0||s.assocLang===l)&&(u===void 0||s.default===u)&&(d===void 0||s.forced===d)&&(!("characteristics"in a)||(function(h,f){f===void 0&&(f="");var c=h.split(","),g=f.split(",");return c.length===g.length&&!c.some((function(v){return g.indexOf(v)===-1}))})(a.characteristics||"",s.characteristics))&&(r===void 0||r(a,s))}function Pe(a,s){var r=a.audioCodec,t=a.channels;return!(r!==void 0&&(s.audioCodec||"").substring(0,4)!==r.substring(0,4)||t!==void 0&&t!==(s.channels||"2"))}function la(a,s,r){for(var t=s;t>-1;t--)if(r(a[t]))return t;for(var e=s+1;e<a.length;e++)if(r(a[e]))return e;return-1}function kr(a,s){var r;return!!a&&a!==((r=s.loadLevelObj)==null?void 0:r.uri)}var Qo=(function(a){function s(t){var e;return(e=a.call(this,"abr",t.logger)||this).hls=void 0,e.lastLevelLoadSec=0,e.lastLoadedFragLevel=-1,e.firstSelection=-1,e._nextAutoLevel=-1,e.nextAutoLevelKey="",e.audioTracksByGroup=null,e.codecTiers=null,e.timer=-1,e.fragCurrent=null,e.partCurrent=null,e.bitrateTestDelay=0,e.rebufferNotice=-1,e.supportedCache={},e.bwEstimator=void 0,e._abandonRulesCheck=function(i){var n,o=e,l=o.fragCurrent,u=o.partCurrent,d=o.hls,h=d.autoLevelEnabled,f=d.media;if(l&&f){var c=performance.now(),g=u?u.stats:l.stats,v=u?u.duration:l.duration,m=c-g.loading.start,p=d.minAutoLevel,E=l.level,T=e._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||E<=p)return e.clearTimer(),void(e._nextAutoLevel=-1);if(h){var S=T>-1&&T!==E,R=!!i||S;if(R||!f.paused&&f.playbackRate&&f.readyState){var A=d.mainForwardBufferInfo;if(R||A!==null){var L=e.bwEstimator.getEstimateTTFB(),b=Math.abs(f.playbackRate);if(!(m<=Math.max(L,v/(2*b)*1e3))){var k=A?A.len/b:0,I=g.loading.first?g.loading.first-g.loading.start:-1,D=g.loaded&&I>-1,P=e.getBwEstimate(),M=d.levels,O=M[E],w=Math.max(g.loaded,Math.round(v*(l.bitrate||O.averageBitrate)/8)),F=D?m-I:m;F<1&&D&&(F=Math.min(m,8*g.loaded/P));var x=D?1e3*g.loaded/F:0,N=L/1e3,H=x?(w-g.loaded)/x:8*w/P+N;if(!(H<=k)){var U,G=x?8*x:P,X=((n=i?.details||e.hls.latestLevelDetails)==null?void 0:n.live)===!0,$=e.hls.config.abrBandWidthUpFactor,Y=Number.POSITIVE_INFINITY;for(U=E-1;U>p;U--){var dt=M[U].maxBitrate,rt=!M[U].details||X;if((Y=e.getTimeToLoadFrag(N,G,v*dt,rt))<Math.min(k,v+N))break}if(!(Y>=H||Y>10*v)){D?e.bwEstimator.sample(m-Math.min(L,I),g.loaded):e.bwEstimator.sampleTTFB(m);var V=M[U].maxBitrate;e.getBwEstimate()*$>V&&e.resetEstimator(V);var Tt=e.findBestLevel(V,p,U,0,k,1,1);Tt>-1&&(U=Tt),e.warn("Fragment "+l.sn+(u?" part "+u.index:"")+" of level "+E+` is loading too slowly;
      Fragment duration: `+l.duration.toFixed(3)+`
      Time to underbuffer: `+k.toFixed(3)+` s
      Estimated load time for current fragment: `+H.toFixed(3)+` s
      Estimated load time for down switch fragment: `+Y.toFixed(3)+` s
      TTFB estimate: `+(0|I)+` ms
      Current BW estimate: `+(B(P)?0|P:"Unknown")+` bps
      New BW estimate: `+(0|e.getBwEstimate())+` bps
      Switching to level `+U+" @ "+(0|V)+" bps"),d.nextLoadLevel=d.nextAutoLevel=U,e.clearTimer();var Q=function(){if(e.clearTimer(),e.fragCurrent===l&&e.hls.loadLevel===U&&U>0){var nt=e.getStarvationDelay();if(e.warn("Aborting inflight request "+(U>0?"and switching down":"")+`
      Fragment duration: `+l.duration.toFixed(3)+` s
      Time to underbuffer: `+nt.toFixed(3)+" s"),l.abortRequests(),e.fragCurrent=e.partCurrent=null,U>p){var W=e.findBestLevel(e.hls.levels[p].bitrate,p,U,0,nt,1,1);W===-1&&(W=p),e.hls.nextLoadLevel=e.hls.nextAutoLevel=W,e.resetEstimator(e.hls.levels[W].bitrate)}}};S||H>2*Y?Q():e.timer=self.setInterval(Q,1e3*Y),d.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:u,stats:g})}}}}}}}},e.hls=t,e.bwEstimator=e.initEstimator(),e.registerListeners(),e}ut(s,a);var r=s.prototype;return r.resetEstimator=function(t){t&&(this.log("setting initial bwe to "+t),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},r.initEstimator=function(){var t=this.hls.config;return new xo(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)},r.registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.FRAG_LOADING,this.onFragLoading,this),t.on(y.FRAG_LOADED,this.onFragLoaded,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this),t.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(y.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.FRAG_LOADING,this.onFragLoading,this),t.off(y.FRAG_LOADED,this.onFragLoaded,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this),t.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(y.ERROR,this.onError,this))},r.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null},r.onManifestLoading=function(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},r.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},r.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},r.onFragLoading=function(t,e){var i,n=e.frag;this.ignoreFragment(n)||(n.bitrateTest||(this.fragCurrent=n,this.partCurrent=(i=e.part)!=null?i:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))},r.onLevelSwitching=function(t,e){this.clearTimer()},r.onError=function(t,e){if(!e.fatal)switch(e.details){case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case _.FRAG_LOAD_TIMEOUT:var i=e.frag,n=this.fragCurrent,o=this.partCurrent;if(i&&n&&i.sn===n.sn&&i.level===n.level){var l=performance.now(),u=o?o.stats:i.stats,d=l-u.loading.start,h=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&h>-1){var f=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(f,h),u.loaded)}else this.bwEstimator.sampleTTFB(d)}}},r.getTimeToLoadFrag=function(t,e,i,n){return t+i/e+(n?t+this.lastLevelLoadSec:0)},r.onLevelLoaded=function(t,e){var i=this.hls.config,n=e.stats.loading,o=n.end-n.first;B(o)&&(this.lastLevelLoadSec=o/1e3),e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)},r.onFragLoaded=function(t,e){var i=e.frag,n=e.part,o=n?n.stats:i.stats;if(i.type===Z&&this.bwEstimator.sampleTTFB(o.loading.first-o.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var l=n?n.duration:i.duration,u=this.hls.levels[i.level],d=(u.loaded?u.loaded.bytes:0)+o.loaded,h=(u.loaded?u.loaded.duration:0)+l;u.loaded={bytes:d,duration:h},u.realBitrate=Math.round(8*d/h)}if(i.bitrateTest){var f={stats:o,frag:i,part:n,id:i.type};this.onFragBuffered(y.FRAG_BUFFERED,f),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}},r.onFragBuffered=function(t,e){var i=e.frag,n=e.part,o=n!=null&&n.stats.loaded?n.stats:i.stats;if(!o.aborted&&!this.ignoreFragment(i)){var l=o.parsing.end-o.loading.start-Math.min(o.loading.first-o.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,o.loaded),o.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},r.ignoreFragment=function(t){return t.type!==Z||t.sn==="initSegment"},r.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},r.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},r.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls;if(i.levels.length<=1)return i.loadLevel;var n=i.maxAutoLevel,o=i.config,l=i.minAutoLevel,u=e?e.duration:t?t.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay(),f=o.abrBandWidthFactor,c=o.abrBandWidthUpFactor;if(h){var g=this.findBestLevel(d,l,n,h,0,f,c);if(g>=0)return this.rebufferNotice=-1,g}var v=u?Math.min(u,o.maxStarvationDelay):o.maxStarvationDelay;if(!h){var m=this.bitrateTestDelay;m&&(v=(u?Math.min(u,o.maxLoadingDelay):o.maxLoadingDelay)-m,this.info("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),f=c=1)}var p=this.findBestLevel(d,l,n,h,v,f,c);if(this.rebufferNotice!==p&&(this.rebufferNotice=p,this.info((h?"rebuffering expected":"buffer is empty")+", optimal quality level "+p)),p>-1)return p;var E=i.levels[l],T=i.loadLevelObj;return T&&E?.bitrate<T.bitrate?l:i.loadLevel},r.getStarvationDelay=function(){var t=this.hls,e=t.media;if(!e)return 1/0;var i=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,n=t.mainForwardBufferInfo;return(n?n.len:0)/i},r.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},r.findBestLevel=function(t,e,i,n,o,l,u){var d,h=this,f=n+o,c=this.lastLoadedFragLevel,g=c===-1?this.hls.firstLevel:c,v=this.fragCurrent,m=this.partCurrent,p=this.hls,E=p.levels,T=p.allAudioTracks,S=p.loadLevel,R=p.config;if(E.length===1)return 0;var A,L=E[g],b=!((d=this.hls.latestLevelDetails)==null||!d.live),k=S===-1||c===-1,I="SDR",D=L?.frameRate||0,P=R.audioPreference,M=R.videoPreference,O=this.audioTracksByGroup||(this.audioTracksByGroup=sa(T)),w=-1;if(k){if(this.firstSelection!==-1)return this.firstSelection;var F=this.codecTiers||(this.codecTiers=(function(nt,W,ht,It){return nt.slice(ht,It+1).reduce((function(it,et,Dt){if(!et.codecSet)return it;var at=et.audioGroups,j=it[et.codecSet];j||(it[et.codecSet]=j={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:Dt,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!at,fragmentError:0}),j.minBitrate=Math.min(j.minBitrate,et.bitrate);var Ot=Math.min(et.height,et.width);return j.minHeight=Math.min(j.minHeight,Ot),j.minFramerate=Math.min(j.minFramerate,et.frameRate),j.minIndex=Math.min(j.minIndex,Dt),j.maxScore=Math.max(j.maxScore,et.score),j.fragmentError+=et.fragmentError,j.videoRanges[et.videoRange]=(j.videoRanges[et.videoRange]||0)+1,at&&at.forEach((function(q){if(q){var gt=W.groups[q];gt&&(j.hasDefaultAudio=j.hasDefaultAudio||W.hasDefaultAudio?gt.hasDefault:gt.hasAutoSelect||!W.hasDefaultAudio&&!W.hasAutoSelectAudio,Object.keys(gt.channels).forEach((function(ot){j.channels[ot]=(j.channels[ot]||0)+gt.channels[ot]})))}})),it}),{})})(E,O,e,i)),x=(function(nt,W,ht,It,it){for(var et=Object.keys(nt),Dt=It?.channels,at=It?.audioCodec,j=it?.videoCodec,Ot=Dt&&parseInt(Dt)===2,q=!1,gt=!1,ot=1/0,St=1/0,At=1/0,Ct=1/0,st=0,_t=[],Wt=zo(W,it),Zt=Wt.preferHDR,jt=Wt.allowedVideoRanges,Jt=function(){var lt=nt[et[xt]];q||(q=lt.channels[2]>0),ot=Math.min(ot,lt.minHeight),St=Math.min(St,lt.minFramerate),At=Math.min(At,lt.minBitrate),jt.filter((function(pt){return lt.videoRanges[pt]>0})).length>0&&(gt=!0)},xt=et.length;xt--;)Jt();ot=B(ot)?ot:0,St=B(St)?St:0;var Gt=Math.max(1080,ot),Rt=Math.max(30,St);At=B(At)?At:ht,ht=Math.max(At,ht),gt||(W=void 0);var Lt=et.length>1;return{codecSet:et.reduce((function(lt,pt){var vt=nt[pt];if(pt===lt)return lt;if(_t=gt?jt.filter((function(ve){return vt.videoRanges[ve]>0})):[],Lt){if(vt.minBitrate>ht)return ue(pt,"min bitrate of "+vt.minBitrate+" > current estimate of "+ht),lt;if(!vt.hasDefaultAudio)return ue(pt,"no renditions with default or auto-select sound found"),lt;if(at&&pt.indexOf(at.substring(0,4))%5!=0)return ue(pt,'audio codec preference "'+at+'" not found'),lt;if(Dt&&!Ot){if(!vt.channels[Dt])return ue(pt,"no renditions with "+Dt+" channel sound found (channels options: "+Object.keys(vt.channels)+")"),lt}else if((!at||Ot)&&q&&vt.channels[2]===0)return ue(pt,"no renditions with stereo sound found"),lt;if(vt.minHeight>Gt)return ue(pt,"min resolution of "+vt.minHeight+" > maximum of "+Gt),lt;if(vt.minFramerate>Rt)return ue(pt,"min framerate of "+vt.minFramerate+" > maximum of "+Rt),lt;if(!_t.some((function(ve){return vt.videoRanges[ve]>0})))return ue(pt,"no variants with VIDEO-RANGE of "+Et(_t)+" found"),lt;if(j&&pt.indexOf(j.substring(0,4))%5!=0)return ue(pt,'video codec preference "'+j+'" not found'),lt;if(vt.maxScore<st)return ue(pt,"max score of "+vt.maxScore+" < selected max of "+st),lt}return lt&&(Ar(pt)>=Ar(lt)||vt.fragmentError>nt[lt].fragmentError)?lt:(Ct=vt.minIndex,st=vt.maxScore,pt)}),void 0),videoRanges:_t,preferHDR:Zt,minFramerate:St,minBitrate:At,minIndex:Ct}})(F,I,t,P,M),N=x.codecSet,H=x.videoRanges,U=x.minFramerate,G=x.minBitrate,X=x.minIndex,$=x.preferHDR;w=X,A=N,I=$?H[H.length-1]:H[0],D=U,t=Math.max(t,G),this.log("picked start tier "+Et(x))}else A=L?.codecSet,I=L?.videoRange;for(var Y,dt=m?m.duration:v?v.duration:0,rt=this.bwEstimator.getEstimateTTFB()/1e3,V=[],Tt=function(){var nt,W=E[Q],ht=Q>g;if(!W)return 0;if(R.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){var It=navigator.mediaCapabilities;typeof It?.decodingInfo=="function"&&(function(q,gt,ot,St,At,Ct){var st=q.videoCodec,_t=q.audioCodec?q.audioGroups:null,Wt=Ct?.audioCodec,Zt=Ct?.channels,jt=Zt?parseInt(Zt):Wt?1/0:2,Jt=null;if(_t!=null&&_t.length)try{Jt=_t.length===1&&_t[0]?gt.groups[_t[0]].channels:_t.reduce((function(xt,Gt){if(Gt){var Rt=gt.groups[Gt];if(!Rt)throw new Error("Audio track group "+Gt+" not found");Object.keys(Rt.channels).forEach((function(Lt){xt[Lt]=(xt[Lt]||0)+Rt.channels[Lt]}))}return xt}),{2:0})}catch{return!0}return st!==void 0&&(st.split(",").some((function(xt){return Sr(xt)}))||q.width>1920&&q.height>1088||q.height>1920&&q.width>1088||q.frameRate>Math.max(St,30)||q.videoRange!=="SDR"&&q.videoRange!==ot||q.bitrate>Math.max(At,8e6))||!!Jt&&B(jt)&&Object.keys(Jt).some((function(xt){return parseInt(xt)>jt}))})(W,O,I,D,t,P)?(W.supportedPromise=ta(W,O,It,h.supportedCache),W.supportedPromise.then((function(q){if(h.hls){W.supportedResult=q;var gt=h.hls.levels,ot=gt.indexOf(W);q.error?h.warn('MediaCapabilities decodingInfo error: "'+q.error+'" for level '+ot+" "+Et(q)):q.supported?q.decodingInfoResults.some((function(St){return St.smooth===!1||St.powerEfficient===!1}))&&h.log("MediaCapabilities decodingInfo for level "+ot+" not smooth or powerEfficient: "+Et(q)):(h.warn("Unsupported MediaCapabilities decodingInfo result for level "+ot+" "+Et(q)),ot>-1&&gt.length>1&&(h.log("Removing unsupported level "+ot),h.hls.removeLevel(ot),h.hls.loadLevel===-1&&(h.hls.nextLoadLevel=0)))}})).catch((function(q){h.warn("Error handling MediaCapabilities decodingInfo: "+q)}))):W.supportedResult=Zn}if((A&&W.codecSet!==A||I&&W.videoRange!==I||ht&&D>W.frameRate||!ht&&D>0&&D<W.frameRate||(nt=W.supportedResult)!=null&&(nt=nt.decodingInfoResults)!=null&&nt.some((function(q){return q.smooth===!1})))&&(!k||Q!==w))return V.push(Q),0;var it,et=W.details,Dt=(m?et?.partTarget:et?.averagetargetduration)||dt;it=ht?u*t:l*t;var at=dt&&n>=2*dt&&o===0?W.averageBitrate:W.maxBitrate,j=h.getTimeToLoadFrag(rt,it,at*Dt,et===void 0);if(it>=at&&(Q===c||W.loadError===0&&W.fragmentError===0)&&(j<=rt||!B(j)||b&&!h.bitrateTestDelay||j<f)){var Ot=h.forcedAutoLevel;return Q===S||Ot!==-1&&Ot===S||(V.length&&h.trace("Skipped level(s) "+V.join(",")+" of "+i+' max with CODECS and VIDEO-RANGE:"'+E[V[0]].codecs+'" '+E[V[0]].videoRange+'; not compatible with "'+A+'" '+I),h.info("switch candidate:"+g+"->"+Q+" adjustedbw("+Math.round(it)+")-bitrate="+Math.round(it-at)+" ttfb:"+rt.toFixed(1)+" avgDuration:"+Dt.toFixed(1)+" maxFetchDuration:"+f.toFixed(1)+" fetchDuration:"+j.toFixed(1)+" firstSelection:"+k+" codecSet:"+W.codecSet+" videoRange:"+W.videoRange+" hls.loadLevel:"+S)),k&&(h.firstSelection=Q),{v:Q}}},Q=i;Q>=e;Q--)if((Y=Tt())!==0&&Y)return Y.v;return-1},r.deriveNextAutoLevel=function(t){var e=this.hls,i=e.maxAutoLevel,n=e.minAutoLevel;return Math.min(Math.max(t,n),i)},yt(s,[{key:"firstAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,i=t.minAutoLevel,n=this.getBwEstimate(),o=this.hls.config.maxStarvationDelay,l=this.findBestLevel(n,i,e,0,o,1,1);if(l>-1)return l;var u=this.hls.firstLevel,d=Math.min(Math.max(u,i),e);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+u+" clamped to "+d),d}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var t=this.forcedAutoLevel,e=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(!(t===-1||e&&i&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;var n=e&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){var o=this.hls.levels;if(o.length>Math.max(t,n)&&o[t].loadError<=o[n].loadError)return t}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n},set:function(t){var e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}}])})(ee),ua=function(a,s){for(var r=0,t=a.length-1,e=null,i=null;r<=t;){var n=s(i=a[e=(r+t)/2|0]);if(n>0)r=e+1;else{if(!(n<0))return i;t=e-1}}return null};function Ce(a,s,r,t,e){r===void 0&&(r=0),t===void 0&&(t=0),e===void 0&&(e=.005);var i=null;if(a){i=s[1+a.sn-s[0].sn]||null;var n=a.endDTS-r;n>0&&n<15e-7&&(r+=15e-7),i&&a.level!==i.level&&i.end<=a.end&&(i=s[2+a.sn-s[0].sn]||null)}else r===0&&s[0].start===0&&(i=s[0]);if(i&&((!a||a.level===i.level)&&da(r,t,i)===0||(function(l,u,d){if(u&&u.start===0&&u.level<l.level&&(u.endPTS||0)>0){var h=u.tagList.reduce((function(f,c){return c[0]==="INF"&&(f+=parseFloat(c[1])),f}),d);return l.start<=h}return!1})(i,a,Math.min(e,t))))return i;var o=ua(s,da.bind(null,r,t));return!o||o===a&&i?i:o}function da(a,s,r){if(a===void 0&&(a=0),s===void 0&&(s=0),r.start<=a&&r.start+r.duration>a)return 0;var t=Math.min(s,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-t<=a?1:r.start-t>a&&r.start?-1:0}function $o(a,s,r){var t=1e3*Math.min(s,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-t>a}function ha(a,s,r){if(a&&a.startCC<=s&&a.endCC>=s){var t,e=a.fragments,i=a.fragmentHint;return i&&(e=e.concat(i)),ua(e,(function(n){return n.cc<s?1:n.cc>s?-1:(t=n,n.end<=r?1:n.start>r?-1:0)})),t||null}return null}function br(a){switch(a.details){case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_TIMEOUT:case _.LEVEL_LOAD_TIMEOUT:case _.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function fa(a){return a.details.startsWith("key")}function ca(a){return fa(a)&&!!a.frag&&!a.frag.decryptdata}function ga(a,s){var r=br(s);return a.default[(r?"timeout":"error")+"Retry"]}function Ti(a,s){var r=a.backoff==="linear"?1:Math.pow(2,s);return Math.min(r*a.retryDelayMs,a.maxRetryDelayMs)}function va(a){return ft(ft({},a),{errorRetry:null,timeoutRetry:null})}function Dr(a,s,r,t){if(!a)return!1;var e=t?.code,i=s<a.maxNumRetry&&((function(n){return Si(n)||!!n&&(n<400||n>499)})(e)||!!r);return a.shouldRetry?a.shouldRetry(a,s,r,t,i):i}function Si(a){return a===0&&navigator.onLine===!1}var ma=0,he=2,Zo=3,_r=5,sr=0,Pr=1,pa=2,ya=4,Jo=(function(a){function s(t){var e;return(e=a.call(this,"error-controller",t.logger)||this).hls=void 0,e.playlistError=0,e.hls=t,e.registerListeners(),e}ut(s,a);var r=s.prototype;return r.registerListeners=function(){var t=this.hls;t.on(y.ERROR,this.onError,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)},r.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.ERROR,this.onError,this),t.off(y.ERROR,this.onErrorOut,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))},r.destroy=function(){this.unregisterListeners(),this.hls=null},r.startLoad=function(t){},r.stopLoad=function(){this.playlistError=0},r.getVariantLevelIndex=function(t){return t?.type===Z?t.level:this.getVariantIndex()},r.getVariantIndex=function(){var t,e=this.hls,i=e.currentLevel;return(t=e.loadLevelObj)!=null&&t.details||i===-1?e.loadLevel:i},r.variantHasKey=function(t,e){if(t){var i;if((i=t.details)!=null&&i.hasKey(e))return!0;var n=t.audioGroups;if(n)return this.hls.allAudioTracks.filter((function(o){return n.indexOf(o.groupId)>=0})).some((function(o){var l;return(l=o.details)==null?void 0:l.hasKey(e)}))}return!1},r.onManifestLoading=function(){this.playlistError=0},r.onLevelUpdated=function(){this.playlistError=0},r.onError=function(t,e){var i;if(!e.fatal){var n=this.hls,o=e.context;switch(e.details){case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case _.FRAG_PARSING_ERROR:if((i=e.frag)!=null&&i.gap)return void(e.errorAction=Ve());case _.FRAG_GAP:case _.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=he);case _.LEVEL_EMPTY_ERROR:case _.LEVEL_PARSING_ERROR:var l,u=e.parent===Z?e.level:n.loadLevel;return void(e.details===_.LEVEL_EMPTY_ERROR&&(l=e.context)!=null&&(l=l.levelDetails)!=null&&l.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,u):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,u)));case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:return void(typeof o?.level=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,o.level)));case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.SUBTITLE_LOAD_ERROR:case _.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){var d=n.loadLevelObj;if(d&&(o.type===ne&&d.hasAudioGroup(o.groupId)||o.type===oe&&d.hasSubtitleGroup(o.groupId)))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,n.loadLevel),e.errorAction.action=he,void(e.errorAction.flags=Pr)}return;case _.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(e.errorAction={action:he,flags:pa});case _.KEY_SYSTEM_SESSION_UPDATE_FAILED:case _.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case _.KEY_SYSTEM_NO_SESSION:return void(e.errorAction={action:he,flags:ya});case _.BUFFER_ADD_CODEC_ERROR:case _.REMUX_ALLOC_ERROR:case _.BUFFER_APPEND_ERROR:var h;return void(e.errorAction||(e.errorAction=this.getLevelSwitchAction(e,(h=e.level)!=null?h:n.loadLevel)));case _.INTERNAL_EXCEPTION:case _.BUFFER_APPENDING_ERROR:case _.BUFFER_FULL_ERROR:case _.LEVEL_SWITCH_ERROR:case _.BUFFER_STALLED_ERROR:case _.BUFFER_SEEK_OVER_HOLE:case _.BUFFER_NUDGE_ON_STALL:return void(e.errorAction=Ve())}e.type===K.KEY_SYSTEM_ERROR&&(e.levelRetry=!1,e.errorAction=Ve())}},r.getPlaylistRetryOrSwitchAction=function(t,e){var i=ga(this.hls.config.playlistLoadPolicy,t),n=this.playlistError++;if(Dr(i,n,br(t),t.response))return{action:_r,flags:sr,retryConfig:i,retryCount:n};var o=this.getLevelSwitchAction(t,e);return i&&(o.retryConfig=i,o.retryCount=n),o},r.getFragRetryOrSwitchAction=function(t){var e=this.hls,i=this.getVariantLevelIndex(t.frag),n=e.levels[i],o=e.config,l=o.fragLoadPolicy,u=o.keyLoadPolicy,d=ga(fa(t)?u:l,t),h=e.levels.reduce((function(c,g){return c+g.fragmentError}),0);if(n&&(t.details!==_.FRAG_GAP&&n.fragmentError++,!ca(t)&&Dr(d,h,br(t),t.response)))return{action:_r,flags:sr,retryConfig:d,retryCount:h};var f=this.getLevelSwitchAction(t,i);return d&&(f.retryConfig=d,f.retryCount=h),f},r.getLevelSwitchAction=function(t,e){var i=this.hls;e==null&&(e=i.loadLevel);var n=this.hls.levels[e];if(n){var o,l,u=t.details;n.loadError++,u===_.BUFFER_APPEND_ERROR&&n.fragmentError++;var d=-1,h=i.levels,f=i.loadLevel,c=i.minAutoLevel,g=i.maxAutoLevel;i.autoLevelEnabled||i.config.preserveManualLevelOnError||(i.loadLevel=-1);for(var v,m=(o=t.frag)==null?void 0:o.type,p=(m===Kt&&u===_.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(u===_.BUFFER_ADD_CODEC_ERROR||u===_.BUFFER_APPEND_ERROR))&&h.some((function(b){var k=b.audioCodec;return n.audioCodec!==k})),E=t.sourceBufferName==="video"&&(u===_.BUFFER_ADD_CODEC_ERROR||u===_.BUFFER_APPEND_ERROR)&&h.some((function(b){var k=b.codecSet,I=b.audioCodec;return n.codecSet!==k&&n.audioCodec===I})),T=(l=t.context)!=null?l:{},S=T.type,R=T.groupId,A=function(){var b=(L+f)%h.length;if(b!==f&&b>=c&&b<=g&&h[b].loadError===0){var k,I,D=h[b];if(u===_.FRAG_GAP&&m===Z&&t.frag){var P=h[b].details;if(P){var M=Ce(t.frag,P.fragments,t.frag.start);if(M!=null&&M.gap)return 0}}else if(S===ne&&D.hasAudioGroup(R)||S===oe&&D.hasSubtitleGroup(R)||m===Kt&&(k=n.audioGroups)!=null&&k.some((function(O){return D.hasAudioGroup(O)}))||m===te&&(I=n.subtitleGroups)!=null&&I.some((function(O){return D.hasSubtitleGroup(O)}))||p&&n.audioCodec===D.audioCodec||E&&n.codecSet===D.codecSet||!p&&n.codecSet!==D.codecSet)return 0;return d=b,1}},L=h.length;L--&&((v=A())===0||v!==1););if(d>-1&&i.loadLevel!==d)return t.levelRetry=!0,this.playlistError=0,{action:he,flags:sr,nextAutoLevel:d}}return{action:he,flags:Pr}},r.onErrorOut=function(t,e){var i;switch((i=e.errorAction)==null?void 0:i.action){case ma:break;case he:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===_.FRAG_GAP?/MediaSource readyState: ended/.test(e.error.message)&&(this.warn('MediaSource ended after "'+e.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError()):e.fatal=!0}e.fatal&&this.hls.stopLoad()},r.sendAlternateToPenaltyBox=function(t){var e=this.hls,i=t.errorAction;if(i){var n=i.flags,o=i.nextAutoLevel;switch(n){case sr:this.switchLevel(t,o);break;case pa:var l=this.getVariantLevelIndex(t.frag),u=e.levels[l],d=u?.attrs["HDCP-LEVEL"];if(i.hdcpLevel=d,d==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(d){e.maxHdcpLevel=Ei[Ei.indexOf(d)-1],i.resolved=!0,this.warn('Restricting playback to HDCP-LEVEL of "'+e.maxHdcpLevel+'" or lower');break}case ya:var h=t.decryptdata;if(h){for(var f=this.hls.levels,c=f.length,g=c;g--;){var v,m;this.variantHasKey(f[g],h)&&(this.log("Banned key found in level "+g+" ("+f[g].bitrate+'bps) or audio group "'+((v=f[g].audioGroups)==null?void 0:v.join(","))+'" ('+((m=t.frag)==null?void 0:m.type)+" fragment) "+Vt(h.keyId||[])),f[g].fragmentError++,f[g].loadError++,this.log("Removing level "+g+" with key error ("+t.error+")"),this.hls.removeLevel(g))}var p=t.frag;if(this.hls.levels.length<c)i.resolved=!0;else if(p&&p.type!==Z){var E=p.decryptdata;E&&!h.matches(E)&&(i.resolved=!0)}}}i.resolved||this.switchLevel(t,o)}},r.switchLevel=function(t,e){if(e!==void 0&&t.errorAction&&(this.warn("switching to level "+e+" after "+t.details),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===_.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&t.sourceBufferName!=="audiovideo"))for(var i=yi(t.mimeType),n=this.hls.levels,o=n.length;o--;)n[o][t.sourceBufferName+"Codec"]===i&&(this.log("Removing level "+o+" for "+t.details+' ("'+i+'" not supported)'),this.hls.removeLevel(o))},s})(ee);function Ve(a){var s={action:ma,flags:sr};return a&&(s.resolved=!0),s}var or="NOT_LOADED",Ea="APPENDING",He="PARTIAL",Ye="OK",tl=(function(){function a(r){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=r,this._registerListeners()}var s=a.prototype;return s._registerListeners=function(){var r=this.hls;r&&(r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.BUFFER_APPENDED,this.onBufferAppended,this),r.on(y.FRAG_BUFFERED,this.onFragBuffered,this),r.on(y.FRAG_LOADED,this.onFragLoaded,this))},s._unregisterListeners=function(){var r=this.hls;r&&(r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.BUFFER_APPENDED,this.onBufferAppended,this),r.off(y.FRAG_BUFFERED,this.onFragBuffered,this),r.off(y.FRAG_LOADED,this.onFragLoaded,this))},s.destroy=function(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},s.getAppendedFrag=function(r,t){var e=this.activePartLists[t];if(e)for(var i=e.length;i--;){var n=e[i];if(!n)break;if(n.start<=r&&r<=n.end&&n.loaded)return n}return this.getBufferedFrag(r,t)},s.getBufferedFrag=function(r,t){return this.getFragAtPos(r,t,!0)},s.getFragAtPos=function(r,t,e){for(var i=this.fragments,n=Object.keys(i),o=n.length;o--;){var l=i[n[o]];if(l?.body.type===t&&(!e||l.buffered)){var u=l.body;if(u.start<=r&&r<=u.end)return u}}return null},s.detectEvictedFragments=function(r,t,e,i,n){var o=this;this.timeRanges&&(this.timeRanges[r]=t);var l=i?.fragment.sn||-1;Object.keys(this.fragments).forEach((function(u){var d=o.fragments[u];if(d&&!(l>=d.body.sn))if(d.buffered||d.loaded&&!n){var h=d.range[r];h&&(h.time.length!==0?h.time.some((function(f){var c=!o.isTimeBuffered(f.startPTS,f.endPTS,t);return c&&o.removeFragment(d.body),c})):o.removeFragment(d.body))}else d.body.type===e&&o.removeFragment(d.body)}))},s.detectPartialFragments=function(r){var t=this,e=this.timeRanges;if(e&&r.frag.sn!=="initSegment"){var i=r.frag,n=We(i),o=this.fragments[n];if(!(!o||o.buffered&&i.gap)){var l=!i.relurl;Object.keys(e).forEach((function(u){var d=i.elementaryStreams[u];if(d){var h=e[u],f=l||d.partial===!0;o.range[u]=t.getBufferedTimes(i,r.part,f,h)}})),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=i.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),Cr(o)||this.removeParts(i.sn-1,i.type)):this.removeFragment(o.body)}}},s.removeParts=function(r,t){var e=this.activePartLists[t];e&&(this.activePartLists[t]=Ta(e,(function(i){return i.fragment.sn>=r})))},s.fragBuffered=function(r,t){var e=We(r),i=this.fragments[e];!i&&t&&(i=this.fragments[e]={body:r,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},r.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},s.getBufferedTimes=function(r,t,e,i){for(var n={time:[],partial:e},o=r.start,l=r.end,u=r.minEndPTS||l,d=r.maxStartPTS||o,h=0;h<i.length;h++){var f=i.start(h)-this.bufferPadding,c=i.end(h)+this.bufferPadding;if(d>=f&&u<=c){n.time.push({startPTS:Math.max(o,i.start(h)),endPTS:Math.min(l,i.end(h))});break}if(o<c&&l>f){var g=Math.max(o,i.start(h)),v=Math.min(l,i.end(h));v>g&&(n.partial=!0,n.time.push({startPTS:g,endPTS:v}))}else if(l<=f)break}return n},s.getPartialFragment=function(r){var t,e,i,n=null,o=0,l=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach((function(d){var h=u[d];h&&Cr(h)&&(e=h.body.start-l,i=h.body.end+l,r>=e&&r<=i&&(t=Math.min(r-e,i-r),o<=t&&(n=h.body,o=t)))})),n},s.isEndListAppended=function(r){var t=this.endListFragments[r];return t!==void 0&&(t.buffered||Cr(t))},s.getState=function(r){var t=We(r),e=this.fragments[t];return e?e.buffered?Cr(e)?He:Ye:Ea:or},s.isTimeBuffered=function(r,t,e){for(var i,n,o=0;o<e.length;o++){if(i=e.start(o)-this.bufferPadding,n=e.end(o)+this.bufferPadding,r>=i&&t<=n)return!0;if(t<=i)return!1}return!1},s.onManifestLoading=function(){this.removeAllFragments()},s.onFragLoaded=function(r,t){if(t.frag.sn!=="initSegment"&&!t.frag.bitrateTest){var e=t.frag,i=t.part?null:t,n=We(e);this.fragments[n]={body:e,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}},s.onBufferAppended=function(r,t){var e=t.frag,i=t.part,n=t.timeRanges,o=t.type;if(e.sn!=="initSegment"){var l=e.type;if(i){var u=this.activePartLists[l];u||(this.activePartLists[l]=u=[]),u.push(i)}this.timeRanges=n;var d=n[o];this.detectEvictedFragments(o,d,l,i)}},s.onFragBuffered=function(r,t){this.detectPartialFragments(t)},s.hasFragment=function(r){var t=We(r);return!!this.fragments[t]},s.hasFragments=function(r){var t=this.fragments,e=Object.keys(t);if(!r)return e.length>0;for(var i=e.length;i--;){var n=t[e[i]];if(n?.body.type===r)return!0}return!1},s.hasParts=function(r){var t;return!((t=this.activePartLists[r])==null||!t.length)},s.removeFragmentsInRange=function(r,t,e,i,n){var o=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach((function(l){var u=o.fragments[l];if(u){var d=u.body;d.type!==e||i&&!d.gap||d.start<t&&d.end>r&&(u.buffered||n)&&o.removeFragment(d)}}))},s.removeFragment=function(r){var t=We(r);r.clearElementaryStreamInfo();var e=this.activePartLists[r.type];if(e){var i=r.sn;this.activePartLists[r.type]=Ta(e,(function(n){return n.fragment.sn!==i}))}delete this.fragments[t],r.endList&&delete this.endListFragments[r.type]},s.removeAllFragments=function(){var r;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var t=(r=this.hls)==null||(r=r.latestLevelDetails)==null?void 0:r.partList;t&&t.forEach((function(e){return e.clearElementaryStreamInfo()}))},a})();function Cr(a){var s,r,t;return a.buffered&&!!(a.body.gap||(s=a.range.video)!=null&&s.partial||(r=a.range.audio)!=null&&r.partial||(t=a.range.audiovideo)!=null&&t.partial)}function We(a){return a.type+"_"+a.level+"_"+a.sn}function Ta(a,s){return a.filter((function(r){var t=s(r);return t||r.clearElementaryStreamInfo(),t}))}var lr=0,Ai=1,el=(function(){function a(s,r,t){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=s,this.aesIV=r,this.aesMode=t}return a.prototype.decrypt=function(s,r){switch(this.aesMode){case lr:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,s);case Ai:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},r,s);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},a})(),rl=(function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var s=a.prototype;return s.uint8ArrayToUint32Array_=function(r){for(var t=new DataView(r),e=new Uint32Array(4),i=0;i<4;i++)e[i]=t.getUint32(4*i);return e},s.initTable=function(){var r=this.sBox,t=this.invSBox,e=this.subMix,i=e[0],n=e[1],o=e[2],l=e[3],u=this.invSubMix,d=u[0],h=u[1],f=u[2],c=u[3],g=new Uint32Array(256),v=0,m=0,p=0;for(p=0;p<256;p++)g[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var E=m^m<<1^m<<2^m<<3^m<<4;E=E>>>8^255&E^99,r[v]=E,t[E]=v;var T=g[v],S=g[T],R=g[S],A=257*g[E]^16843008*E;i[v]=A<<24|A>>>8,n[v]=A<<16|A>>>16,o[v]=A<<8|A>>>24,l[v]=A,A=16843009*R^65537*S^257*T^16843008*v,d[E]=A<<24|A>>>8,h[E]=A<<16|A>>>16,f[E]=A<<8|A>>>24,c[E]=A,v?(v=T^g[g[g[R^T]]],m^=g[g[m]]):v=m=1}},s.expandKey=function(r){for(var t=this.uint8ArrayToUint32Array_(r),e=!0,i=0;i<t.length&&e;)e=t[i]===this.key[i],i++;if(!e){this.key=t;var n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);var o,l,u,d,h=this.ksRows=4*(n+6+1),f=this.keySchedule=new Uint32Array(h),c=this.invKeySchedule=new Uint32Array(h),g=this.sBox,v=this.rcon,m=this.invSubMix,p=m[0],E=m[1],T=m[2],S=m[3];for(o=0;o<h;o++)o<n?u=f[o]=t[o]:(d=u,o%n==0?(d=g[(d=d<<8|d>>>24)>>>24]<<24|g[d>>>16&255]<<16|g[d>>>8&255]<<8|g[255&d],d^=v[o/n|0]<<24):n>6&&o%n==4&&(d=g[d>>>24]<<24|g[d>>>16&255]<<16|g[d>>>8&255]<<8|g[255&d]),f[o]=u=(f[o-n]^d)>>>0);for(l=0;l<h;l++)o=h-l,d=3&l?f[o]:f[o-4],c[l]=l<4||o<=4?d:p[g[d>>>24]]^E[g[d>>>16&255]]^T[g[d>>>8&255]]^S[g[255&d]],c[l]=c[l]>>>0}},s.networkToHostOrderSwap=function(r){return r<<24|(65280&r)<<8|(16711680&r)>>8|r>>>24},s.decrypt=function(r,t,e){for(var i,n,o,l,u,d,h,f,c,g,v,m,p,E,T=this.keySize+6,S=this.invKeySchedule,R=this.invSBox,A=this.invSubMix,L=A[0],b=A[1],k=A[2],I=A[3],D=this.uint8ArrayToUint32Array_(e),P=D[0],M=D[1],O=D[2],w=D[3],F=new Int32Array(r),x=new Int32Array(F.length),N=this.networkToHostOrderSwap;t<F.length;){for(c=N(F[t]),g=N(F[t+1]),v=N(F[t+2]),m=N(F[t+3]),u=c^S[0],d=m^S[1],h=v^S[2],f=g^S[3],p=4,E=1;E<T;E++)i=L[u>>>24]^b[d>>16&255]^k[h>>8&255]^I[255&f]^S[p],n=L[d>>>24]^b[h>>16&255]^k[f>>8&255]^I[255&u]^S[p+1],o=L[h>>>24]^b[f>>16&255]^k[u>>8&255]^I[255&d]^S[p+2],l=L[f>>>24]^b[u>>16&255]^k[d>>8&255]^I[255&h]^S[p+3],u=i,d=n,h=o,f=l,p+=4;i=R[u>>>24]<<24^R[d>>16&255]<<16^R[h>>8&255]<<8^R[255&f]^S[p],n=R[d>>>24]<<24^R[h>>16&255]<<16^R[f>>8&255]<<8^R[255&u]^S[p+1],o=R[h>>>24]<<24^R[f>>16&255]<<16^R[u>>8&255]<<8^R[255&d]^S[p+2],l=R[f>>>24]<<24^R[u>>16&255]<<16^R[d>>8&255]<<8^R[255&h]^S[p+3],x[t]=N(i^P),x[t+1]=N(l^M),x[t+2]=N(o^O),x[t+3]=N(n^w),P=c,M=g,O=v,w=m,t+=4}return x.buffer},a})(),il=(function(){function a(s,r,t){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=s,this.key=r,this.aesMode=t}return a.prototype.expandKey=function(){var s=(function(r){switch(r){case lr:return"AES-CBC";case Ai:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+r)}})(this.aesMode);return this.subtle.importKey("raw",this.key,{name:s},!1,["encrypt","decrypt"])},a})(),Li=(function(){function a(r,t){var e=(t===void 0?{}:t).removePKCS7Padding,i=e===void 0||e;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=r.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var s=a.prototype;return s.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},s.isSync=function(){return this.useSoftware},s.flush=function(){var r=this.currentResult,t=this.remainderData;if(!r||t)return this.reset(),null;var e,i,n,o=new Uint8Array(r);return this.reset(),this.removePKCS7Padding?(i=(e=o).byteLength,(n=i&&new DataView(e.buffer).getUint8(i-1))?e.slice(0,i-n):e):o},s.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},s.decrypt=function(r,t,e,i){var n=this;return this.useSoftware?new Promise((function(o,l){var u=ArrayBuffer.isView(r)?r:new Uint8Array(r);n.softwareDecrypt(u,t,e,i);var d=n.flush();d?o(d.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(r),t,e,i)},s.softwareDecrypt=function(r,t,e,i){var n=this.currentIV,o=this.currentResult,l=this.remainderData;if(i!==lr||t.byteLength!==16)return ct.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(r=re(l,r),this.remainderData=null);var u=this.getValidChunk(r);if(!u.length)return null;n&&(e=n);var d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new rl),d.expandKey(t);var h=o;return this.currentResult=d.decrypt(u.buffer,0,e),this.currentIV=u.slice(-16).buffer,h||null},s.webCryptoDecrypt=function(r,t,e,i){var n=this;if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(r,t,e,i));this.key=t,this.fastAesKey=new il(this.subtle,t,i)}return this.fastAesKey.expandKey().then((function(o){return n.subtle?(n.logOnce("WebCrypto AES decrypt"),new el(n.subtle,new Uint8Array(e),i).decrypt(r.buffer,o)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(o){return ct.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+o.name+": "+o.message),n.onWebCryptoError(r,t,e,i)}))},s.onWebCryptoError=function(r,t,e,i){var n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(r,t,e,i);var o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")},s.getValidChunk=function(r){var t=r,e=r.length-r.length%16;return e!==r.length&&(t=r.slice(0,e),this.remainderData=r.slice(e)),t},s.logOnce=function(r){this.logEnabled&&(ct.log("[decrypter]: "+r),this.logEnabled=!1)},a})(),Sa=Math.pow(2,17),nl=(function(){function a(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var s=a.prototype;return s.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},s.abort=function(){this.loader&&this.loader.abort()},s.load=function(r,t){var e=this,i=r.url;if(!i)return Promise.reject(new pe({type:K.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var n=this.config,o=n.fLoader,l=n.loader;return new Promise((function(u,d){if(e.loader&&e.loader.destroy(),r.gap){if(r.tagList.some((function(m){return m[0]==="GAP"})))return void d(La(r));r.gap=!1}var h=e.loader=o?new o(n):new l(n),f=Aa(r);r.loader=h;var c=va(n.fragLoadPolicy.default),g={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:r.sn==="initSegment"?1/0:Sa};r.stats=h.stats;var v={onSuccess:function(m,p,E,T){e.resetLoader(r,h);var S=m.data;E.resetIV&&r.decryptdata&&(r.decryptdata.iv=new Uint8Array(S.slice(0,16)),S=S.slice(16)),u({frag:r,part:null,payload:S,networkDetails:T})},onError:function(m,p,E,T){e.resetLoader(r,h),d(new pe({type:K.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:ft({url:i,data:void 0},m),error:new Error("HTTP Error "+m.code+" "+m.text),networkDetails:E,stats:T}))},onAbort:function(m,p,E){e.resetLoader(r,h),d(new pe({type:K.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:r,error:new Error("Aborted"),networkDetails:E,stats:m}))},onTimeout:function(m,p,E){e.resetLoader(r,h),d(new pe({type:K.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:E,stats:m}))}};t&&(v.onProgress=function(m,p,E,T){return t({frag:r,part:null,payload:E,networkDetails:T})}),h.load(f,g,v)}))},s.loadPart=function(r,t,e){var i=this;this.abort();var n=this.config,o=n.fLoader,l=n.loader;return new Promise((function(u,d){if(i.loader&&i.loader.destroy(),r.gap||t.gap)d(La(r,t));else{var h=i.loader=o?new o(n):new l(n),f=Aa(r,t);r.loader=h;var c=va(n.fragLoadPolicy.default),g={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Sa};t.stats=h.stats,h.load(f,g,{onSuccess:function(v,m,p,E){i.resetLoader(r,h),i.updateStatsFromPart(r,t);var T={frag:r,part:t,payload:v.data,networkDetails:E};e(T),u(T)},onError:function(v,m,p,E){i.resetLoader(r,h),d(new pe({type:K.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:t,response:ft({url:f.url,data:void 0},v),error:new Error("HTTP Error "+v.code+" "+v.text),networkDetails:p,stats:E}))},onAbort:function(v,m,p){r.stats.aborted=t.stats.aborted,i.resetLoader(r,h),d(new pe({type:K.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:r,part:t,error:new Error("Aborted"),networkDetails:p,stats:v}))},onTimeout:function(v,m,p){i.resetLoader(r,h),d(new pe({type:K.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:t,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:p,stats:v}))}})}}))},s.updateStatsFromPart=function(r,t){var e=r.stats,i=t.stats,n=i.total;if(e.loaded+=i.loaded,n){var o=Math.round(r.duration/t.duration),l=Math.min(Math.round(e.loaded/n),o),u=(o-l)*Math.round(e.loaded/l);e.total=e.loaded+u}else e.total=Math.max(e.loaded,e.total);var d=e.loading,h=i.loading;d.start?d.first+=h.first-h.start:(d.start=h.start,d.first=h.first),d.end=h.end},s.resetLoader=function(r,t){r.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},a})();function Aa(a,s){s===void 0&&(s=null);var r,t=s||a,e={frag:a,part:s,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(B(i)&&B(n)){var o,l=i,u=n;if(a.sn==="initSegment"&&((r=(o=a.decryptdata)==null?void 0:o.method)==="AES-128"||r==="AES-256")){var d=n-i;d%16&&(u=n+(16-d%16)),i!==0&&(e.resetIV=!0,l=i-16)}e.rangeStart=l,e.rangeEnd=u}return e}function La(a,s){var r=new Error("GAP "+(a.gap?"tag":"attribute")+" found"),t={type:K.MEDIA_ERROR,details:_.FRAG_GAP,fatal:!1,frag:a,error:r,networkDetails:null};return s&&(t.part=s),(s||a).stats.aborted=!0,new pe(t)}var pe=(function(a){function s(r){var t;return(t=a.call(this,r.error.message)||this).data=void 0,t.data=r,t}return ut(s,a),s})(Be(Error)),Ia=(function(a){function s(t,e){var i;return(i=a.call(this,t,e)||this)._boundTick=void 0,i._tickTimer=null,i._tickInterval=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}ut(s,a);var r=s.prototype;return r.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},r.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},r.onHandlerDestroyed=function(){},r.hasInterval=function(){return!!this._tickInterval},r.hasNextTick=function(){return!!this._tickTimer},r.setInterval=function(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)},r.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},r.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},r.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},r.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},r.doTick=function(){},s})(ee),Ii=function(a,s,r,t,e,i){t===void 0&&(t=0),e===void 0&&(e=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=a,this.sn=s,this.id=r,this.size=t,this.part=e,this.partial=i},Ra={length:0,start:function(){return 0},end:function(){return 0}},tt=(function(){function a(){}return a.isBuffered=function(s,r){if(s){for(var t=a.getBuffered(s),e=t.length;e--;)if(r>=t.start(e)&&r<=t.end(e))return!0}return!1},a.bufferedRanges=function(s){if(s){var r=a.getBuffered(s);return a.timeRangesToArray(r)}return[]},a.timeRangesToArray=function(s){for(var r=[],t=0;t<s.length;t++)r.push({start:s.start(t),end:s.end(t)});return r},a.bufferInfo=function(s,r,t){if(s){var e=a.bufferedRanges(s);if(e.length)return a.bufferedInfo(e,r,t)}return{len:0,start:r,end:r,bufferedIndex:-1}},a.bufferedInfo=function(s,r,t){r=Math.max(0,r),s.length>1&&s.sort((function(m,p){return m.start-p.start||p.end-m.end}));var e=-1,i=[];if(t)for(var n=0;n<s.length;n++){r>=s[n].start&&r<=s[n].end&&(e=n);var o=i.length;if(o){var l=i[o-1].end;s[n].start-l<t?s[n].end>l&&(i[o-1].end=s[n].end):i.push(s[n])}else i.push(s[n])}else i=s;for(var u,d=0,h=r,f=r,c=0;c<i.length;c++){var g=i[c].start,v=i[c].end;if(e===-1&&r>=g&&r<=v&&(e=c),r+t>=g&&r<v)h=g,d=(f=v)-r;else if(r+t<g){u=g;break}}return{len:d,start:h||0,end:f||0,nextStart:u,buffered:s,bufferedIndex:e}},a.getBuffered=function(s){try{return s.buffered||Ra}catch(r){return ct.log("failed to get media.buffered",r),Ra}},a})(),ka=/\{\$([a-zA-Z0-9-_]+)\}/g;function ba(a){return ka.test(a)}function Ri(a,s){if(a.variableList!==null||a.hasVariableRefs){var r=a.variableList;return s.replace(ka,(function(t){var e=t.substring(2,t.length-1),i=r?.[e];return i===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+e+'"')),t):i}))}return s}function Da(a,s,r){var t,e,i=a.variableList;if(i||(a.variableList=i={}),"QUERYPARAM"in s){t=s.QUERYPARAM;try{var n=new self.URL(r).searchParams;if(!n.has(t))throw new Error('"'+t+'" does not match any query parameter in URI: "'+r+'"');e=n.get(t)}catch(o){a.playlistParsingError||(a.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+o.message))}}else t=s.NAME,e=s.VALUE;t in i?a.playlistParsingError||(a.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+t+'"')):i[t]=e||""}function al(a,s,r){var t=s.IMPORT;if(r&&t in r){var e=a.variableList;e||(a.variableList=e={}),e[t]=r[t]}else a.playlistParsingError||(a.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+t+'"'))}var sl=/^(\d+)x(\d+)$/,_a=/(.+?)=(".*?"|.*?)(?:,|$)/g,Pt=(function(){function a(r,t){typeof r=="string"&&(r=a.parseAttrList(r,t)),mt(this,r)}var s=a.prototype;return s.decimalInteger=function(r){var t=parseInt(this[r],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},s.hexadecimalInteger=function(r){if(this[r]){var t=(this[r]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var e=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)e[i]=parseInt(t.slice(2*i,2*i+2),16);return e}return null},s.hexadecimalIntegerAsNumber=function(r){var t=parseInt(this[r],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},s.decimalFloatingPoint=function(r){return parseFloat(this[r])},s.optionalFloat=function(r,t){var e=this[r];return e?parseFloat(e):t},s.enumeratedString=function(r){return this[r]},s.enumeratedStringList=function(r,t){var e=this[r];return(e?e.split(/[ ,]+/):[]).reduce((function(i,n){return i[n.toLowerCase()]=!0,i}),t)},s.bool=function(r){return this[r]==="YES"},s.decimalResolution=function(r){var t=sl.exec(this[r]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},a.parseAttrList=function(r,t){var e,i={};for(_a.lastIndex=0;(e=_a.exec(r))!==null;){var n=e[1].trim(),o=e[2],l=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1,u=!1;if(l)o=o.slice(1,-1);else switch(n){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=Ri(t,o);else if(!u&&!l)switch(n){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":ct.warn(r+": attribute "+n+" is missing quotes")}i[n]=o}return i},yt(a,[{key:"clientAttrs",get:function(){return Object.keys(this).filter((function(r){return r.substring(0,2)==="X-"}))}}])})();function ol(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"||a==="SCTE35-CMD"}var Pa=(function(){return yt((function(a,s,r){var t;if(r===void 0&&(r=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=s?.tagAnchor||null,this.tagOrder=(t=s?.tagOrder)!=null?t:r,s){var e=s.attr;for(var i in e)if(Object.prototype.hasOwnProperty.call(a,i)&&a[i]!==e[i]){ct.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+a.ID+'"'),this._badValueForSameId=i;break}a=mt(new Pt({}),e,a)}if(this.attr=a,s?(this._startDate=s._startDate,this._cue=s._cue,this._endDate=s._endDate,this._dateAtEnd=s._dateAtEnd):this._startDate=new Date(a["START-DATE"]),"END-DATE"in this.attr){var n=s?.endDate||new Date(this.attr["END-DATE"]);B(n.getTime())&&(this._endDate=n)}}),[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var a=this._cue;return a===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):a}},{key:"startTime",get:function(){var a=this.tagAnchor;return a===null||a.programDateTime===null?(ct.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+a),NaN):a.start+(this.startDate.getTime()-a.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var a=this._endDate||this._dateAtEnd;if(a)return a;var s=this.duration;return s!==null?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*s):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var a=this.attr.decimalFloatingPoint("DURATION");if(B(a))return a}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class==="com.apple.hls.interstitial"}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&B(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])})(),ll=(function(){function a(r){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=r}var s=a.prototype;return s.reloaded=function(r){if(!r)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-r.lastPartSn,e=this.lastPartIndex-r.lastPartIndex;this.updated=this.endSN!==r.endSN||!!e||!!t||!this.live,this.advanced=this.endSN>r.endSN||t>0||t===0&&e>0,this.updated||this.advanced?this.misses=Math.floor(.6*r.misses):this.misses=r.misses+1},s.hasKey=function(r){return this.encryptedFragments.some((function(t){var e=t.decryptdata;return e||(t.setKeyFormat(r.keyFormat),e=t.decryptdata),!!e&&r.matches(e)}))},yt(a,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&B(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var r=this.driftEndTime-this.driftStartTime;return r>0?1e3*(this.driftEnd-this.driftStart)/r:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){return this.fragments.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var r=this.partList;if(r){var t=this.lastPartIndex;if(t!==-1){for(var e=r.length;e--;)if(r[e].index>t)return r[e].index;return t}}return 0}},{key:"lastPartSn",get:function(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var r=this.partEnd-this.fragmentStart;return this.age>Math.max(r,this.totalduration)+this.levelTargetDuration}return!1}}])})();function ki(a,s){return a.length===s.length&&!a.some((function(r,t){return r!==s[t]}))}function Ca(a,s){return!a&&!s||!(!a||!s)&&ki(a,s)}function je(a){return a==="AES-128"||a==="AES-256"||a==="AES-256-CTR"}function bi(a){switch(a){case"AES-128":case"AES-256":return lr;case"AES-256-CTR":return Ai;default:throw new Error("invalid full segment method "+a)}}function Di(a){return Uint8Array.from(atob(a),(function(s){return s.charCodeAt(0)}))}function _i(a){return Uint8Array.from(unescape(encodeURIComponent(a)),(function(s){return s.charCodeAt(0)}))}function wa(a){var s=function(r,t,e){var i=r[t];r[t]=r[e],r[e]=i};s(a,0,3),s(a,1,2),s(a,4,5),s(a,6,7)}function ul(a){var s,r,t=a.split(":"),e=null;if(t[0]==="data"&&t.length===2){var i=t[1].split(";"),n=i[i.length-1].split(",");if(n.length===2){var o=n[0]==="base64",l=n[1];o?(i.splice(-1,1),e=Di(l)):(s=_i(l).subarray(0,16),(r=new Uint8Array(16)).set(s,16-s.length),e=r)}}return e}var wr=typeof self<"u"?self:void 0,kt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Pi="org.w3.clearkey",Or="com.apple.streamingkeydelivery",xr="com.microsoft.playready",Mr="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Fr(a){switch(a){case Or:return kt.FAIRPLAY;case xr:return kt.PLAYREADY;case Mr:return kt.WIDEVINE;case Pi:return kt.CLEARKEY}}function Ci(a){switch(a){case kt.FAIRPLAY:return Or;case kt.PLAYREADY:return xr;case kt.WIDEVINE:return Mr;case kt.CLEARKEY:return Pi}}function ur(a){var s=a.drmSystems,r=a.widevineLicenseUrl,t=s?[kt.FAIRPLAY,kt.WIDEVINE,kt.PLAYREADY,kt.CLEARKEY].filter((function(e){return!!s[e]})):[];return!t[kt.WIDEVINE]&&r&&t.push(kt.WIDEVINE),t}var Oa,xa=wr!=null&&(Oa=wr.navigator)!=null&&Oa.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null,Nr={},Ma=(function(){function a(r,t,e,i,n,o){i===void 0&&(i=[1]),n===void 0&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=r,this.uri=t,this.keyFormat=e,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!r&&r!=="NONE",this.isCommonEncryption=this.encrypted&&!je(r),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(Fn(o)))}a.clearKeyUriToKeyIdMap=function(){Nr={}},a.setKeyIdForUri=function(r,t){Nr[r]=t};var s=a.prototype;return s.matches=function(r){return r.uri===this.uri&&r.method===this.method&&r.encrypted===this.encrypted&&r.keyFormat===this.keyFormat&&ki(r.keyFormatVersions,this.keyFormatVersions)&&Ca(r.iv,this.iv)&&Ca(r.keyId,this.keyId)},s.isSupported=function(){if(this.method){if(je(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Or:case Mr:case xr:case Pi:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},s.getDecryptData=function(r){if(!this.encrypted||!this.uri)return null;if(je(this.method)){var t=this.iv;return t||(typeof r!="number"&&(ct.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),r=0),t=(function(g){for(var v=new Uint8Array(16),m=12;m<16;m++)v[m]=g>>8*(15-m)&255;return v})(r)),new a(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.pssh&&this.keyId)return this;var e=ul(this.uri);if(e)switch(this.keyFormat){case Mr:if(this.pssh=e,!this.keyId){var i=(function(g){var v=[];if(g instanceof ArrayBuffer)for(var m=g.byteLength,p=0;p+32<m;){var E=Vo(new DataView(g,p));v.push(E),p+=E.size}return v})(e.buffer);if(i.length){var n,o=i[0];this.keyId=(n=o.kids)!=null&&n.length?o.kids[0]:null}}if(!this.keyId){var l=e.length-22;this.keyId=e.subarray(l,l+16)}break;case xr:var u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ko(u,0,e),this.keyId=(function(g){var v=new Uint16Array(g.buffer,g.byteOffset,g.byteLength/2),m=String.fromCharCode.apply(null,Array.from(v)),p=m.substring(m.indexOf("<"),m.length),E=new DOMParser().parseFromString(p,"text/xml").getElementsByTagName("KID")[0];if(E){var T=E.childNodes[0]?E.childNodes[0].nodeValue:E.getAttribute("VALUE");if(T){var S=Di(T).subarray(0,16);return wa(S),S}}return null})(e);break;default:var d=e.subarray(0,16);if(d.length!==16){var h=new Uint8Array(16);h.set(d,16-d.length),d=h}this.keyId=d}if(!this.keyId||this.keyId.byteLength!==16){var f=Nr[this.uri];if(!f){var c=Object.keys(Nr).length%Number.MAX_SAFE_INTEGER;f=new Uint8Array(16),new DataView(f.buffer,12,4).setUint32(0,c),a.setKeyIdForUri(this.uri,f)}this.keyId=f}return this},a})(),Fa=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Na=/#EXT-X-MEDIA:(.*)/g,dl=/^#EXT(?:INF|-X-TARGETDURATION):/m,wi=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),hl=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),dr=(function(){function a(){}return a.findGroup=function(s,r){for(var t=0;t<s.length;t++){var e=s[t];if(e.id===r)return e}},a.resolve=function(s,r){return oi.buildAbsoluteURL(r,s,{alwaysNormalize:!0})},a.isMediaPlaylist=function(s){return dl.test(s)},a.parseMasterPlaylist=function(s,r){var t,e={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:ba(s)},i=[];if(Fa.lastIndex=0,!s.startsWith("#EXTM3U"))return e.playlistParsingError=new Error("no EXTM3U delimiter"),e;for(;(t=Fa.exec(s))!=null;)if(t[1]){var n,o=new Pt(t[1],e),l=Ri(e,t[2]),u={attrs:o,bitrate:o.decimalInteger("BANDWIDTH")||o.decimalInteger("AVERAGE-BANDWIDTH"),name:o.NAME,url:a.resolve(l,r)},d=o.decimalResolution("RESOLUTION");d&&(u.width=d.width,u.height=d.height),Ka(o.CODECS,u);var h=o["SUPPLEMENTAL-CODECS"];h&&(u.supplemental={},Ka(h,u.supplemental)),(n=u.unknownCodecs)!=null&&n.length||i.push(u),e.levels.push(u)}else if(t[3]){var f=t[3],c=t[4];switch(f){case"SESSION-DATA":var g=new Pt(c,e),v=g["DATA-ID"];v&&(e.sessionData===null&&(e.sessionData={}),e.sessionData[v]=g);break;case"SESSION-KEY":var m=Ba(c,r,e);m.encrypted&&m.isSupported()?(e.sessionKeys===null&&(e.sessionKeys=[]),e.sessionKeys.push(m)):ct.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+c+'"');break;case"DEFINE":Da(e,new Pt(c,e),r);break;case"CONTENT-STEERING":var p=new Pt(c,e);e.contentSteering={uri:a.resolve(p["SERVER-URI"],r),pathwayId:p["PATHWAY-ID"]||"."};break;case"START":e.startTimeOffset=Ga(c)}}var E=i.length>0&&i.length<e.levels.length;return e.levels=E?i:e.levels,e.levels.length===0&&(e.playlistParsingError=new Error("no levels found in manifest")),e},a.parseMasterPlaylistMedia=function(s,r,t){var e,i={},n=t.levels,o={AUDIO:n.map((function(S){return{id:S.attrs.AUDIO,audioCodec:S.audioCodec}})),SUBTITLES:n.map((function(S){return{id:S.attrs.SUBTITLES,textCodec:S.textCodec}})),"CLOSED-CAPTIONS":[]},l=0;for(Na.lastIndex=0;(e=Na.exec(s))!==null;){var u=new Pt(e[1],t),d=u.TYPE;if(d){var h=o[d],f=i[d]||[];i[d]=f;var c=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],v=u.CHANNELS,m=u.CHARACTERISTICS,p=u["INSTREAM-ID"],E={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||c||"",type:d,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:c,url:u.URI?a.resolve(u.URI,r):""};if(g&&(E.assocLang=g),v&&(E.channels=v),m&&(E.characteristics=m),p&&(E.instreamId=p),h!=null&&h.length){var T=a.findGroup(h,E.groupId)||h[0];Va(E,T,"audioCodec"),Va(E,T,"textCodec")}f.push(E)}}return i},a.parseLevelPlaylist=function(s,r,t,e,i,n){var o,l,u,d,h,f={url:r},c=new ll(r),g=c.fragments,v=[],m=null,p=0,E=0,T=0,S=0,R=0,A=null,L=new fi(e,f),b=-1,k=!1,I=null;if(wi.lastIndex=0,c.m3u8=s,c.hasVariableRefs=ba(s),((o=wi.exec(s))==null?void 0:o[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(l=wi.exec(s))!==null;){k&&(k=!1,(L=new fi(e,f)).playlistOffset=T,L.setStart(T),L.sn=p,L.cc=S,R&&(L.bitrate=R),L.level=t,m&&(L.initSegment=m,m.rawProgramDateTime&&(L.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),I&&(L.setByteRange(I),I=null)));var D=l[1];if(D){L.duration=parseFloat(D);var P=(" "+l[2]).slice(1);L.title=P||null,L.tagList.push(P?["INF",D,P]:["INF",D])}else if(l[3]){if(B(L.duration)){L.playlistOffset=T,L.setStart(T),d&&Ya(L,d,c),L.sn=p,L.level=t,L.cc=S,g.push(L);var M=(" "+l[3]).slice(1);L.relurl=Ri(c,M),Oi(L,A,v),A=L,T+=L.duration,p++,E=0,k=!0}}else{if(!(l=l[0].match(hl))){ct.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length&&l[u]===void 0;u++);var O=(" "+l[u]).slice(1),w=(" "+l[u+1]).slice(1),F=l[u+2]?(" "+l[u+2]).slice(1):null;switch(O){case"BYTERANGE":A?L.setByteRange(w,A):L.setByteRange(w);break;case"PROGRAM-DATE-TIME":L.rawProgramDateTime=w,L.tagList.push(["PROGRAM-DATE-TIME",w]),b===-1&&(b=g.length);break;case"PLAYLIST-TYPE":c.type&&ye(c,O,l),c.type=w.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?ye(c,O,l):g.length>0&&Wa(c,O,l),p=c.startSN=parseInt(w);break;case"SKIP":c.skippedSegments&&ye(c,O,l);var x=new Pt(w,c),N=x.decimalInteger("SKIPPED-SEGMENTS");if(B(N)){c.skippedSegments+=N;for(var H=N;H--;)g.push(null);p+=N}var U=x.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(U.split("	")));break;case"TARGETDURATION":c.targetduration!==0&&ye(c,O,l),c.targetduration=Math.max(parseInt(w),1);break;case"VERSION":c.version!==null&&ye(c,O,l),c.version=parseInt(w);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||ye(c,O,l),c.live=!1;break;case"#":(w||F)&&L.tagList.push(F?[w,F]:[w]);break;case"DISCONTINUITY":S++,L.tagList.push(["DIS"]);break;case"GAP":L.gap=!0,L.tagList.push([O]);break;case"BITRATE":L.tagList.push([O,w]),R=1e3*parseInt(w),B(R)?L.bitrate=R:R=0;break;case"DATERANGE":var G=new Pt(w,c),X=new Pa(G,c.dateRanges[G.ID],c.dateRangeTagCount);c.dateRangeTagCount++,X.isValid||c.skippedSegments?c.dateRanges[X.id]=X:ct.warn('Ignoring invalid DATERANGE tag: "'+w+'"'),L.tagList.push(["EXT-X-DATERANGE",w]);break;case"DEFINE":var $=new Pt(w,c);"IMPORT"in $?al(c,$,n):Da(c,$,r);break;case"DISCONTINUITY-SEQUENCE":c.startCC!==0?ye(c,O,l):g.length>0&&Wa(c,O,l),c.startCC=S=parseInt(w);break;case"KEY":var Y=Ba(w,r,c);if(Y.isSupported()){if(Y.method==="NONE"){d=void 0;break}d||(d={});var dt=d[Y.keyFormat];dt!=null&&dt.matches(Y)||(dt&&(d=mt({},d)),d[Y.keyFormat]=Y)}else ct.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'+w+'"');break;case"START":c.startTimeOffset=Ga(w);break;case"MAP":var rt=new Pt(w,c);if(L.duration){var V=new fi(e,f);Ha(V,rt,t,d),m=V,L.initSegment=m,m.rawProgramDateTime&&!L.rawProgramDateTime&&(L.rawProgramDateTime=m.rawProgramDateTime)}else{var Tt=L.byteRangeEndOffset;if(Tt){var Q=L.byteRangeStartOffset;I=Tt-Q+"@"+Q}else I=null;Ha(L,rt,t,d),m=L,k=!0}m.cc=S;break;case"SERVER-CONTROL":h&&ye(c,O,l),h=new Pt(w),c.canBlockReload=h.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=h.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&h.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=h.optionalFloat("PART-HOLD-BACK",0),c.holdBack=h.optionalFloat("HOLD-BACK",0);break;case"PART-INF":c.partTarget&&ye(c,O,l);var nt=new Pt(w);c.partTarget=nt.decimalFloatingPoint("PART-TARGET");break;case"PART":var W=c.partList;W||(W=c.partList=[]);var ht=E>0?W[W.length-1]:void 0,It=E++,it=new Pt(w,c),et=new Fo(it,L,f,It,ht);W.push(et),L.duration+=et.duration;break;case"PRELOAD-HINT":var Dt=new Pt(w,c);c.preloadHint=Dt;break;case"RENDITION-REPORT":var at=new Pt(w,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(at);break;default:ct.warn("line parsed but not handled: "+l)}}}A&&!A.relurl?(g.pop(),T-=A.duration,c.partList&&(c.fragmentHint=A)):c.partList&&(Oi(L,A,v),L.cc=S,c.fragmentHint=L,d&&Ya(L,d,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));var j=g.length,Ot=g[0],q=g[j-1];if((T+=c.skippedSegments*c.targetduration)>0&&j&&q){c.averagetargetduration=T/j;var gt=q.sn;c.endSN=gt!=="initSegment"?gt:0,c.live||(q.endList=!0),b>0&&((function(ot,St){for(var At=ot[St],Ct=St;Ct--;){var st=ot[Ct];if(!st)return;st.programDateTime=At.programDateTime-1e3*st.duration,At=st}})(g,b),Ot&&v.unshift(Ot))}return c.fragmentHint&&(T+=c.fragmentHint.duration),c.totalduration=T,v.length&&c.dateRangeTagCount&&Ot&&Ua(v,c),c.endCC=S,c},a})();function Ua(a,s){var r=a.length;if(!r){if(!s.hasProgramDateTime)return;var t=s.fragments[s.fragments.length-1];a.push(t),r++}for(var e=a[r-1],i=s.live?1/0:s.totalduration,n=Object.keys(s.dateRanges),o=n.length;o--;){var l=s.dateRanges[n[o]],u=l.startDate.getTime();l.tagAnchor=e.ref;for(var d=r;d--;){var h;if(((h=a[d])==null?void 0:h.sn)<s.startSN)break;var f=fl(s,u,a,d,i);if(f!==-1){l.tagAnchor=s.fragments[f].ref;break}}}}function fl(a,s,r,t,e){var i=r[t];if(i){var n,o=i.programDateTime;if((s>=o||t===0)&&s<=o+1e3*((((n=r[t+1])==null?void 0:n.start)||e)-i.start)){var l=r[t].sn-a.startSN;if(l<0)return-1;var u=a.fragments;if(u.length>r.length)for(var d=(r[t+1]||u[u.length-1]).sn-a.startSN;d>l;d--){var h=u[d].programDateTime;if(s>=h&&s<h+1e3*u[d].duration)return d}return l}}return-1}function Ba(a,s,r){var t,e,i=new Pt(a,r),n=(t=i.METHOD)!=null?t:"",o=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,d=(e=i.KEYFORMAT)!=null?e:"identity";o&&i.IV&&!l&&ct.error("Invalid IV: "+i.IV);var h=o?dr.resolve(o,s):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Ma(n,h,d,f,l,i.KEYID)}function Ga(a){var s=new Pt(a).decimalFloatingPoint("TIME-OFFSET");return B(s)?s:null}function Ka(a,s){var r=(a||"").split(/[ ,]+/).filter((function(t){return t}));["video","audio","text"].forEach((function(t){var e=r.filter((function(i){return vi(i,t)}));e.length&&(s[t+"Codec"]=e.map((function(i){return i.split("/")[0]})).join(","),r=r.filter((function(i){return e.indexOf(i)===-1})))})),s.unknownCodecs=r}function Va(a,s,r){var t=s[r];t&&(a[r]=t)}function Oi(a,s,r){a.rawProgramDateTime?r.push(a):s!=null&&s.programDateTime&&(a.programDateTime=s.endProgramDateTime)}function Ha(a,s,r,t){a.relurl=s.URI,s.BYTERANGE&&a.setByteRange(s.BYTERANGE),a.level=r,a.sn="initSegment",t&&(a.levelkeys=t),a.initSegment=null}function Ya(a,s,r){a.levelkeys=s;var t=r.encryptedFragments;t.length&&t[t.length-1].levelkeys===s||!Object.keys(s).some((function(e){return s[e].isCommonEncryption}))||t.push(a)}function ye(a,s,r){a.playlistParsingError=new Error("#EXT-X-"+s+" must not appear more than once ("+r[0]+")")}function Wa(a,s,r){a.playlistParsingError=new Error("#EXT-X-"+s+" must appear before the first Media Segment ("+r[0]+")")}function xi(a,s){var r=s.startPTS;if(B(r)){var t,e=0;s.sn>a.sn?(e=r-a.start,t=a):(e=a.start-r,t=s),t.duration!==e&&t.setDuration(e)}else s.sn>a.sn?a.cc===s.cc&&a.minEndPTS?s.setStart(a.start+(a.minEndPTS-a.start)):s.setStart(a.start+a.duration):s.setStart(Math.max(a.start-s.duration,0))}function ja(a,s,r,t,e,i,n){t-r<=0&&(n.warn("Fragment should have a positive duration",s),t=r+s.duration,i=e+s.duration);var o=r,l=t,u=s.startPTS,d=s.endPTS;if(B(u)){var h=Math.abs(u-r);a&&h>a.totalduration?n.warn("media timestamps and playlist times differ by "+h+"s for level "+s.level+" "+a.url):B(s.deltaPTS)?s.deltaPTS=Math.max(h,s.deltaPTS):s.deltaPTS=h,o=Math.max(r,u),r=Math.min(r,u),e=s.startDTS!==void 0?Math.min(e,s.startDTS):e,l=Math.min(t,d),t=Math.max(t,d),i=s.endDTS!==void 0?Math.max(i,s.endDTS):i}var f=r-s.start;s.start!==0&&s.setStart(r),s.setDuration(t-s.start),s.startPTS=r,s.maxStartPTS=o,s.startDTS=e,s.endPTS=t,s.minEndPTS=l,s.endDTS=i;var c,g=s.sn;if(!a||g<a.startSN||g>a.endSN)return 0;var v=g-a.startSN,m=a.fragments;for(m[v]=s,c=v;c>0;c--)xi(m[c],m[c-1]);for(c=v;c<m.length-1;c++)xi(m[c],m[c+1]);return a.fragmentHint&&xi(m[m.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,f}function cl(a,s,r){if(a!==s){for(var t,e=null,i=a.fragments,n=i.length-1;n>=0;n--){var o=i[n].initSegment;if(o){e=o;break}}a.fragmentHint&&delete a.fragmentHint.endPTS,(function(p,E,T){for(var S=E.skippedSegments,R=Math.max(p.startSN,E.startSN)-E.startSN,A=(p.fragmentHint?1:0)+(S?E.endSN:Math.min(p.endSN,E.endSN))-E.startSN,L=E.startSN-p.startSN,b=E.fragmentHint?E.fragments.concat(E.fragmentHint):E.fragments,k=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,I=R;I<=A;I++){var D=k[L+I],P=b[I];if(S&&!P&&D&&(P=E.fragments[I]=D),D&&P){T(D,P,I,b);var M=D.relurl,O=P.relurl;if(M&&gl(M,O))return void(E.playlistParsingError=qa("media sequence mismatch "+P.sn+":",p,E,0,P));if(D.cc!==P.cc)return void(E.playlistParsingError=qa("discontinuity sequence mismatch ("+D.cc+"!="+P.cc+")",p,E,0,P))}}})(a,s,(function(p,E,T,S){if((!s.startCC||s.skippedSegments)&&E.cc!==p.cc){for(var R=p.cc-E.cc,A=T;A<S.length;A++)S[A].cc+=R;s.endCC=S[S.length-1].cc}B(p.startPTS)&&B(p.endPTS)&&(E.setStart(E.startPTS=p.startPTS),E.startDTS=p.startDTS,E.maxStartPTS=p.maxStartPTS,E.endPTS=p.endPTS,E.endDTS=p.endDTS,E.minEndPTS=p.minEndPTS,E.setDuration(p.endPTS-p.startPTS),E.duration&&(t=E),s.PTSKnown=s.alignedSliding=!0),p.hasStreams&&(E.elementaryStreams=p.elementaryStreams),E.loader=p.loader,p.hasStats&&(E.stats=p.stats),p.initSegment&&(E.initSegment=p.initSegment,e=p.initSegment)}));var l=s.fragments,u=s.fragmentHint?l.concat(s.fragmentHint):l;if(e&&u.forEach((function(p){var E;!p||p.initSegment&&p.initSegment.relurl!==((E=e)==null?void 0:E.relurl)||(p.initSegment=e)})),s.skippedSegments){if(s.deltaUpdateFailed=l.some((function(p){return!p})),s.deltaUpdateFailed){r.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var d=s.skippedSegments;d--;)l.shift();s.startSN=l[0].sn}else{s.canSkipDateRanges&&(s.dateRanges=(function(p,E,T){var S=E.dateRanges,R=E.recentlyRemovedDateranges,A=mt({},p);R&&R.forEach((function(b){delete A[b]}));var L=Object.keys(A).length;return L?(Object.keys(S).forEach((function(b){var k=A[b],I=new Pa(S[b].attr,k);I.isValid?(A[b]=I,k||(I.tagOrder+=L)):T.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+Et(S[b].attr)+'"')})),A):S})(a.dateRanges,s,r));var h=a.fragments.filter((function(p){return p.rawProgramDateTime}));if(a.hasProgramDateTime&&!s.hasProgramDateTime)for(var f=1;f<u.length;f++)u[f].programDateTime===null&&Oi(u[f],u[f-1],h);Ua(h,s)}s.endCC=l[l.length-1].cc}if(!s.startCC){var c,g=Qa(a,s.startSN-1);s.startCC=(c=g?.cc)!=null?c:l[0].cc}(function(p,E,T){if(p&&E)for(var S=0,R=0,A=p.length;R<=A;R++){var L=p[R],b=E[R+S];L&&b&&L.index===b.index&&L.fragment.sn===b.fragment.sn?T(L,b):S--}})(a.partList,s.partList,(function(p,E){E.elementaryStreams=p.elementaryStreams,E.stats=p.stats})),t?ja(s,t,t.startPTS,t.endPTS,t.startDTS,t.endDTS,r):Xa(a,s),l.length&&(s.totalduration=s.edge-l[0].start),s.driftStartTime=a.driftStartTime,s.driftStart=a.driftStart;var v=s.advancedDateTime;if(s.advanced&&v){var m=s.edge;s.driftStart||(s.driftStartTime=v,s.driftStart=m),s.driftEndTime=v,s.driftEnd=m}else s.driftEndTime=a.driftEndTime,s.driftEnd=a.driftEnd,s.advancedDateTime=a.advancedDateTime;s.requestScheduled===-1&&(s.requestScheduled=a.requestScheduled)}}function qa(a,s,r,t,e){return new Error(a+" "+e.url+`
Playlist starting @`+s.startSN+`
`+s.m3u8+`

Playlist starting @`+r.startSN+`
`+r.m3u8)}function Xa(a,s,r){r===void 0&&(r=!0);var t=s.startSN+s.skippedSegments-a.startSN,e=a.fragments,i=t>=0,n=0;if(i&&t<e.length)n=e[t].start;else if(i&&s.startSN===a.endSN+1)n=a.fragmentEnd;else if(i&&r)n=a.fragmentStart+t*s.levelTargetDuration;else{if(s.skippedSegments||s.fragmentStart!==0)return;n=a.fragmentStart}Mi(s,n)}function Mi(a,s){if(s){for(var r=a.fragments,t=a.skippedSegments;t<r.length;t++)r[t].addStart(s);a.fragmentHint&&a.fragmentHint.addStart(s)}}function za(a,s){s===void 0&&(s=1/0);var r=1e3*a.targetduration;if(a.updated){var t=a.fragments;if(t.length&&4*r>s){var e=1e3*t[t.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}function Qa(a,s,r){if(!a)return null;var t=a.fragments[s-a.startSN];return t||((t=a.fragmentHint)&&t.sn===s?t:s<a.startSN&&r&&r.sn===s?r:null)}function $a(a,s,r){return a?Za(a.partList,s,r):null}function Za(a,s,r){if(a)for(var t=a.length;t--;){var e=a[t];if(e.index===r&&e.fragment.sn===s)return e}return null}function Ja(a){a.forEach((function(s,r){var t;(t=s.details)==null||t.fragments.forEach((function(e){e.level=r,e.initSegment&&(e.initSegment.level=r)}))}))}function gl(a,s){return!(a===s||!s)&&ts(a)!==ts(s)}function ts(a){return a.replace(/\?[^?]*$/,"")}function hr(a,s){for(var r=0,t=a.length;r<t;r++){var e;if(((e=a[r])==null?void 0:e.cc)===s)return a[r]}return null}function es(a,s){var r=a.start+s;a.startPTS=r,a.setStart(r),a.endPTS=r+a.duration}function rs(a,s){for(var r=s.fragments,t=0,e=r.length;t<e;t++)es(r[t],a);s.fragmentHint&&es(s.fragmentHint,a),s.alignedSliding=!0}function is(a,s){if((function(i,n){return!!(i&&n.startCC<i.endCC&&n.endCC>i.startCC)})(s,a)){var r=Math.min(s.endCC,a.endCC),t=hr(s.fragments,r),e=hr(a.fragments,r);t&&e&&(ct.log("Aligning playlist at start of dicontinuity sequence "+r),rs(t.start-e.start,a))}}function Ur(a,s){if(a.hasProgramDateTime&&s.hasProgramDateTime){var r=a.fragments,t=s.fragments;if(r.length&&t.length){var e,i,n=Math.min(s.endCC,a.endCC);s.startCC<n&&a.startCC<n&&(e=hr(t,n),i=hr(r,n)),e&&i||(i=hr(r,(e=t[Math.floor(t.length/2)]).cc)||r[Math.floor(r.length/2)]);var o=e.programDateTime,l=i.programDateTime;o&&l&&rs((l-o)/1e3-(i.start-e.start),a)}}}function Bt(a,s,r){Ht(a,s,r),a.addEventListener(s,r)}function Ht(a,s,r){a.removeEventListener(s,r)}var vl=function(a){for(var s="",r=a.length,t=0;t<r;t++)s+="["+a.start(t).toFixed(3)+"-"+a.end(t).toFixed(3)+"]";return s},C={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Fi=(function(a){function s(t,e,i,n,o){var l;return(l=a.call(this,n,t.logger)||this).hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=C.STOPPED,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.buffering=!0,l.loadingParts=!1,l.loopSn=void 0,l.onMediaSeeking=function(){var u=l,d=u.config,h=u.fragCurrent,f=u.media,c=u.mediaBuffer,g=u.state,v=f?f.currentTime:0,m=tt.bufferInfo(c||f,v,d.maxBufferHole),p=!m.len;if(l.log("Media seeking to "+(B(v)?v.toFixed(3):v)+", state: "+g+", "+(p?"out of":"in")+" buffer"),l.state===C.ENDED)l.resetLoadingState();else if(h){var E=d.maxFragLookUpTolerance,T=h.start-E,S=h.start+h.duration+E;if(p||S<m.start||T>m.end){var R=v>S;(v<T||R)&&(R&&h.loader&&(l.log("Cancelling fragment load for seek (sn: "+h.sn+")"),h.abortRequests(),l.resetLoadingState()),l.fragPrevious=null)}}if(f&&(l.fragmentTracker.removeFragmentsInRange(v,1/0,l.playlistType,!0),v>l.lastCurrentTime&&(l.lastCurrentTime=v),!l.loadingParts)){var A=Math.max(m.end,v),L=l.shouldLoadParts(l.getLevelDetails(),A);L&&(l.log("LL-Part loading ON after seeking to "+v.toFixed(2)+" with buffer @"+A.toFixed(2)),l.loadingParts=L)}l.hls.hasEnoughToStart||(l.log("Setting "+(p?"startPosition":"nextLoadPosition")+" to "+v+" for seek without enough to start"),l.nextLoadPosition=v,p&&(l.startPosition=v)),p&&l.state===C.IDLE&&l.tickImmediate()},l.onMediaEnded=function(){l.log("setting startPosition to 0 because media ended"),l.startPosition=l.lastCurrentTime=0},l.playlistType=o,l.hls=t,l.fragmentLoader=new nl(t.config),l.keyLoader=i,l.fragmentTracker=e,l.config=t.config,l.decrypter=new Li(t.config),l}ut(s,a);var r=s.prototype;return r.registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.ERROR,this.onError,this)},r.doTick=function(){this.onTickEnd()},r.onTickEnd=function(){},r.startLoad=function(t){},r.stopLoad=function(){if(this.state!==C.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=C.STOPPED}},r.pauseBuffering=function(){this.buffering=!1},r.resumeBuffering=function(){this.buffering=!0},r._streamEnded=function(t,e){if(e.live||!this.media)return!1;var i=t.end||0,n=this.config.timelineOffset||0;if(i<=n)return!1;var o=t.buffered;this.config.maxBufferHole&&o&&o.length>1&&(t=tt.bufferedInfo(o,t.start,0));var l=t.nextStart;if(l&&l>n&&l<e.edge||this.media.currentTime<t.start)return!1;var u=e.partList;if(u!=null&&u.length){var d=u[u.length-1];return tt.isBuffered(this.media,d.start+d.duration/2)}var h=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(h)},r.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details},r.onMediaAttached=function(t,e){var i=this.media=this.mediaBuffer=e.media;Bt(i,"seeking",this.onMediaSeeking),Bt(i,"ended",this.onMediaEnded);var n=this.config;this.levels&&n.autoStartLoad&&this.state===C.STOPPED&&this.startLoad(n.startPosition)},r.onMediaDetaching=function(t,e){var i=!!e.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Ht(n,"seeking",this.onMediaSeeking),Ht(n,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},r.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},r.onError=function(t,e){},r.onManifestLoaded=function(t,e){this.startTimeOffset=e.startTimeOffset},r.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),a.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},r.onHandlerDestroyed=function(){this.state=C.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,a.prototype.onHandlerDestroyed.call(this)},r.loadFragment=function(t,e,i){this.startFragRequested=!0,this._loadFragForPlayback(t,e,i)},r._loadFragForPlayback=function(t,e,i){var n=this;this._doFragLoad(t,e,i,(function(o){var l=o.frag;if(n.fragContextChanged(l))return n.warn(l.type+" sn: "+l.sn+(o.part?" part: "+o.part.index:"")+" of "+n.fragInfo(l,!1,o.part)+") was dropped during download."),void n.fragmentTracker.removeFragment(l);l.stats.chunkCount++,n._handleFragmentLoadProgress(o)})).then((function(o){if(o){var l=n.state,u=o.frag;n.fragContextChanged(u)?(l===C.FRAG_LOADING||!n.fragCurrent&&l===C.PARSING)&&(n.fragmentTracker.removeFragment(u),n.state=C.IDLE):("payload"in o&&(n.log("Loaded "+u.type+" sn: "+u.sn+" of "+n.playlistLabel()+" "+u.level),n.hls.trigger(y.FRAG_LOADED,o)),n._handleFragmentLoadComplete(o))}})).catch((function(o){n.state!==C.STOPPED&&n.state!==C.ERROR&&(n.warn("Frag error: "+(o?.message||o)),n.resetFragmentLoading(t))}))},r.clearTrackerIfNeeded=function(t){var e,i=this.fragmentTracker;if(i.getState(t)===Ea){var n=t.type,o=this.getFwdBufferInfo(this.mediaBuffer,n),l=Math.max(t.duration,o?o.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?t.sn-u.sn:0)==1||this.reduceMaxBufferLength(l,t.duration))&&i.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===He&&i.removeFragment(t))},r.checkLiveUpdate=function(t){if(t.updated&&!t.live){var e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)},r.waitForLive=function(t){var e=t.details;return e?.live&&e.type!=="EVENT"&&(this.levelLastLoaded!==t||e.expired)},r.flushMainBuffer=function(t,e,i){if(i===void 0&&(i=null),t-e){var n={startOffset:t,endOffset:e,type:i};this.hls.trigger(y.BUFFER_FLUSHING,n)}},r._loadInitSegment=function(t,e){var i=this;this._doFragLoad(t,e).then((function(n){var o=n?.frag;if(!o||i.fragContextChanged(o)||!i.levels)throw new Error("init load aborted");return n})).then((function(n){var o=i.hls,l=n.frag,u=n.payload,d=l.decryptdata;if(u&&u.byteLength>0&&d!=null&&d.key&&d.iv&&je(d.method)){var h=self.performance.now();return i.decrypter.decrypt(new Uint8Array(u),d.key.buffer,d.iv.buffer,bi(d.method)).catch((function(f){throw o.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:l}),f})).then((function(f){var c=self.performance.now();return o.trigger(y.FRAG_DECRYPTED,{frag:l,payload:f,stats:{tstart:h,tdecrypt:c}}),n.payload=f,i.completeInitSegmentLoad(n)}))}return i.completeInitSegmentLoad(n)})).catch((function(n){i.state!==C.STOPPED&&i.state!==C.ERROR&&(i.warn(n),i.resetFragmentLoading(t))}))},r.completeInitSegmentLoad=function(t){if(!this.levels)throw new Error("init load aborted, missing levels");var e=t.frag.stats;this.state!==C.STOPPED&&(this.state=C.IDLE),t.frag.data=new Uint8Array(t.payload),e.parsing.start=e.buffering.start=self.performance.now(),e.parsing.end=e.buffering.end=self.performance.now(),this.tick()},r.unhandledEncryptionError=function(t,e){var i,n,o=t.tracks;if(o&&!e.encrypted&&((i=o.audio)!=null&&i.encrypted||(n=o.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){var l=this.media,u=new Error("Encrypted track with no key in "+this.fragInfo(e)+" (media "+(l?"attached mediaKeys: "+l.mediaKeys:"detached")+")");return this.warn(u.message),!(!l||l.mediaKeys)&&(this.hls.trigger(y.ERROR,{type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_KEYS,fatal:!1,error:u,frag:e}),this.resetTransmuxer(),!0)}return!1},r.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.sn!==e.sn||t.level!==e.level},r.fragBufferedComplete=function(t,e){var i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+this.fragInfo(t,!1,e)+" > buffer:"+(i?vl(tt.getBuffered(i)):"(detached)")+")"),wt(t)){var n;if(t.type!==te){var o=t.elementaryStreams;if(!Object.keys(o).some((function(u){return!!o[u]})))return void(this.state=C.IDLE)}var l=(n=this.levels)==null?void 0:n[t.level];l!=null&&l.fragmentError&&(this.log("Resetting level fragment error count of "+l.fragmentError+" on frag buffered"),l.fragmentError=0)}this.state=C.IDLE},r._handleFragmentLoadComplete=function(t){var e=this.transmuxer;if(e){var i=t.frag,n=t.part,o=t.partsLoaded,l=!o||o.length===0||o.some((function(d){return!d})),u=new Ii(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!l);e.flush(u)}},r._handleFragmentLoadProgress=function(t){},r._doFragLoad=function(t,e,i,n){var o,l=this;i===void 0&&(i=null),this.fragCurrent=t;var u=e.details;if(!this.levels||!u)throw new Error("frag load aborted, missing level"+(u?"":" detail")+"s");var d=null;if(!t.encrypted||(o=t.decryptdata)!=null&&o.key)t.encrypted||(d=this.keyLoader.loadClear(t,u.encryptedFragments,this.startFragRequested))&&this.log("[eme] blocking frag load until media-keys acquired");else if(this.log("Loading key for "+t.sn+" of ["+u.startSN+"-"+u.endSN+"], "+this.playlistLabel()+" "+t.level),this.state=C.KEY_LOADING,this.fragCurrent=t,d=this.keyLoader.load(t).then((function(S){if(!l.fragContextChanged(S.frag))return l.hls.trigger(y.KEY_LOADED,S),l.state===C.KEY_LOADING&&(l.state=C.IDLE),S})),this.hls.trigger(y.KEY_LOADING,{frag:t}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);var h,f=this.fragPrevious;if(wt(t)&&(!f||t.sn!==f.sn)){var c=this.shouldLoadParts(e.details,t.end);c!==this.loadingParts&&(this.log("LL-Part loading "+(c?"ON":"OFF")+" loading sn "+f?.sn+"->"+t.sn),this.loadingParts=c)}if(i=Math.max(t.start,i||0),this.loadingParts&&wt(t)){var g=u.partList;if(g&&n){i>u.fragmentEnd&&u.fragmentHint&&(t=u.fragmentHint);var v=this.getNextPart(g,t,i);if(v>-1){var m,p=g[v];return t=this.fragCurrent=p.fragment,this.log("Loading "+t.type+" sn: "+t.sn+" part: "+p.index+" ("+v+"/"+(g.length-1)+") of "+this.fragInfo(t,!1,p)+") cc: "+t.cc+" ["+u.startSN+"-"+u.endSN+"], target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=p.start+p.duration,this.state=C.FRAG_LOADING,m=d?d.then((function(S){return!S||l.fragContextChanged(S.frag)?null:l.doFragPartsLoad(t,p,e,n)})).catch((function(S){return l.handleFragLoadError(S)})):this.doFragPartsLoad(t,p,e,n).catch((function(S){return l.handleFragLoadError(S)})),this.hls.trigger(y.FRAG_LOADING,{frag:t,part:p,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}if(!t.url||this.loadedEndOfParts(g,i))return Promise.resolve(null)}}if(wt(t)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @"+i.toFixed(2)+" Check buffer at sn: "+t.sn+" loaded parts: "+((h=u.partList)==null?void 0:h.filter((function(S){return S.loaded})).map((function(S){return"["+S.start+"-"+S.end+"]"})))),this.loadingParts=!1;else if(!t.url)return Promise.resolve(null);this.log("Loading "+t.type+" sn: "+t.sn+" of "+this.fragInfo(t,!1)+") cc: "+t.cc+" ["+u.startSN+"-"+u.endSN+"], target: "+parseFloat(i.toFixed(3))),B(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=C.FRAG_LOADING;var E,T=this.config.progressive;return E=T&&d?d.then((function(S){return!S||l.fragContextChanged(S.frag)?null:l.fragmentLoader.load(t,n)})).catch((function(S){return l.handleFragLoadError(S)})):Promise.all([this.fragmentLoader.load(t,T?n:void 0),d]).then((function(S){var R=S[0];return!T&&n&&n(R),R})).catch((function(S){return l.handleFragLoadError(S)})),this.hls.trigger(y.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):E},r.doFragPartsLoad=function(t,e,i,n){var o=this;return new Promise((function(l,u){var d,h=[],f=(d=i.details)==null?void 0:d.partList,c=function(g){o.fragmentLoader.loadPart(t,g,n).then((function(v){h[g.index]=v;var m=v.part;o.hls.trigger(y.FRAG_LOADED,v);var p=$a(i.details,t.sn,g.index+1)||Za(f,t.sn,g.index+1);if(!p)return l({frag:t,part:m,partsLoaded:h});c(p)})).catch(u)};c(e)}))},r.handleFragLoadError=function(t){if("data"in t){var e=t.data;e.frag&&e.details===_.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):e.frag&&e.type===K.KEY_SYSTEM_ERROR?(e.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(e.frag)):this.hls.trigger(y.ERROR,e)}else this.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},r._handleTransmuxerFlush=function(t){var e=this.getCurrentContext(t);if(e&&this.state===C.PARSING){var i=e.frag,n=e.part,o=e.level,l=self.performance.now();i.stats.parsing.end=l,n&&(n.stats.parsing.end=l);var u=this.getLevelDetails(),d=u&&i.sn>u.endSN||this.shouldLoadParts(u,i.end);d!==this.loadingParts&&(this.log("LL-Part loading "+(d?"ON":"OFF")+" after parsing segment ending @"+i.end.toFixed(2)),this.loadingParts=d),this.updateLevelTiming(i,n,o,t.partial)}else this.fragCurrent||this.state===C.STOPPED||this.state===C.ERROR||(this.state=C.IDLE)},r.shouldLoadParts=function(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t.partList){var i,n,o=t.partList[0];if(o.fragment.type===te)return!1;if(e>=o.end+(((i=t.fragmentHint)==null?void 0:i.duration)||0)&&(this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>o.start-o.fragment.duration)return!0}}return!1},r.getCurrentContext=function(t){var e=this.levels,i=this.fragCurrent,n=t.level,o=t.sn,l=t.part;if(e==null||!e[n])return this.warn("Levels object was unset while buffering fragment "+o+" of "+this.playlistLabel()+" "+n+". The current chunk will not be buffered."),null;var u=e[n],d=u.details,h=l>-1?$a(d,o,l):null,f=h?h.fragment:Qa(d,o,i);return f?(i&&i!==f&&(f.stats=i.stats),{frag:f,part:h,level:u}):null},r.bufferFragmentData=function(t,e,i,n,o){if(this.state===C.PARSING){var l=t.data1,u=t.data2,d=l;if(u&&(d=re(l,u)),d.length){var h=this.initPTS[e.cc],f=h?-h.baseTime/h.timescale:void 0,c={type:t.type,frag:e,part:i,chunkMeta:n,offset:f,parent:e.type,data:d};if(this.hls.trigger(y.BUFFER_APPENDING,c),t.dropped&&t.independent&&!i){if(o)return;this.flushBufferGap(e)}}}},r.flushBufferGap=function(t){var e=this.media;if(e)if(tt.isBuffered(e,e.currentTime)){var i=e.currentTime,n=tt.bufferInfo(e,i,0),o=t.duration,l=Math.min(2*this.config.maxFragLookUpTolerance,.25*o),u=Math.max(Math.min(t.start-l,n.end-l),i+l);t.start-u>l&&this.flushMainBuffer(u,t.start)}else this.flushMainBuffer(0,t.start)},r.getFwdBufferInfo=function(t,e){var i,n=this.getLoadPosition();if(!B(n))return null;var o=this.lastCurrentTime>n||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,n,e,o)},r.getFwdBufferInfoAtPos=function(t,e,i,n){var o=tt.bufferInfo(t,e,n);if(o.len===0&&o.nextStart!==void 0){var l=this.fragmentTracker.getBufferedFrag(e,i);if(l&&(o.nextStart<=l.end||l.gap)){var u=Math.max(Math.min(o.nextStart,l.end)-e,n);return tt.bufferInfo(t,e,u)}}return o},r.getMaxBufferLength=function(t){var e,i=this.config;return e=t?Math.max(8*i.maxBufferSize/t,i.maxBufferLength):i.maxBufferLength,Math.min(e,i.maxMaxBufferLength)},r.reduceMaxBufferLength=function(t,e){var i=this.config,n=Math.max(Math.min(t-e,i.maxBufferLength),e),o=Math.max(t-3*e,i.maxMaxBufferLength/2,n);return o>=n&&(i.maxMaxBufferLength=o,this.warn("Reduce max buffer length to "+o+"s"),!0)},r.getAppendedFrag=function(t,e){e===void 0&&(e=Z);var i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(t,e):null;return i&&"fragment"in i?i.fragment:i},r.getNextFragment=function(t,e){var i=e.fragments,n=i.length;if(!n)return null;var o=this.config,l=i[0].start,u=o.lowLatencyMode&&!!e.partList,d=null;if(e.live){var h=o.initialLiveManifestSize;if(n<h)return this.warn("Not enough fragments to start playback (have: "+n+", need: "+h+")"),null;if(!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||t<l){var f;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(e);var c=this.hls.startPosition,g=this.hls.liveSyncPosition,v=d?(c!==-1&&c>=l?c:g)||d.start:t;this.log("Setting startPosition to "+v+" to match start frag at live edge. mainStart: "+c+" liveSyncPosition: "+g+" frag.start: "+((f=d)==null?void 0:f.start)),this.startPosition=this.nextLoadPosition=v}}else t<=l&&(d=i[0]);if(!d){var m=this.loadingParts?e.partEnd:e.fragmentEnd;d=this.getFragmentAtPosition(t,m,e)}var p=this.filterReplacedPrimary(d,e);if(!p&&d){var E=d.sn-e.startSN;p=this.filterReplacedPrimary(i[E+1]||null,e)}return this.mapToInitFragWhenRequired(p)},r.isLoopLoading=function(t,e){var i=this.fragmentTracker.getState(t);return(i===Ye||i===He&&!!t.gap)&&this.nextLoadPosition>e},r.getNextFragmentLoopLoading=function(t,e,i,n,o){var l=null;if(t.gap&&(l=this.getNextFragment(this.nextLoadPosition,e))&&!l.gap&&i.nextStart){var u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n,0);if(u!==null&&i.len+u.len>=o){var d=l.sn;return this.loopSn!==d&&(this.log('buffer full after gaps in "'+n+'" playlist starting at sn: '+d),this.loopSn=d),null}}return this.loopSn=void 0,l},r.filterReplacedPrimary=function(t,e){if(!t)return t;if(ns(this.config)&&t.type!==te){var i=this.hls.interstitialsManager,n=i?.bufferingItem;if(n){var o=n.event;if(o){if(o.appendInPlace||Math.abs(t.start-n.start)>1||n.start===0)return null}else if(t.end<=n.start&&e?.live===!1||t.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||t.start-n.end>1))return null}var l=i?.playerQueue;if(l)for(var u=l.length;u--;){var d=l[u].interstitial;if(d.appendInPlace&&t.start>=d.startTime&&t.end<=d.resumeTime)return null}}return t},r.mapToInitFragWhenRequired=function(t){return t==null||!t.initSegment||t.initSegment.data||this.bitrateTest?t:t.initSegment},r.getNextPart=function(t,e,i){for(var n=-1,o=!1,l=!0,u=0,d=t.length;u<d;u++){var h=t[u];if(l=l&&!h.independent,n>-1&&i<h.start)break;var f=h.loaded;f?n=-1:(o||(h.independent||l)&&h.fragment===e)&&(h.fragment!==e&&this.warn("Need buffer at "+i+" but next unloaded part starts at "+h.start),n=u),o=f}return n},r.loadedEndOfParts=function(t,e){for(var i,n=t.length;n--;){if(!(i=t[n]).loaded)return!1;if(e>i.start)return!0}return!1},r.getInitialLiveFragment=function(t){var e=t.fragments,i=this.fragPrevious,n=null;if(i){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),n=(function(d,h,f){if(h===null||!Array.isArray(d)||!d.length||!B(h)||h<(d[0].programDateTime||0)||h>=(d[d.length-1].endProgramDateTime||0))return null;for(var c=0;c<d.length;++c){var g=d[c];if($o(h,f,g))return g}return null})(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var o=i.sn+1;if(o>=t.startSN&&o<=t.endSN){var l=e[o-t.startSN];i.cc===l.cc&&(n=l,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))}n||(n=ha(t,i.cc,i.end))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn)}}else{var u=this.hls.liveSyncPosition;u!==null&&(n=this.getFragmentAtPosition(u,this.bitrateTest?t.fragmentEnd:t.edge,t))}return n},r.getFragmentAtPosition=function(t,e,i){var n,o,l=this.config,u=this.fragPrevious,d=i.fragments,h=i.endSN,f=i.fragmentHint,c=l.maxFragLookUpTolerance,g=i.partList,v=!!(this.loadingParts&&g!=null&&g.length&&f);if(v&&!this.bitrateTest&&g[g.length-1].fragment.sn===f.sn&&(d=d.concat(f),h=f.sn),n=t<e?Ce(u,d,t,t<this.lastCurrentTime||t>e-c||(o=this.media)!=null&&o.paused||!this.startFragRequested?0:c):d[d.length-1]){var m=n.sn-i.startSN,p=this.fragmentTracker.getState(n);if((p===Ye||p===He&&n.gap)&&(u=n),u&&n.sn===u.sn&&(!v||g[0].fragment.sn>n.sn||!i.live)&&n.level===u.level){var E=d[m+1];n=n.sn<h&&this.fragmentTracker.getState(E)!==Ye?E:null}}return n},r.alignPlaylists=function(t,e,i){var n=t.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;var o=t.fragmentStart,l=!e,u=t.alignedSliding&&B(o);if(l||!u&&!o){(function(h,f){h&&(is(f,h),f.alignedSliding||Ur(f,h),f.alignedSliding||f.skippedSegments||Xa(h,f,!1))})(i,t);var d=t.fragmentStart;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" fragments: "+n),d}return o},r.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},r.setStartPosition=function(t,e){var i=this.startPosition;i<e&&(i=-1);var n=this.timelineOffset;if(i===-1){var o=this.startTimeOffset!==null,l=o?this.startTimeOffset:t.startTimeOffset;l!==null&&B(l)?(i=e+l,l<0&&(i+=t.edge),i=Math.min(Math.max(e,i),e+t.totalduration),this.log("Setting startPosition to "+i+" for start time offset "+l+" found in "+(o?"multivariant":"media")+" playlist"),this.startPosition=i):t.live?(i=this.hls.liveSyncPosition||e,this.log("Setting startPosition to -1 to start at live edge "+i),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+n}this.nextLoadPosition=i+n},r.getLoadPosition=function(){var t,e=this.media,i=0;return(t=this.hls)!=null&&t.hasEnoughToStart&&e?i=e.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i},r.handleFragLoadAborted=function(t,e){this.transmuxer&&t.type===this.playlistType&&wt(t)&&t.stats.aborted&&(this.log("Fragment "+t.sn+(e?" part "+e.index:"")+" of "+this.playlistLabel()+" "+t.level+" was aborted"),this.resetFragmentLoading(t))},r.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===C.FRAG_LOADING_WAITING_RETRY)||(this.state=C.IDLE)},r.onFragmentOrKeyLoadError=function(t,e){var i;if(e.chunkMeta&&!e.frag){var n=this.getCurrentContext(e.chunkMeta);n&&(e.frag=n.frag)}var o=e.frag;if(o&&o.type===t&&this.levels)if(this.fragContextChanged(o)){var l;this.warn("Frag load error must match current frag to retry "+o.url+" > "+((l=this.fragCurrent)==null?void 0:l.url))}else{var u=e.details===_.FRAG_GAP;u&&this.fragmentTracker.fragBuffered(o,!0);var d=e.errorAction;if(d){var h=d.action,f=d.flags,c=d.retryCount,g=c===void 0?0:c,v=d.retryConfig,m=!!v,p=m&&h===_r,E=m&&!d.resolved&&f===Pr,T=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!p&&E&&wt(o)&&!o.endList&&T&&!ca(e))this.resetFragmentErrors(t),this.treatAsGap(o),d.resolved=!0;else if((p||E)&&g<v.maxNumRetry){var S,R=Si((S=e.response)==null?void 0:S.code),A=Ti(v,g);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+A,this.state=C.FRAG_LOADING_WAITING_RETRY,d.resolved=!0,R)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(e.reason="offline");this.warn("Fragment "+o.sn+" of "+t+" "+o.level+" errored with "+e.details+", retrying loading "+(g+1)+"/"+v.maxNumRetry+" in "+A+"ms")}else if(v){if(this.resetFragmentErrors(t),!(g<v.maxNumRetry))return void this.warn(e.details+" reached or exceeded max retry ("+g+")");u||h===Zo||(d.resolved=!0)}else this.state=h===he?C.WAITING_LEVEL:C.ERROR;this.tickImmediate()}else this.state=C.ERROR}},r.checkRetryDate=function(){var t=self.performance.now(),e=this.retryDate,i=e===1/0;(!e||t>=e||i&&!Si(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=C.IDLE)},r.reduceLengthAndFlushBuffer=function(t){if(this.state===C.PARSING||this.state===C.PARSED){var e=t.frag,i=t.parent,n=this.getFwdBufferInfo(this.mediaBuffer,i),o=n&&n.len>.5;o&&this.reduceMaxBufferLength(n.len,e?.duration||10);var l=!o;return l&&this.warn("Buffer full error while media.currentTime ("+this.getLoadPosition()+") is not buffered, flush "+i+" buffer"),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),l}return!1},r.resetFragmentErrors=function(t){t===Kt&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==C.STOPPED&&(this.state=C.IDLE)},r.afterBufferFlushed=function(t,e,i){if(t){var n=tt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,n,i),this.state===C.ENDED&&this.resetLoadingState()}},r.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==C.STOPPED&&(this.state=C.IDLE)},r.resetStartWhenNotLoaded=function(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var t=this.levelLastLoaded,e=t?t.details:null;e!=null&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},r.resetWhenMissingContext=function(t){this.log("Loading context changed while buffering sn "+t.sn+" of "+this.playlistLabel()+" "+(t.level===-1?"<removed>":t.level)+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()},r.removeUnbufferedFrags=function(t){t===void 0&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},r.updateLevelTiming=function(t,e,i,n){var o=this,l=i.details;if(l){var u;if(!Object.keys(t.elementaryStreams).reduce((function(h,f){var c=t.elementaryStreams[f];if(c){var g=c.endPTS-c.startPTS;if(g<=0)return o.warn("Could not parse fragment "+t.sn+" "+f+" duration reliably ("+g+")"),h||!1;var v=n?0:ja(l,t,c.startPTS,c.endPTS,c.startDTS,c.endDTS,o);return o.hls.trigger(y.LEVEL_PTS_UPDATED,{details:l,level:i,drift:v,type:f,frag:t,start:c.startPTS,end:c.endPTS}),!0}return h}),!1)&&(i.fragmentError===0&&this.treatAsGap(t,i),((u=this.transmuxer)==null?void 0:u.error)===null)){var d=new Error("Found no media in fragment "+t.sn+" of "+this.playlistLabel()+" "+t.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(d.message),this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:t,reason:"Found no media in msn "+t.sn+" of "+this.playlistLabel()+' "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=C.PARSED,this.log("Parsed "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+this.fragInfo(t,!1,e)+")"),this.hls.trigger(y.FRAG_PARSED,{frag:t,part:e})}else this.warn("level.details undefined")},r.playlistLabel=function(){return this.playlistType===Z?"level":"track"},r.fragInfo=function(t,e,i){var n,o;return e===void 0&&(e=!0),this.playlistLabel()+" "+t.level+" ("+(i?"part":"frag")+":["+((n=e&&!i?t.startPTS:(i||t).start)!=null?n:NaN).toFixed(3)+"-"+((o=e&&!i?t.endPTS:(i||t).end)!=null?o:NaN).toFixed(3)+"]"+(i&&t.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):"")},r.treatAsGap=function(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)},r.resetTransmuxer=function(){var t;(t=this.transmuxer)==null||t.reset()},r.recoverWorkerError=function(t){t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())},yt(s,[{key:"startPositionValue",get:function(){var t=this.nextLoadPosition,e=this.startPosition;return e===-1&&t?t:e}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var t,e=this.config.timelineOffset;return e?((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e:0}},{key:"primaryPrefetch",get:function(){var t;return!(!ns(this.config)||!(!((t=this.hls.interstitialsManager)==null||(t=t.playingItem)==null)&&t.event))}},{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}])})(Ia);function ns(a){return!!a.interstitialsController&&a.enableInterstitialPlayback!==!1}var as=(function(){function a(){this.chunks=[],this.dataLength=0}var s=a.prototype;return s.push=function(r){this.chunks.push(r),this.dataLength+=r.length},s.flush=function(){var r,t=this.chunks,e=this.dataLength;return t.length?(r=t.length===1?t[0]:(function(i,n){for(var o=new Uint8Array(n),l=0,u=0;u<i.length;u++){var d=i[u];o.set(d,l),l+=d.length}return o})(t,e),this.reset(),r):new Uint8Array(0)},s.reset=function(){this.chunks.length=0,this.dataLength=0},a})();function ss(a,s){return s+10<=a.length&&a[s]===51&&a[s+1]===68&&a[s+2]===73&&a[s+3]<255&&a[s+4]<255&&a[s+6]<128&&a[s+7]<128&&a[s+8]<128&&a[s+9]<128}function Ni(a,s){return s+10<=a.length&&a[s]===73&&a[s+1]===68&&a[s+2]===51&&a[s+3]<255&&a[s+4]<255&&a[s+6]<128&&a[s+7]<128&&a[s+8]<128&&a[s+9]<128}function Br(a,s){var r=0;return r=(127&a[s])<<21,r|=(127&a[s+1])<<14,r|=(127&a[s+2])<<7,r|=127&a[s+3]}function fr(a,s){for(var r=s,t=0;Ni(a,s);)t+=10,t+=Br(a,s+6),ss(a,s+10)&&(t+=10),s+=t;if(t>0)return a.subarray(r,r+t)}function os(a,s){return a[s]===255&&(246&a[s+1])==240}function ls(a,s){return 1&a[s+1]?7:9}function Ui(a,s){return(3&a[s+3])<<11|a[s+4]<<3|(224&a[s+5])>>>5}function Gr(a,s){return s+1<a.length&&os(a,s)}function ml(a,s){if(Gr(a,s)){var r=ls(a,s);if(s+r>=a.length)return!1;var t=Ui(a,s);if(t<=r)return!1;var e=s+t;return e===a.length||Gr(a,e)}return!1}function us(a,s,r,t,e){if(!a.samplerate){var i=(function(n,o,l,u){var d=o[l+2],h=d>>2&15;if(!(h>12)){var f=1+(d>>6&3),c=o[l+3]>>6&3|(1&d)<<2,g="mp4a.40."+f,v=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][h],m=h;f!==5&&f!==29||(m-=3);var p=[f<<3|(14&m)>>1,(1&m)<<7|c<<3];return ct.log("manifest codec:"+u+", parsed codec:"+g+", channels:"+c+", rate:"+v+" (ADTS object type:"+f+" sampling index:"+h+")"),{config:p,samplerate:v,channelCount:c,codec:g,parsedCodec:g,manifestCodec:u}}var E=new Error("invalid ADTS sampling index:"+h);n.emit(y.ERROR,y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message})})(s,r,t,e);if(!i)return;mt(a,i)}}function ds(a){return 9216e4/a}function hs(a,s,r,t,e){var i,n=t+e*ds(a.samplerate),o=(function(g,v){var m=ls(g,v);if(v+m<=g.length){var p=Ui(g,v)-m;if(p>0)return{headerLength:m,frameLength:p}}})(s,r);if(o){var l=o.frameLength,u=o.headerLength,d=u+l,h=Math.max(0,r+d-s.length);h?(i=new Uint8Array(d-u)).set(s.subarray(r+u,s.length),0):i=s.subarray(r+u,r+d);var f={unit:i,pts:n};return h||a.samples.push(f),{sample:f,length:d,missing:h}}var c=s.length-r;return(i=new Uint8Array(c)).set(s.subarray(r,s.length),0),{sample:{unit:i,pts:n},length:c,missing:-1}}function pl(a,s){return Ni(a,s)&&Br(a,s+6)+10<=a.length-s}function Bi(a,s,r){return s===void 0&&(s=0),r===void 0&&(r=1/0),(function(t,e,i,n){var o=(function(v){return v instanceof ArrayBuffer?v:v.buffer})(t),l=1;"BYTES_PER_ELEMENT"in n&&(l=n.BYTES_PER_ELEMENT);var u,d=(u=t)&&u.buffer instanceof ArrayBuffer&&u.byteLength!==void 0&&u.byteOffset!==void 0?t.byteOffset:0,h=(d+t.byteLength)/l,f=(d+e)/l,c=Math.floor(Math.max(0,Math.min(f,h))),g=Math.floor(Math.min(c+Math.max(i,0),h));return new n(o,c,g-c)})(a,s,r,Uint8Array)}function yl(a){var s={key:a.type,description:"",data:"",mimeType:null,pictureType:null};if(!(a.size<2))if(a.data[0]===3){var r=a.data.subarray(1).indexOf(0);if(r!==-1){var t=Xt(Bi(a.data,1,r)),e=a.data[2+r],i=a.data.subarray(3+r).indexOf(0);if(i!==-1){var n,o=Xt(Bi(a.data,3+r,i));return n=t==="-->"?Xt(Bi(a.data,4+r+i)):(function(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer})(a.data.subarray(4+r+i)),s.mimeType=t,s.pictureType=e,s.description=o,s.data=n,s}}}else console.log("Ignore frame with unrecognized character encoding")}function El(a){return a.type==="PRIV"?(function(s){if(!(s.size<2)){var r=Xt(s.data,!0),t=new Uint8Array(s.data.subarray(r.length+1));return{key:s.type,info:r,data:t.buffer}}})(a):a.type[0]==="W"?(function(s){if(s.type==="WXXX"){if(s.size<2)return;var r=1,t=Xt(s.data.subarray(r),!0);r+=t.length+1;var e=Xt(s.data.subarray(r));return{key:s.type,info:t,data:e}}var i=Xt(s.data);return{key:s.type,info:"",data:i}})(a):a.type==="APIC"?yl(a):(function(s){if(!(s.size<2)){if(s.type==="TXXX"){var r=1,t=Xt(s.data.subarray(r),!0);r+=t.length+1;var e=Xt(s.data.subarray(r));return{key:s.type,info:t,data:e}}var i=Xt(s.data.subarray(1));return{key:s.type,info:"",data:i}}})(a)}function Tl(a){var s=String.fromCharCode(a[0],a[1],a[2],a[3]),r=Br(a,4);return{type:s,size:r,data:a.subarray(10,10+r)}}var Kr=10,Sl=10;function fs(a){for(var s=0,r=[];Ni(a,s);){var t=Br(a,s+6);a[s+5]>>6&1&&(s+=Kr);for(var e=(s+=Kr)+t;s+Sl<e;){var i=Tl(a.subarray(s)),n=El(i);n&&r.push(n),s+=i.size+Kr}ss(a,s)&&(s+=Kr)}return r}function cs(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"}function Al(a){if(a.data.byteLength===8){var s=new Uint8Array(a.data),r=1&s[3],t=(s[4]<<23)+(s[5]<<15)+(s[6]<<7)+s[7];return t/=45,r&&(t+=4772185884e-2),Math.round(t)}}function Gi(a){for(var s=fs(a),r=0;r<s.length;r++){var t=s[r];if(cs(t))return Al(t)}}var Qt=(function(a){return a.audioId3="org.id3",a.dateRange="com.apple.quicktime.HLS",a.emsg="https://aomedia.org/emsg/ID3",a.misbklv="urn:misb:KLV:bin:1910.1",a})({});function fe(a,s){return a===void 0&&(a=""),s===void 0&&(s=9e4),{type:a,id:-1,pid:-1,inputTimeScale:s,sequenceNumber:-1,samples:[],dropped:0}}var Ki=(function(){function a(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var s=a.prototype;return s.resetInitSegment=function(r,t,e,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},s.resetTimeStamp=function(r){this.initPTS=r,this.resetContiguity()},s.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},s.canParse=function(r,t){return!1},s.appendFrame=function(r,t,e){},s.demux=function(r,t){this.cachedData&&(r=re(this.cachedData,r),this.cachedData=null);var e,i=fr(r,0),n=i?i.length:0,o=this._audioTrack,l=this._id3Track,u=i?Gi(i):void 0,d=r.length;for((this.basePTS===null||this.frameIndex===0&&B(u))&&(this.basePTS=Ll(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Qt.audioId3,duration:Number.POSITIVE_INFINITY});n<d;){if(this.canParse(r,n)){var h=this.appendFrame(o,r,n);h?(this.frameIndex++,this.lastPTS=h.sample.pts,e=n+=h.length):n=d}else pl(r,n)?(i=fr(r,n),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Qt.audioId3,duration:Number.POSITIVE_INFINITY}),e=n+=i.length):n++;if(n===d&&e!==d){var f=r.slice(e);this.cachedData?this.cachedData=re(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:fe(),id3Track:l,textTrack:fe()}},s.demuxSampleAes=function(r,t,e){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},s.flush=function(r){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:fe(),id3Track:this._id3Track,textTrack:fe()}},s.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},a})(),Ll=function(a,s,r){return B(a)?90*a:9e4*s+(r?9e4*r.baseTime/r.timescale:0)},Vr=null,Il=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Rl=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],kl=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],bl=[0,1,1,4];function gs(a,s,r,t,e){if(!(r+24>s.length)){var i=vs(s,r);if(i&&r+i.frameLength<=s.length){var n=t+e*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:s.subarray(r,r+i.frameLength),pts:n,dts:n};return a.config=[],a.channelCount=i.channelCount,a.samplerate=i.sampleRate,a.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}}function vs(a,s){var r=a[s+1]>>3&3,t=a[s+1]>>1&3,e=a[s+2]>>4&15,i=a[s+2]>>2&3;if(r!==1&&e!==0&&e!==15&&i!==3){var n=a[s+2]>>1&1,o=a[s+3]>>6,l=1e3*Il[14*(r===3?3-t:t===3?3:4)+e-1],u=Rl[3*(r===3?0:r===2?1:2)+i],d=o===3?1:2,h=kl[r][t],f=bl[t],c=8*h*f,g=Math.floor(h*l/u+n)*f;if(Vr===null){var v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Vr=v?parseInt(v[1]):0}return Vr&&Vr<=87&&t===2&&l>=224e3&&o===0&&(a[s+3]=128|a[s+3]),{sampleRate:u,channelCount:d,frameLength:g,samplesPerFrame:c}}}function Vi(a,s){return a[s]===255&&(224&a[s+1])==224&&(6&a[s+1])!=0}function ms(a,s){return s+1<a.length&&Vi(a,s)}function ps(a,s){if(s+1<a.length&&Vi(a,s)){var r=vs(a,s),t=4;r!=null&&r.frameLength&&(t=r.frameLength);var e=s+t;return e===a.length||ms(a,e)}return!1}var Dl=(function(a){function s(t,e){var i;return(i=a.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=e,i}ut(s,a);var r=s.prototype;return r.resetInitSegment=function(t,e,i,n){a.prototype.resetInitSegment.call(this,t,e,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}},s.probe=function(t,e){if(!t)return!1;var i=fr(t,0),n=i?.length||0;if(ps(t,n))return!1;for(var o=t.length;n<o;n++)if(ml(t,n))return e.log("ADTS sync word found !"),!0;return!1},r.canParse=function(t,e){return(function(i,n){return(function(o,l){return l+5<o.length})(i,n)&&os(i,n)&&Ui(i,n)<=i.length-n})(t,e)},r.appendFrame=function(t,e,i){us(t,this.observer,e,i,t.manifestCodec);var n=hs(t,e,i,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n},s})(Ki),ys=function(a,s){var r=0,t=5;s+=t;for(var e=new Uint32Array(1),i=new Uint32Array(1),n=new Uint8Array(1);t>0;){n[0]=a[s];var o=Math.min(t,8),l=8-o;i[0]=4278190080>>>24+l<<l,e[0]=(n[0]&i[0])>>l,r=r?r<<o|e[0]:e[0],s+=1,t-=o}return r},_l=(function(a){function s(t){var e;return(e=a.call(this)||this).observer=void 0,e.observer=t,e}ut(s,a);var r=s.prototype;return r.resetInitSegment=function(t,e,i,n){a.prototype.resetInitSegment.call(this,t,e,i,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}},r.canParse=function(t,e){return e+64<t.length},r.appendFrame=function(t,e,i){var n=Es(t,e,i,this.basePTS,this.frameIndex);if(n!==-1)return{sample:t.samples[t.samples.length-1],length:n,missing:0}},s.probe=function(t){if(!t)return!1;var e=fr(t,0);if(!e)return!1;var i=e.length;return t[i]===11&&t[i+1]===119&&Gi(e)!==void 0&&ys(t,i)<16},s})(Ki);function Es(a,s,r,t,e){if(r+8>s.length||s[r]!==11||s[r+1]!==119)return-1;var i=s[r+4]>>6;if(i>=3)return-1;var n=[48e3,44100,32e3][i],o=63&s[r+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+i];if(r+l>s.length)return-1;var u=s[r+6]>>5,d=0;u===2?d+=2:(1&u&&u!==1&&(d+=2),4&u&&(d+=2));var h=(s[r+6]<<8|s[r+7])>>12-d&1,f=[2,1,2,3,3,4,4,5][u]+h,c=s[r+5]>>3,g=7&s[r+5],v=new Uint8Array([i<<6|c<<1|g>>2,(3&g)<<6|u<<3|h<<2|o>>4,o<<4&224]),m=t+e*(1536/n*9e4),p=s.subarray(r,r+l);return a.config=v,a.channelCount=f,a.samplerate=n,a.samples.push({unit:p,pts:m}),l}var Pl=(function(a){function s(){return a.apply(this,arguments)||this}ut(s,a);var r=s.prototype;return r.resetInitSegment=function(t,e,i,n){a.prototype.resetInitSegment.call(this,t,e,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}},s.probe=function(t){if(!t)return!1;var e=fr(t,0),i=e?.length||0;if(e&&t[i]===11&&t[i+1]===119&&Gi(e)!==void 0&&ys(t,i)<=16)return!1;for(var n=t.length;i<n;i++)if(ps(t,i))return ct.log("MPEG Audio sync word found !"),!0;return!1},r.canParse=function(t,e){return(function(i,n){return Vi(i,n)&&4<=i.length-n})(t,e)},r.appendFrame=function(t,e,i){if(this.basePTS!==null)return gs(t,e,i,this.basePTS,this.frameIndex)},s})(Ki),Cl=/\/emsg[-/]ID3/i,wl=(function(){function a(r,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var s=a.prototype;return s.resetTimeStamp=function(){},s.resetInitSegment=function(r,t,e,i){var n=this.videoTrack=fe("video",1),o=this.audioTrack=fe("audio",1),l=this.txtTrack=fe("text",1);if(this.id3Track=fe("id3",1),this.timeOffset=0,r!=null&&r.byteLength){var u=Yn(r);if(u.video){var d=u.video,h=d.id,f=d.timescale,c=d.codec,g=d.supplemental;n.id=h,n.timescale=l.timescale=f,n.codec=c,n.supplemental=g}if(u.audio){var v=u.audio,m=v.id,p=v.timescale,E=v.codec;o.id=m,o.timescale=p,o.codec=E}l.id=Gn.text,n.sampleDuration=0,n.duration=o.duration=i}},s.resetContiguity=function(){this.remainderData=null},a.probe=function(r){return(function(t){for(var e=t.byteLength,i=0;i<e;){var n=z(t,i);if(n>8&&t[i+4]===109&&t[i+5]===111&&t[i+6]===111&&t[i+7]===102)return!0;i=n>1?i+n:e}return!1})(r)},s.demux=function(r,t){this.timeOffset=t;var e=r,i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(e=re(this.remainderData,r));var o=(function(u){var d={valid:null,remainder:null},h=J(u,["moof"]);if(h.length<2)return d.remainder=u,d;var f=h[h.length-1];return d.valid=u.slice(0,f.byteOffset-8),d.remainder=u.slice(f.byteOffset-8),d})(e);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=e;var l=this.extractID3Track(i,t);return n.samples=jn(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},s.flush=function(){var r=this.timeOffset,t=this.videoTrack,e=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return e.samples=jn(r,t),{videoTrack:t,audioTrack:fe(),id3Track:i,textTrack:fe()}},s.extractID3Track=function(r,t){var e=this,i=this.id3Track;if(r.samples.length){var n=J(r.samples,["emsg"]);n&&n.forEach((function(o){var l=(function(c){var g=c[0],v="",m="",p=0,E=0,T=0,S=0,R=0,A=0;if(g===0){for(;Mt(c.subarray(A,A+1))!=="\0";)v+=Mt(c.subarray(A,A+1)),A+=1;for(v+=Mt(c.subarray(A,A+1)),A+=1;Mt(c.subarray(A,A+1))!=="\0";)m+=Mt(c.subarray(A,A+1)),A+=1;m+=Mt(c.subarray(A,A+1)),A+=1,p=z(c,12),E=z(c,16),S=z(c,20),R=z(c,24),A=28}else if(g===1){p=z(c,A+=4);var L=z(c,A+=4),b=z(c,A+=4);for(A+=4,T=Math.pow(2,32)*L+b,wo(T)||(T=Number.MAX_SAFE_INTEGER,ct.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),S=z(c,A),R=z(c,A+=4),A+=4;Mt(c.subarray(A,A+1))!=="\0";)v+=Mt(c.subarray(A,A+1)),A+=1;for(v+=Mt(c.subarray(A,A+1)),A+=1;Mt(c.subarray(A,A+1))!=="\0";)m+=Mt(c.subarray(A,A+1)),A+=1;m+=Mt(c.subarray(A,A+1)),A+=1}return{schemeIdUri:v,value:m,timeScale:p,presentationTime:T,presentationTimeDelta:E,eventDuration:S,id:R,payload:c.subarray(A,c.byteLength)}})(o);if(Cl.test(l.schemeIdUri)){var u=Ts(l,t),d=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var h=l.payload;i.samples.push({data:h,len:h.byteLength,dts:u,pts:u,type:Qt.emsg,duration:d})}else if(e.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var f=Ts(l,t);i.samples.push({data:l.payload,len:l.payload.byteLength,dts:f,pts:f,type:Qt.misbklv,duration:Number.POSITIVE_INFINITY})}}))}return i},s.demuxSampleAes=function(r,t,e){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},s.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},a})();function Ts(a,s){return B(a.presentationTime)?a.presentationTime/a.timeScale:s+a.presentationTimeDelta/a.timeScale}var Ol=(function(){function a(r,t,e){this.keyData=void 0,this.decrypter=void 0,this.keyData=e,this.decrypter=new Li(t,{removePKCS7Padding:!1})}var s=a.prototype;return s.decryptBuffer=function(r){return this.decrypter.decrypt(r,this.keyData.key.buffer,this.keyData.iv.buffer,lr)},s.decryptAacSample=function(r,t,e){var i=this,n=r[t].unit;if(!(n.length<=16)){var o=n.subarray(16,n.length-n.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then((function(u){var d=new Uint8Array(u);n.set(d,16),i.decrypter.isSync()||i.decryptAacSamples(r,t+1,e)})).catch(e)}},s.decryptAacSamples=function(r,t,e){for(;;t++){if(t>=r.length)return void e();if(!(r[t].unit.length<32||(this.decryptAacSample(r,t,e),this.decrypter.isSync())))return}},s.getAvcEncryptedData=function(r){for(var t=16*Math.floor((r.length-48)/160)+16,e=new Int8Array(t),i=0,n=32;n<r.length-16;n+=160,i+=16)e.set(r.subarray(n,n+16),i);return e},s.getAvcDecryptedUnit=function(r,t){for(var e=new Uint8Array(t),i=0,n=32;n<r.length-16;n+=160,i+=16)r.set(e.subarray(i,i+16),n);return r},s.decryptAvcSample=function(r,t,e,i,n){var o=this,l=qn(n.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then((function(d){n.data=o.getAvcDecryptedUnit(l,d),o.decrypter.isSync()||o.decryptAvcSamples(r,t,e+1,i)})).catch(i)},s.decryptAvcSamples=function(r,t,e,i){if(r instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,e=0){if(t>=r.length)return void i();for(var n=r[t].units;!(e>=n.length);e++){var o=n[e];if(!(o.data.length<=48||o.type!==1&&o.type!==5||(this.decryptAvcSample(r,t,e,i,o),this.decrypter.isSync())))return}}},a})(),Ss=(function(){function a(){this.VideoSample=null}var s=a.prototype;return s.createVideoSample=function(r,t,e){return{key:r,frame:!1,pts:t,dts:e,units:[],length:0}},s.getLastNalUnit=function(r){var t,e,i=this.VideoSample;if(i&&i.units.length!==0||(i=r[r.length-1]),(t=i)!=null&&t.units){var n=i.units;e=n[n.length-1]}return e},s.pushAccessUnit=function(r,t){if(r.units.length&&r.frame){if(r.pts===void 0){var e=t.samples,i=e.length;if(!i)return void t.dropped++;var n=e[i-1];r.pts=n.pts,r.dts=n.dts}t.samples.push(r)}},s.parseNALu=function(r,t,e){var i,n,o=t.byteLength,l=r.naluState||0,u=l,d=[],h=0,f=-1,c=0;for(l===-1&&(f=0,c=this.getNALuType(t,0),l=0,h=1);h<o;)if(i=t[h++],l)if(l!==1)if(i)if(i===1){if(n=h-l-1,f>=0){var g={data:t.subarray(f,n),type:c};d.push(g)}else{var v=this.getLastNalUnit(r.samples);v&&(u&&h<=4-u&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-u)),n>0&&(v.data=re(v.data,t.subarray(0,n)),v.state=0))}h<o?(f=h,c=this.getNALuType(t,h),l=0):l=-1}else l=0;else l=3;else l=i?0:2;else l=i?0:1;if(f>=0&&l>=0){var m={data:t.subarray(f,o),type:c,state:l};d.push(m)}if(d.length===0){var p=this.getLastNalUnit(r.samples);p&&(p.data=re(p.data,t))}return r.naluState=l,d},a})(),cr=(function(){function a(r){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=r,this.bytesAvailable=r.byteLength,this.word=0,this.bitsAvailable=0}var s=a.prototype;return s.loadWord=function(){var r=this.data,t=this.bytesAvailable,e=r.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");i.set(r.subarray(e,e+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},s.skipBits=function(r){var t;r=Math.min(r,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>r?(this.word<<=r,this.bitsAvailable-=r):(r-=this.bitsAvailable,r-=(t=r>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=r,this.bitsAvailable-=r)},s.readBits=function(r){var t=Math.min(this.bitsAvailable,r),e=this.word>>>32-t;if(r>32&&ct.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=r-t)>0&&this.bitsAvailable?e<<t|this.readBits(t):e},s.skipLZ=function(){var r;for(r=0;r<this.bitsAvailable;++r)if((this.word&2147483648>>>r)!=0)return this.word<<=r,this.bitsAvailable-=r,r;return this.loadWord(),r+this.skipLZ()},s.skipUEG=function(){this.skipBits(1+this.skipLZ())},s.skipEG=function(){this.skipBits(1+this.skipLZ())},s.readUEG=function(){var r=this.skipLZ();return this.readBits(r+1)-1},s.readEG=function(){var r=this.readUEG();return 1&r?1+r>>>1:-1*(r>>>1)},s.readBoolean=function(){return this.readBits(1)===1},s.readUByte=function(){return this.readBits(8)},s.readUShort=function(){return this.readBits(16)},s.readUInt=function(){return this.readBits(32)},a})(),xl=(function(a){function s(){return a.apply(this,arguments)||this}ut(s,a);var r=s.prototype;return r.parsePES=function(t,e,i,n){var o,l=this,u=this.parseNALu(t,i.data,n),d=this.VideoSample,h=!1;i.data=null,d&&u.length&&!t.audFound&&(this.pushAccessUnit(d,t),d=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach((function(f){var c,g;switch(f.type){case 1:var v=!1;o=!0;var m,p=f.data;if(h&&p.length>4){var E=l.readSliceType(p);E!==2&&E!==4&&E!==7&&E!==9||(v=!0)}v&&(m=d)!=null&&m.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.frame=!0,d.key=v;break;case 5:o=!0,(c=d)!=null&&c.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0,d.frame=!0;break;case 6:o=!0,gi(f.data,1,i.pts,e.samples);break;case 7:var T,S;o=!0,h=!0;var R=f.data,A=l.readSPS(R);if(!t.sps||t.width!==A.width||t.height!==A.height||((T=t.pixelRatio)==null?void 0:T[0])!==A.pixelRatio[0]||((S=t.pixelRatio)==null?void 0:S[1])!==A.pixelRatio[1]){t.width=A.width,t.height=A.height,t.pixelRatio=A.pixelRatio,t.sps=[R];for(var L=R.subarray(1,4),b="avc1.",k=0;k<3;k++){var I=L[k].toString(16);I.length<2&&(I="0"+I),b+=I}t.codec=b}break;case 8:o=!0,t.pps=[f.data];break;case 9:o=!0,t.audFound=!0,(g=d)!=null&&g.frame&&(l.pushAccessUnit(d,t),d=null),d||(d=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;case 12:o=!0;break;default:o=!1}d&&o&&d.units.push(f)})),n&&d&&(this.pushAccessUnit(d,t),this.VideoSample=null)},r.getNALuType=function(t,e){return 31&t[e]},r.readSliceType=function(t){var e=new cr(t);return e.readUByte(),e.readUEG(),e.readUEG()},r.skipScalingList=function(t,e){for(var i=8,n=8,o=0;o<t;o++)n!==0&&(n=(i+e.readEG()+256)%256),i=n===0?i:n},r.readSPS=function(t){var e,i,n,o=new cr(t),l=0,u=0,d=0,h=0,f=o.readUByte.bind(o),c=o.readBits.bind(o),g=o.readUEG.bind(o),v=o.readBoolean.bind(o),m=o.skipBits.bind(o),p=o.skipEG.bind(o),E=o.skipUEG.bind(o),T=this.skipScalingList.bind(this);f();var S=f();if(c(5),m(3),f(),E(),S===100||S===110||S===122||S===244||S===44||S===83||S===86||S===118||S===128){var R=g();if(R===3&&m(1),E(),E(),m(1),v())for(i=R!==3?8:12,n=0;n<i;n++)v()&&T(n<6?16:64,o)}E();var A=g();if(A===0)g();else if(A===1)for(m(1),p(),p(),e=g(),n=0;n<e;n++)p();E(),m(1);var L=g(),b=g(),k=c(1);k===0&&m(1),m(1),v()&&(l=g(),u=g(),d=g(),h=g());var I=[1,1];if(v()&&v())switch(f()){case 1:I=[1,1];break;case 2:I=[12,11];break;case 3:I=[10,11];break;case 4:I=[16,11];break;case 5:I=[40,33];break;case 6:I=[24,11];break;case 7:I=[20,11];break;case 8:I=[32,11];break;case 9:I=[80,33];break;case 10:I=[18,11];break;case 11:I=[15,11];break;case 12:I=[64,33];break;case 13:I=[160,99];break;case 14:I=[4,3];break;case 15:I=[3,2];break;case 16:I=[2,1];break;case 255:I=[f()<<8|f(),f()<<8|f()]}return{width:Math.ceil(16*(L+1)-2*l-2*u),height:(2-k)*(b+1)*16-(k?2:4)*(d+h),pixelRatio:I}},s})(Ss),Ml=(function(a){function s(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(t=a.call.apply(a,[this].concat(i))||this).initVPS=null,t}ut(s,a);var r=s.prototype;return r.parsePES=function(t,e,i,n){var o,l=this,u=this.parseNALu(t,i.data,n),d=this.VideoSample,h=!1;i.data=null,d&&u.length&&!t.audFound&&(this.pushAccessUnit(d,t),d=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach((function(f){var c,g;switch(f.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:d||(d=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts)),d.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:var v;o=!0,h&&(v=d)!=null&&v.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0,d.frame=!0;break;case 19:case 20:o=!0,(c=d)!=null&&c.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0,d.frame=!0;break;case 39:o=!0,gi(f.data,2,i.pts,e.samples);break;case 32:o=!0,t.vps||(typeof t.params!="object"&&(t.params={}),t.params=mt(t.params,l.readVPS(f.data)),l.initVPS=f.data),t.vps=[f.data];break;case 33:if(o=!0,h=!0,t.vps===void 0||t.vps[0]===l.initVPS||t.sps===void 0||l.matchSPS(t.sps[0],f.data)||(l.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){var m=l.readSPS(f.data);for(var p in t.width=m.width,t.height=m.height,t.pixelRatio=m.pixelRatio,t.codec=m.codecString,t.sps=[],typeof t.params!="object"&&(t.params={}),m.params)t.params[p]=m.params[p]}l.pushParameterSet(t.sps,f.data,t.vps),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0;break;case 34:if(o=!0,typeof t.params=="object"){if(!t.pps){t.pps=[];var E=l.readPPS(f.data);for(var T in E)t.params[T]=E[T]}l.pushParameterSet(t.pps,f.data,t.vps)}break;case 35:o=!0,t.audFound=!0,(g=d)!=null&&g.frame&&(l.pushAccessUnit(d,t),d=null),d||(d=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;default:o=!1}d&&o&&d.units.push(f)})),n&&d&&(this.pushAccessUnit(d,t),this.VideoSample=null)},r.pushParameterSet=function(t,e,i){(i&&i[0]===this.initVPS||!i&&!t.length)&&t.push(e)},r.getNALuType=function(t,e){return(126&t[e])>>>1},r.ebsp2rbsp=function(t){for(var e=new Uint8Array(t.byteLength),i=0,n=0;n<t.byteLength;n++)n>=2&&t[n]===3&&t[n-1]===0&&t[n-2]===0||(e[i]=t[n],i++);return new Uint8Array(e.buffer,0,i)},r.pushAccessUnit=function(t,e){a.prototype.pushAccessUnit.call(this,t,e),this.initVPS&&(this.initVPS=null)},r.readVPS=function(t){var e=new cr(t);return e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6),{numTemporalLayers:e.readBits(3)+1,temporalIdNested:e.readBoolean()}},r.readSPS=function(t){var e=new cr(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);var i=e.readBits(3);e.readBoolean();for(var n=e.readBits(2),o=e.readBoolean(),l=e.readBits(5),u=e.readUByte(),d=e.readUByte(),h=e.readUByte(),f=e.readUByte(),c=e.readUByte(),g=e.readUByte(),v=e.readUByte(),m=e.readUByte(),p=e.readUByte(),E=e.readUByte(),T=e.readUByte(),S=[],R=[],A=0;A<i;A++)S.push(e.readBoolean()),R.push(e.readBoolean());if(i>0)for(var L=i;L<8;L++)e.readBits(2);for(var b=0;b<i;b++)S[b]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),R[b]&&e.readUByte();e.readUEG();var k=e.readUEG();k==3&&e.skipBits(1);var I=e.readUEG(),D=e.readUEG(),P=e.readBoolean(),M=0,O=0,w=0,F=0;P&&(M+=e.readUEG(),O+=e.readUEG(),w+=e.readUEG(),F+=e.readUEG());for(var x=e.readUEG(),N=e.readUEG(),H=e.readUEG(),U=e.readBoolean()?0:i;U<=i;U++)e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.readBoolean()&&e.readBoolean())for(var G=0;G<4;G++)for(var X=0;X<(G===3?2:6);X++)if(e.readBoolean()){var $=Math.min(64,1<<4+(G<<1));G>1&&e.readEG();for(var Y=0;Y<$;Y++)e.readEG()}else e.readUEG();e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());for(var dt=e.readUEG(),rt=0,V=0;V<dt;V++){var Tt=!1;if(V!==0&&(Tt=e.readBoolean()),Tt){V===dt&&e.readUEG(),e.readBoolean(),e.readUEG();for(var Q=0,nt=0;nt<=rt;nt++){var W=e.readBoolean(),ht=!1;W||(ht=e.readBoolean()),(W||ht)&&Q++}rt=Q}else{var It=e.readUEG(),it=e.readUEG();rt=It+it;for(var et=0;et<It;et++)e.readUEG(),e.readBoolean();for(var Dt=0;Dt<it;Dt++)e.readUEG(),e.readBoolean()}}if(e.readBoolean())for(var at=e.readUEG(),j=0;j<at;j++){for(var Ot=0;Ot<H+4;Ot++)e.readBits(1);e.readBits(1)}var q=0,gt=1,ot=1,St=!0,At=1,Ct=0;if(e.readBoolean(),e.readBoolean(),e.readBoolean()){if(e.readBoolean()){var st=e.readUByte();st>0&&st<16?(gt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][st-1],ot=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][st-1]):st===255&&(gt=e.readBits(16),ot=e.readBits(16))}if(e.readBoolean()&&e.readBoolean(),e.readBoolean()&&(e.readBits(3),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())),e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG()),e.readBoolean()&&(At=e.readBits(32),Ct=e.readBits(32),e.readBoolean()&&e.readUEG(),e.readBoolean())){var _t=e.readBoolean(),Wt=e.readBoolean(),Zt=!1;(_t||Wt)&&((Zt=e.readBoolean())&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),Zt&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(var jt=0;jt<=i;jt++){var Jt=!1;(St=e.readBoolean())||e.readBoolean()?e.readEG():Jt=e.readBoolean();var xt=Jt?1:e.readUEG()+1;if(_t)for(var Gt=0;Gt<xt;Gt++)e.readUEG(),e.readUEG(),Zt&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(Wt)for(var Rt=0;Rt<xt;Rt++)e.readUEG(),e.readUEG(),Zt&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),q=e.readUEG())}var Lt=I,lt=D;if(P){var pt=1,vt=1;k===1?pt=vt=2:k==2&&(pt=2),Lt=I-pt*O-pt*M,lt=D-vt*F-vt*w}for(var ve=n?["A","B","C"][n]:"",Ne=u<<24|d<<16|h<<8|f,Ut=0,Se=0;Se<32;Se++)Ut=(Ut|(Ne>>Se&1)<<31-Se)>>>0;var qt=Ut.toString(16);return l===1&&qt==="2"&&(qt="6"),{codecString:"hvc1."+ve+l+"."+qt+"."+(o?"H":"L")+T+".B0",params:{general_tier_flag:o,general_profile_idc:l,general_profile_space:n,general_profile_compatibility_flags:[u,d,h,f],general_constraint_indicator_flags:[c,g,v,m,p,E],general_level_idc:T,bit_depth:x+8,bit_depth_luma_minus8:x,bit_depth_chroma_minus8:N,min_spatial_segmentation_idc:q,chroma_format_idc:k,frame_rate:{fixed:St,fps:Ct/At}},width:Lt,height:lt,pixelRatio:[gt,ot]}},r.readPPS=function(t){var e=new cr(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2),e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);var i=e.readBoolean(),n=e.readBoolean(),o=1;return n&&i?o=0:n?o=3:i&&(o=2),{parallelismType:o}},r.matchSPS=function(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)},s})(Ss),Nt=188,Fl=(function(){function a(r,t,e,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=r,this.config=t,this.typeSupported=e,this.logger=i,this.videoParser=null}a.probe=function(r,t){var e=a.syncOffset(r);return e>0&&t.warn("MPEG2-TS detected but first sync word found @ offset "+e),e!==-1},a.syncOffset=function(r){for(var t=r.length,e=Math.min(940,t-Nt)+1,i=0;i<e;){for(var n=!1,o=-1,l=0,u=i;u<t;u+=Nt){if(r[u]!==71||t-u!==Nt&&r[u+Nt]!==71){if(l)return-1;break}if(l++,o===-1&&(o=u)!==0&&(e=Math.min(o+18612,r.length-Nt)+1),n||(n=Hi(r,u)===0),n&&l>1&&(o===0&&l>2||u+Nt>e))return o}i++}return-1},a.createTrack=function(r,t){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:Gn[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?t:void 0}};var s=a.prototype;return s.resetInitSegment=function(r,t,e,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=a.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=a.createTrack("audio",i),this._id3Track=a.createTrack("id3"),this._txtTrack=a.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=e},s.resetTimeStamp=function(){},s.resetContiguity=function(){var r=this._audioTrack,t=this._videoTrack,e=this._id3Track;r&&(r.pesData=null),t&&(t.pesData=null),e&&(e.pesData=null),this.aacOverFlow=null,this.remainderData=null},s.demux=function(r,t,e,i){var n;e===void 0&&(e=!1),i===void 0&&(i=!1),e||(this.sampleAes=null);var o=this._videoTrack,l=this._audioTrack,u=this._id3Track,d=this._txtTrack,h=o.pid,f=o.pesData,c=l.pid,g=u.pid,v=l.pesData,m=u.pesData,p=null,E=this.pmtParsed,T=this._pmtId,S=r.length;if(this.remainderData&&(S=(r=re(this.remainderData,r)).length,this.remainderData=null),S<Nt&&!i)return this.remainderData=r,{audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};var R=Math.max(0,a.syncOffset(r));(S-=(S-R)%Nt)<r.byteLength&&!i&&(this.remainderData=new Uint8Array(r.buffer,S,r.buffer.byteLength-S));for(var A=0,L=R;L<S;L+=Nt)if(r[L]===71){var b=!!(64&r[L+1]),k=Hi(r,L),I=void 0;if((48&r[L+3])>>4>1){if((I=L+5+r[L+4])===L+Nt)continue}else I=L+4;switch(k){case h:b&&(f&&(n=qe(f,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,d,n,!1)),f={data:[],size:0}),f&&(f.data.push(r.subarray(I,L+Nt)),f.size+=L+Nt-I);break;case c:if(b){if(v&&(n=qe(v,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,n);break;case"mp3":this.parseMPEGPES(l,n);break;case"ac3":this.parseAC3PES(l,n)}v={data:[],size:0}}v&&(v.data.push(r.subarray(I,L+Nt)),v.size+=L+Nt-I);break;case g:b&&(m&&(n=qe(m,this.logger))&&this.parseID3PES(u,n),m={data:[],size:0}),m&&(m.data.push(r.subarray(I,L+Nt)),m.size+=L+Nt-I);break;case 0:b&&(I+=r[I]+1),T=this._pmtId=Nl(r,I);break;case T:b&&(I+=r[I]+1);var D=Ul(r,I,this.typeSupported,e,this.observer,this.logger);(h=D.videoPid)>0&&(o.pid=h,o.segmentCodec=D.segmentVideoCodec),(c=D.audioPid)>0&&(l.pid=c,l.segmentCodec=D.segmentAudioCodec),(g=D.id3Pid)>0&&(u.pid=g),p===null||E||(this.logger.warn("MPEG-TS PMT found at "+L+" after unknown PID '"+p+"'. Backtracking to sync byte @"+R+" to parse all TS packets."),p=null,L=R-188),E=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=k}}else A++;A>0&&Yi(this.observer,new Error("Found "+A+" TS packet/s that do not start with 0x47"),void 0,this.logger),o.pesData=f,l.pesData=v,u.pesData=m;var P={audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};return i&&this.extractRemainingSamples(P),P},s.flush=function(){var r,t=this.remainderData;return this.remainderData=null,r=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(r),this.sampleAes?this.decrypt(r,this.sampleAes):r},s.extractRemainingSamples=function(r){var t,e=r.audioTrack,i=r.videoTrack,n=r.id3Track,o=r.textTrack,l=i.pesData,u=e.pesData,d=n.pesData;if(l&&(t=qe(l,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,o,t,!0),i.pesData=null)):i.pesData=l,u&&(t=qe(u,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,t);break;case"mp3":this.parseMPEGPES(e,t);break;case"ac3":this.parseAC3PES(e,t)}e.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=u;d&&(t=qe(d,this.logger))?(this.parseID3PES(n,t),n.pesData=null):n.pesData=d},s.demuxSampleAes=function(r,t,e){var i=this.demux(r,e,!0,!this.config.progressive),n=this.sampleAes=new Ol(this.observer,this.config,t);return this.decrypt(i,n)},s.readyVideoParser=function(r){this.videoParser===null&&(r==="avc"?this.videoParser=new xl:r==="hevc"&&(this.videoParser=new Ml))},s.decrypt=function(r,t){return new Promise((function(e){var i=r.audioTrack,n=r.videoTrack;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,(function(){n.samples?t.decryptAvcSamples(n.samples,0,0,(function(){e(r)})):e(r)})):n.samples&&t.decryptAvcSamples(n.samples,0,0,(function(){e(r)}))}))},s.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},s.parseAACPES=function(r,t){var e,i,n,o=0,l=this.aacOverFlow,u=t.data;if(l){this.aacOverFlow=null;var d=l.missing,h=l.sample.unit.byteLength;if(d===-1)u=re(l.sample.unit,u);else{var f=h-d;l.sample.unit.set(u.subarray(0,d),f),r.samples.push(l.sample),o=l.missing}}for(e=o,i=u.length;e<i-1&&!Gr(u,e);e++);if(e!==o){var c,g=e<i-1;if(c=g?"AAC PES did not start with ADTS header,offset:"+e:"No ADTS header found in AAC PES",Yi(this.observer,new Error(c),g,this.logger),!g)return}if(us(r,this.observer,u,e,this.audioCodec),t.pts!==void 0)n=t.pts;else{if(!l)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var v=ds(r.samplerate);n=l.sample.pts+v}for(var m,p=0;e<i;){if(e+=(m=hs(r,u,e,n,p)).length,m.missing){this.aacOverFlow=m;break}for(p++;e<i-1&&!Gr(u,e);e++);}},s.parseMPEGPES=function(r,t){var e=t.data,i=e.length,n=0,o=0,l=t.pts;if(l!==void 0)for(;o<i;)if(ms(e,o)){var u=gs(r,e,o,l,n);if(!u)break;o+=u.length,n++}else o++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},s.parseAC3PES=function(r,t){var e=t.data,i=t.pts;if(i!==void 0)for(var n,o=e.length,l=0,u=0;u<o&&(n=Es(r,e,u,i,l++))>0;)u+=n;else this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS")},s.parseID3PES=function(r,t){if(t.pts!==void 0){var e=mt({},t,{type:this._videoTrack?Qt.emsg:Qt.audioId3,duration:Number.POSITIVE_INFINITY});r.samples.push(e)}else this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},a})();function Hi(a,s){return((31&a[s+1])<<8)+a[s+2]}function Nl(a,s){return(31&a[s+10])<<8|a[s+11]}function Ul(a,s,r,t,e,i){var n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=s+3+((15&a[s+1])<<8|a[s+2])-4;for(s+=12+((15&a[s+10])<<8|a[s+11]);s<o;){var l=Hi(a,s),u=(15&a[s+3])<<8|a[s+4];switch(a[s]){case 207:if(!t){Wi("ADTS AAC",i);break}case 15:n.audioPid===-1&&(n.audioPid=l);break;case 21:n.id3Pid===-1&&(n.id3Pid=l);break;case 219:if(!t){Wi("H.264",i);break}case 27:n.videoPid===-1&&(n.videoPid=l);break;case 3:case 4:r.mpeg||r.mp3?n.audioPid===-1&&(n.audioPid=l,n.segmentAudioCodec="mp3"):i.log("MPEG audio found, not supported in this browser");break;case 193:if(!t){Wi("AC-3",i);break}case 129:r.ac3?n.audioPid===-1&&(n.audioPid=l,n.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(n.audioPid===-1&&u>0)for(var d=s+5,h=u;h>2;){a[d]===106&&(r.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=l,n.segmentAudioCodec="ac3"));var f=a[d+1]+2;d+=f,h-=f}break;case 194:case 135:return Yi(e,new Error("Unsupported EC-3 in M2TS found"),void 0,i),n;case 36:n.videoPid===-1&&(n.videoPid=l,n.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"))}s+=u+5}return n}function Yi(a,s,r,t){t.warn("parsing error: "+s.message),a.emit(y.ERROR,y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:s,reason:s.message})}function Wi(a,s){s.log(a+" with AES-128-CBC encryption found in unencrypted stream")}function qe(a,s){var r,t,e,i,n,o=0,l=a.data;if(!a||a.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=re(l[0],l[1]),l.splice(1,1);if(((r=l[0])[0]<<16)+(r[1]<<8)+r[2]===1){if((t=(r[4]<<8)+r[5])&&t>a.size-6)return null;var u=r[7];192&u&&(i=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2,64&u?i-(n=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2)>54e5&&(s.warn(Math.round((i-n)/9e4)+"s delta between PTS and DTS, align them"),i=n):n=i);var d=(e=r[8])+9;if(a.size<=d)return null;a.size-=d;for(var h=new Uint8Array(a.size),f=0,c=l.length;f<c;f++){var g=(r=l[f]).byteLength;if(d){if(d>g){d-=g;continue}r=r.subarray(d),g-=d,d=0}h.set(r,o),o+=g}return t&&(t-=e+3),{data:h,pts:i,dts:n,len:t}}return null}var Bl=(function(){function a(){}return a.getSilentFrame=function(s,r){if(s==="mp4a.40.2"){if(r===1)return new Uint8Array([0,200,0,128,35,128]);if(r===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(r===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(r===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(r===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(r===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(r===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(r===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},a})(),be=Math.pow(2,32)-1,Ft=(function(){function a(){}return a.init=function(){var s;for(s in a.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},a.types)a.types.hasOwnProperty(s)&&(a.types[s]=[s.charCodeAt(0),s.charCodeAt(1),s.charCodeAt(2),s.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:r,audio:t};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=i,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var n=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,n,l,n,o),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(s){for(var r=8,t=arguments.length,e=new Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];for(var n=e.length,o=n;n--;)r+=e[n].byteLength;var l=new Uint8Array(r);for(l[0]=r>>24&255,l[1]=r>>16&255,l[2]=r>>8&255,l[3]=255&r,l.set(s,4),n=0,r=8;n<o;n++)l.set(e[n],r),r+=e[n].byteLength;return l},a.hdlr=function(s){return a.box(a.types.hdlr,a.HDLR_TYPES[s])},a.mdat=function(s){return a.box(a.types.mdat,s)},a.mdhd=function(s,r){r*=s;var t=Math.floor(r/(be+1)),e=Math.floor(r%(be+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,255&s,t>>24,t>>16&255,t>>8&255,255&t,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))},a.mdia=function(s){return a.box(a.types.mdia,a.mdhd(s.timescale||0,s.duration||0),a.hdlr(s.type),a.minf(s))},a.mfhd=function(s){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s]))},a.minf=function(s){return s.type==="audio"?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(s)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(s))},a.moof=function(s,r,t){return a.box(a.types.moof,a.mfhd(s),a.traf(t,r))},a.moov=function(s){for(var r=s.length,t=[];r--;)t[r]=a.trak(s[r]);return a.box.apply(null,[a.types.moov,a.mvhd(s[0].timescale||0,s[0].duration||0)].concat(t).concat(a.mvex(s)))},a.mvex=function(s){for(var r=s.length,t=[];r--;)t[r]=a.trex(s[r]);return a.box.apply(null,[a.types.mvex].concat(t))},a.mvhd=function(s,r){r*=s;var t=Math.floor(r/(be+1)),e=Math.floor(r%(be+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,s>>24&255,s>>16&255,s>>8&255,255&s,t>>24,t>>16&255,t>>8&255,255&t,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,i)},a.sdtp=function(s){var r,t,e=s.samples||[],i=new Uint8Array(4+e.length);for(r=0;r<e.length;r++)t=e[r].flags,i[r+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return a.box(a.types.sdtp,i)},a.stbl=function(s){return a.box(a.types.stbl,a.stsd(s),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(s){var r,t,e,i=[],n=[];for(r=0;r<s.sps.length;r++)e=(t=s.sps[r]).byteLength,i.push(e>>>8&255),i.push(255&e),i=i.concat(Array.prototype.slice.call(t));for(r=0;r<s.pps.length;r++)e=(t=s.pps[r]).byteLength,n.push(e>>>8&255),n.push(255&e),n=n.concat(Array.prototype.slice.call(t));var o=a.box(a.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|s.sps.length].concat(i).concat([s.pps.length]).concat(n))),l=s.width,u=s.height,d=s.pixelRatio[0],h=s.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))},a.esds=function(s){var r=s.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(r,[6,1,2]))},a.audioStsd=function(s){var r=s.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s.channelCount||0,0,16,0,0,0,0,r>>8&255,255&r,0,0])},a.mp4a=function(s){return a.box(a.types.mp4a,a.audioStsd(s),a.box(a.types.esds,a.esds(s)))},a.mp3=function(s){return a.box(a.types[".mp3"],a.audioStsd(s))},a.ac3=function(s){return a.box(a.types["ac-3"],a.audioStsd(s),a.box(a.types.dac3,s.config))},a.stsd=function(s){var r=s.segmentCodec;if(s.type==="audio"){if(r==="aac")return a.box(a.types.stsd,a.STSD,a.mp4a(s));if(r==="ac3"&&s.config)return a.box(a.types.stsd,a.STSD,a.ac3(s));if(r==="mp3"&&s.codec==="mp3")return a.box(a.types.stsd,a.STSD,a.mp3(s))}else{if(!s.pps||!s.sps)throw new Error("video track missing pps or sps");if(r==="avc")return a.box(a.types.stsd,a.STSD,a.avc1(s));if(r==="hevc"&&s.vps)return a.box(a.types.stsd,a.STSD,a.hvc1(s))}throw new Error("unsupported "+s.type+" segment codec ("+r+"/"+s.codec+")")},a.tkhd=function(s){var r=s.id,t=(s.duration||0)*(s.timescale||0),e=s.width||0,i=s.height||0,n=Math.floor(t/(be+1)),o=Math.floor(t%(be+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,i>>8&255,255&i,0,0]))},a.traf=function(s,r){var t=a.sdtp(s),e=s.id,i=Math.floor(r/(be+1)),n=Math.floor(r%(be+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n])),a.trun(s,t.length+16+20+8+16+8+8),t)},a.trak=function(s){return s.duration=s.duration||4294967295,a.box(a.types.trak,a.tkhd(s),a.mdia(s))},a.trex=function(s){var r=s.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(s,r){var t,e,i,n,o,l,u=s.samples||[],d=u.length,h=12+16*d,f=new Uint8Array(h);for(r+=8+h,f.set([s.type==="video"?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),t=0;t<d;t++)i=(e=u[t]).duration,n=e.size,o=e.flags,l=e.cts,f.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*t);return a.box(a.types.trun,f)},a.initSegment=function(s){a.types||a.init();var r=a.moov(s);return re(a.FTYP,r)},a.hvc1=function(s){for(var r=s.params,t=[s.vps,s.sps,s.pps],e=new Uint8Array([1,r.general_profile_space<<6|(r.general_tier_flag?32:0)|r.general_profile_idc,r.general_profile_compatibility_flags[0],r.general_profile_compatibility_flags[1],r.general_profile_compatibility_flags[2],r.general_profile_compatibility_flags[3],r.general_constraint_indicator_flags[0],r.general_constraint_indicator_flags[1],r.general_constraint_indicator_flags[2],r.general_constraint_indicator_flags[3],r.general_constraint_indicator_flags[4],r.general_constraint_indicator_flags[5],r.general_level_idc,240|r.min_spatial_segmentation_idc>>8,255&r.min_spatial_segmentation_idc,252|r.parallelismType,252|r.chroma_format_idc,248|r.bit_depth_luma_minus8,248|r.bit_depth_chroma_minus8,0,parseInt(r.frame_rate.fps),3|r.temporal_id_nested<<2|r.num_temporal_layers<<3|(r.frame_rate.fixed?64:0),t.length]),i=e.length,n=0;n<t.length;n+=1){i+=3;for(var o=0;o<t[n].length;o+=1)i+=2+t[n][o].length}var l=new Uint8Array(i);l.set(e,0),i=e.length;for(var u=t.length-1,d=0;d<t.length;d+=1){l.set(new Uint8Array([32+d|(d===u?128:0),0,t[d].length]),i),i+=3;for(var h=0;h<t[d].length;h+=1)l.set(new Uint8Array([t[d][h].length>>8,255&t[d][h].length]),i),i+=2,l.set(t[d][h],i),i+=t[d][h].length}var f=a.box(a.types.hvcC,l),c=s.width,g=s.height,v=s.pixelRatio[0],m=s.pixelRatio[1];return a.box(a.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,g>>8&255,255&g,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,255&v,m>>24,m>>16&255,m>>8&255,255&m])))},a})();Ft.types=void 0,Ft.HDLR_TYPES=void 0,Ft.STTS=void 0,Ft.STSC=void 0,Ft.STCO=void 0,Ft.STSZ=void 0,Ft.VMHD=void 0,Ft.SMHD=void 0,Ft.STSD=void 0,Ft.FTYP=void 0,Ft.DINF=void 0;var As=9e4;function ji(a,s,r,t){r===void 0&&(r=1),t===void 0&&(t=!1);var e=a*s*r;return t?Math.round(e):e}function gr(a,s){return ji(a,1e3,1/As,s)}var Xe=null,qi=null;function Ls(a,s,r,t){return{duration:s,size:r,cts:t,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:a?2:1,isNonSync:a?0:1}}}var Hr=(function(a){function s(t,e,i,n){var o;if((o=a.call(this,"mp4-remuxer",n)||this).observer=void 0,o.config=void 0,o.typeSupported=void 0,o.ISGenerated=!1,o._initPTS=null,o._initDTS=null,o.nextVideoTs=null,o.nextAudioTs=null,o.videoSampleDuration=null,o.isAudioContiguous=!1,o.isVideoContiguous=!1,o.videoTrackConfig=void 0,o.observer=t,o.config=e,o.typeSupported=i,o.ISGenerated=!1,Xe===null){var l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Xe=l?parseInt(l[1]):0}if(qi===null){var u=navigator.userAgent.match(/Safari\/(\d+)/i);qi=u?parseInt(u[1]):0}return o}ut(s,a);var r=s.prototype;return r.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},r.resetTimeStamp=function(t){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=t},r.resetNextTimestamp=function(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},r.resetInitSegment=function(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},r.getVideoStartPts=function(t){var e=!1,i=t[0].pts,n=t.reduce((function(o,l){var u=l.pts,d=u-o;return d<-4294967296&&(e=!0,d=(u=ie(u,i))-o),d>0?o:u}),i);return e&&this.debug("PTS rollover detected"),n},r.remux=function(t,e,i,n,o,l,u,d){var h,f,c,g,v,m,p=o,E=o,T=t.pid>-1,S=e.pid>-1,R=e.samples.length,A=t.samples.length>0,L=u&&R>0||R>1;if((!T||A)&&(!S||L)||this.ISGenerated||u){if(this.ISGenerated){var b,k,I,D,P=this.videoTrackConfig;(P&&(e.width!==P.width||e.height!==P.height||((b=e.pixelRatio)==null?void 0:b[0])!==((k=P.pixelRatio)==null?void 0:k[0])||((I=e.pixelRatio)==null?void 0:I[1])!==((D=P.pixelRatio)==null?void 0:D[1]))||!P&&L||this.nextAudioTs===null&&A)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(t,e,o,l));var M,O=this.isVideoContiguous,w=-1;if(L&&(w=(function(U){for(var G=0;G<U.length;G++)if(U[G].key)return G;return-1})(e.samples),!O&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,w>0){this.warn("Dropped "+w+" out of "+R+" video samples due to a missing keyframe");var F=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(w),e.dropped+=w,M=E+=(e.samples[0].pts-F)/e.inputTimeScale}else w===-1&&(this.warn("No keyframe found out of "+R+" video samples"),m=!1);if(this.ISGenerated){if(A&&L){var x=this.getVideoStartPts(e.samples),N=(ie(t.samples[0].pts,x)-x)/e.inputTimeScale;p+=Math.max(0,N),E+=Math.max(0,-N)}if(A){if(t.samplerate||(this.warn("regenerate InitSegment as audio detected"),c=this.generateIS(t,e,o,l)),f=this.remuxAudio(t,p,this.isAudioContiguous,l,S||L||d===Kt?E:void 0),L){var H=f?f.endPTS-f.startPTS:0;e.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),c=this.generateIS(t,e,o,l)),h=this.remuxVideo(e,E,O,H)}}else L&&(h=this.remuxVideo(e,E,O,0));h&&(h.firstKeyFrame=w,h.independent=w!==-1,h.firstKeyFramePTS=M)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(v=Is(i,o,this._initPTS,this._initDTS)),n.samples.length&&(g=Rs(n,o,this._initPTS))),{audio:f,video:h,initSegment:c,independent:m,text:g,id3:v}},r.generateIS=function(t,e,i,n){var o,l,u,d=t.samples,h=e.samples,f=this.typeSupported,c={},g=this._initPTS,v=!g||n,m="audio/mp4",p=-1;if(v&&(o=l=1/0),t.config&&d.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":f.mpeg?(m="audio/mpeg",t.codec=""):f.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}c.audio={id:"audio",container:m,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&f.mpeg?new Uint8Array(0):Ft.initSegment([t]),metadata:{channelCount:t.channelCount}},v&&(p=t.id,u=t.inputTimeScale,g&&u===g.timescale?v=!1:o=l=d[0].pts-Math.round(u*i))}if(e.sps&&e.pps&&h.length){if(e.timescale=e.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:Ft.initSegment([e]),metadata:{width:e.width,height:e.height}},v)if(p=e.id,u=e.inputTimeScale,g&&u===g.timescale)v=!1;else{var E=this.getVideoStartPts(h),T=Math.round(u*i);l=Math.min(l,ie(h[0].dts,E)-T),o=Math.min(o,E-T)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,v?(g&&this.warn("Timestamps at playlist time: "+(n?"":"~")+i+" "+o/u+" != initPTS: "+g.baseTime/g.timescale+" ("+g.baseTime+"/"+g.timescale+") trackId: "+g.trackId),this.log("Found initPTS at playlist time: "+i+" offset: "+o/u+" ("+o+"/"+u+") trackId: "+p),this._initPTS={baseTime:o,timescale:u,trackId:p},this._initDTS={baseTime:l,timescale:u,trackId:p}):o=u=void 0,{tracks:c,initPTS:o,timescale:u,trackId:p}},r.remuxVideo=function(t,e,i,n){var o,l,u=t.inputTimeScale,d=t.samples,h=[],f=d.length,c=this._initPTS,g=c.baseTime*u/c.timescale,v=this.nextVideoTs,m=8,p=this.videoSampleDuration,E=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,S=!1;if(!i||v===null){var R=g+e*u,A=d[0].pts-ie(d[0].dts,d[0].pts);Xe&&v!==null&&Math.abs(R-A-(v+g))<15e3?i=!0:v=R-A-g}for(var L=v+g,b=0;b<f;b++){var k=d[b];k.pts=ie(k.pts,L),k.dts=ie(k.dts,L),k.dts<d[b>0?b-1:b].dts&&(S=!0)}S&&d.sort((function(Ut,Se){var qt=Ut.dts-Se.dts,In=Ut.pts-Se.pts;return qt||In})),o=d[0].dts;var I=(l=d[d.length-1].dts)-o,D=I?Math.round(I/(f-1)):p||t.inputTimeScale/30;if(i){var P=o-L,M=P>D,O=P<-1;if((M||O)&&(M?this.warn((t.segmentCodec||"").toUpperCase()+": "+gr(P,!0)+" ms ("+P+"dts) hole between fragments detected at "+e.toFixed(3)):this.warn((t.segmentCodec||"").toUpperCase()+": "+gr(-P,!0)+" ms ("+P+"dts) overlapping between fragments detected at "+e.toFixed(3)),!O||L>=d[0].pts||Xe)){o=L;var w=d[0].pts-P;if(M)d[0].dts=o,d[0].pts=w;else for(var F=!0,x=0;x<d.length&&!(d[x].dts>w&&F);x++){var N=d[x].pts;if(d[x].dts-=P,d[x].pts-=P,x<d.length-1){var H=d[x+1].pts;F=H<=d[x].pts==H<=N}}this.log("Video: Initial PTS/DTS adjusted: "+gr(w,!0)+"/"+gr(o,!0)+", delta: "+gr(P,!0)+" ms")}}for(var U=0,G=0,X=o=Math.max(0,o),$=0;$<f;$++){for(var Y=d[$],dt=Y.units,rt=dt.length,V=0,Tt=0;Tt<rt;Tt++)V+=dt[Tt].data.length;G+=V,U+=rt,Y.length=V,Y.dts<X?(Y.dts=X,X+=D/4|0||1):X=Y.dts,E=Math.min(Y.pts,E),T=Math.max(Y.pts,T)}l=d[f-1].dts;var Q,nt=G+4*U+8;try{Q=new Uint8Array(nt)}catch(Ut){return void this.observer.emit(y.ERROR,y.ERROR,{type:K.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:Ut,bytes:nt,reason:"fail allocating video mdat "+nt})}var W=new DataView(Q.buffer);W.setUint32(0,nt),Q.set(Ft.types.mdat,4);for(var ht=!1,It=Number.POSITIVE_INFINITY,it=Number.POSITIVE_INFINITY,et=Number.NEGATIVE_INFINITY,Dt=Number.NEGATIVE_INFINITY,at=0;at<f;at++){for(var j=d[at],Ot=j.units,q=0,gt=0,ot=Ot.length;gt<ot;gt++){var St=Ot[gt],At=St.data,Ct=St.data.byteLength;W.setUint32(m,Ct),m+=4,Q.set(At,m),m+=Ct,q+=4+Ct}var st=void 0;if(at<f-1)p=d[at+1].dts-j.dts,st=d[at+1].pts-j.pts;else{var _t=this.config,Wt=at>0?j.dts-d[at-1].dts:D;if(st=at>0?j.pts-d[at-1].pts:D,_t.stretchShortVideoTrack&&this.nextAudioTs!==null){var Zt=Math.floor(_t.maxBufferHole*u),jt=(n?E+n*u:this.nextAudioTs+g)-j.pts;jt>Zt?((p=jt-Wt)<0?p=Wt:ht=!0,this.log("It is approximately "+jt/90+" ms to the next segment; using duration "+p/90+" ms for the last video frame.")):p=Wt}else p=Wt}var Jt=Math.round(j.pts-j.dts);It=Math.min(It,p),et=Math.max(et,p),it=Math.min(it,st),Dt=Math.max(Dt,st),h.push(Ls(j.key,p,q,Jt))}if(h.length){if(Xe){if(Xe<70){var xt=h[0].flags;xt.dependsOn=2,xt.isNonSync=0}}else if(qi&&Dt-it<et-It&&D/et<.025&&h[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Gt=o,Rt=0,Lt=h.length;Rt<Lt;Rt++){var lt=Gt+h[Rt].duration,pt=Gt+h[Rt].cts;if(Rt<Lt-1){var vt=lt+h[Rt+1].cts;h[Rt].duration=vt-pt}else h[Rt].duration=Rt?h[Rt-1].duration:D;h[Rt].cts=0,Gt=lt}}}var ve=l+(p=ht||!p?D:p);this.nextVideoTs=v=ve-g,this.videoSampleDuration=p,this.isVideoContiguous=!0;var Ne={data1:Ft.moof(t.sequenceNumber++,o,mt(t,{samples:h})),data2:Q,startPTS:(E-g)/u,endPTS:(T+p-g)/u,startDTS:(o-g)/u,endDTS:v/u,type:"video",hasAudio:!1,hasVideo:!0,nb:h.length,dropped:t.dropped};return t.samples=[],t.dropped=0,Ne},r.getSamplesPerFrame=function(t){switch(t.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}},r.remuxAudio=function(t,e,i,n,o){var l=t.inputTimeScale,u=l/(t.samplerate?t.samplerate:l),d=this.getSamplesPerFrame(t),h=d*u,f=this._initPTS,c=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],v=o!==void 0,m=t.samples,p=c?0:8,E=this.nextAudioTs||-1,T=f.baseTime*l/f.timescale,S=T+e*l;if(this.isAudioContiguous=i=i||m.length&&E>0&&(n&&Math.abs(S-(E+T))<9e3||Math.abs(ie(m[0].pts,S)-(E+T))<20*h),m.forEach((function(ht){ht.pts=ie(ht.pts,S)})),!i||E<0){if(m=m.filter((function(ht){return ht.pts>=0})),!m.length)return;E=o===0?0:n&&!v?Math.max(0,S-T):m[0].pts-T}if(t.segmentCodec==="aac")for(var R=this.config.maxAudioFramesDrift,A=0,L=E+T;A<m.length;A++){var b=m[A],k=b.pts,I=k-L,D=Math.abs(1e3*I/l);if(I<=-R*h&&v)A===0&&(this.warn("Audio frame @ "+(k/l).toFixed(3)+"s overlaps marker by "+Math.round(1e3*I/l)+" ms."),this.nextAudioTs=E=k-T,L=k);else if(I>=R*h&&D<1e4&&v){var P=Math.round(I/h);for(L=k-P*h;L<0&&P&&h;)P--,L+=h;A===0&&(this.nextAudioTs=E=L-T),this.warn("Injecting "+P+" audio frames @ "+((L-T)/l).toFixed(3)+"s due to "+Math.round(1e3*I/l)+" ms gap.");for(var M=0;M<P;M++){var O=Bl.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);O||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),O=b.unit.subarray()),m.splice(A,0,{unit:O,pts:L}),L+=h,A++}}b.pts=L,L+=h}for(var w,F=null,x=null,N=0,H=m.length;H--;)N+=m[H].unit.byteLength;for(var U=0,G=m.length;U<G;U++){var X=m[U],$=X.unit,Y=X.pts;if(x!==null)g[U-1].duration=Math.round((Y-x)/u);else{if(i&&t.segmentCodec==="aac"&&(Y=E+T),F=Y,!(N>0))return;N+=p;try{w=new Uint8Array(N)}catch(ht){return void this.observer.emit(y.ERROR,y.ERROR,{type:K.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:ht,bytes:N,reason:"fail allocating audio mdat "+N})}c||(new DataView(w.buffer).setUint32(0,N),w.set(Ft.types.mdat,4))}w.set($,p);var dt=$.byteLength;p+=dt,g.push(Ls(!0,d,dt,0)),x=Y}var rt=g.length;if(rt){var V=g[g.length-1];E=x-T,this.nextAudioTs=E+u*V.duration;var Tt=c?new Uint8Array(0):Ft.moof(t.sequenceNumber++,F/u,mt({},t,{samples:g}));t.samples=[];var Q=(F-T)/l,nt=E/l,W={data1:Tt,data2:w,startPTS:Q,endPTS:nt,startDTS:Q,endDTS:nt,type:"audio",hasAudio:!0,hasVideo:!1,nb:rt};return this.isAudioContiguous=!0,W}},s})(ee);function ie(a,s){var r;if(s===null)return a;for(r=s<a?-8589934592:8589934592;Math.abs(a-s)>4294967296;)a+=r;return a}function Is(a,s,r,t){var e=a.samples.length;if(e){for(var i=a.inputTimeScale,n=0;n<e;n++){var o=a.samples[n];o.pts=ie(o.pts-r.baseTime*i/r.timescale,s*i)/i,o.dts=ie(o.dts-t.baseTime*i/t.timescale,s*i)/i}var l=a.samples;return a.samples=[],{samples:l}}}function Rs(a,s,r){var t=a.samples.length;if(t){for(var e=a.inputTimeScale,i=0;i<t;i++){var n=a.samples[i];n.pts=ie(n.pts-r.baseTime*e/r.timescale,s*e)/e}a.samples.sort((function(l,u){return l.pts-u.pts}));var o=a.samples;return a.samples=[],{samples:o}}}var Ee,Gl=(function(a){function s(t,e,i,n){var o;return(o=a.call(this,"passthrough-remuxer",n)||this).emitInitSegment=!1,o.audioCodec=void 0,o.videoCodec=void 0,o.initData=void 0,o.initPTS=null,o.initTracks=void 0,o.lastEndTime=null,o.isVideoContiguous=!1,o}ut(s,a);var r=s.prototype;return r.destroy=function(){},r.resetTimeStamp=function(t){this.lastEndTime=null;var e=this.initPTS;e&&t&&e.baseTime===t.baseTime&&e.timescale===t.timescale||(this.initPTS=t)},r.resetNextTimestamp=function(){this.isVideoContiguous=!1,this.lastEndTime=null},r.resetInitSegment=function(t,e,i,n){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(t,n),this.emitInitSegment=!0},r.generateInitSegment=function(t,e){var i=this.audioCodec,n=this.videoCodec;if(t==null||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var o=this.initData=Yn(t),l=o.audio,u=o.video;if(e)(function(f,c){if(f&&c){var g=c.keyId;g&&c.isCommonEncryption&&J(f,["moov","trak"]).forEach((function(v){var m=J(v,["mdia","minf","stbl","stsd"])[0].subarray(8),p=J(m,["enca"]),E=p.length>0;E||(p=J(m,["encv"])),p.forEach((function(T){J(E?T.subarray(28):T.subarray(78),["sinf"]).forEach((function(S){var R=Wn(S);if(R){var A=R.subarray(8,24);A.some((function(L){return L!==0}))||(ct.log("[eme] Patching keyId in 'enc"+(E?"a":"v")+">sinf>>tenc' box: "+Vt(A)+" -> "+Vt(g)),R.set(g,8))}}))}))}))}})(t,e);else{var d=l||u;d!=null&&d.encrypted&&this.warn('Init segment with encrypted track with has no key ("'+d.codec+'")!')}l&&(i=ks(l,zt,this)),u&&(n=ks(u,ae,this));var h={};l&&u?h.audiovideo={container:"video/mp4",codec:i+","+n,supplemental:u.supplemental,encrypted:u.encrypted,initSegment:t,id:"main"}:l?h.audio={container:"audio/mp4",codec:i,encrypted:l.encrypted,initSegment:t,id:"audio"}:u?h.video={container:"video/mp4",codec:n,supplemental:u.supplemental,encrypted:u.encrypted,initSegment:t,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=h},r.remux=function(t,e,i,n,o,l){var u,d,h=this.initPTS,f=this.lastEndTime,c={audio:void 0,video:void 0,text:n,id3:i,initSegment:void 0};B(f)||(f=this.lastEndTime=o||0);var g=e.samples;if(!g.length)return c;var v={initPTS:void 0,timescale:void 0,trackId:void 0},m=this.initData;if((u=m)!=null&&u.length||(this.generateInitSegment(g),m=this.initData),(d=m)==null||!d.length)return this.warn("Failed to generate initSegment."),c;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);var p=(function(Y,dt,rt){for(var V={},Tt=J(Y,["moof","traf"]),Q=0;Q<Tt.length;Q++){var nt=Tt[Q],W=J(nt,["tfhd"])[0],ht=z(W,4),It=dt[ht];if(It){V[ht]||(V[ht]={start:NaN,duration:0,sampleCount:0,timescale:It.timescale,type:It.type});var it=V[ht],et=J(nt,["tfdt"])[0];if(et){var Dt=et[0],at=z(et,4);Dt===1&&(at===Bn?rt.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(at*=Bn+1,at+=z(et,8))),B(at)&&(!B(it.start)||at<it.start)&&(it.start=at)}var j=It.default,Ot=z(W,0)|j?.flags,q=j?.duration||0;8&Ot&&(q=z(W,2&Ot?12:8));for(var gt=J(nt,["trun"]),ot=it.start||0,St=0,At=q,Ct=0;Ct<gt.length;Ct++){var st=gt[Ct],_t=z(st,4),Wt=it.sampleCount;it.sampleCount+=_t;var Zt=1&st[3],jt=4&st[3],Jt=1&st[2],xt=2&st[2],Gt=4&st[2],Rt=8&st[2],Lt=8,lt=_t;for(Zt&&(Lt+=4),jt&&_t&&(1&st[Lt+1]||it.keyFrameIndex!==void 0||(it.keyFrameIndex=Wt),Lt+=4,Jt?(At=z(st,Lt),Lt+=4):At=q,xt&&(Lt+=4),Rt&&(Lt+=4),ot+=At,St+=At,lt--);lt--;)Jt?(At=z(st,Lt),Lt+=4):At=q,xt&&(Lt+=4),Gt&&(1&st[Lt+1]||it.keyFrameIndex===void 0&&(it.keyFrameIndex=it.sampleCount-(lt+1),it.keyFrameStart=ot),Lt+=4),Rt&&(Lt+=4),ot+=At,St+=At;!St&&q&&(St+=q*_t)}it.duration+=St}}if(!Object.keys(V).some((function(qt){return V[qt].duration}))){for(var pt=1/0,vt=0,ve=J(Y,["sidx"]),Ne=0;Ne<ve.length;Ne++){var Ut=Uo(ve[Ne]);if(Ut!=null&&Ut.references){pt=Math.min(pt,Ut.earliestPresentationTime/Ut.timescale);var Se=Ut.references.reduce((function(qt,In){return qt+In.info.duration||0}),0);vt=Math.max(vt,Se+Ut.earliestPresentationTime/Ut.timescale)}}vt&&B(vt)&&Object.keys(V).forEach((function(qt){V[qt].duration||(V[qt].duration=vt*V[qt].timescale-V[qt].start)}))}return V})(g,m,this),E=m.audio?p[m.audio.id]:null,T=m.video?p[m.video.id]:null,S=Yr(T,1/0),R=Yr(E,1/0),A=Yr(T,0,!0),L=Yr(E,0,!0),b=o,k=0,I=E&&(!T||!h&&R<S||h&&h.trackId===m.audio.id),D=I?E:T;if(D){var P=D.timescale,M=D.start-o*P,O=I?m.audio.id:m.video.id;b=D.start/P,k=I?L-R:A-S,!l&&h||!(function(Y,dt,rt,V){if(Y===null)return!0;var Tt=Math.max(V,1),Q=dt-Y.baseTime/Y.timescale;return Math.abs(Q-rt)>Tt})(h,b,o,k)&&P===h.timescale||(h&&this.warn("Timestamps at playlist time: "+(l?"":"~")+o+" "+M/P+" != initPTS: "+h.baseTime/h.timescale+" ("+h.baseTime+"/"+h.timescale+") trackId: "+h.trackId),this.log("Found initPTS at playlist time: "+o+" offset: "+(b-o)+" ("+M+"/"+P+") trackId: "+O),h=null,v.initPTS=M,v.timescale=P,v.trackId=O)}else this.warn("No audio or video samples found for initPTS at playlist time: "+o);h?(v.initPTS=h.baseTime,v.timescale=h.timescale,v.trackId=h.trackId):(v.timescale&&v.trackId!==void 0&&v.initPTS!==void 0||(this.warn("Could not set initPTS"),v.initPTS=b,v.timescale=1,v.trackId=-1),this.initPTS=h={baseTime:v.initPTS,timescale:v.timescale,trackId:v.trackId});var w=b-h.baseTime/h.timescale,F=w+k;k>0?this.lastEndTime=F:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var x=!!m.audio,N=!!m.video,H="";x&&(H+="audio"),N&&(H+="video");var U={data1:g,startPTS:w,startDTS:w,endPTS:F,endDTS:F,type:H,hasAudio:x,hasVideo:N,nb:1,dropped:0,encrypted:!!m.audio&&m.audio.encrypted||!!m.video&&m.video.encrypted};c.audio=x&&!N?U:void 0,c.video=N?U:void 0;var G=T?.sampleCount;if(G){var X=T.keyFrameIndex,$=X!==-1;U.nb=G,U.dropped=X===0||this.isVideoContiguous?0:$?X:G,U.independent=$,U.firstKeyFrame=X,$&&T.keyFrameStart&&(U.firstKeyFramePTS=(T.keyFrameStart-h.baseTime)/h.timescale),this.isVideoContiguous||(c.independent=$),this.isVideoContiguous||(this.isVideoContiguous=$),U.dropped&&this.warn("fmp4 does not start with IDR: firstIDR "+X+"/"+G+" dropped: "+U.dropped+" start: "+(U.firstKeyFramePTS||"NA"))}return c.initSegment=v,c.id3=Is(i,o,h,h),n.samples.length&&(c.text=Rs(n,o,h)),c},s})(ee);function Yr(a,s,r){return r===void 0&&(r=!1),a?.start!==void 0?(a.start+(r?a.duration:0))/a.timescale:s}function ks(a,s,r){var t=a.codec;return t&&t.length>4?t:s===zt?t==="ec-3"||t==="ac-3"||t==="alac"?t:t==="fLaC"||t==="Opus"?Lr(t,!1):(r.warn('Unhandled audio codec "'+t+'" in mp4 MAP'),t||"mp4a"):(r.warn('Unhandled video codec "'+t+'" in mp4 MAP'),t||"avc1")}try{Ee=self.performance.now.bind(self.performance)}catch{Ee=Date.now}var Wr=[{demux:wl,remux:Gl},{demux:Fl,remux:Hr},{demux:Dl,remux:Hr},{demux:Pl,remux:Hr}];Wr.splice(2,0,{demux:_l,remux:Hr});var Xi=(function(){function a(r,t,e,i,n,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=r,this.typeSupported=t,this.config=e,this.id=n,this.logger=o}var s=a.prototype;return s.configure=function(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()},s.push=function(r,t,e,i){var n=this,o=e.transmuxing;o.executeStart=Ee();var l=new Uint8Array(r),u=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=i||u,f=h.contiguous,c=h.discontinuity,g=h.trackSwitch,v=h.accurateTimeOffset,m=h.timeOffset,p=h.initSegmentChange,E=d.audioCodec,T=d.videoCodec,S=d.defaultInitPts,R=d.duration,A=d.initSegmentData,L=(function(F,x){var N=null;return F.byteLength>0&&x?.key!=null&&x.iv!==null&&x.method!=null&&(N=x),N})(l,t);if(L&&je(L.method)){var b=this.getDecrypter(),k=bi(L.method);if(!b.isSync())return this.asyncResult=!0,this.decryptionPromise=b.webCryptoDecrypt(l,L.key.buffer,L.iv.buffer,k).then((function(F){var x=n.push(F,null,e);return n.decryptionPromise=null,x})),this.decryptionPromise;var I=b.softwareDecrypt(l,L.key.buffer,L.iv.buffer,k);if(e.part>-1){var D=b.flush();I=D&&D.buffer}if(!I)return o.executeEnd=Ee(),zi(e);l=new Uint8Array(I)}var P=this.needsProbing(c,g);if(P){var M=this.configureTransmuxer(l);if(M)return this.logger.warn("[transmuxer] "+M.message),this.observer.emit(y.ERROR,y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:M,reason:M.message}),o.executeEnd=Ee(),zi(e)}(c||g||p||P)&&this.resetInitSegment(A,E,T,R,t),(c||p||P)&&this.resetInitialTimestamp(S),f||this.resetContiguity();var O=this.transmux(l,L,m,v,e);this.asyncResult=we(O);var w=this.currentTransmuxState;return w.contiguous=!0,w.discontinuity=!1,w.trackSwitch=!1,o.executeEnd=Ee(),O},s.flush=function(r){var t=this,e=r.transmuxing;e.executeStart=Ee();var i=this.decrypter,n=this.currentTransmuxState,o=this.decryptionPromise;if(o)return this.asyncResult=!0,o.then((function(){return t.flush(r)}));var l=[],u=n.timeOffset;if(i){var d=i.flush();d&&l.push(this.push(d.buffer,null,r))}var h=this.demuxer,f=this.remuxer;if(!h||!f){e.executeEnd=Ee();var c=[zi(r)];return this.asyncResult?Promise.resolve(c):c}var g=h.flush(u);return we(g)?(this.asyncResult=!0,g.then((function(v){return t.flushRemux(l,v,r),l}))):(this.flushRemux(l,g,r),this.asyncResult?Promise.resolve(l):l)},s.flushRemux=function(r,t,e){var i=t.audioTrack,n=t.videoTrack,o=t.id3Track,l=t.textTrack,u=this.currentTransmuxState,d=u.accurateTimeOffset,h=u.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+e.sn+(e.part>-1?" part: "+e.part:"")+" of "+(this.id===Z?"level":"track")+" "+e.level);var f=this.remuxer.remux(i,n,o,l,h,d,!0,this.id);r.push({remuxResult:f,chunkMeta:e}),e.transmuxing.executeEnd=Ee()},s.resetInitialTimestamp=function(r){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetTimeStamp(r),e.resetTimeStamp(r))},s.resetContiguity=function(){var r=this.demuxer,t=this.remuxer;r&&t&&(r.resetContiguity(),t.resetNextTimestamp())},s.resetInitSegment=function(r,t,e,i,n){var o=this.demuxer,l=this.remuxer;o&&l&&(o.resetInitSegment(r,t,e,i),l.resetInitSegment(r,t,e,n))},s.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},s.transmux=function(r,t,e,i,n){return t&&t.method==="SAMPLE-AES"?this.transmuxSampleAes(r,t,e,i,n):this.transmuxUnencrypted(r,e,i,n)},s.transmuxUnencrypted=function(r,t,e,i){var n=this.demuxer.demux(r,t,!1,!this.config.progressive),o=n.audioTrack,l=n.videoTrack,u=n.id3Track,d=n.textTrack;return{remuxResult:this.remuxer.remux(o,l,u,d,t,e,!1,this.id),chunkMeta:i}},s.transmuxSampleAes=function(r,t,e,i,n){var o=this;return this.demuxer.demuxSampleAes(r,t,e).then((function(l){return{remuxResult:o.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,e,i,!1,o.id),chunkMeta:n}}))},s.configureTransmuxer=function(r){for(var t,e=this.config,i=this.observer,n=this.typeSupported,o=0,l=Wr.length;o<l;o++){var u;if((u=Wr[o].demux)!=null&&u.probe(r,this.logger)){t=Wr[o];break}}if(!t)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,h=this.remuxer,f=t.remux,c=t.demux;h&&h instanceof f||(this.remuxer=new f(i,e,n,this.logger)),d&&d instanceof c||(this.demuxer=new c(i,e,n,this.logger),this.probe=c.probe)},s.needsProbing=function(r,t){return!this.demuxer||!this.remuxer||r||t},s.getDecrypter=function(){var r=this.decrypter;return r||(r=this.decrypter=new Li(this.config)),r},a})(),zi=function(a){return{remuxResult:{},chunkMeta:a}};function we(a){return"then"in a&&a.then instanceof Function}var Kl=function(a,s,r,t,e){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=a,this.videoCodec=s,this.initSegmentData=r,this.duration=t,this.defaultInitPts=e||null},Vl=function(a,s,r,t,e,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=a,this.contiguous=s,this.accurateTimeOffset=r,this.trackSwitch=t,this.timeOffset=e,this.initSegmentChange=i},Qi=[];function $i(a,s,r){if(!((t=s.remuxResult).audio||t.video||t.text||t.id3||t.initSegment))return!1;var t,e=[],i=s.remuxResult,n=i.audio,o=i.video;return n&&bs(e,n),o&&bs(e,o),a.postMessage({event:"transmuxComplete",data:s,instanceNo:r},e),!0}function bs(a,s){s.data1&&a.push(s.data1.buffer),s.data2&&a.push(s.data2.buffer)}function Ds(a,s,r,t){s.reduce((function(e,i){return $i(a,i,t)||e}),!1)||a.postMessage({event:"transmuxComplete",data:s[0],instanceNo:t}),a.postMessage({event:"flush",data:r,instanceNo:t})}function ze(a,s,r){self.postMessage({event:a,data:s,instanceNo:r})}Ae!==void 0&&Ae&&self.addEventListener("message",(function(a){var s=a.data,r=s.instanceNo;if(r!==void 0){var t=Qi[r];if(s.cmd==="reset"&&(delete Qi[s.resetNo],t&&t.destroy(),s.cmd="init"),s.cmd==="init"){var e=JSON.parse(s.config),i=new yr;i.on(y.FRAG_DECRYPTED,ze),i.on(y.ERROR,ze);var n=xn(e.debug,s.id);return(function(d,h){var f=function(g){d[g]=function(){var v=Array.prototype.join.call(arguments," ");ze("workerLog",{logType:g,message:v},h)}};for(var c in d)f(c)})(n,r),Qi[r]=new Xi(i,s.typeSupported,e,"",s.id,n),void ze("init",null,r)}if(t)switch(s.cmd){case"configure":t.configure(s.config);break;case"demux":var o=t.push(s.data,s.decryptdata,s.chunkMeta,s.state);we(o)?o.then((function(d){$i(self,d,r)})).catch((function(d){ze(y.ERROR,{instanceNo:r,type:K.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:s.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker push error"},r)})):$i(self,o,r);break;case"flush":var l=s.chunkMeta,u=t.flush(l);we(u)?u.then((function(d){Ds(self,d,l,r)})).catch((function(d){ze(y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:s.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker flush error"},r)})):Ds(self,u,l,r)}}}));var vr="1.6.12",Qe={},_s=0,Ps=(function(){function a(r,t,e,i){var n=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=_s++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(f){var c=f.data,g=n.hls;if(g&&c!=null&&c.event&&c.instanceNo===n.instanceNo)switch(c.event){case"init":var v,m=(v=n.workerContext)==null?void 0:v.objectURL;m&&self.URL.revokeObjectURL(m);break;case"transmuxComplete":n.handleTransmuxComplete(c.data);break;case"flush":n.onFlush(c.data);break;case"workerLog":g.logger[c.data.logType]&&g.logger[c.data.logType](c.data.message);break;default:c.data=c.data||{},c.data.frag=n.frag,c.data.part=n.part,c.data.id=n.id,g.trigger(c.event,c.data)}},this.onWorkerError=function(f){if(n.hls){var c=new Error(f.message+"  ("+f.filename+":"+f.lineno+")");n.hls.config.enableWorker=!1,n.hls.logger.warn('Error in "'+n.id+'" Web Worker, fallback to inline'),n.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})}};var o=r.config;this.hls=r,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=e,this.onFlush=i;var l=function(f,c){(c=c||{}).frag=n.frag||void 0,f===y.ERROR&&(c.parent=n.id,c.part=n.part,n.error=c.error),n.hls.trigger(f,c)};this.observer=new yr,this.observer.on(y.FRAG_DECRYPTED,l),this.observer.on(y.ERROR,l);var u=$n(o.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var d=this.hls.logger;o.workerPath;try{o.workerPath?(d.log("loading Web Worker "+o.workerPath+' for "'+t+'"'),this.workerContext=(function(f){var c=Qe[f];if(c)return c.clientCount++,c;var g=new self.URL(f,self.location.href).href,v={worker:new self.Worker(g),scriptURL:g,clientCount:1};return Qe[f]=v,v})(o.workerPath)):(d.log('injecting Web Worker for "'+t+'"'),this.workerContext=(function(){var f=Qe[vr];if(f)return f.clientCount++,f;var c=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+er.toString()+")(true);"],{type:"text/javascript"}),g=self.URL.createObjectURL(c),v={worker:new self.Worker(g),objectURL:g,clientCount:1};return Qe[vr]=v,v})());var h=this.workerContext.worker;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Et(o)})}catch(f){d.warn('Error setting up "'+t+'" Web Worker, fallback to inline',f),this.terminateWorker(),this.error=null,this.transmuxer=new Xi(this.observer,u,o,"",t,r.logger)}}else this.transmuxer=new Xi(this.observer,u,o,"",t,r.logger)}var s=a.prototype;return s.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var r=this.instanceNo;this.instanceNo=_s++;var t=this.hls.config,e=$n(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:r,typeSupported:e,id:this.id,config:Et(t)})}},s.terminateWorker=function(){if(this.workerContext){var r=this.workerContext.worker;this.workerContext=null,r.removeEventListener("message",this.onWorkerMessage),r.removeEventListener("error",this.onWorkerError),(function(t){var e=Qe[t||vr];if(e&&e.clientCount--==1){var i=e.worker,n=e.objectURL;delete Qe[t||vr],n&&self.URL.revokeObjectURL(n),i.terminate()}})(this.hls.config.workerPath)}},s.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var r=this.transmuxer;r&&(r.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},s.push=function(r,t,e,i,n,o,l,u,d,h){var f,c,g=this;d.transmuxing.start=self.performance.now();var v=this.instanceNo,m=this.transmuxer,p=o?o.start:n.start,E=n.decryptdata,T=this.frag,S=!(T&&n.cc===T.cc),R=!(T&&d.level===T.level),A=T?d.sn-T.sn:-1,L=this.part?d.part-this.part.index:-1,b=A===0&&d.id>1&&d.id===T?.stats.chunkCount,k=!R&&(A===1||A===0&&(L===1||b&&L<=0)),I=self.performance.now();(R||A||n.stats.parsing.start===0)&&(n.stats.parsing.start=I),!o||!L&&k||(o.stats.parsing.start=I);var D=!(T&&((f=n.initSegment)==null?void 0:f.url)===((c=T.initSegment)==null?void 0:c.url)),P=new Vl(S,k,u,R,p,D);if(!k||S||D){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+n.type+" sn: "+d.sn+(d.part>-1?" part: "+d.part:"")+" "+(this.id===Z?"level":"track")+": "+d.level+" id: "+d.id+`
        discontinuity: `+S+`
        trackSwitch: `+R+`
        contiguous: `+k+`
        accurateTimeOffset: `+u+`
        timeOffset: `+p+`
        initSegmentChange: `+D);var M=new Kl(e,i,t,l,h);this.configureTransmuxer(M)}if(this.frag=n,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:r,decryptdata:E,chunkMeta:d,state:P},r instanceof ArrayBuffer?[r]:[]);else if(m){var O=m.push(r,E,d,P);we(O)?O.then((function(w){g.handleTransmuxComplete(w)})).catch((function(w){g.transmuxerError(w,d,"transmuxer-interface push error")})):this.handleTransmuxComplete(O)}},s.flush=function(r){var t=this;r.transmuxing.start=self.performance.now();var e=this.instanceNo,i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:r});else if(i){var n=i.flush(r);we(n)?n.then((function(o){t.handleFlushResult(o,r)})).catch((function(o){t.transmuxerError(o,r,"transmuxer-interface flush error")})):this.handleFlushResult(n,r)}},s.transmuxerError=function(r,t,e){this.hls&&(this.error=r,this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:r,err:r,reason:e}))},s.handleFlushResult=function(r,t){var e=this;r.forEach((function(i){e.handleTransmuxComplete(i)})),this.onFlush(t)},s.configureTransmuxer=function(r){var t=this.instanceNo,e=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:r}):e&&e.configure(r)},s.handleTransmuxComplete=function(r){r.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(r)},a})(),Hl=(function(a){function s(t,e,i){var n;return(n=a.call(this,t,e,i,"audio-stream-controller",Kt)||this).mainAnchor=null,n.mainFragLoading=null,n.audioOnly=!1,n.bufferedTrack=null,n.switchingTrack=null,n.trackId=-1,n.waitingData=null,n.mainDetails=null,n.flushing=!1,n.bufferFlushed=!1,n.cachedTrackLoadedData=null,n.registerListeners(),n}ut(s,a);var r=s.prototype;return r.onHandlerDestroying=function(){this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this),this.resetItem()},r.resetItem=function(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null},r.registerListeners=function(){a.prototype.registerListeners.call(this);var t=this.hls;t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(y.BUFFER_RESET,this.onBufferReset,this),t.on(y.BUFFER_CREATED,this.onBufferCreated,this),t.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(y.FRAG_LOADING,this.onFragLoading,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},r.unregisterListeners=function(){var t=this.hls;t&&(a.prototype.unregisterListeners.call(this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(y.BUFFER_RESET,this.onBufferReset,this),t.off(y.BUFFER_CREATED,this.onBufferCreated,this),t.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(y.FRAG_LOADING,this.onFragLoading,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this))},r.onInitPtsFound=function(t,e){var i=e.frag,n=e.id,o=e.initPTS,l=e.timescale,u=e.trackId;if(n===Z){var d=i.cc,h=this.fragCurrent;if(this.initPTS[d]={baseTime:o,timescale:l,trackId:u},this.log("InitPTS for cc: "+d+" found from main: "+o/l+" ("+o+"/"+l+") trackId: "+u),this.mainAnchor=i,this.state===C.WAITING_INIT_PTS){var f=this.waitingData;(!f&&!this.loadingParts||f&&f.frag.cc!==d)&&this.syncWithAnchor(i,f?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==d?(h.abortRequests(),this.syncWithAnchor(i,h)):this.state===C.IDLE&&this.tick()}},r.getLoadPosition=function(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:a.prototype.getLoadPosition.call(this)},r.syncWithAnchor=function(t,e){var i,n=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(!e||n?.cc!==e.cc){var o=(n||t).cc,l=ha(this.getLevelDetails(),o,this.getLoadPosition());l&&(this.log("Syncing with main frag at "+l.start+" cc "+l.cc),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===C.IDLE&&this.doTickIdle())}},r.startLoad=function(t,e){if(!this.levels)return this.startPosition=t,void(this.state=C.STOPPED);var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),i>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),t=i,this.state=C.IDLE):this.state=C.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()},r.doTick=function(){switch(this.state){case C.IDLE:this.doTickIdle();break;case C.WAITING_TRACK:var t=this.levels,e=this.trackId,i=t?.[e],n=i?.details;if(n&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(n))break;this.state=C.WAITING_INIT_PTS}break;case C.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break;case C.WAITING_INIT_PTS:var o=this.waitingData;if(o){var l=o.frag,u=o.part,d=o.cache,h=o.complete,f=this.mainAnchor;if(this.initPTS[l.cc]!==void 0){this.waitingData=null,this.state=C.FRAG_LOADING;var c={frag:l,part:u,payload:d.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(c),h&&a.prototype._handleFragmentLoadComplete.call(this,c)}else f&&f.cc!==o.frag.cc&&this.syncWithAnchor(f,o.frag)}else this.state=C.IDLE}this.onTickEnd()},r.resetLoadingState=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),a.prototype.resetLoadingState.call(this)},r.onTickEnd=function(){var t=this.media;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)},r.doTickIdle=function(){var t,e=this.hls,i=this.levels,n=this.media,o=this.trackId,l=e.config;if(this.buffering&&(n||this.primaryPrefetch||!this.startFragRequested&&l.startFragPrefetch)&&i!=null&&i[o]){var u=i[o],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d))return this.state=C.WAITING_TRACK,void(this.startFragRequested=!1);var h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,zt,Kt));var f=this.getFwdBufferInfo(h,Kt);if(f!==null){if(!this.switchingTrack&&this._streamEnded(f,d))return e.trigger(y.BUFFER_EOS,{type:"audio"}),void(this.state=C.ENDED);var c=f.len,g=e.maxBufferLength,v=d.fragments,m=v[0].start,p=this.getLoadPosition(),E=this.flushing?p:f.end;if(this.switchingTrack&&n){var T=p;d.PTSKnown&&T<m&&(f.end>m||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=m+.05)}if(!(c>=g&&!this.switchingTrack&&E<v[v.length-1].start)){var S=this.getNextFragment(E,d);if(S&&this.isLoopLoading(S,E)&&(S=this.getNextFragmentLoopLoading(S,d,f,Z,g)),S){var R=((t=this.mainFragLoading)==null?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&R&&wt(S)&&!S.endList&&(!d.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(R)===Ye&&(this.mainFragLoading=R=null),R&&wt(R))){if(S.start>R.end){var A=this.fragmentTracker.getFragAtPos(E,Z);A&&A.end>R.end&&(R=A,this.mainFragLoading={frag:A,targetBufferTime:null})}if(S.start>R.end)return}this.loadFragment(S,u,E)}else this.bufferFlushed=!0}}}},r.onMediaDetaching=function(t,e){this.bufferFlushed=this.flushing=!1,a.prototype.onMediaDetaching.call(this,t,e)},r.onAudioTracksUpdated=function(t,e){var i=e.audioTracks;this.resetTransmuxer(),this.levels=i.map((function(n){return new ar(n)}))},r.onAudioTrackSwitching=function(t,e){var i=!!e.url;this.trackId=e.id;var n=this.fragCurrent;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),i?(this.switchingTrack=e,this.flushAudioIfNeeded(e),this.state!==C.STOPPED&&(this.setInterval(100),this.state=C.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())},r.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1},r.onLevelLoaded=function(t,e){this.mainDetails=e.details;var i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(y.AUDIO_TRACK_LOADED,i))},r.onAudioTrackLoaded=function(t,e){var i,n=this.levels,o=e.details,l=e.id,u=e.groupId,d=e.track;if(n){var h=this.mainDetails;if(!h||o.endCC>h.endCC||h.expired)return this.cachedTrackLoadedData=e,void(this.state!==C.STOPPED&&(this.state=C.WAITING_TRACK));this.cachedTrackLoadedData=null,this.log("Audio track "+l+' "'+d.name+'" of "'+u+'" loaded ['+o.startSN+","+o.endSN+"]"+(o.lastPartSn?"[part-"+o.lastPartSn+"-"+o.lastPartIndex+"]":"")+",duration:"+o.totalduration);var f=n[l],c=0;if(o.live||(i=f.details)!=null&&i.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;var g;f.details&&(c=this.alignPlaylists(o,f.details,(g=this.levelLastLoaded)==null?void 0:g.details)),o.alignedSliding||(is(o,h),o.alignedSliding||Ur(o,h),c=o.fragmentStart)}f.details=o,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(h,c),this.hls.trigger(y.AUDIO_TRACK_UPDATED,{details:o,id:l,groupId:e.groupId}),this.state!==C.WAITING_TRACK||this.waitForCdnTuneIn(o)||(this.state=C.IDLE),this.tick()}else this.warn("Audio tracks reset while loading track "+l+' "'+d.name+'" of "'+u+'"')},r._handleFragmentLoadProgress=function(t){var e,i=t.frag,n=t.part,o=t.payload,l=this.config,u=this.trackId,d=this.levels;if(d){var h=d[u];if(h){var f=h.details;if(!f)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);var c=l.defaultAudioCodec||h.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new Ps(this.hls,Kt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var v=this.initPTS[i.cc],m=(e=i.initSegment)==null?void 0:e.data;if(v!==void 0){var p=n?n.index:-1,E=p!==-1,T=new Ii(i.level,i.sn,i.stats.chunkCount,o.byteLength,p,E);g.push(o,m,c,"",i,n,f.totalduration,!1,T,v)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+f.startSN+" ,"+f.endSN+"],track "+u),(this.waitingData=this.waitingData||{frag:i,part:n,cache:new as,complete:!1}).cache.push(new Uint8Array(o)),this.state!==C.STOPPED&&(this.state=C.WAITING_INIT_PTS)}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},r._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:a.prototype._handleFragmentLoadComplete.call(this,t)},r.onBufferReset=function(){this.mediaBuffer=null},r.onBufferCreated=function(t,e){this.bufferFlushed=this.flushing=!1;var i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)},r.onFragLoading=function(t,e){!this.audioOnly&&e.frag.type===Z&&wt(e.frag)&&(this.mainFragLoading=e,this.state===C.IDLE&&this.tick())},r.onFragBuffered=function(t,e){var i=e.frag,n=e.part;if(i.type===Kt)if(this.fragContextChanged(i))this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if(wt(i)){this.fragPrevious=i;var o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,ft({},o)))}this.fragBufferedComplete(i,n),this.media&&this.tick()}else this.audioOnly||i.type!==Z||i.elementaryStreams.video||i.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)},r.onError=function(t,e){var i;if(e.fatal)this.state=C.ERROR;else switch(e.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Kt,e);break;case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==C.WAITING_TRACK||((i=e.context)==null?void 0:i.type)!==ne||(this.state=C.IDLE);break;case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)||this.resetLoadingState();break;case _.BUFFER_FULL_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}},r.onBufferFlushing=function(t,e){e.type!==ae&&(this.flushing=!0)},r.onBufferFlushed=function(t,e){var i=e.type;if(i!==ae){this.flushing=!1,this.bufferFlushed=!0,this.state===C.ENDED&&(this.state=C.IDLE);var n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,i,Kt),this.tick())}},r._handleTransmuxComplete=function(t){var e,i="audio",n=this.hls,o=t.remuxResult,l=t.chunkMeta,u=this.getCurrentContext(l);if(u){var d=u.frag,h=u.part,f=u.level,c=f.details,g=o.audio,v=o.text,m=o.id3,p=o.initSegment;if(!this.fragContextChanged(d)&&c){if(this.state=C.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){var E=d.initSegment||d;if(this.unhandledEncryptionError(p,d))return;this._bufferInitSegment(f,p.tracks,E,l),n.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:p.tracks})}if(g){var T=g.startPTS,S=g.endPTS,R=g.startDTS,A=g.endDTS;h&&(h.elementaryStreams[zt]={startPTS:T,endPTS:S,startDTS:R,endDTS:A}),d.setElementaryStreamInfo(zt,T,S,R,A),this.bufferFragmentData(g,d,h,l)}if(m!=null&&(e=m.samples)!=null&&e.length){var L=mt({id:i,frag:d,details:c},m);n.trigger(y.FRAG_PARSING_METADATA,L)}if(v){var b=mt({id:i,frag:d,details:c},v);n.trigger(y.FRAG_PARSING_USERDATA,b)}}else this.fragmentTracker.removeFragment(d)}else this.resetWhenMissingContext(l)},r._bufferInitSegment=function(t,e,i,n){if(this.state===C.PARSING&&(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,e.audio)){var o=e.audio;o.id=Kt;var l=t.audioCodec;this.log("Init audio buffer, container:"+o.container+", codecs[level/parsed]=["+l+"/"+o.codec+"]"),l&&l.split(",").length===1&&(o.levelCodec=l),this.hls.trigger(y.BUFFER_CODECS,e);var u=o.initSegment;if(u!=null&&u.byteLength){var d={type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:u};this.hls.trigger(y.BUFFER_APPENDING,d)}this.tickImmediate()}},r.loadFragment=function(t,e,i){var n,o=this.fragmentTracker.getState(t);if(this.switchingTrack||o===or||o===He)if(wt(t))if((n=e.details)!=null&&n.live&&!this.initPTS[t.cc]){this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=C.WAITING_INIT_PTS;var l=this.mainDetails;l&&l.fragmentStart!==e.details.fragmentStart&&Ur(e.details,l)}else a.prototype.loadFragment.call(this,t,e,i);else this._loadInitSegment(t,e);else this.clearTrackerIfNeeded(t)},r.flushAudioIfNeeded=function(t){if(this.media&&this.bufferedTrack){var e=this.bufferedTrack;_e({name:e.name,lang:e.lang,assocLang:e.assocLang,characteristics:e.characteristics,audioCodec:e.audioCodec,channels:e.channels},t,Pe)||(kr(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}},r.completeAudioSwitch=function(t){var e=this.hls;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(y.AUDIO_TRACK_SWITCHED,ft({},t))},s})(Fi),Zi=(function(a){function s(t,e){var i;return(i=a.call(this,e,t.logger)||this).hls=void 0,i.canLoad=!1,i.timer=-1,i.hls=t,i}ut(s,a);var r=s.prototype;return r.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},r.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},r.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},r.stopLoad=function(){this.canLoad=!1,this.clearTimer()},r.switchParams=function(t,e,i){var n=e?.renditionReports;if(n){for(var o=-1,l=0;l<n.length;l++){var u=n[l],d=void 0;try{d=new self.URL(u.URI,e.url).href}catch(m){this.warn("Could not construct new URL for Rendition Report: "+m),d=u.URI||""}if(d===t){o=l;break}d===t.substring(0,d.length)&&(o=l)}if(o!==-1){var h=n[o],f=parseInt(h["LAST-MSN"])||e.lastPartSn,c=parseInt(h["LAST-PART"])||e.lastPartIndex;if(this.hls.config.lowLatencyMode){var g=Math.min(e.age-e.partTarget,e.targetduration);c>=0&&g>e.partTarget&&(c+=1)}var v=i&&ia(i);return new na(f,c>=0?c:void 0,v)}}},r.loadPlaylist=function(t){this.clearTimer()},r.loadingPlaylist=function(t,e){this.clearTimer()},r.shouldLoadPlaylist=function(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)},r.getUrlWithDirectives=function(t,e){if(e)try{return e.addDirectives(t)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}return t},r.playlistLoaded=function(t,e,i){var n=e.details,o=e.stats,l=self.performance.now(),u=o.loading.first?Math.max(0,l-o.loading.first):0;n.advancedDateTime=Date.now()-u;var d=this.hls.config.timelineOffset;if(d!==n.appliedTimelineOffset){var h=Math.max(d||0,0);n.appliedTimelineOffset=h,n.fragments.forEach((function(F){F.setStart(F.playlistOffset+h)}))}if(n.live||i!=null&&i.live){var f="levelInfo"in e?e.levelInfo:e.track;if(n.reloaded(i),i&&n.fragments.length>0){cl(i,n,this);var c=n.playlistParsingError;if(c){this.warn(c);var g=this.hls;if(!g.config.ignorePlaylistParsingErrors){var v,m=e.networkDetails;return void g.trigger(y.ERROR,{type:K.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:c,reason:c.message,level:e.level||void 0,parent:(v=n.fragments[0])==null?void 0:v.type,networkDetails:m,stats:o})}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=o.loading.start);var p,E=this.hls.mainForwardBufferInfo,T=E?E.end-E.len:0,S=za(n,1e3*(n.edge-T));if(n.requestScheduled+S<l?n.requestScheduled=l:n.requestScheduled+=S,this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED")),!this.canLoad||!n.live)return;var R=void 0,A=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var L=this.hls.config.lowLatencyMode,b=n.lastPartSn,k=n.endSN,I=n.lastPartIndex,D=b===k;I!==-1?D?(R=k+1,A=L?0:I):(R=b,A=L?I+1:n.maxPartIndex):R=k+1;var P=n.age,M=P+n.ageHeader,O=Math.min(M-n.partTarget,1.5*n.targetduration);if(O>0){if(M>3*n.targetduration)this.log("Playlist last advanced "+P.toFixed(2)+"s ago. Omitting segment and part directives."),R=void 0,A=void 0;else if(i!=null&&i.tuneInGoal&&M-n.partTarget>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+O+" with playlist age: "+n.age),O=0;else{var w=Math.floor(O/n.targetduration);R+=w,A!==void 0&&(A+=Math.round(O%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+P.toFixed(2)+"s goal: "+O+" skip sn "+w+" to part "+A)}n.tuneInGoal=O}if(p=this.getDeliveryDirectives(n,e.deliveryDirectives,R,A),L||!D)return n.requestScheduled=l,void this.loadingPlaylist(f,p)}else(n.canBlockReload||n.canSkipUntil)&&(p=this.getDeliveryDirectives(n,e.deliveryDirectives,R,A));p&&R!==void 0&&n.canBlockReload&&(n.requestScheduled=o.loading.first+Math.max(S-2*u,S/2)),this.scheduleLoading(f,p,n)}else this.clearTimer()},r.scheduleLoading=function(t,e,i){var n=this,o=i||t.details;if(o){var l=self.performance.now(),u=o.requestScheduled;if(l>=u)this.loadingPlaylist(t,e);else{var d=u-l;this.log("reload live playlist "+(t.name||t.bitrate+"bps")+" in "+Math.round(d)+" ms"),this.clearTimer(),this.timer=self.setTimeout((function(){return n.loadingPlaylist(t,e)}),d)}}else this.loadingPlaylist(t,e)},r.getDeliveryDirectives=function(t,e,i,n){var o=ia(t);return e!=null&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,n=e.part,o=ra),new na(i,n,o)},r.checkRetry=function(t){var e=this,i=t.details,n=br(t),o=t.errorAction,l=o||{},u=l.action,d=l.retryCount,h=d===void 0?0:d,f=l.retryConfig,c=!!o&&!!f&&(u===_r||!o.resolved&&u===he);if(c){var g;if(h>=f.maxNumRetry)return!1;if(n&&(g=t.context)!=null&&g.deliveryDirectives)this.warn("Retrying playlist loading "+(h+1)+"/"+f.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var v=Ti(f,h);this.clearTimer(),this.timer=self.setTimeout((function(){return e.loadPlaylist()}),v),this.warn("Retrying playlist loading "+(h+1)+"/"+f.maxNumRetry+' after "'+i+'" in '+v+"ms")}t.levelRetry=!0,o.resolved=!0}return c},s})(ee);function Cs(a,s){if(a.length!==s.length)return!1;for(var r=0;r<a.length;r++)if(!mr(a[r].attrs,s[r].attrs))return!1;return!0}function mr(a,s,r){var t=a["STABLE-RENDITION-ID"];return t&&!r?t===s["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some((function(e){return a[e]!==s[e]}))}function Ji(a,s){return s.label.toLowerCase()===a.name.toLowerCase()&&(!s.language||s.language.toLowerCase()===(a.lang||"").toLowerCase())}var Yl=(function(a){function s(t){var e;return(e=a.call(this,t,"audio-track-controller")||this).tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.registerListeners(),e}ut(s,a);var r=s.prototype;return r.registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(y.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(y.ERROR,this.onError,this)},r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,a.prototype.destroy.call(this)},r.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},r.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},r.onAudioTrackLoaded=function(t,e){var i=e.id,n=e.groupId,o=e.details,l=this.tracksInGroup[i];if(l&&l.groupId===n){var u=l.details;l.details=e.details,this.log("Audio track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+n+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,e,u)}else this.warn("Audio track with id:"+i+" and group:"+n+" not found in active group "+l?.groupId)},r.onLevelLoading=function(t,e){this.switchLevel(e.level)},r.onLevelSwitching=function(t,e){this.switchLevel(e.level)},r.switchLevel=function(t){var e=this.hls.levels[t];if(e){var i=e.audioGroups||null,n=this.groupIds,o=this.currentTrack;if(!i||n?.length!==i?.length||i!=null&&i.some((function(p){return n?.indexOf(p)===-1}))){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var l=this.tracks.filter((function(p){return!i||i.indexOf(p.groupId)!==-1}));if(l.length)this.selectDefaultTrack&&!l.some((function(p){return p.default}))&&(this.selectDefaultTrack=!1),l.forEach((function(p,E){p.id=E}));else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=l;var u=this.hls.config.audioPreference;if(!o&&u){var d=de(u,l,Pe);if(d>-1)o=l[d];else{var h=de(u,this.tracks);o=this.tracks[h]}}var f=this.findTrackId(o);f===-1&&o&&(f=this.findTrackId(null));var c={audioTracks:l};this.log("Updating audio tracks, "+l.length+" track(s) found in group(s): "+i?.join(",")),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,c);var g=this.trackId;if(f!==-1&&g===-1)this.setAudioTrack(f);else if(l.length&&g===-1){var v,m=new Error("No audio track selected for current audio group-ID(s): "+((v=this.groupIds)==null?void 0:v.join(","))+" track count: "+l.length);this.warn(m.message),this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}},r.onError=function(t,e){!e.fatal&&e.context&&(e.context.type!==ne||e.context.id!==this.trackId||this.groupIds&&this.groupIds.indexOf(e.context.groupId)===-1||this.checkRetry(e))},r.setAudioOption=function(t){var e=this.hls;if(e.config.audioPreference=t,t){var i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){var n=this.currentTrack;if(n&&_e(t,n,Pe))return n;var o=de(t,this.tracksInGroup,Pe);if(o>-1){var l=this.tracksInGroup[o];return this.setAudioTrack(o),l}if(n){var u=e.loadLevel;u===-1&&(u=e.firstAutoLevel);var d=(function(f,c,g,v,m){var p=c[v],E=c.reduce((function(L,b,k){var I=b.uri;return(L[I]||(L[I]=[])).push(k),L}),{})[p.uri];E.length>1&&(v=Math.max.apply(Math,E));var T=p.videoRange,S=p.frameRate,R=p.codecSet.substring(0,4),A=la(c,v,(function(L){if(L.videoRange!==T||L.frameRate!==S||L.codecSet.substring(0,4)!==R)return!1;var b=L.audioGroups,k=g.filter((function(I){return!b||b.indexOf(I.groupId)!==-1}));return de(f,k,m)>-1}));return A>-1?A:la(c,v,(function(L){var b=L.audioGroups,k=g.filter((function(I){return!b||b.indexOf(I.groupId)!==-1}));return de(f,k,m)>-1}))})(t,e.levels,i,u,Pe);if(d===-1)return null;e.nextLoadLevel=d}if(t.channels||t.audioCodec){var h=de(t,i);if(h>-1)return i[h]}}}return null},r.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length)this.warn("Invalid audio track id: "+t);else{this.selectDefaultTrack=!1;var i=this.currentTrack,n=e[t],o=n.details&&!n.details.live;if(!(t===this.trackId&&n===i&&o||(this.log("Switching to audio-track "+t+' "'+n.name+'" lang:'+n.lang+" group:"+n.groupId+" channels:"+n.channels),this.trackId=t,this.currentTrack=n,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,ft({},n)),o))){var l=this.switchParams(n.url,i?.details,n.details);this.loadPlaylist(l)}}},r.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var n=e[i];if((!this.selectDefaultTrack||n.default)&&(!t||_e(t,n,Pe)))return i}if(t){for(var o=t.name,l=t.lang,u=t.assocLang,d=t.characteristics,h=t.audioCodec,f=t.channels,c=0;c<e.length;c++)if(_e({name:o,lang:l,assocLang:u,characteristics:d,audioCodec:h,channels:f},e[c],Pe))return c;for(var g=0;g<e.length;g++){var v=e[g];if(mr(t.attrs,v.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return g}for(var m=0;m<e.length;m++){var p=e[m];if(mr(t.attrs,p.attrs,["LANGUAGE"]))return m}}return-1},r.loadPlaylist=function(t){a.prototype.loadPlaylist.call(this);var e=this.currentTrack;this.shouldLoadPlaylist(e)&&kr(e.url,this.hls)&&this.scheduleLoading(e,t)},r.loadingPlaylist=function(t,e){a.prototype.loadingPlaylist.call(this,t,e);var i=t.id,n=t.groupId,o=this.getUrlWithDirectives(t.url,e),l=t.details,u=l?.age;this.log("Loading audio-track "+i+' "'+t.name+'" lang:'+t.lang+" group:"+n+(e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:"")+(u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):"")+" "+o),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:o,id:i,groupId:n,deliveryDirectives:e||null,track:t})},yt(s,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])})(Zi),Wl=(function(){function a(r){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=r}var s=a.prototype;return s.destroy=function(){this.tracks=this.queues=null},s.append=function(r,t,e){if(this.queues!==null&&this.tracks!==null){var i=this.queues[t];i.push(r),i.length!==1||e||this.executeNext(t)}},s.appendBlocker=function(r){var t=this;return new Promise((function(e){var i={label:"async-blocker",execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};t.append(i,r)}))},s.prependBlocker=function(r){var t=this;return new Promise((function(e){if(t.queues){var i={label:"async-blocker-prepend",execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};t.queues[r].unshift(i)}}))},s.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach((function(r){var t,e=(t=r[0])==null?void 0:t.label;e!=="async-blocker"&&e!=="async-blocker-prepend"||(r[0].execute(),r.splice(0,1))}))},s.unblockAudio=function(r){this.queues!==null&&this.queues.audio[0]===r&&this.shiftAndExecuteNext("audio")},s.executeNext=function(r){if(this.queues!==null&&this.tracks!==null){var t=this.queues[r];if(t.length){var e=t[0];try{e.execute()}catch(o){var i;if(e.onError(o),this.queues===null||this.tracks===null)return;var n=(i=this.tracks[r])==null?void 0:i.buffer;n!=null&&n.updating||this.shiftAndExecuteNext(r)}}}},s.shiftAndExecuteNext=function(r){this.queues!==null&&(this.queues[r].shift(),this.executeNext(r))},s.current=function(r){var t;return((t=this.queues)==null?void 0:t[r][0])||null},s.toString=function(){var r=this.queues,t=this.tracks;return r===null||t===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},s.list=function(r){var t,e;return(t=this.queues)!=null&&t[r]||(e=this.tracks)!=null&&e[r]?r+": ("+this.listSbInfo(r)+") "+this.listOps(r):""},s.listSbInfo=function(r){var t,e=(t=this.tracks)==null?void 0:t[r],i=e?.buffer;return i?"SourceBuffer"+(i.updating?" updating":"")+(e.ended?" ended":"")+(e.ending?" ending":""):"none"},s.listOps=function(r){var t;return((t=this.queues)==null?void 0:t[r].map((function(e){return e.label})).join(", "))||""},a})(),ws=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Os="HlsJsTrackRemovedError",jl=(function(a){function s(r){var t;return(t=a.call(this,r)||this).name=Os,t}return ut(s,a),s})(Be(Error)),ql=(function(a){function s(t,e){var i,n;return(i=a.call(this,"buffer-controller",t.logger)||this).hls=void 0,i.fragmentTracker=void 0,i.details=null,i._objectUrl=null,i.operationQueue=null,i.bufferCodecEventsTotal=0,i.media=null,i.mediaSource=null,i.lastMpegAudioChunk=null,i.blockedAudioAppend=null,i.lastVideoAppendEnd=0,i.appendSource=void 0,i.transferData=void 0,i.overrides=void 0,i.appendErrors={audio:0,video:0,audiovideo:0},i.tracks={},i.sourceBuffers=[[null,null],[null,null]],i._onEndStreaming=function(o){var l;i.hls&&((l=i.mediaSource)==null?void 0:l.readyState)==="open"&&i.hls.pauseBuffering()},i._onStartStreaming=function(o){i.hls&&i.hls.resumeBuffering()},i._onMediaSourceOpen=function(o){var l=i,u=l.media,d=l.mediaSource;o&&i.log("Media source opened"),u&&d&&(d.removeEventListener("sourceopen",i._onMediaSourceOpen),u.removeEventListener("emptied",i._onMediaEmptied),i.updateDuration(),i.hls.trigger(y.MEDIA_ATTACHED,{media:u,mediaSource:d}),i.mediaSource!==null&&i.checkPendingTracks())},i._onMediaSourceClose=function(){i.log("Media source closed")},i._onMediaSourceEnded=function(){i.log("Media source ended")},i._onMediaEmptied=function(){var o=i,l=o.mediaSrc,u=o._objectUrl;l!==u&&i.error("Media element src was set while attaching MediaSource ("+u+" > "+l+")")},i.hls=t,i.fragmentTracker=e,i.appendSource=(n=ke(t.config.preferManagedMediaSource),typeof self<"u"&&n===self.ManagedMediaSource),i.initTracks(),i.registerListeners(),i}ut(s,a);var r=s.prototype;return r.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},r.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},r.registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.BUFFER_RESET,this.onBufferReset,this),t.on(y.BUFFER_APPENDING,this.onBufferAppending,this),t.on(y.BUFFER_CODECS,this.onBufferCodecs,this),t.on(y.BUFFER_EOS,this.onBufferEos,this),t.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(y.FRAG_PARSED,this.onFragParsed,this),t.on(y.FRAG_CHANGED,this.onFragChanged,this),t.on(y.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.BUFFER_RESET,this.onBufferReset,this),t.off(y.BUFFER_APPENDING,this.onBufferAppending,this),t.off(y.BUFFER_CODECS,this.onBufferCodecs,this),t.off(y.BUFFER_EOS,this.onBufferEos,this),t.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(y.FRAG_PARSED,this.onFragParsed,this),t.off(y.FRAG_CHANGED,this.onFragChanged,this),t.off(y.ERROR,this.onError,this)},r.transferMedia=function(){var t=this,e=this.media,i=this.mediaSource;if(!e)return null;var n={};if(this.operationQueue){var o=this.isUpdating();o||this.operationQueue.removeBlockers();var l=this.isQueued();(o||l)&&this.warn("Transfering MediaSource with"+(l?" operations in queue":"")+(o?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var u=this.transferData;return!this.sourceBufferCount&&u&&u.mediaSource===i?mt(n,u.tracks):this.sourceBuffers.forEach((function(d){var h=d[0];h&&(n[h]=mt({},t.tracks[h]),t.removeBuffer(h)),d[0]=d[1]=null})),{media:e,mediaSource:i,tracks:n}},r.initTracks=function(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},r.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},r.onManifestParsed=function(t,e){var i,n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(n+" bufferCodec event(s) expected."),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()},r.onMediaAttaching=function(t,e){var i=this.media=e.media;this.transferData=this.overrides=void 0;var n=ke(this.appendSource);if(n){var o=!!e.mediaSource;(o||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);var l=this.mediaSource=e.mediaSource||new n;if(this.assignMediaSource(l),o)this._objectUrl=i.src,this.attachTransferred();else{var u=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{i.removeAttribute("src");var d=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||d&&l instanceof d,xs(i),(function(h,f){var c=self.document.createElement("source");c.type="video/mp4",c.src=f,h.appendChild(c)})(i,u),i.load()}catch{i.src=u}else i.src=u}i.addEventListener("emptied",this._onMediaEmptied)}},r.assignMediaSource=function(t){var e,i;this.log((((e=this.transferData)==null?void 0:e.mediaSource)===t?"transferred":"created")+" media source: "+((i=t.constructor)==null?void 0:i.name)),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))},r.attachTransferred=function(){var t=this,e=this.media,i=this.transferData;if(i&&e){var n=this.tracks,o=i.tracks,l=o?Object.keys(o):null,u=l?l.length:0,d=function(){Promise.resolve().then((function(){t.media&&t.mediaSourceOpenOrEnded&&t._onMediaSourceOpen()}))};if(o&&l&&u){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+Et(n,(function(g,v){return g==="initSegment"?void 0:v}))+`;
transfer tracks: `+Et(o,(function(g,v){return g==="initSegment"?void 0:v}))+"}"),!Mn(o,n)){i.mediaSource=null,i.tracks=void 0;var h=e.currentTime,f=this.details,c=Math.max(h,f?.fragments[0].start||0);return c-h>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time "+h+" -> "+c):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(o)+'"->"'+Object.keys(n)+'") start time: '+c+" currentTime: "+h),this.onMediaDetaching(y.MEDIA_DETACHING,{}),this.onMediaAttaching(y.MEDIA_ATTACHING,i),void(e.currentTime=c))}this.transferData=void 0,l.forEach((function(g){var v=g,m=o[v];if(m){var p=m.buffer;if(p){var E=t.fragmentTracker,T=m.id;if(E.hasFragments(T)||E.hasParts(T)){var S=tt.getBuffered(p);E.detectEvictedFragments(v,S,T,null,!0)}var R=tn(v),A=[v,p];t.sourceBuffers[R]=A,p.updating&&t.operationQueue&&t.operationQueue.prependBlocker(v),t.trackSourceBuffer(v,m)}}})),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}},r.onMediaDetaching=function(t,e){var i=this,n=!!e.transferMedia;this.transferData=this.overrides=void 0;var o=this.media,l=this.mediaSource,u=this._objectUrl;if(l){if(this.log("media source "+(n?"transferring":"detaching")),n)this.sourceBuffers.forEach((function(c){var g=c[0];g&&i.removeBuffer(g)})),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var d=l.readyState==="open";try{for(var h=l.sourceBuffers,f=h.length;f--;)d&&h[f].abort(),l.removeSourceBuffer(h[f]);d&&l.endOfStream()}catch(c){this.warn("onMediaDetaching: "+c.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}o&&(o.removeEventListener("emptied",this._onMediaEmptied),n||(u&&self.URL.revokeObjectURL(u),this.mediaSrc===u?(o.removeAttribute("src"),this.appendSource&&xs(o),o.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(y.MEDIA_DETACHED,e)},r.onBufferReset=function(){var t=this;this.sourceBuffers.forEach((function(e){var i=e[0];i&&t.resetBuffer(i)})),this.initTracks()},r.resetBuffer=function(t){var e,i=(e=this.tracks[t])==null?void 0:e.buffer;if(this.removeBuffer(t),i)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(o){this.warn("onBufferReset "+t,o)}delete this.tracks[t]},r.removeBuffer=function(t){this.removeBufferListeners(t),this.sourceBuffers[tn(t)]=[null,null];var e=this.tracks[t];e&&(e.buffer=void 0)},r.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Wl(this.tracks)},r.onBufferCodecs=function(t,e){var i,n=this,o=this.tracks,l=Object.keys(e);this.log('BUFFER_CODECS: "'+l+'" (current SB count '+this.sourceBufferCount+")");var u="audiovideo"in e&&(o.audio||o.video)||o.audiovideo&&("audio"in e||"video"in e),d=!u&&this.sourceBufferCount&&this.media&&l.some((function(h){return!o[h]}));u||d?this.warn('Unsupported transition between "'+Object.keys(o)+'" and "'+l+'" SourceBuffers'):(l.forEach((function(h){var f,c,g=e[h],v=g.id,m=g.codec,p=g.levelCodec,E=g.container,T=g.metadata,S=g.supplemental,R=o[h],A=(f=n.transferData)==null||(f=f.tracks)==null?void 0:f[h],L=A!=null&&A.buffer?A:R,b=L?.pendingCodec||L?.codec,k=L?.levelCodec;R||(R=o[h]={buffer:void 0,listeners:[],codec:m,supplemental:S,container:E,levelCodec:p,metadata:T,id:v});var I=Ir(b,k),D=I?.replace(ws,"$1"),P=Ir(m,p),M=(c=P)==null?void 0:c.replace(ws,"$1");P&&I&&D!==M&&(h.slice(0,5)==="audio"&&(P=Lr(P,n.appendSource)),n.log("switching codec "+b+" to "+P),P!==(R.pendingCodec||R.codec)&&(R.pendingCodec=P),R.container=E,n.appendChangeType(h,E,P))})),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!e.video&&((i=e.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))},r.appendChangeType=function(t,e,i){var n=this,o=e+";codecs="+i,l={label:"change-type="+o,execute:function(){var u=n.tracks[t];if(u){var d=u.buffer;d!=null&&d.changeType&&(n.log("changing "+t+" sourceBuffer type to "+o),d.changeType(o),u.codec=i,u.container=e)}n.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(u){n.warn("Failed to change "+t+" SourceBuffer type",u)}};this.append(l,t,this.isPending(this.tracks[t]))},r.blockAudio=function(t){var e,i=this,n=t.start,o=n+.05*t.duration;if(((e=this.fragmentTracker.getAppendedFrag(n,Z))==null?void 0:e.gap)!==!0){var l={label:"block-audio",execute:function(){var u,d=i.tracks.video;(i.lastVideoAppendEnd>o||d!=null&&d.buffer&&tt.isBuffered(d.buffer,o)||((u=i.fragmentTracker.getAppendedFrag(o,Z))==null?void 0:u.gap)===!0)&&(i.blockedAudioAppend=null,i.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(u){i.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:l,frag:t},this.append(l,"audio",!0)}},r.unblockAudio=function(){var t=this.blockedAudioAppend,e=this.operationQueue;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))},r.onBufferAppending=function(t,e){var i=this,n=this.tracks,o=e.data,l=e.type,u=e.parent,d=e.frag,h=e.part,f=e.chunkMeta,c=e.offset,g=f.buffering[l],v=d.sn,m=d.cc,p=self.performance.now();g.start=p;var E=d.stats.buffering,T=h?h.stats.buffering:null;E.start===0&&(E.start=p),T&&T.start===0&&(T.start=p);var S=n.audio,R=!1;l==="audio"&&S?.container==="audio/mpeg"&&(R=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);var A=n.video,L=A?.buffer;if(L&&v!=="initSegment"){var b=h||d,k=this.blockedAudioAppend;if(l!=="audio"||u==="main"||this.blockedAudioAppend||A.ending||A.ended){if(l==="video"){var I=b.end;if(k){var D=k.frag.start;(I>D||I<this.lastVideoAppendEnd||tt.isBuffered(L,D))&&this.unblockAudio()}this.lastVideoAppendEnd=I}}else{var P=b.start+.05*b.duration,M=L.buffered,O=this.currentOp("video");M.length||O?!O&&!tt.isBuffered(L,P)&&this.lastVideoAppendEnd<P&&this.blockAudio(b):this.blockAudio(b)}}var w=(h||d).start,F={label:"append-"+l,execute:function(){var x;g.executeStart=self.performance.now();var N=(x=i.tracks[l])==null?void 0:x.buffer;N&&(R?i.updateTimestampOffset(N,w,.1,l,v,m):c!==void 0&&B(c)&&i.updateTimestampOffset(N,c,1e-6,l,v,m)),i.appendExecutor(o,l)},onStart:function(){},onComplete:function(){var x=self.performance.now();g.executeEnd=g.end=x,E.first===0&&(E.first=x),T&&T.first===0&&(T.first=x);var N={};i.sourceBuffers.forEach((function(H){var U=H[0],G=H[1];U&&(N[U]=tt.getBuffered(G))})),i.appendErrors[l]=0,l==="audio"||l==="video"?i.appendErrors.audiovideo=0:(i.appendErrors.audio=0,i.appendErrors.video=0),i.hls.trigger(y.BUFFER_APPENDED,{type:l,frag:d,part:h,chunkMeta:f,parent:d.type,timeRanges:N})},onError:function(x){var N,H={type:K.MEDIA_ERROR,parent:d.type,details:_.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:d,part:h,chunkMeta:f,error:x,err:x,fatal:!1},U=(N=i.media)==null?void 0:N.error;if(x.code===DOMException.QUOTA_EXCEEDED_ERR||x.name=="QuotaExceededError"||"quota"in x)H.details=_.BUFFER_FULL_ERROR;else if(x.code===DOMException.INVALID_STATE_ERR&&i.mediaSourceOpenOrEnded&&!U)H.errorAction=Ve(!0);else if(x.name===Os&&i.sourceBufferCount===0)H.errorAction=Ve(!0);else{var G=++i.appendErrors[l];i.warn("Failed "+G+"/"+i.hls.config.appendErrorMaxRetry+' times to append segment in "'+l+'" sourceBuffer ('+(U||"no media error")+")"),(G>=i.hls.config.appendErrorMaxRetry||U)&&(H.fatal=!0)}i.hls.trigger(y.ERROR,H)}};this.log('queuing "'+l+'" append sn: '+v+(h?" p: "+h.index:"")+" of "+(d.type===Z?"level":"track")+" "+d.level+" cc: "+m),this.append(F,l,this.isPending(this.tracks[l]))},r.getFlushOp=function(t,e,i){var n=this;return this.log('queuing "'+t+'" remove '+e+"-"+i),{label:"remove",execute:function(){n.removeExecutor(t,e,i)},onStart:function(){},onComplete:function(){n.hls.trigger(y.BUFFER_FLUSHED,{type:t})},onError:function(o){n.warn("Failed to remove "+e+"-"+i+' from "'+t+'" SourceBuffer',o)}}},r.onBufferFlushing=function(t,e){var i=this,n=e.type,o=e.startOffset,l=e.endOffset;n?this.append(this.getFlushOp(n,o,l),n):this.sourceBuffers.forEach((function(u){var d=u[0];d&&i.append(i.getFlushOp(d,o,l),d)}))},r.onFragParsed=function(t,e){var i=this,n=e.frag,o=e.part,l=[],u=o?o.elementaryStreams:n.elementaryStreams;u[hi]?l.push("audiovideo"):(u[zt]&&l.push("audio"),u[ae]&&l.push("video")),l.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers((function(){var d=self.performance.now();n.stats.buffering.end=d,o&&(o.stats.buffering.end=d);var h=o?o.stats:n.stats;i.hls.trigger(y.FRAG_BUFFERED,{frag:n,part:o,stats:h,id:n.type})}),l).catch((function(d){i.warn("Fragment buffered callback "+d),i.stepOperationQueue(i.sourceBufferTypes)}))},r.onFragChanged=function(t,e){this.trimBuffers()},r.onBufferEos=function(t,e){var i,n=this;this.sourceBuffers.forEach((function(l){var u=l[0];if(u){var d=n.tracks[u];e.type&&e.type!==u||(d.ending=!0,d.ended||(d.ended=!0,n.log(u+" buffer reached EOS")))}}));var o=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some((function(l){var u,d=l[0];return d&&!((u=n.tracks[d])!=null&&u.ended)}))?o?(this.log("Queueing EOS"),this.blockUntilOpen((function(){n.tracksEnded();var l=n.mediaSource;l&&l.readyState==="open"?(n.log("Calling mediaSource.endOfStream()"),l.endOfStream(),n.hls.trigger(y.BUFFERED_TO_END,void 0)):l&&n.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+l.readyState)}))):(this.tracksEnded(),this.hls.trigger(y.BUFFERED_TO_END,void 0)):e.type==="video"&&this.unblockAudio()},r.tracksEnded=function(){var t=this;this.sourceBuffers.forEach((function(e){var i=e[0];if(i!==null){var n=t.tracks[i];n&&(n.ending=!1)}}))},r.onLevelUpdated=function(t,e){var i=e.details;i.fragments.length&&(this.details=i,this.updateDuration())},r.updateDuration=function(){var t=this;this.blockUntilOpen((function(){var e=t.getDurationAndRange();e&&t.updateMediaSource(e)}))},r.onError=function(t,e){if(e.details===_.BUFFER_APPEND_ERROR&&e.frag){var i,n=(i=e.errorAction)==null?void 0:i.nextAutoLevel;B(n)&&n!==e.frag.level&&this.resetAppendErrors()}},r.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},r.trimBuffers=function(){var t=this.hls,e=this.details,i=this.media;if(i&&e!==null&&this.sourceBufferCount){var n=t.config,o=i.currentTime,l=e.levelTargetDuration,u=e.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(B(u)&&u>=0){var d=Math.max(u,l),h=Math.floor(o/l)*l-d;this.flushBackBuffer(o,l,h)}var f=n.frontBufferFlushThreshold;if(B(f)&&f>0){var c=Math.max(n.maxBufferLength,f),g=Math.max(c,l),v=Math.floor(o/l)*l+g;this.flushFrontBuffer(o,l,v)}}},r.flushBackBuffer=function(t,e,i){var n=this;this.sourceBuffers.forEach((function(o){var l=o[0],u=o[1];if(u){var d=tt.getBuffered(u);if(d.length>0&&i>d.start(0)){var h;n.hls.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:i});var f=n.tracks[l];if((h=n.details)!=null&&h.live)n.hls.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(f!=null&&f.ended)return void n.log("Cannot flush "+l+" back buffer while SourceBuffer is in ended state");n.hls.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:l})}}}))},r.flushFrontBuffer=function(t,e,i){var n=this;this.sourceBuffers.forEach((function(o){var l=o[0],u=o[1];if(u){var d=tt.getBuffered(u),h=d.length;if(h<2)return;var f=d.start(h-1),c=d.end(h-1);if(i>f||t>=f&&t<=c)return;n.hls.trigger(y.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:l})}}))},r.getDurationAndRange=function(){var t,e=this.details,i=this.mediaSource;if(!e||!this.media||i?.readyState!=="open")return null;var n=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&i.setLiveSeekableRange){var o=Math.max(0,e.fragmentStart);return{duration:1/0,start:o,end:Math.max(o,n)}}return{duration:1/0}}var l=(t=this.overrides)==null?void 0:t.duration;if(l)return B(l)?{duration:l}:null;var u=this.media.duration;return n>(B(i.duration)?i.duration:0)&&n>u||!B(u)?{duration:n}:null},r.updateMediaSource=function(t){var e=t.duration,i=t.start,n=t.end,o=this.mediaSource;this.media&&o&&o.readyState==="open"&&(o.duration!==e&&(B(e)&&this.log("Updating MediaSource duration to "+e.toFixed(3)),o.duration=e),i!==void 0&&n!==void 0&&(this.log("MediaSource duration is set to "+o.duration+". Setting seekable range to "+i+"-"+n+"."),o.setLiveSeekableRange(i,n)))},r.checkPendingTracks=function(){var t=this.bufferCodecEventsTotal,e=this.pendingTrackCount,i=this.tracks;if(this.log("checkPendingTracks (pending: "+e+" codec events expected: "+t+") "+Et(i)),this.tracksReady){var n,o=(n=this.transferData)==null?void 0:n.tracks;o&&Object.keys(o).length?this.attachTransferred():this.createSourceBuffers()}},r.bufferCreated=function(){var t=this;if(this.sourceBufferCount){var e={};this.sourceBuffers.forEach((function(n){var o=n[0],l=n[1];if(o){var u=t.tracks[o];e[o]={buffer:l,container:u.container,codec:u.codec,supplemental:u.supplemental,levelCodec:u.levelCodec,id:u.id,metadata:u.metadata}}})),this.hls.trigger(y.BUFFER_CREATED,{tracks:e}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach((function(n){var o=n[0];t.executeNext(o)}))}else{var i=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:i,reason:i.message})}},r.createSourceBuffers=function(){var t=this.tracks,e=this.sourceBuffers,i=this.mediaSource;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(var n in t){var o=n,l=t[o];if(this.isPending(l)){var u=this.getTrackCodec(l,o),d=l.container+";codecs="+u;l.codec=u,this.log("creating sourceBuffer("+d+")"+(this.currentOp(o)?" Queued":"")+" "+Et(l));try{var h=i.addSourceBuffer(d),f=tn(o),c=[o,h];e[f]=c,l.buffer=h}catch(v){var g;return this.error("error while trying to add sourceBuffer: "+v.message),this.shiftAndExecuteNext(o),(g=this.operationQueue)==null||g.removeBlockers(),delete this.tracks[o],void this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:v,sourceBufferName:o,mimeType:d,parent:l.id})}this.trackSourceBuffer(o,l)}}this.bufferCreated()},r.getTrackCodec=function(t,e){var i=t.supplemental,n=t.codec;i&&(e==="video"||e==="audiovideo")&&ir(i,"video")&&(n=(function(l,u){var d=[];if(l)for(var h=l.split(","),f=0;f<h.length;f++)vi(h[f],"video")||d.push(h[f]);return u&&d.push(u),d.join(",")})(n,i));var o=Ir(n,t.levelCodec);return o?e.slice(0,5)==="audio"?Lr(o,this.appendSource):o:""},r.trackSourceBuffer=function(t,e){var i=this,n=e.buffer;if(n){var o=this.getTrackCodec(e,t);this.tracks[t]={buffer:n,codec:o,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(function(l,u){var d=u.removedRanges;d!=null&&d.length&&i.hls.trigger(y.BUFFER_FLUSHED,{type:l})}))}},r.onSBUpdateStart=function(t){var e=this.currentOp(t);e&&e.onStart()},r.onSBUpdateEnd=function(t){var e;if(((e=this.mediaSource)==null?void 0:e.readyState)!=="closed"){var i=this.currentOp(t);i&&(i.onComplete(),this.shiftAndExecuteNext(t))}else this.resetBuffer(t)},r.onSBUpdateError=function(t,e){var i,n=new Error(t+" SourceBuffer error. MediaSource readyState: "+((i=this.mediaSource)==null?void 0:i.readyState));this.error(""+n,e),this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:n,fatal:!1});var o=this.currentOp(t);o&&o.onError(n)},r.updateTimestampOffset=function(t,e,i,n,o,l){var u=e-t.timestampOffset;Math.abs(u)>=i&&(this.log("Updating "+n+" SourceBuffer timestampOffset to "+e+" (sn: "+o+" cc: "+l+")"),t.timestampOffset=e)},r.removeExecutor=function(t,e,i){var n=this.media,o=this.mediaSource,l=this.tracks[t],u=l?.buffer;if(!n||!o||!u)return this.warn("Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void this.shiftAndExecuteNext(t);var d=B(n.duration)?n.duration:1/0,h=B(o.duration)?o.duration:1/0,f=Math.max(0,e),c=Math.min(i,d,h);c>f&&(!l.ending||l.ended)?(l.ended=!1,this.log("Removing ["+f+","+c+"] from the "+t+" SourceBuffer"),u.remove(f,c)):this.shiftAndExecuteNext(t)},r.appendExecutor=function(t,e){var i=this.tracks[e],n=i?.buffer;if(!n)throw new jl("Attempting to append to the "+e+" SourceBuffer, but it does not exist");i.ending=!1,i.ended=!1,n.appendBuffer(t)},r.blockUntilOpen=function(t){var e=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch((function(i){e.warn("SourceBuffer blocked callback "+i),e.stepOperationQueue(e.sourceBufferTypes)}));else try{t()}catch(i){this.warn("Callback run without blocking "+this.operationQueue+" "+i)}},r.isUpdating=function(){return this.sourceBuffers.some((function(t){var e=t[0],i=t[1];return e&&i.updating}))},r.isQueued=function(){var t=this;return this.sourceBuffers.some((function(e){var i=e[0];return i&&!!t.currentOp(i)}))},r.isPending=function(t){return!!t&&!t.buffer},r.blockBuffers=function(t,e){var i=this;if(e===void 0&&(e=this.sourceBufferTypes),!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);var n=this.operationQueue,o=e.map((function(l){return i.appendBlocker(l)}));return e.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(o).then((function(l){n===i.operationQueue&&(t(),i.stepOperationQueue(i.sourceBufferTypes))}))},r.stepOperationQueue=function(t){var e=this;t.forEach((function(i){var n,o=(n=e.tracks[i])==null?void 0:n.buffer;o&&!o.updating&&e.shiftAndExecuteNext(i)}))},r.append=function(t,e,i){this.operationQueue&&this.operationQueue.append(t,e,i)},r.appendBlocker=function(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)},r.currentOp=function(t){return this.operationQueue?this.operationQueue.current(t):null},r.executeNext=function(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)},r.shiftAndExecuteNext=function(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)},r.addBufferListener=function(t,e,i){var n=this.tracks[t];if(n){var o=n.buffer;if(o){var l=i.bind(this,t);n.listeners.push({event:e,listener:l}),o.addEventListener(e,l)}}},r.removeBufferListeners=function(t){var e=this.tracks[t];if(e){var i=e.buffer;i&&(e.listeners.forEach((function(n){i.removeEventListener(n.event,n.listener)})),e.listeners.length=0)}},yt(s,[{key:"mediaSourceOpenOrEnded",get:function(){var t,e=(t=this.mediaSource)==null?void 0:t.readyState;return e==="open"||e==="ended"}},{key:"sourceBufferTracks",get:function(){var t=this;return Object.keys(this.tracks).reduce((function(e,i){var n=t.tracks[i];return e[i]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e}),{})}},{key:"bufferedToEnd",get:function(){var t=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some((function(e){var i=e[0];if(i){var n=t.tracks[i];if(n)return!n.ended||n.ending}return!1}))}},{key:"tracksReady",get:function(){var t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var t,e,i=((t=this.media)==null||(e=t.querySelector)==null?void 0:e.call(t,"source"))||this.media;return i?.src}},{key:"pendingTrackCount",get:function(){var t=this;return Object.keys(this.tracks).reduce((function(e,i){return e+(t.isPending(t.tracks[i])?1:0)}),0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce((function(t,e){return t+(e[0]?1:0)}),0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map((function(t){return t[0]})).filter((function(t){return!!t}))}}])})(ee);function xs(a){var s=a.querySelectorAll("source");[].slice.call(s).forEach((function(r){a.removeChild(r)}))}function tn(a){return a==="audio"?1:0}var Xl=(function(){function a(r){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=r,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var s=a.prototype;return s.setStreamController=function(r){this.streamController=r},s.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},s.registerListeners=function(){var r=this.hls;r.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(y.MANIFEST_PARSED,this.onManifestParsed,this),r.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(y.BUFFER_CODECS,this.onBufferCodecs,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},s.unregisterListener=function(){var r=this.hls;r.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MANIFEST_PARSED,this.onManifestParsed,this),r.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(y.BUFFER_CODECS,this.onBufferCodecs,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},s.onFpsDropLevelCapping=function(r,t){var e=this.hls.levels[t.droppedLevel];this.isLevelAllowed(e)&&this.restrictedLevels.push({bitrate:e.bitrate,height:e.height,width:e.width})},s.onMediaAttaching=function(r,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},s.onManifestParsed=function(r,t){var e=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onLevelsUpdated=function(r,t){this.timer&&B(this.autoLevelCapping)&&this.detectPlayerSize()},s.onBufferCodecs=function(r,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},s.onMediaDetaching=function(){this.stopCapping(),this.media=null},s.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);var r=this.hls.levels;if(r.length){var t=this.hls,e=this.getMaxLevel(r.length-1);e!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to "+e+": "+r[e].height+"p@"+r[e].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),t.autoLevelCapping=e,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},s.getMaxLevel=function(r){var t=this,e=this.hls.levels;if(!e.length)return-1;var i=e.filter((function(n,o){return t.isLevelAllowed(n)&&o<=r}));return this.clientRect=null,a.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},s.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},s.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},s.getDimensions=function(){if(this.clientRect)return this.clientRect;var r=this.media,t={width:0,height:0};if(r){var e=r.getBoundingClientRect();t.width=e.width,t.height=e.height,t.width||t.height||(t.width=e.right-e.left||r.width||0,t.height=e.bottom-e.top||r.height||0)}return this.clientRect=t,t},s.isLevelAllowed=function(r){return!this.restrictedLevels.some((function(t){return r.bitrate===t.bitrate&&r.width===t.width&&r.height===t.height}))},a.getMaxLevelByMediaSize=function(r,t,e){if(r==null||!r.length)return-1;for(var i,n,o=r.length-1,l=Math.max(t,e),u=0;u<r.length;u+=1){var d=r[u];if((d.width>=l||d.height>=l)&&(i=d,!(n=r[u+1])||i.width!==n.width||i.height!==n.height)){o=u;break}}return o},yt(a,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return Math.min(r,this.hls.config.maxDevicePixelRatio)}}])})(),Yt={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},zl={HLS:"h"},Oe=function a(s,r){Array.isArray(s)&&(s=s.map((function(t){return t instanceof a?t:new a(t)}))),this.value=s,this.params=r},Ql="Dict";function $l(a,s,r,t){return new Error("failed to "+a+' "'+(e=s,(Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":typeof e=="object"?JSON.stringify(e):String(e))+'" as ')+r,{cause:t});var e}function ce(a,s,r){return $l("serialize",a,s,r)}var Ms=function(a){this.description=a},Fs="Bare Item",Zl="Boolean",Jl="Byte Sequence";function tu(a){if(ArrayBuffer.isView(a)===!1)throw ce(a,Jl);return":"+(s=a,btoa(String.fromCharCode.apply(String,s))+":");var s}var eu="Integer";function Ns(a){if((function(s){return s<-999999999999999||999999999999999<s})(a))throw ce(a,eu);return a.toString()}function Us(a,s){if(a<0)return-Us(-a,s);var r=Math.pow(10,s);if(Math.abs(a*r%1-.5)<Number.EPSILON){var t=Math.floor(a*r);return(t%2==0?t:t+1)/r}return Math.round(a*r)/r}var ru="Decimal";function iu(a){var s=Us(a,3);if(Math.floor(Math.abs(s)).toString().length>12)throw ce(a,ru);var r=s.toString();return r.includes(".")?r:r+".0"}var nu="String",au=/[\x00-\x1f\x7f]+/,su="Token";function Bs(a){var s,r=(s=a).description||s.toString().slice(7,-1);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(r)===!1)throw ce(r,su);return r}function en(a){switch(typeof a){case"number":if(!B(a))throw ce(a,Fs);return Number.isInteger(a)?Ns(a):iu(a);case"string":return(function(s){if(au.test(s))throw ce(s,nu);return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'})(a);case"symbol":return Bs(a);case"boolean":return(function(s){if(typeof s!="boolean")throw ce(s,Zl);return s?"?1":"?0"})(a);case"object":if(a instanceof Date)return(function(s){return"@"+Ns(s.getTime()/1e3)})(a);if(a instanceof Uint8Array)return tu(a);if(a instanceof Ms)return Bs(a);default:throw ce(a,Fs)}}var ou="Key";function rn(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw ce(a,ou);return a}function nn(a){return a==null?"":Object.entries(a).map((function(s){var r=s[0],t=s[1];return t===!0?";"+rn(r):";"+rn(r)+"="+en(t)})).join("")}function Gs(a){return a instanceof Oe?""+en(a.value)+nn(a.params):en(a)}function lu(a,s){if(s===void 0&&(s={whitespace:!0}),typeof a!="object"||a==null)throw ce(a,Ql);var r=a instanceof Map?a.entries():Object.entries(a),t=s?.whitespace?" ":"";return Array.from(r).map((function(e){var i=e[0],n=e[1];n instanceof Oe==0&&(n=new Oe(n));var o,l=rn(i);return n.value===!0?l+=nn(n.params):(l+="=",Array.isArray(n.value)?l+="("+(o=n).value.map(Gs).join(" ")+")"+nn(o.params):l+=Gs(n)),l})).join(","+t)}function Ks(a,s){return lu(a,s)}var ge="CMCD-Object",bt="CMCD-Request",xe="CMCD-Session",De="CMCD-Status",uu={br:ge,ab:ge,d:ge,ot:ge,tb:ge,tpb:ge,lb:ge,tab:ge,lab:ge,url:ge,pb:bt,bl:bt,tbl:bt,dl:bt,ltc:bt,mtp:bt,nor:bt,nrr:bt,rc:bt,sn:bt,sta:bt,su:bt,ttfb:bt,ttfbb:bt,ttlb:bt,cmsdd:bt,cmsds:bt,smrt:bt,df:bt,cs:bt,ts:bt,cid:xe,pr:xe,sf:xe,sid:xe,st:xe,v:xe,msd:xe,bs:De,bsd:De,cdn:De,rtp:De,bg:De,pt:De,ec:De,e:De},du={REQUEST:bt};function hu(a,s){var r={};if(!a)return r;var t,e=Object.keys(a),i=s?(t=s,Object.keys(t).reduce((function(n,o){var l;return(l=t[o])===null||l===void 0||l.forEach((function(u){return n[u]=o})),n}),{})):{};return e.reduce((function(n,o){var l,u=uu[o]||i[o]||du.REQUEST;return((l=n[u])!==null&&l!==void 0?l:n[u]={})[o]=a[o],n}),r)}var Vs="event",jr=function(a){return Math.round(a)},an=function(a,s){return Array.isArray(a)?a.map((function(r){return an(r,s)})):a instanceof Oe&&typeof a.value=="string"?new Oe(an(a.value,s),a.params):(s.baseUrl&&(a=(function(r,t){var e=new URL(r),i=new URL(t);if(e.origin!==i.origin)return r;for(var n=e.pathname.split("/").slice(1),o=i.pathname.split("/").slice(1,-1);n[0]===o[0];)n.shift(),o.shift();for(;o.length;)o.shift(),n.unshift("..");return n.join("/")+e.search+e.hash})(a,s.baseUrl)),s.version===1?encodeURIComponent(a):a)},qr=function(a){return 100*jr(a/100)},fu={br:jr,d:jr,bl:qr,dl:qr,mtp:qr,nor:function(a,s){var r=a;return s.version>=2&&(a instanceof Oe&&typeof a.value=="string"?r=new Oe([a]):typeof a=="string"&&(r=[a])),an(r,s)},rtp:qr,tb:jr},Hs="request",Ys="response",sn=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],cu=["e"],gu=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Xr(a){return gu.test(a)}var zr,Ws=["d","dl","nor","ot","rtp","su"],vu=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"],mu=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function pu(a){return mu.includes(a)||Xr(a)}var yu=((zr={})[Ys]=function(a){return sn.includes(a)||Ws.includes(a)||vu.includes(a)||Xr(a)},zr[Vs]=function(a){return sn.includes(a)||cu.includes(a)||Xr(a)},zr[Hs]=function(a){return sn.includes(a)||Ws.includes(a)||Xr(a)},zr);function js(a,s){s===void 0&&(s={});var r={};if(a==null||typeof a!="object")return r;var t=s.version||a.v||1,e=s.reportingMode||Hs,i=t===1?pu:yu[e],n=Object.keys(a).filter(i),o=s.filter;typeof o=="function"&&(n=n.filter(o));var l=e===Ys||e===Vs;l&&!n.includes("ts")&&n.push("ts"),t>1&&!n.includes("v")&&n.push("v");var u=mt({},fu,s.formatters),d={version:t,reportingMode:e,baseUrl:s.baseUrl};return n.sort().forEach((function(h){var f=a[h],c=u[h];if(typeof c=="function"&&(f=c(f,d)),h==="v"){if(t===1)return;f=t}h=="pr"&&f===1||(l&&h==="ts"&&!B(f)&&(f=Date.now()),(function(g){return typeof g=="number"?B(g):g!=null&&g!==""&&g!==!1})(f)&&((function(g){return["ot","sf","st","e","sta"].includes(g)})(h)&&typeof f=="string"&&(f=new Ms(f)),r[h]=f))})),r}function Eu(a,s,r){return mt(a,(function(t,e){e===void 0&&(e={});var i={};if(!t)return i;var n=hu(js(t,e),e?.customHeaderMap);return Object.entries(n).reduce((function(o,l){var u=l[0],d=Ks(l[1],{whitespace:!1});return d&&(o[u]=d),o}),i)})(s,r))}var Tu="CMCD";function Su(a,s){if(s===void 0&&(s={}),!a)return"";var r=(function(t,e){return e===void 0&&(e={}),t?Ks(js(t,e),{whitespace:!1}):""})(a,s);return encodeURIComponent(r)}var qs=/CMCD=[^&#]+/;function Au(a,s,r){var t=(function(i,n){if(n===void 0&&(n={}),!i)return"";var o=Su(i,n);return Tu+"="+o})(s,r);if(!t)return a;if(qs.test(a))return a.replace(qs,t);var e=a.includes("?")?"&":"?";return""+a+e+t}var Lu=(function(){function a(r){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(n){try{t.apply(n,{ot:Yt.MANIFEST,su:!t.initialized})}catch(o){t.hls.logger.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(n){try{var o=n.frag,l=n.part,u=t.hls.levels[o.level],d=t.getObjectType(o),h={d:1e3*(l||o).duration,ot:d};d!==Yt.VIDEO&&d!==Yt.AUDIO&&d!=Yt.MUXED||(h.br=u.bitrate/1e3,h.tb=t.getTopBandwidth(d)/1e3,h.bl=t.getBufferLength(d));var f=l?t.getNextPart(l):t.getNextFrag(o);f!=null&&f.url&&f.url!==o.url&&(h.nor=f.url),t.apply(n,h)}catch(c){t.hls.logger.warn("Could not generate segment CMCD data.",c)}},this.hls=r;var e=this.config=r.config,i=e.cmcd;i!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||r.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}var s=a.prototype;return s.registerListeners=function(){var r=this.hls;r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHED,this.onMediaDetached,this),r.on(y.BUFFER_CREATED,this.onBufferCreated,this)},s.unregisterListeners=function(){var r=this.hls;r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHED,this.onMediaDetached,this),r.off(y.BUFFER_CREATED,this.onBufferCreated,this)},s.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null},s.onMediaAttached=function(r,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},s.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},s.onBufferCreated=function(r,t){var e,i;this.audioBuffer=(e=t.tracks.audio)==null?void 0:e.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer},s.createData=function(){var r;return{v:1,sf:zl.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)==null?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},s.apply=function(r,t){t===void 0&&(t={}),mt(t,this.createData());var e=t.ot===Yt.INIT||t.ot===Yt.VIDEO||t.ot===Yt.MUXED;this.starved&&e&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);var i=this.includeKeys;i&&(t=Object.keys(t).reduce((function(o,l){return i.includes(l)&&(o[l]=t[l]),o}),{}));var n={baseUrl:r.url};this.useHeaders?(r.headers||(r.headers={}),Eu(r.headers,t,n)):r.url=Au(r.url,t,n)},s.getNextFrag=function(r){var t,e=(t=this.hls.levels[r.level])==null?void 0:t.details;if(e){var i=r.sn-e.startSN;return e.fragments[i+1]}},s.getNextPart=function(r){var t,e=r.index,i=r.fragment,n=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(n)for(var o=i.sn,l=n.length-1;l>=0;l--){var u=n[l];if(u.index===e&&u.fragment.sn===o)return n[l+1]}},s.getObjectType=function(r){var t=r.type;return t==="subtitle"?Yt.TIMED_TEXT:r.sn==="initSegment"?Yt.INIT:t==="audio"?Yt.AUDIO:t==="main"?this.hls.audioTracks.length?Yt.VIDEO:Yt.MUXED:void 0},s.getTopBandwidth=function(r){var t,e=0,i=this.hls;if(r===Yt.AUDIO)t=i.audioTracks;else{var n=i.maxAutoLevel,o=n>-1?n+1:i.levels.length;t=i.levels.slice(0,o)}return t.forEach((function(l){l.bitrate>e&&(e=l.bitrate)})),e>0?e:NaN},s.getBufferLength=function(r){var t=this.media,e=r===Yt.AUDIO?this.audioBuffer:this.videoBuffer;return e&&t?1e3*tt.bufferInfo(e,t.currentTime,this.config.maxBufferHole).len:NaN},s.createPlaylistLoader=function(){var r=this.config.pLoader,t=this.applyPlaylistData,e=r||this.config.loader;return(function(){function i(o){this.loader=void 0,this.loader=new e(o)}var n=i.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(o,l,u){t(o),this.loader.load(o,l,u)},yt(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])})()},s.createFragmentLoader=function(){var r=this.config.fLoader,t=this.applyFragmentData,e=r||this.config.loader;return(function(){function i(o){this.loader=void 0,this.loader=new e(o)}var n=i.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(o,l,u){t(o),this.loader.load(o,l,u)},yt(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])})()},a})(),Iu=(function(a){function s(t){var e;return(e=a.call(this,"content-steering",t.logger)||this).hls=void 0,e.loader=null,e.uri=null,e.pathwayId=".",e._pathwayPriority=null,e.timeToLoad=300,e.reloadTimer=-1,e.updated=0,e.started=!1,e.enabled=!0,e.levels=null,e.audioTracks=null,e.subtitleTracks=null,e.penalizedPathways={},e.hls=t,e.registerListeners(),e}ut(s,a);var r=s.prototype;return r.registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.ERROR,this.onError,this))},r.pathways=function(){return(this.levels||[]).reduce((function(t,e){return t.indexOf(e.pathwayId)===-1&&t.push(e.pathwayId),t}),[])},r.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}},r.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},r.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},r.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},r.removeLevel=function(t){var e=this.levels;e&&(this.levels=e.filter((function(i){return i!==t})))},r.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},r.onManifestLoaded=function(t,e){var i=e.contentSteering;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())},r.onManifestParsed=function(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks},r.onError=function(t,e){var i=e.errorAction;if(i?.action===he&&i.flags===Pr){var n=this.levels,o=this._pathwayPriority,l=this.pathwayId;if(e.context){var u=e.context,d=u.groupId,h=u.pathwayId,f=u.type;d&&n?l=this.getPathwayForGroupId(d,f,l):h&&(l=h)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!o&&n&&(o=this.pathways()),o&&o.length>1&&(this.updatePathwayPriority(o),i.resolved=this.pathwayId!==l),e.details!==_.BUFFER_APPEND_ERROR||e.fatal?i.resolved||this.warn("Could not resolve "+e.details+' ("'+e.error.message+'") with content-steering for Pathway: '+l+" levels: "+(n&&n.length)+" priorities: "+Et(o)+" penalized: "+Et(this.penalizedPathways)):i.resolved=!0}},r.filterParsedLevels=function(t){this.levels=t;var e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){var i=t[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+i+'"'),e=this.getLevelsForPathway(i),this.pathwayId=i}return e.length!==t.length&&this.log("Found "+e.length+"/"+t.length+' levels in Pathway "'+this.pathwayId+'"'),e},r.getLevelsForPathway=function(t){return this.levels===null?[]:this.levels.filter((function(e){return t===e.pathwayId}))},r.updatePathwayPriority=function(t){var e;this._pathwayPriority=t;var i=this.penalizedPathways,n=performance.now();Object.keys(i).forEach((function(f){n-i[f]>3e5&&delete i[f]}));for(var o=0;o<t.length;o++){var l=t[o];if(!(l in i)){if(l===this.pathwayId)return;var u=this.hls.nextLoadLevel,d=this.hls.levels[u];if((e=this.getLevelsForPathway(l)).length>0){this.log('Setting Pathway to "'+l+'"'),this.pathwayId=l,Ja(e),this.hls.trigger(y.LEVELS_UPDATED,{levels:e});var h=this.hls.levels[u];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log("Unstable Pathways change from bitrate "+d.bitrate+" to "+h.bitrate),this.hls.nextLoadLevel=u);break}}}},r.getPathwayForGroupId=function(t,e,i){for(var n=this.getLevelsForPathway(i).concat(this.levels||[]),o=0;o<n.length;o++)if(e===ne&&n[o].hasAudioGroup(t)||e===oe&&n[o].hasSubtitleGroup(t))return n[o].pathwayId;return i},r.clonePathways=function(t){var e=this,i=this.levels;if(i){var n={},o={};t.forEach((function(l){var u=l.ID,d=l["BASE-ID"],h=l["URI-REPLACEMENT"];if(!i.some((function(c){return c.pathwayId===u}))){var f=e.getLevelsForPathway(d).map((function(c){var g=new Pt(c.attrs);g["PATHWAY-ID"]=u;var v=g.AUDIO&&g.AUDIO+"_clone_"+u,m=g.SUBTITLES&&g.SUBTITLES+"_clone_"+u;v&&(n[g.AUDIO]=v,g.AUDIO=v),m&&(o[g.SUBTITLES]=m,g.SUBTITLES=m);var p=zs(c.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),E=new ar({attrs:g,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:p,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(var T=1;T<c.audioGroups.length;T++)E.addGroupId("audio",c.audioGroups[T]+"_clone_"+u);if(c.subtitleGroups)for(var S=1;S<c.subtitleGroups.length;S++)E.addGroupId("text",c.subtitleGroups[S]+"_clone_"+u);return E}));i.push.apply(i,f),Xs(e.audioTracks,n,h,u),Xs(e.subtitleTracks,o,h,u)}}))}},r.loadSteeringManifest=function(t){var e,i=this,n=this.hls.config,o=n.loader;this.loader&&this.loader.destroy(),this.loader=new o(n);try{e=new self.URL(t)}catch{return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+t)}if(e.protocol!=="data:"){var l=0|(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate);e.searchParams.set("_HLS_pathway",this.pathwayId),e.searchParams.set("_HLS_throughput",""+l)}var u={responseType:"json",url:e.href},d=n.steeringManifestLoadPolicy.default,h=d.errorRetry||d.timeoutRetry||{},f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},c={onSuccess:function(g,v,m,p){i.log('Loaded steering manifest: "'+e+'"');var E=g.data;if(E?.VERSION===1){i.updated=performance.now(),i.timeToLoad=E.TTL;var T=E["RELOAD-URI"],S=E["PATHWAY-CLONES"],R=E["PATHWAY-PRIORITY"];if(T)try{i.uri=new self.URL(T,e).href}catch{return i.enabled=!1,void i.log("Failed to parse Steering Manifest RELOAD-URI: "+T)}i.scheduleRefresh(i.uri||m.url),S&&i.clonePathways(S);var A={steeringManifest:E,url:e.toString()};i.hls.trigger(y.STEERING_MANIFEST_LOADED,A),R&&i.updatePathwayPriority(R)}else i.log("Steering VERSION "+E.VERSION+" not supported!")},onError:function(g,v,m,p){if(i.log("Error loading steering manifest: "+g.code+" "+g.text+" ("+v.url+")"),i.stopLoad(),g.code===410)return i.enabled=!1,void i.log("Steering manifest "+v.url+" no longer available");var E=1e3*i.timeToLoad;if(g.code!==429)i.scheduleRefresh(i.uri||v.url,E);else{var T=i.loader;if(typeof T?.getResponseHeader=="function"){var S=T.getResponseHeader("Retry-After");S&&(E=1e3*parseFloat(S))}i.log("Steering manifest "+v.url+" rate limited")}},onTimeout:function(g,v,m){i.log("Timeout loading steering manifest ("+v.url+")"),i.scheduleRefresh(i.uri||v.url)}};this.log("Requesting steering manifest: "+e),this.loader.load(u,f,c)},r.scheduleRefresh=function(t,e){var i=this;e===void 0&&(e=1e3*this.timeToLoad),this.clearTimeout(),this.reloadTimer=self.setTimeout((function(){var n,o=(n=i.hls)==null?void 0:n.media;!o||o.ended?i.scheduleRefresh(t,1e3*i.timeToLoad):i.loadSteeringManifest(t)}),e)},yt(s,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(t){this.updatePathwayPriority(t)}}])})(ee);function Xs(a,s,r,t){a&&Object.keys(s).forEach((function(e){var i=a.filter((function(n){return n.groupId===e})).map((function(n){var o=mt({},n);return o.details=void 0,o.attrs=new Pt(o.attrs),o.url=o.attrs.URI=zs(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),o.groupId=o.attrs["GROUP-ID"]=s[e],o.attrs["PATHWAY-ID"]=t,o}));a.push.apply(a,i)}))}function zs(a,s,r,t){var e,i=t.HOST,n=t.PARAMS,o=t[r];s&&(e=o?.[s])&&(a=e);var l=new self.URL(a);return i&&!e&&(l.host=i),n&&Object.keys(n).sort().forEach((function(u){u&&l.searchParams.set(u,n[u])})),l.href}var Qs=(function(a){function s(t){var e;return(e=a.call(this,"eme",t.logger)||this).hls=void 0,e.config=void 0,e.media=null,e.keyFormatPromise=null,e.keySystemAccessPromises={},e._requestLicenseFailureCount=0,e.mediaKeySessions=[],e.keyIdToKeySessionPromise={},e.mediaKeys=null,e.setMediaKeysQueue=s.CDMCleanupPromise?[s.CDMCleanupPromise]:[],e.bannedKeyIds={},e.onMediaEncrypted=function(i){var n=i.initDataType,o=i.initData,l='"'+i.type+'" event: init data type: "'+n+'"';if(e.debug(l),o!==null){if(!e.keyFormatPromise){var u=Object.keys(e.keySystemAccessPromises);u.length||(u=ur(e.config));var d=u.map(Ci).filter((function(h){return!!h}));e.keyFormatPromise=e.getKeyFormatPromise(d)}e.keyFormatPromise.then((function(h){var f=Fr(h);if(n==="sinf"&&f===kt.FAIRPLAY){var c;try{var g=Mt(new Uint8Array(o)),v=Wn(Di(JSON.parse(g).sinf));if(!v)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(v.subarray(8,24))}catch(b){return void e.warn(l+" Failed to parse sinf: "+b)}for(var m,p=Vt(c),E=e,T=E.keyIdToKeySessionPromise,S=E.mediaKeySessions,R=T[p],A=function(){var b=S[L],k=b.decryptdata;if(!k.keyId)return 0;var I=Vt(k.keyId);return ki(c,k.keyId)||k.uri.replace(/-/g,"").indexOf(p)!==-1?(R=T[I])?(k.pssh||(delete T[I],k.pssh=new Uint8Array(o),k.keyId=c,(R=T[p]=R.then((function(){return e.generateRequestWithPreferredKeySession(b,n,o,"encrypted-event-key-match")}))).catch((function(D){return e.handleError(D)}))),1):0:void 0},L=0;L<S.length&&((m=A())===0||m!==1);L++);R||e.handleError(new Error("Key ID "+p+" not encountered in playlist. Key-system sessions "+S.length+"."))}else e.log('Ignoring "'+i.type+'" event with init data type: "'+n+'" for selected key-system '+f)})).catch((function(h){return e.handleError(h)}))}},e.onWaitingForKey=function(i){e.log('"'+i.type+'" event')},e.hls=t,e.config=t.config,e.registerListeners(),e}ut(s,a);var r=s.prototype;return r.destroy=function(){this.onDestroying(),this.onMediaDetached();var t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null},r.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(y.DESTROYING,this.onDestroying,this)},r.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(y.DESTROYING,this.onDestroying,this)},r.getLicenseServerUrl=function(t){var e=this.config,i=e.drmSystems,n=e.widevineLicenseUrl,o=i?.[t];return o?o.licenseUrl:t===kt.WIDEVINE&&n?n:void 0},r.getLicenseServerUrlOrThrow=function(t){var e=this.getLicenseServerUrl(t);if(e===void 0)throw new Error('no license server URL configured for key-system "'+t+'"');return e},r.getServerCertificateUrl=function(t){var e=this.config.drmSystems,i=e?.[t];if(i)return i.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+t+'"]')},r.attemptKeySystemAccess=function(t){var e=this,i=this.hls.levels,n=function(u,d,h){return!!u&&h.indexOf(u)===d},o=i.map((function(u){return u.audioCodec})).filter(n),l=i.map((function(u){return u.videoCodec})).filter(n);return o.length+l.length===0&&l.push("avc1.42e01e"),new Promise((function(u,d){var h=function(f){var c=f.shift();e.getMediaKeysPromise(c,o,l).then((function(g){return u({keySystem:c,mediaKeys:g})})).catch((function(g){f.length?h(f):d(g instanceof $t?g:new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))}))};h(t)}))},r.requestMediaKeySystemAccess=function(t,e){var i=this.config.requestMediaKeySystemAccessFunc;if(typeof i!="function"){var n="Configured requestMediaKeySystemAccess is not a function "+i;return xa===null&&self.location.protocol==="http:"&&(n="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(n))}return i(t,e)},r.getMediaKeysPromise=function(t,e,i){var n,o=this,l=(function(f,c,g,v){var m;switch(f){case kt.FAIRPLAY:m=["cenc","sinf"];break;case kt.WIDEVINE:case kt.PLAYREADY:m=["cenc"];break;case kt.CLEARKEY:m=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+f)}return(function(p,E,T,S){return[{initDataTypes:p,persistentState:S.persistentState||"optional",distinctiveIdentifier:S.distinctiveIdentifier||"optional",sessionTypes:S.sessionTypes||[S.sessionType||"temporary"],audioCapabilities:E.map((function(R){return{contentType:"audio/mp4; codecs="+R,robustness:S.audioRobustness||"",encryptionScheme:S.audioEncryptionScheme||null}})),videoCapabilities:T.map((function(R){return{contentType:"video/mp4; codecs="+R,robustness:S.videoRobustness||"",encryptionScheme:S.videoEncryptionScheme||null}}))}]})(m,c,g,v)})(t,e,i,this.config.drmSystemOptions||{}),u=this.keySystemAccessPromises[t],d=(n=u)==null?void 0:n.keySystemAccess;if(!d){this.log('Requesting encrypted media "'+t+'" key-system access with config: '+Et(l)),d=this.requestMediaKeySystemAccess(t,l);var h=u=this.keySystemAccessPromises[t]={keySystemAccess:d};return d.catch((function(f){o.log('Failed to obtain access to key-system "'+t+'": '+f)})),d.then((function(f){o.log('Access for key-system "'+f.keySystem+'" obtained');var c=o.fetchServerCertificate(t);o.log('Create media-keys for "'+t+'"');var g=h.mediaKeys=f.createMediaKeys().then((function(v){return o.log('Media-keys created for "'+t+'"'),h.hasMediaKeys=!0,c.then((function(m){return m?o.setMediaKeysServerCertificate(v,t,m):v}))}));return g.catch((function(v){o.error('Failed to create media-keys for "'+t+'"}: '+v)})),g}))}return d.then((function(){return u.mediaKeys}))},r.createMediaKeySessionContext=function(t){var e=t.decryptdata,i=t.keySystem,n=t.mediaKeys;this.log('Creating key-system session "'+i+'" keyId: '+Vt(e.keyId||[])+" keyUri: "+e.uri);var o=n.createSession(),l={decryptdata:e,keySystem:i,mediaKeys:n,mediaKeysSession:o,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l},r.renewKeySession=function(t){var e=t.decryptdata;if(e.pssh){var i=this.createMediaKeySessionContext(t),n=Qr(e);this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(i,"cenc",e.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)},r.updateKeySession=function(t,e){var i=t.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyId '+Vt(t.decryptdata.keyId||[])+`
      } (data length: `+e.byteLength+")"),i.update(e)},r.getSelectedKeySystemFormats=function(){var t=this;return Object.keys(this.keySystemAccessPromises).map((function(e){return{keySystem:e,hasMediaKeys:t.keySystemAccessPromises[e].hasMediaKeys}})).filter((function(e){return!!e.hasMediaKeys})).map((function(e){return Ci(e.keySystem)})).filter((function(e){return!!e}))},r.getKeySystemAccess=function(t){var e=this;return this.getKeySystemSelectionPromise(t).then((function(i){var n=i.keySystem,o=i.mediaKeys;return e.attemptSetMediaKeys(n,o)}))},r.selectKeySystem=function(t){var e=this;return new Promise((function(i,n){e.getKeySystemSelectionPromise(t).then((function(o){var l=o.keySystem,u=Ci(l);u?i(u):n(new Error('Unable to find format for key-system "'+l+'"'))})).catch(n)}))},r.selectKeySystemFormat=function(t){var e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+t.sn+" "+t.type+": "+t.level+") key formats "+e.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise},r.getKeyFormatPromise=function(t){var e=ur(this.config),i=t.map(Fr).filter((function(n){return!!n&&e.indexOf(n)!==-1}));return this.selectKeySystem(i)},r.getKeyStatus=function(t){for(var e=this.mediaKeySessions,i=0;i<e.length;i++){var n=Ru(t,e[i]);if(n)return n}},r.loadKey=function(t){var e=this,i=t.keyInfo.decryptdata,n=Qr(i),o=this.bannedKeyIds[n];if(o||this.getKeyStatus(i)==="internal-error"){var l=$s(o||"internal-error",i);return this.handleError(l,t.frag),Promise.reject(l)}var u="(keyId: "+n+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+u);var d=this.keyIdToKeySessionPromise[n];if(!d){var h=this.getKeySystemForKeyPromise(i).then((function(f){var c=f.keySystem,g=f.mediaKeys;return e.throwIfDestroyed(),e.log("Handle encrypted media sn: "+t.frag.sn+" "+t.frag.type+": "+t.frag.level+" using key "+u),e.attemptSetMediaKeys(c,g).then((function(){return e.throwIfDestroyed(),e.createMediaKeySessionContext({keySystem:c,mediaKeys:g,decryptdata:i})}))})).then((function(f){var c=i.pssh?i.pssh.buffer:null;return e.generateRequestWithPreferredKeySession(f,"cenc",c,"playlist-key")}));return h.catch((function(f){return e.handleError(f,t.frag)})),this.keyIdToKeySessionPromise[n]=h,h}return d.catch((function(f){if(f instanceof $t){var c=ft({},f.data);e.getKeyStatus(i)==="internal-error"&&(c.decryptdata=i);var g=new $t(c,f.message);e.handleError(g,t.frag)}})),d},r.throwIfDestroyed=function(t){if(!this.hls)throw new Error("invalid state")},r.handleError=function(t,e){if(this.hls)if(t instanceof $t){e&&(t.data.frag=e);var i=t.data.decryptdata;this.error(t.message+(i?" ("+Vt(i.keyId||[])+")":"")),this.hls.trigger(y.ERROR,t.data)}else this.error(t.message),this.hls.trigger(y.ERROR,{type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0})},r.getKeySystemForKeyPromise=function(t){var e=Qr(t),i=this.keyIdToKeySessionPromise[e];if(!i){var n=Fr(t.keyFormat),o=n?[n]:ur(this.config);return this.attemptKeySystemAccess(o)}return i},r.getKeySystemSelectionPromise=function(t){if(t.length||(t=ur(this.config)),t.length===0)throw new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+Et({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(t)},r.attemptSetMediaKeys=function(t,e){var i=this;if(this.mediaKeys===e)return Promise.resolve();var n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+t+'"');var o=Promise.all(n).then((function(){if(!i.media)throw i.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(e)}));return this.mediaKeys=e,this.setMediaKeysQueue.push(o),o.then((function(){i.log('Media-keys set for "'+t+'"'),n.push(o),i.setMediaKeysQueue=i.setMediaKeysQueue.filter((function(l){return n.indexOf(l)===-1}))}))},r.generateRequestWithPreferredKeySession=function(t,e,i,n){var o,l=this,u=(o=this.config.drmSystems)==null||(o=o[t.keySystem])==null?void 0:o.generateRequest;if(u)try{var d=u.call(this.hls,e,i,t);if(!d)throw new Error("Invalid response from configured generateRequest filter");e=d.initDataType,i=d.initData?d.initData:null,t.decryptdata.pssh=i?new Uint8Array(i):null}catch(E){if(this.warn(E.message),this.hls&&this.hls.config.debug)throw E}if(i===null)return this.log('Skipping key-session request for "'+n+'" (no initData)'),Promise.resolve(t);var h=Qr(t.decryptdata),f=t.decryptdata.uri;this.log('Generating key-session request for "'+n+'" keyId: '+h+" URI: "+f+" (init data type: "+e+" length: "+i.byteLength+")");var c=new yr,g=t._onmessage=function(E){var T=t.mediaKeysSession;if(T){var S=E.messageType,R=E.message;l.log('"'+S+'" message event for session "'+T.sessionId+'" message size: '+R.byteLength),S==="license-request"||S==="license-renewal"?l.renewLicense(t,R).catch((function(A){c.eventNames().length?c.emit("error",A):l.handleError(A)})):S==="license-release"?t.keySystem===kt.FAIRPLAY&&l.updateKeySession(t,_i("acknowledged")).then((function(){return l.removeSession(t)})).catch((function(A){return l.handleError(A)})):l.warn('unhandled media key message type "'+S+'"')}else c.emit("error",new Error("invalid state"))},v=function(E,T){var S;T.keyStatus=E,E.startsWith("usable")?c.emit("resolved"):E==="internal-error"||E==="output-restricted"||E==="output-downscaled"?S=$s(E,T.decryptdata):E==="expired"?S=new Error("key expired (keyId: "+h+")"):E==="released"?S=new Error("key released"):E==="status-pending"||l.warn('unhandled key status change "'+E+'" (keyId: '+h+")"),S&&(c.eventNames().length?c.emit("error",S):l.handleError(S))},m=t._onkeystatuseschange=function(E){if(t.mediaKeysSession){var T=l.getKeyStatuses(t);if(Object.keys(T).some((function(A){return T[A]!=="status-pending"}))){if(T[h]==="expired")return l.log("Expired key "+Et(T)+' in key-session "'+t.mediaKeysSession.sessionId+'"'),void l.renewKeySession(t);var S,R=T[h];R?v(R,t):(t.keyStatusTimeouts||(t.keyStatusTimeouts={}),(S=t.keyStatusTimeouts)[h]||(S[h]=self.setTimeout((function(){if(t.mediaKeysSession&&l.mediaKeys){var A=l.getKeyStatus(t.decryptdata);if(A&&A!=="status-pending")return l.log("No status for keyId "+h+' in key-session "'+t.mediaKeysSession.sessionId+'". Using session key-status '+A+" from other session."),v(A,t);l.log("key status for "+h+' in key-session "'+t.mediaKeysSession.sessionId+'" timed out after 0ms'),v(R="internal-error",t)}}),0)),l.log("No status for keyId "+h+" ("+Et(T)+")."))}}else c.emit("error",new Error("invalid state"))};Bt(t.mediaKeysSession,"message",g),Bt(t.mediaKeysSession,"keystatuseschange",m);var p=new Promise((function(E,T){c.on("error",T),c.on("resolved",E)}));return t.mediaKeysSession.generateRequest(e,i).then((function(){l.log('Request generated for key-session "'+t.mediaKeysSession.sessionId+'" keyId: '+h+" URI: "+f)})).catch((function(E){throw new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_NO_SESSION,error:E,decryptdata:t.decryptdata,fatal:!1},"Error generating key-session request: "+E)})).then((function(){return p})).catch((function(E){return c.removeAllListeners(),l.removeSession(t).then((function(){throw E}))})).then((function(){return c.removeAllListeners(),t}))},r.getKeyStatuses=function(t){var e=this,i={};return t.mediaKeysSession.keyStatuses.forEach((function(n,o){if(typeof o=="string"&&typeof n=="object"){var l=o;o=n,n=l}var u="buffer"in o?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):new Uint8Array(o);t.keySystem===kt.PLAYREADY&&u.length===16&&wa(u);var d=Vt(u);n==="internal-error"&&(e.bannedKeyIds[d]=n),e.log('key status change "'+n+'" for keyStatuses keyId: '+d+' key-session "'+t.mediaKeysSession.sessionId+'"'),i[d]=n})),i},r.fetchServerCertificate=function(t){var e=this.config,i=new e.loader(e),n=this.getServerCertificateUrl(t);return n?(this.log('Fetching server certificate for "'+t+'"'),new Promise((function(o,l){var u={responseType:"arraybuffer",url:n},d=e.certLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:function(c,g,v,m){o(c.data)},onError:function(c,g,v,m){l(new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:ft({url:u.url,data:void 0},c)},'"'+t+'" certificate request failed ('+n+"). Status: "+c.code+" ("+c.text+")"))},onTimeout:function(c,g,v){l(new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:u.url,data:void 0}},'"'+t+'" certificate request timed out ('+n+")"))},onAbort:function(c,g,v){l(new Error("aborted"))}};i.load(u,h,f)}))):Promise.resolve()},r.setMediaKeysServerCertificate=function(t,e,i){var n=this;return new Promise((function(o,l){t.setServerCertificate(i).then((function(u){n.log("setServerCertificate "+(u?"success":"not supported by CDM")+" ("+i.byteLength+') on "'+e+'"'),o(t)})).catch((function(u){l(new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:u,fatal:!0},u.message))}))}))},r.renewLicense=function(t,e){var i=this;return this.requestLicense(t,new Uint8Array(e)).then((function(n){return i.updateKeySession(t,new Uint8Array(n)).catch((function(o){throw new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:t.decryptdata,error:o,fatal:!1},o.message)}))}))},r.unpackPlayReadyKeyMessage=function(t,e){var i=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!i.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;var n=new DOMParser().parseFromString(i,"application/xml"),o=n.querySelectorAll("HttpHeader");if(o.length>0)for(var l,u=0,d=o.length;u<d;u++){var h,f,c=(h=(l=o[u]).querySelector("name"))==null?void 0:h.textContent,g=(f=l.querySelector("value"))==null?void 0:f.textContent;c&&g&&t.setRequestHeader(c,g)}var v=n.querySelector("Challenge"),m=v?.textContent;if(!m)throw new Error("Cannot find <Challenge> in key message");return _i(atob(m))},r.setupLicenseXHR=function(t,e,i,n){var o=this,l=this.config.licenseXhrSetup;return l?Promise.resolve().then((function(){if(!i.decryptdata)throw new Error("Key removed");return l.call(o.hls,t,e,i,n)})).catch((function(u){if(!i.decryptdata)throw u;return t.open("POST",e,!0),l.call(o.hls,t,e,i,n)})).then((function(u){return t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:u||n}})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:n}))},r.requestLicense=function(t,e){var i=this,n=this.config.keyLoadPolicy.default;return new Promise((function(o,l){var u=i.getLicenseServerUrlOrThrow(t.keySystem);i.log("Sending license request to URL: "+u);var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=function(){if(!i.hls||!t.mediaKeysSession)return l(new Error("invalid state"));if(d.readyState===4)if(d.status===200){i._requestLicenseFailureCount=0;var h=d.response;i.log("License received "+(h instanceof ArrayBuffer?h.byteLength:h));var f=i.config.licenseResponseCallback;if(f)try{h=f.call(i.hls,d,u,t)}catch(m){i.error(m)}o(h)}else{var c=n.errorRetry,g=c?c.maxNumRetry:0;if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>g||d.status>=400&&d.status<500)l(new $t({type:K.KEY_SYSTEM_ERROR,details:_.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:t.decryptdata,fatal:!0,networkDetails:d,response:{url:u,data:void 0,code:d.status,text:d.statusText}},"License Request XHR failed ("+u+"). Status: "+d.status+" ("+d.statusText+")"));else{var v=g-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+v+" attempts left"),i.requestLicense(t,e).then(o,l)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=d,i.setupLicenseXHR(d,u,t,e).then((function(h){var f=h.xhr,c=h.licenseChallenge;t.keySystem==kt.PLAYREADY&&(c=i.unpackPlayReadyKeyMessage(f,c)),f.send(c)})).catch(l)}))},r.onDestroying=function(){this.unregisterListeners(),this._clear()},r.onMediaAttached=function(t,e){if(this.config.emeEnabled){var i=e.media;this.media=i,Bt(i,"encrypted",this.onMediaEncrypted),Bt(i,"waitingforkey",this.onWaitingForKey)}},r.onMediaDetached=function(){var t=this.media;t&&(Ht(t,"encrypted",this.onMediaEncrypted),Ht(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)},r._clear=function(){var t,e=this;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={},this.mediaKeys||this.mediaKeySessions.length){var i=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ma.clearKeyUriToKeyIdMap();var o=n.length;s.CDMCleanupPromise=Promise.all(n.map((function(l){return e.removeSession(l)})).concat((i==null||(t=i.setMediaKeys(null))==null?void 0:t.catch((function(l){e.log("Could not clear media keys: "+l),e.hls&&e.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: "+l)})})))||Promise.resolve())).catch((function(l){e.log("Could not close sessions and clear media keys: "+l),e.hls&&e.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: "+l)})})).then((function(){o&&e.log("finished closing key sessions and clearing media keys")}))}},r.onManifestLoading=function(){this.keyFormatPromise=null,this.bannedKeyIds={}},r.onManifestLoaded=function(t,e){var i=e.sessionKeys;if(i&&this.config.emeEnabled&&!this.keyFormatPromise){var n=i.reduce((function(o,l){return o.indexOf(l.keyFormat)===-1&&o.push(l.keyFormat),o}),[]);this.log("Selecting key-system from session-keys "+n.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(n)}},r.removeSession=function(t){var e=this,i=t.mediaKeysSession,n=t.licenseXhr,o=t.decryptdata;if(i){this.log('Remove licenses and keys and close session "'+i.sessionId+'" keyId: '+Vt(o?.keyId||[])),t._onmessage&&(i.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;var l=this.mediaKeySessions.indexOf(t);l>-1&&this.mediaKeySessions.splice(l,1);var u=t.keyStatusTimeouts;u&&Object.keys(u).forEach((function(h){return self.clearTimeout(u[h])}));var d=(function(h){var f;return!(!h||h.sessionType!=="persistent-license"&&((f=h.sessionTypes)==null||!f.some((function(c){return c==="persistent-license"}))))})(this.config.drmSystemOptions)?new Promise((function(h,f){self.setTimeout((function(){return f(new Error("MediaKeySession.remove() timeout"))}),8e3),i.remove().then(h).catch(f)})):Promise.resolve();return d.catch((function(h){e.log("Could not remove session: "+h),e.hls&&e.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: "+h)})})).then((function(){return i.close()})).catch((function(h){e.log("Could not close session: "+h),e.hls&&e.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: "+h)})}))}return Promise.resolve()},s})(ee);function Qr(a){if(!a)throw new Error("Could not read keyId of undefined decryptdata");if(a.keyId===null)throw new Error("keyId is null");return Vt(a.keyId)}function Ru(a,s){return a.keyId&&s.mediaKeysSession.keyStatuses.has(a.keyId)?s.mediaKeysSession.keyStatuses.get(a.keyId):a.matches(s.decryptdata)?s.keyStatus:void 0}Qs.CDMCleanupPromise=void 0;var $t=(function(a){function s(r,t){var e;return(e=a.call(this,t)||this).data=void 0,r.error||(r.error=new Error(t)),e.data=r,r.err=r.error,e}return ut(s,a),s})(Be(Error));function $s(a,s){var r=a==="output-restricted",t=r?_.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:_.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new $t({type:K.KEY_SYSTEM_ERROR,details:t,fatal:!1,decryptdata:s},r?"HDCP level output restricted":'key status changed to "'+a+'"')}var ku=(function(){function a(r){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=r,this.registerListeners()}var s=a.prototype;return s.setStreamController=function(r){this.streamController=r},s.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},s.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},s.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},s.onMediaAttaching=function(r,t){var e=this.hls.config;if(e.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod)}},s.onMediaDetaching=function(){this.media=null},s.checkFPS=function(r,t,e){var i=performance.now();if(t){if(this.lastTime){var n=i-this.lastTime,o=e-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*o/n,d=this.hls;if(d.trigger(y.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:e}),u>0&&o>d.config.fpsDroppedMonitoringThreshold*l){var h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h-=1,d.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=e,this.lastDecodedFrames=t}},s.checkFPSInterval=function(){var r=this.media;if(r)if(this.isVideoPlaybackQualityAvailable){var t=r.getVideoPlaybackQuality();this.checkFPS(r,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)},a})();function pr(a){for(var s=5381,r=a.length;r;)s=33*s^a.charCodeAt(--r);return(s>>>0).toString()}var $e=.025,$r=(function(a){return a[a.Point=0]="Point",a[a.Range=1]="Range",a})({});function bu(a,s,r){return a.identifier+"-"+(r+1)+"-"+pr(s)}var Du=(function(){function a(r,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=r,this.setDateRange(r)}var s=a.prototype;return s.setDateRange=function(r){this.dateRange=r,this.resumeOffset=r.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=r.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=r.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=r.attr.enumeratedStringList("X-SNAP",this.snapOptions)},s.reset=function(){var r;this.appendInPlaceStarted=!1,(r=this.assetListLoader)==null||r.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)},s.isAssetPastPlayoutLimit=function(r){var t;if(r>0&&r>=this.assetList.length)return!0;var e=this.playoutLimit;return!(r<=0||isNaN(e))&&(e===0||(((t=this.assetList[r])==null?void 0:t.startOffset)||0)>e)},s.findAssetIndex=function(r){return this.assetList.indexOf(r)},s.toString=function(){return'["'+(r=this).identifier+'" '+(r.cue.pre?"<pre>":r.cue.post?"<post>":"")+r.timelineStart.toFixed(2)+"-"+r.resumeTime.toFixed(2)+"]";var r},yt(a,[{key:"identifier",get:function(){return this.dateRange.id}},{key:"startDate",get:function(){return this.dateRange.startDate}},{key:"startTime",get:function(){var r=this.dateRange.startTime;if(this.snapOptions.out){var t=this.dateRange.tagAnchor;if(t)return on(r,t)}return r}},{key:"startOffset",get:function(){return this.cue.pre?0:this.startTime}},{key:"startIsAligned",get:function(){if(this.startTime===0||this.snapOptions.out)return!0;var r=this.dateRange.tagAnchor;if(r){var t=this.dateRange.startTime;return t-on(t,r)<.1}return!1}},{key:"resumptionOffset",get:function(){var r=this.resumeOffset,t=B(r)?r:this.duration;return this.cumulativeDuration+t}},{key:"resumeTime",get:function(){var r=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){var t=this.resumeAnchor;if(t)return on(r,t)}return r}},{key:"appendInPlace",get:function(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<$e))},set:function(r){this.appendInPlaceStarted?this.resetOnResume=!r:this.appendInPlaceDisabled=!r}},{key:"timelineStart",get:function(){return this._timelineStart!==null?this._timelineStart:this.startTime},set:function(r){this._timelineStart=r}},{key:"duration",get:function(){var r,t=this.playoutLimit;return r=this._duration!==null?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<r&&(r=t),r},set:function(r){this._duration=r}},{key:"cue",get:function(){return this.dateRange.cue}},{key:"timelineOccupancy",get:function(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?$r.Range:$r.Point}},{key:"supplementsPrimary",get:function(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}},{key:"contentMayVary",get:function(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}},{key:"assetUrl",get:function(){return this.dateRange.attr["X-ASSET-URI"]}},{key:"assetListUrl",get:function(){return this.dateRange.attr["X-ASSET-LIST"]}},{key:"baseUrl",get:function(){return this.base.url}},{key:"assetListLoaded",get:function(){return this.assetList.length>0||this.assetListResponse!==null}}])})();function on(a,s){return a-s.start<s.duration/2&&!(Math.abs(a-(s.start+s.duration))<$e)?s.start:s.start+s.duration}function Zs(a,s,r){var t=new self.URL(a,r);return t.protocol!=="data:"&&t.searchParams.set("_HLS_primary_id",s),t}function ln(a,s){for(;(r=a.assetList[++s])!=null&&r.error;)var r;return s}function Ze(a){var s=a.timelineStart,r=a.duration||0;return'["'+a.identifier+'" '+s.toFixed(2)+"-"+(s+r).toFixed(2)+"]"}var _u=(function(){function a(r,t,e,i){var n=this;this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=function(){n.reachedPlayout(n.currentTime)&&n.hls&&n.hls.trigger(y.PLAYOUT_LIMIT_REACHED,{})};var o=this.hls=new r(t);this.interstitial=e,this.assetItem=i;var l=function(){n.hasDetails=!0};o.once(y.LEVEL_LOADED,l),o.once(y.AUDIO_TRACK_LOADED,l),o.once(y.SUBTITLE_TRACK_LOADED,l),o.on(y.MEDIA_ATTACHING,(function(u,d){var h=d.media;n.removeMediaListeners(),n.mediaAttached=h,n.interstitial.playoutLimit&&(h.addEventListener("timeupdate",n.checkPlayout),n.appendInPlace&&o.on(y.BUFFER_APPENDED,(function(){var f=n.bufferedEnd;n.reachedPlayout(f)&&(n._bufferedEosTime=f,o.trigger(y.BUFFERED_TO_END,void 0))})))}))}var s=a.prototype;return s.loadSource=function(){var r=this.hls;if(r)if(r.url)r.levels.length&&!r.started&&r.startLoad(-1,!0);else{var t=this.assetItem.uri;try{t=Zs(t,r.config.primarySessionId||"").href}catch{}r.loadSource(t)}},s.bufferedInPlaceToEnd=function(r){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!r)return!1;var e=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,n=tt.bufferInfo(r,i,0);return this.getAssetTime(n.end)>=e-.02},s.reachedPlayout=function(r){var t=this.interstitial.playoutLimit;return this.startOffset+r>=t},s.getAssetTime=function(r){var t=this.timelineOffset,e=this.duration;return Math.min(Math.max(0,r-t),e)},s.removeMediaListeners=function(){var r=this.mediaAttached;r&&(this._currentTime=r.currentTime,this.bufferSnapShot(),r.removeEventListener("timeupdate",this.checkPlayout))},s.bufferSnapShot=function(){var r;this.mediaAttached&&(r=this.hls)!=null&&r.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)},s.destroy=function(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null},s.attachMedia=function(r){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(r)},s.detachMedia=function(){var r;this.removeMediaListeners(),this.mediaAttached=null,(r=this.hls)==null||r.detachMedia()},s.resumeBuffering=function(){var r;(r=this.hls)==null||r.resumeBuffering()},s.pauseBuffering=function(){var r;(r=this.hls)==null||r.pauseBuffering()},s.transferMedia=function(){var r;return this.bufferSnapShot(),((r=this.hls)==null?void 0:r.transferMedia())||null},s.resetDetails=function(){var r=this.hls;if(r&&this.hasDetails){r.stopLoad();var t=function(e){return delete e.details};r.levels.forEach(t),r.allAudioTracks.forEach(t),r.allSubtitleTracks.forEach(t),this.hasDetails=!1}},s.on=function(r,t,e){var i;(i=this.hls)==null||i.on(r,t)},s.once=function(r,t,e){var i;(i=this.hls)==null||i.once(r,t)},s.off=function(r,t,e){var i;(i=this.hls)==null||i.off(r,t)},s.toString=function(){var r;return"HlsAssetPlayer: "+Ze(this.assetItem)+" "+((r=this.hls)==null?void 0:r.sessionId)+" "+(this.appendInPlace?"append-in-place":"")},yt(a,[{key:"appendInPlace",get:function(){return this.interstitial.appendInPlace}},{key:"destroyed",get:function(){var r;return!((r=this.hls)!=null&&r.userConfig)}},{key:"assetId",get:function(){return this.assetItem.identifier}},{key:"interstitialId",get:function(){return this.assetItem.parentIdentifier}},{key:"media",get:function(){var r;return((r=this.hls)==null?void 0:r.media)||null}},{key:"bufferedEnd",get:function(){var r=this.media||this.mediaAttached;if(!r)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;var t=tt.bufferInfo(r,r.currentTime,.001);return this.getAssetTime(t.end)}},{key:"currentTime",get:function(){var r=this.media||this.mediaAttached;return r?this.getAssetTime(r.currentTime):this._currentTime||0}},{key:"duration",get:function(){var r=this.assetItem.duration;if(!r)return 0;var t=this.interstitial.playoutLimit;if(t){var e=t-this.startOffset;if(e>0&&e<r)return e}return r}},{key:"remaining",get:function(){var r=this.duration;return r?Math.max(0,r-this.currentTime):0}},{key:"startOffset",get:function(){return this.assetItem.startOffset}},{key:"timelineOffset",get:function(){var r;return((r=this.hls)==null?void 0:r.config.timelineOffset)||0},set:function(r){var t=this.timelineOffset;if(r!==t){var e=r-t;if(Math.abs(e)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=r}}}}])})(),Pu=(function(a){function s(t,e){var i;return(i=a.call(this,"interstitials-sched",e)||this).onScheduleUpdate=void 0,i.eventMap={},i.events=null,i.items=null,i.durations={primary:0,playout:0,integrated:0},i.onScheduleUpdate=t,i}ut(s,a);var r=s.prototype;return r.destroy=function(){this.reset(),this.onScheduleUpdate=null},r.reset=function(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach((function(t){return t.reset()})),this.events=this.items=null},r.resetErrorsInRange=function(t,e){return this.events?this.events.reduce((function(i,n){return t<=n.startOffset&&e>n.startOffset?(delete n.error,i+1):i}),0):0},r.getEvent=function(t){return t&&this.eventMap[t]||null},r.hasEvent=function(t){return t in this.eventMap},r.findItemIndex=function(t,e){if(t.event)return this.findEventIndex(t.event.identifier);var i=-1;t.nextEvent?i=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(i=this.findEventIndex(t.previousEvent.identifier)+1);var n=this.items;if(n)for(n[i]||(e===void 0&&(e=t.start),i=this.findItemIndexAtTime(e));i>=0&&(o=n[i])!=null&&o.event;){var o;i--}return i},r.findItemIndexAtTime=function(t,e){var i=this.items;if(i)for(var n=0;n<i.length;n++){var o=i[n];if(e&&e!=="primary"&&(o=o[e]),t===o.start||t>o.start&&t<o.end)return n}return-1},r.findJumpRestrictedIndex=function(t,e){var i=this.items;if(i)for(var n=t;n<=e&&i[n];n++){var o=i[n].event;if(o!=null&&o.restrictions.jump&&!o.appendInPlace)return n}return-1},r.findEventIndex=function(t){var e=this.items;if(e)for(var i=e.length;i--;){var n;if(((n=e[i].event)==null?void 0:n.identifier)===t)return i}return-1},r.findAssetIndex=function(t,e){var i=t.assetList,n=i.length;if(n>1)for(var o=0;o<n;o++){var l=i[o];if(!l.error){var u=l.timelineStart;if(e===u||e>u&&(e<u+(l.duration||0)||o===n-1))return o}}return 0},r.parseInterstitialDateRanges=function(t,e){var i=this,n=t.main.details,o=n.dateRanges,l=this.events,u=this.parseDateRanges(o,{url:n.url},e),d=Object.keys(o),h=l?l.filter((function(f){return!d.includes(f.identifier)})):[];u.length&&u.sort((function(f,c){var g=f.cue.pre,v=f.cue.post,m=c.cue.pre,p=c.cue.post;if(g&&!m)return-1;if(m&&!g||v&&!p)return 1;if(p&&!v)return-1;if(!(g||m||v||p)){var E=f.startTime,T=c.startTime;if(E!==T)return E-T}return f.dateRange.tagOrder-c.dateRange.tagOrder})),this.events=u,h.forEach((function(f){i.removeEvent(f)})),this.updateSchedule(t,h)},r.updateSchedule=function(t,e,i){e===void 0&&(e=[]),i===void 0&&(i=!1);var n=this.events||[];if(n.length||e.length||this.length<2){var o=this.items,l=this.parseSchedule(n,t);(i||e.length||o?.length!==l.length||l.some((function(u,d){return Math.abs(u.playout.start-o[d].playout.start)>.005||Math.abs(u.playout.end-o[d].playout.end)>.005})))&&(this.items=l,this.onScheduleUpdate(e,o))}},r.parseDateRanges=function(t,e,i){for(var n=[],o=Object.keys(t),l=0;l<o.length;l++){var u=o[l],d=t[u];if(d.isInterstitial){var h=this.eventMap[u];h?h.setDateRange(d):(h=new Du(d,e),this.eventMap[u]=h,i===!1&&(h.appendInPlace=i)),n.push(h)}}return n},r.parseSchedule=function(t,e){var i=[],n=e.main.details,o=n.live?1/0:n.edge,l=0;if((t=t.filter((function(m){return!(m.error||m.cue.once&&m.hasPlayed)}))).length){this.resolveOffsets(t,e);var u=0,d=0;if(t.forEach((function(m,p){var E=m.cue.pre,T=m.cue.post,S=t[p-1]||null,R=m.appendInPlace,A=T?o:m.startOffset,L=m.duration,b=m.timelineOccupancy===$r.Range?L:0,k=m.resumptionOffset,I=S?.startTime===A,D=A+m.cumulativeDuration,P=R?D+L:A+k;if(E||!T&&A<=0){var M=d;d+=b,m.timelineStart=D;var O=l;l+=L,i.push({event:m,start:D,end:P,playout:{start:O,end:l},integrated:{start:M,end:d}})}else{if(!(A<=o))return;if(!I){var w=A-u;if(w>.033){var F=u,x=d;d+=w;var N=l;l+=w;var H={previousEvent:t[p-1]||null,nextEvent:m,start:F,end:F+w,playout:{start:N,end:l},integrated:{start:x,end:d}};i.push(H)}else w>0&&S&&(S.cumulativeDuration+=w,i[i.length-1].end=A)}T&&(P=D),m.timelineStart=D;var U=d;d+=b;var G=l;l+=L,i.push({event:m,start:D,end:P,playout:{start:G,end:l},integrated:{start:U,end:d}})}var X=m.resumeTime;u=T||X>o?o:X})),u<o){var h,f=u,c=d,g=o-u;d+=g;var v=l;l+=g,i.push({previousEvent:((h=i[i.length-1])==null?void 0:h.event)||null,nextEvent:null,start:u,end:f+g,playout:{start:v,end:l},integrated:{start:c,end:d}})}this.setDurations(o,l,d)}else i.push({previousEvent:null,nextEvent:null,start:0,end:o,playout:{start:0,end:o},integrated:{start:0,end:o}}),this.setDurations(o,o,o);return i},r.setDurations=function(t,e,i){this.durations={primary:t,playout:e,integrated:i}},r.resolveOffsets=function(t,e){var i=this,n=e.main.details,o=n.live?1/0:n.edge,l=0,u=-1;t.forEach((function(d,h){var f=d.cue.pre,c=d.cue.post,g=f?0:c?o:d.startTime;i.updateAssetDurations(d),u===g?d.cumulativeDuration=l:(l=0,u=g),!c&&d.snapOptions.in&&(d.resumeAnchor=Ce(null,n.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted&&(i.primaryCanResumeInPlaceAt(d,e)||(d.appendInPlace=!1)),!d.appendInPlace&&h+1<t.length&&t[h+1].startTime-t[h].resumeTime<.033&&(t[h+1].appendInPlace=!1,t[h+1].appendInPlace&&i.warn("Could not change append strategy for abutting event "+d));var v=B(d.resumeOffset)?d.resumeOffset:d.duration;l+=v}))},r.primaryCanResumeInPlaceAt=function(t,e){var i=this,n=t.resumeTime,o=t.startTime+t.resumptionOffset;return Math.abs(n-o)>$e?(this.log('"'+t.identifier+'" resumption '+n+" not aligned with estimated timeline end "+o),!1):!Object.keys(e).some((function(l){var u=e[l].details,d=u.edge;if(n>=d)return i.log('"'+t.identifier+'" resumption '+n+" past "+l+" playlist end "+d),!1;var h=Ce(null,u.fragments,n);if(!h)return i.log('"'+t.identifier+'" resumption '+n+" does not align with any fragments in "+l+" playlist ("+u.fragStart+"-"+u.fragmentEnd+")"),!0;var f=l==="audio"?.175:0;return!(Math.abs(h.start-n)<$e+f||Math.abs(h.end-n)<$e+f||(i.log('"'+t.identifier+'" resumption '+n+" not aligned with "+l+" fragment bounds ("+h.start+"-"+h.end+" sn: "+h.sn+" cc: "+h.cc+")"),0))}))},r.updateAssetDurations=function(t){if(t.assetListLoaded){for(var e=t.timelineStart,i=0,n=!1,o=!1,l=0;l<t.assetList.length;l++){var u=t.assetList[l],d=e+i;u.startOffset=i,u.timelineStart=d,n||(n=u.duration===null),o||(o=!!u.error),i+=u.error?0:u.duration||0}t.duration=n&&!o?Math.max(i,t.duration):i}},r.removeEvent=function(t){t.reset(),delete this.eventMap[t.identifier]},yt(s,[{key:"duration",get:function(){var t=this.items;return t?t[t.length-1].end:0}},{key:"length",get:function(){return this.items?this.items.length:0}},{key:"assetIdAtEnd",get:function(){var t,e=(t=this.items)==null||(t=t[this.length-1])==null?void 0:t.event;if(e){var i=e.assetList,n=i[i.length-1];if(n)return n.identifier}return null}}])})(ee);function se(a){return"["+(a.event?'"'+a.event.identifier+'"':"primary")+": "+a.start.toFixed(2)+"-"+a.end.toFixed(2)+"]"}var Cu=(function(){function a(r){this.hls=void 0,this.hls=r}var s=a.prototype;return s.destroy=function(){this.hls=null},s.loadAssetList=function(r,t){var e,i=this,n=r.assetListUrl;try{e=Zs(n,this.hls.sessionId,r.baseUrl)}catch(g){var o=this.assignAssetListError(r,_.ASSET_LIST_LOAD_ERROR,g,n);return void this.hls.trigger(y.ERROR,o)}t&&e.protocol!=="data:"&&e.searchParams.set("_HLS_start_offset",""+t);var l=this.hls.config,u=new l.loader(l),d={responseType:"json",url:e.href},h=l.interstitialAssetListLoadPolicy.default,f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(g,v,m,p){var E=g.data,T=E?.ASSETS;if(Array.isArray(T))r.assetListResponse=E,i.hls.trigger(y.ASSET_LIST_LOADED,{event:r,assetListResponse:E,networkDetails:p});else{var S=i.assignAssetListError(r,_.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,v,p);i.hls.trigger(y.ERROR,S)}},onError:function(g,v,m,p){var E=i.assignAssetListError(r,_.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status "+g.code+" "+g.text+" ("+v.url+")"),v.url,p,m);i.hls.trigger(y.ERROR,E)},onTimeout:function(g,v,m){var p=i.assignAssetListError(r,_.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST ("+v.url+")"),v.url,g,m);i.hls.trigger(y.ERROR,p)}};return u.load(d,f,c),this.hls.trigger(y.ASSET_LIST_LOADING,{event:r}),u},s.assignAssetListError=function(r,t,e,i,n,o){return r.error=e,{type:K.NETWORK_ERROR,details:t,fatal:!1,interstitial:r,url:i,error:e,networkDetails:o,stats:n}},a})();function Js(a){a?.play().catch((function(){}))}function Zr(a,s){return"["+a+"] Advancing timeline position to "+s}var wu=(function(a){function s(t,e){var i;return(i=a.call(this,"interstitials",t.logger)||this).HlsPlayerClass=void 0,i.hls=void 0,i.assetListLoader=void 0,i.mediaSelection=null,i.altSelection=null,i.media=null,i.detachedData=null,i.requiredTracks=null,i.manager=null,i.playerQueue=[],i.bufferedPos=-1,i.timelinePos=-1,i.schedule=void 0,i.playingItem=null,i.bufferingItem=null,i.waitingItem=null,i.endedItem=null,i.playingAsset=null,i.endedAsset=null,i.bufferingAsset=null,i.shouldPlay=!1,i.onPlay=function(){i.shouldPlay=!0},i.onPause=function(){i.shouldPlay=!1},i.onSeeking=function(){var n=i.currentTime;if(n!==void 0&&!i.playbackDisabled&&i.schedule){var o=n-i.timelinePos;if(!(Math.abs(o)<1/7056e5)){var l=o<=-.01;i.timelinePos=n,i.bufferedPos=n;var u=i.playingItem;if(u)if(l&&i.schedule.resetErrorsInRange(n,n-o)&&i.updateSchedule(!0),i.checkBuffer(),l&&n<u.start||n>=u.end){var d,h=i.findItemIndex(u),f=i.schedule.findItemIndexAtTime(n);if(f===-1&&(f=h+(l?-1:1),i.log("seeked "+(l?"back ":"")+"to position not covered by schedule "+n+" (resolving from "+h+" to "+f+")")),!i.isInterstitial(u)&&(d=i.media)!=null&&d.paused&&(i.shouldPlay=!1),!l&&f>h){var c=i.schedule.findJumpRestrictedIndex(h+1,f);if(c>h)return void i.setSchedulePosition(c)}i.setSchedulePosition(f)}else{var g=i.playingAsset;if(g){var v,m=g.timelineStart,p=g.duration||0;(l&&n<m||n>=m+p)&&((v=u.event)!=null&&v.appendInPlace&&(i.clearInterstitial(u.event,u),i.flushFrontBuffer(n)),i.setScheduleToAssetAtTime(n,g))}else if(i.playingLastItem&&i.isInterstitial(u)){var E=u.event.assetList[0];E&&(i.endedItem=i.playingItem,i.playingItem=null,i.setScheduleToAssetAtTime(n,E))}}else i.checkBuffer()}}},i.onTimeupdate=function(){var n=i.currentTime;if(n!==void 0&&!i.playbackDisabled&&n>i.timelinePos){i.timelinePos=n,n>i.bufferedPos&&i.checkBuffer();var o=i.playingItem;if(o&&!i.playingLastItem){if(n>=o.end){i.timelinePos=o.end;var l=i.findItemIndex(o);i.setSchedulePosition(l+1)}var u=i.playingAsset;u&&n>=u.timelineStart+(u.duration||0)&&i.setScheduleToAssetAtTime(n,u)}}},i.onScheduleUpdate=function(n,o){var l=i.schedule;if(l){var u=i.playingItem,d=l.events||[],h=l.items||[],f=l.durations,c=n.map((function(E){return E.identifier})),g=!(!d.length&&!c.length);(g||o)&&i.log("INTERSTITIALS_UPDATED ("+d.length+"): "+d+`
Schedule: `+h.map((function(E){return se(E)}))+" pos: "+i.timelinePos),c.length&&i.log("Removed events "+c);var v=null,m=null;u&&(v=i.updateItem(u,i.timelinePos),i.itemsMatch(u,v)?i.playingItem=v:i.waitingItem=i.endedItem=null),i.waitingItem=i.updateItem(i.waitingItem),i.endedItem=i.updateItem(i.endedItem);var p=i.bufferingItem;if(p&&(m=i.updateItem(p,i.bufferedPos),i.itemsMatch(p,m)?i.bufferingItem=m:p.event&&(i.bufferingItem=i.playingItem,i.clearInterstitial(p.event,null))),n.forEach((function(E){E.assetList.forEach((function(T){i.clearAssetPlayer(T.identifier,null)}))})),i.playerQueue.forEach((function(E){if(E.interstitial.appendInPlace){var T=E.assetItem.timelineStart,S=E.timelineOffset-T;if(S)try{E.timelineOffset=T}catch(R){Math.abs(S)>$e&&i.warn(R+' ("'+E.assetId+'" '+E.timelineOffset+"->"+T+")")}}})),g||o){if(i.hls.trigger(y.INTERSTITIALS_UPDATED,{events:d.slice(0),schedule:h.slice(0),durations:f,removedIds:c}),i.isInterstitial(u)&&c.includes(u.event.identifier))return i.warn('Interstitial "'+u.event.identifier+'" removed while playing'),void i.primaryFallback(u.event);u&&i.trimInPlace(v,u),p&&m!==v&&i.trimInPlace(m,p),i.checkBuffer()}}},i.hls=t,i.HlsPlayerClass=e,i.assetListLoader=new Cu(t),i.schedule=new Pu(i.onScheduleUpdate,t.logger),i.registerListeners(),i}ut(s,a);var r=s.prototype;return r.registerListeners=function(){var t=this.hls;t&&(t.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(y.BUFFER_APPENDED,this.onBufferAppended,this),t.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(y.MEDIA_ENDED,this.onMediaEnded,this),t.on(y.ERROR,this.onError,this),t.on(y.DESTROYING,this.onDestroying,this))},r.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(y.BUFFER_CODECS,this.onBufferCodecs,this),t.off(y.BUFFER_APPENDED,this.onBufferAppended,this),t.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(y.MEDIA_ENDED,this.onMediaEnded,this),t.off(y.ERROR,this.onError,this),t.off(y.DESTROYING,this.onDestroying,this))},r.startLoad=function(){this.resumeBuffering()},r.stopLoad=function(){this.pauseBuffering()},r.resumeBuffering=function(){var t;(t=this.getBufferingPlayer())==null||t.resumeBuffering()},r.pauseBuffering=function(){var t;(t=this.getBufferingPlayer())==null||t.pauseBuffering()},r.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null},r.onDestroying=function(){var t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)},r.removeMediaListeners=function(t){Ht(t,"play",this.onPlay),Ht(t,"pause",this.onPause),Ht(t,"seeking",this.onSeeking),Ht(t,"timeupdate",this.onTimeupdate)},r.onMediaAttaching=function(t,e){var i=this.media=e.media;Bt(i,"seeking",this.onSeeking),Bt(i,"timeupdate",this.onTimeupdate),Bt(i,"play",this.onPlay),Bt(i,"pause",this.onPause)},r.onMediaAttached=function(t,e){var i=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!n){this.clearScheduleState();var o=this.findItemIndex(i);this.setSchedulePosition(o)}},r.clearScheduleState=function(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null},r.onMediaDetaching=function(t,e){var i=!!e.transferMedia,n=this.media;if(this.media=null,!i&&(n&&this.removeMediaListeners(n),this.detachedData)){var o=this.getBufferingPlayer();o&&(this.log("Removing schedule state for detachedData and "+o),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,o.detachMedia()),this.shouldPlay=!1}},r.isInterstitial=function(t){return!(t==null||!t.event)},r.retreiveMediaSource=function(t,e){var i=this.getAssetPlayer(t);i&&this.transferMediaFromPlayer(i,e)},r.transferMediaFromPlayer=function(t,e){var i=t.interstitial.appendInPlace,n=t.media;if(i&&n===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&n)return void(this.detachedData={media:n});var o=t.transferMedia();this.log("transfer MediaSource from "+t+" "+Et(o)),this.detachedData=o}else e&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))},r.transferMediaTo=function(t,e){var i,n,o=this;if(t.media!==e){var l,u=null,d=this.hls,h=t!==d,f=h&&t.interstitial.appendInPlace,c=(i=this.detachedData)==null?void 0:i.mediaSource;if(d.media)f&&(u=d.transferMedia(),this.detachedData=u),l="Primary";else if(c){var g=this.getBufferingPlayer();g?(u=g.transferMedia(),l=""+g):l="detached MediaSource"}else l="detached media";if(!u){if(c)u=this.detachedData,this.log("using detachedData: MediaSource "+Et(u));else if(!this.detachedData||d.media===e){var v=this.playerQueue;v.length>1&&v.forEach((function(S){if(h&&S.interstitial.appendInPlace!==f){var R=S.interstitial;o.clearInterstitial(S.interstitial,null),R.appendInPlace=!1,R.appendInPlace&&o.warn("Could not change append strategy for queued assets "+R)}})),this.hls.detachMedia(),this.detachedData={media:e}}}var m=u&&"mediaSource"in u&&((n=u.mediaSource)==null?void 0:n.readyState)!=="closed",p=m&&u?u:e;this.log((m?"transfering MediaSource":"attaching media")+" to "+(h?t:"Primary")+" from "+l+" (media.currentTime: "+e.currentTime+")");var E=this.schedule;if(p===u&&E){var T=h&&t.assetId===E.assetIdAtEnd;p.overrides={duration:E.duration,endOfStream:!h||T,cueRemoval:!h}}t.attachMedia(p)}},r.onInterstitialCueEnter=function(){this.onTimeupdate()},r.checkStart=function(){var t=this.schedule,e=t?.events;if(e&&!this.playbackDisabled&&this.media){this.bufferedPos===-1&&(this.bufferedPos=0);var i=this.timelinePos,n=this.effectivePlayingItem;if(i===-1){var o=this.hls.startPosition;if(this.log(Zr("checkStart",o)),this.timelinePos=o,e.length&&e[0].cue.pre){var l=t.findEventIndex(e[0].identifier);this.setSchedulePosition(l)}else if(o>=0||!this.primaryLive){var u=this.timelinePos=o>0?o:0,d=t.findItemIndexAtTime(u);this.setSchedulePosition(d)}}else if(n&&!this.playingItem){var h=t.findItemIndex(n);this.setSchedulePosition(h)}}},r.advanceAssetBuffering=function(t,e){var i=t.event,n=i.findAssetIndex(e),o=ln(i,n);if(i.isAssetPastPlayoutLimit(o)){if(this.schedule){var l,u=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(t)+1];u&&this.bufferedToItem(u)}}else this.bufferedToEvent(t,o)},r.advanceAfterAssetEnded=function(t,e,i){var n=ln(t,i);if(t.isAssetPastPlayoutLimit(n)){if(this.schedule){var o=this.schedule.items;if(o){var l=e+1;if(l>=o.length)return void this.setSchedulePosition(-1);var u=t.resumeTime;this.timelinePos<u&&(this.log(Zr("advanceAfterAssetEnded",u)),this.timelinePos=u,t.appendInPlace&&this.advanceInPlace(u),this.checkBuffer(this.bufferedPos<u)),this.setSchedulePosition(l)}}}else{if(t.appendInPlace){var d=t.assetList[n];d&&this.advanceInPlace(d.timelineStart)}this.setSchedulePosition(e,n)}},r.setScheduleToAssetAtTime=function(t,e){var i=this.schedule;if(i){var n=e.parentIdentifier,o=i.getEvent(n);if(o){var l=i.findEventIndex(n),u=i.findAssetIndex(o,t);this.advanceAfterAssetEnded(o,l,u-1)}}},r.setSchedulePosition=function(t,e){var i,n=(i=this.schedule)==null?void 0:i.items;if(n&&!this.playbackDisabled){var o=t>=0?n[t]:null;this.log("setSchedulePosition "+t+", "+e+" ("+(o&&se(o))+") pos: "+this.timelinePos);var l=this.waitingItem||this.playingItem,u=this.playingLastItem;if(this.isInterstitial(l)){var d=l.event,h=this.playingAsset,f=h?.identifier,c=f?this.getAssetPlayer(f):null;if(c&&f&&(!this.eventItemsMatch(l,o)||e!==void 0&&f!==d.assetList[e].identifier)){var g,v=d.findAssetIndex(h);if(this.log("INTERSTITIAL_ASSET_ENDED "+(v+1)+"/"+d.assetList.length+" "+Ze(h)),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(y.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:v,event:d,schedule:n.slice(0),scheduleIndex:t,player:c}),l!==this.playingItem)return void(this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(d,this.findItemIndex(this.playingItem),v));this.retreiveMediaSource(f,o),!c.media||(g=this.detachedData)!=null&&g.mediaSource||c.detachMedia()}if(!this.eventItemsMatch(l,o)&&(this.endedItem=l,this.playingItem=null,this.log("INTERSTITIAL_ENDED "+d+" "+se(l)),d.hasPlayed=!0,this.hls.trigger(y.INTERSTITIAL_ENDED,{event:d,schedule:n.slice(0),scheduleIndex:t}),d.cue.once)){var m;this.updateSchedule();var p=(m=this.schedule)==null?void 0:m.items;if(o&&p){var E=this.findItemIndex(o);this.advanceSchedule(E,p,e,l,u)}return}}this.advanceSchedule(t,n,e,l,u)}},r.advanceSchedule=function(t,e,i,n,o){var l=this,u=this.schedule;if(u){var d=e[t]||null,h=this.primaryMedia,f=this.playerQueue;if(f.length&&f.forEach((function(T){var S=T.interstitial,R=u.findEventIndex(S.identifier);(R<t||R>t+1)&&l.clearInterstitial(S,d)})),this.isInterstitial(d)){this.timelinePos=Math.min(Math.max(this.timelinePos,d.start),d.end);var c=d.event;if(i===void 0){var g=ln(c,(i=u.findAssetIndex(c,this.timelinePos))-1);if(c.isAssetPastPlayoutLimit(g)||c.appendInPlace&&this.timelinePos===d.end)return void this.advanceAfterAssetEnded(c,t,i);i=g}var v=this.waitingItem;this.assetsBuffered(d,h)||this.setBufferingItem(d);var m=this.preloadAssets(c,i);if(this.eventItemsMatch(d,v||n)||(this.waitingItem=d,this.log("INTERSTITIAL_STARTED "+se(d)+" "+(c.appendInPlace?"append in place":"")),this.hls.trigger(y.INTERSTITIAL_STARTED,{event:c,schedule:e.slice(0),scheduleIndex:t})),!c.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading "+c);if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!h)return void this.log("Waiting for attachMedia to start Interstitial "+c);this.waitingItem=this.endedItem=null,this.playingItem=d;var p=c.assetList[i];if(!p)return void this.advanceAfterAssetEnded(c,t,i||0);if(m||(m=this.getAssetPlayer(p.identifier)),m===null||m.destroyed){var E=c.assetList.length;this.warn("asset "+(i+1)+"/"+E+" player destroyed "+c),(m=this.createAssetPlayer(c,p,i)).loadSource()}if(!this.eventItemsMatch(d,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(p))return;this.startAssetPlayer(m,i,e,t,h),this.shouldPlay&&Js(m.media)}else d?(this.resumePrimary(d,t,n),this.shouldPlay&&Js(this.hls.media)):o&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(u.durations.primary,null))}},r.resumePrimary=function(t,e,i){var n,o;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log("resuming "+se(t)),(n=this.detachedData)==null||!n.mediaSource){var l=this.timelinePos;(l<t.start||l>=t.end)&&(l=this.getPrimaryResumption(t,e),this.log(Zr("resumePrimary",l)),this.timelinePos=l),this.attachPrimary(l,t)}if(i){var u=(o=this.schedule)==null?void 0:o.items;u&&(this.log("INTERSTITIALS_PRIMARY_RESUMED "+se(t)),this.hls.trigger(y.INTERSTITIALS_PRIMARY_RESUMED,{schedule:u.slice(0),scheduleIndex:e}),this.checkBuffer())}},r.getPrimaryResumption=function(t,e){var i=t.start;if(this.primaryLive){var n=this.primaryDetails;if(e===0)return this.hls.startPosition;if(n&&(i<n.fragmentStart||i>n.edge))return this.hls.liveSyncPosition||-1}return i},r.isAssetBuffered=function(t){var e=this.getAssetPlayer(t.identifier);return e!=null&&e.hls?e.hls.bufferedToEnd:tt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)},r.attachPrimary=function(t,e,i){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;var n=this.primaryMedia;if(n){var o=this.hls;o.media?this.checkBuffer():(this.transferMediaTo(o,n),i&&this.startLoadingPrimaryAt(t,i)),i||(this.log(Zr("attachPrimary",t)),this.timelinePos=t,this.startLoadingPrimaryAt(t,i))}},r.startLoadingPrimaryAt=function(t,e){var i,n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((i=n.mainForwardBufferInfo)==null?void 0:i.start)||n.media.currentTime)-t)>.5?n.startLoad(t,e):n.bufferingEnabled||n.resumeBuffering()},r.onManifestLoading=function(){var t;this.stopLoad(),(t=this.schedule)==null||t.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(y.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(y.BUFFER_CODECS,this.onBufferCodecs,this)},r.onLevelUpdated=function(t,e){if(e.level!==-1&&this.schedule){var i=this.hls.levels[e.level];if(i.details){var n=ft(ft({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}}},r.onAudioTrackUpdated=function(t,e){var i=this.hls.audioTracks[e.id],n=this.mediaSelection;if(n){var o=ft(ft({},n),{},{audio:i});this.mediaSelection=o}else this.altSelection=ft(ft({},this.altSelection),{},{audio:i})},r.onSubtitleTrackUpdated=function(t,e){var i=this.hls.subtitleTracks[e.id],n=this.mediaSelection;if(n){var o=ft(ft({},n),{},{subtitles:i});this.mediaSelection=o}else this.altSelection=ft(ft({},this.altSelection),{},{subtitles:i})},r.onAudioTrackSwitching=function(t,e){var i=oa(e);this.playerQueue.forEach((function(n){var o=n.hls;return o&&(o.setAudioOption(e)||o.setAudioOption(i))}))},r.onSubtitleTrackSwitch=function(t,e){var i=oa(e);this.playerQueue.forEach((function(n){var o=n.hls;return o&&(o.setSubtitleOption(e)||e.id!==-1&&o.setSubtitleOption(i))}))},r.onBufferCodecs=function(t,e){var i=e.tracks;i&&(this.requiredTracks=i)},r.onBufferAppended=function(t,e){this.checkBuffer()},r.onBufferFlushed=function(t,e){var i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){var n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}},r.onBufferedToEnd=function(t){if(this.schedule){var e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(var i=0;i<e.length;i++){var n=e[i];if(n.cue.post){var o,l=this.schedule.findEventIndex(n.identifier),u=(o=this.schedule.items)==null?void 0:o[l];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}},r.onMediaEnded=function(t){var e=this.playingItem;if(!this.playingLastItem&&e){var i=this.findItemIndex(e);this.setSchedulePosition(i+1)}else this.shouldPlay=!1},r.updateItem=function(t,e){var i,n=(i=this.schedule)==null?void 0:i.items;return t&&n&&n[this.findItemIndex(t,e)]||null},r.trimInPlace=function(t,e){var i=this;if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((function(l,u){t.event.isAssetPastPlayoutLimit(u)&&i.clearAssetPlayer(l.identifier,null)}));var n=t.end+.25,o=tt.bufferInfo(this.primaryMedia,n,0);(o.end>n||(o.nextStart||0)>n)&&(this.log("trim buffered interstitial "+se(t)+" (was "+se(e)+")"),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}},r.itemsMatch=function(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))},r.eventItemsMatch=function(t,e){var i;return!!e&&(t===e||t.event.identifier===((i=e.event)==null?void 0:i.identifier))},r.findItemIndex=function(t,e){return t&&this.schedule?this.schedule.findItemIndex(t,e):-1},r.updateSchedule=function(t){var e;t===void 0&&(t=!1);var i=this.mediaSelection;i&&((e=this.schedule)==null||e.updateSchedule(i,[],t))},r.checkBuffer=function(t){var e,i=(e=this.schedule)==null?void 0:e.items;if(i){var n=tt.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=n.len<1),this.updateBufferedPos(n.end,i,t)}},r.updateBufferedPos=function(t,e,i){var n=this.schedule,o=this.bufferingItem;if(!(this.bufferedPos>t)&&n)if(e.length===1&&this.itemsMatch(e[0],o))this.bufferedPos=t;else{var l=this.playingItem,u=this.findItemIndex(l),d=n.findItemIndexAtTime(t);if(this.bufferedPos<t){var h,f=this.findItemIndex(o),c=Math.min(f+1,e.length-1),g=e[c];if((d===-1&&o&&t>=o.end||(h=g.event)!=null&&h.appendInPlace&&t+.01>=g.start)&&(d=c),this.isInterstitial(o)){var v=o.event;if(c-u>1&&v.appendInPlace===!1||v.assetList.length===0&&v.assetListLoader)return}if(this.bufferedPos=t,d>f&&d>u)this.bufferedToItem(g);else{var m=this.primaryDetails;this.primaryLive&&m&&t>m.edge-m.targetduration&&g.start<m.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(g)&&this.preloadAssets(g.event,0)}}else i&&l&&!this.itemsMatch(l,o)&&(d===u?this.bufferedToItem(l):d===u+1&&this.bufferedToItem(e[d]))}},r.assetsBuffered=function(t,e){var i=this;return t.event.assetList.length!==0&&!t.event.assetList.some((function(n){var o=i.getAssetPlayer(n.identifier);return!(o!=null&&o.bufferedInPlaceToEnd(e))}))},r.setBufferingItem=function(t){var e=this,i=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(t,i)&&n){var o=n.items,l=n.events;if(!o||!l)return i;var u=this.isInterstitial(t),d=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));var h=d?d.remaining:i?i.end-this.timelinePos:0;if(this.log("INTERSTITIALS_BUFFERED_TO_BOUNDARY "+se(t)+(i?" ("+h.toFixed(2)+" remaining)":"")),!this.playbackDisabled)if(u){var f=n.findAssetIndex(t.event,this.bufferedPos);t.event.assetList.forEach((function(c,g){var v=e.getAssetPlayer(c.identifier);v&&(g===f&&v.loadSource(),v.resumeBuffering())}))}else this.hls.resumeBuffering(),this.playerQueue.forEach((function(c){return c.pauseBuffering()}));this.hls.trigger(y.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:o.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==t&&(this.bufferingItem=t);return i},r.bufferedToItem=function(t,e){e===void 0&&(e=0);var i=this.setBufferingItem(t);if(!this.playbackDisabled){if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(i!==null){this.bufferingAsset=null;var n=this.detachedData;n&&n.mediaSource?this.attachPrimary(t.start,t,!0):this.preloadPrimary(t)}}},r.preloadPrimary=function(t){var e=this.findItemIndex(t),i=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(i)},r.bufferedToEvent=function(t,e){var i=t.event,n=i.assetList.length===0&&!i.assetListLoader,o=i.cue.once;if(n||!o){var l=this.preloadAssets(i,e);if(l!=null&&l.interstitial.appendInPlace){var u=this.primaryMedia;u&&this.bufferAssetPlayer(l,u)}}},r.preloadAssets=function(t,e){var i=t.assetUrl,n=t.assetList.length,o=n===0&&!t.assetListLoader,l=t.cue.once;if(o){var u,d=t.timelineStart;if(t.appendInPlace){var h,f=this.playingItem;this.isInterstitial(f)||(f==null||(h=f.nextEvent)==null?void 0:h.identifier)!==t.identifier||this.flushFrontBuffer(d+.25)}var c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition)===-1&&(c=this.hls.liveSyncPosition||0),c&&!t.cue.pre&&!t.cue.post){var g=c-d;g>0&&(u=Math.round(1e3*g)/1e3)}if(this.log("Load interstitial asset "+(e+1)+"/"+(i?1:n)+" "+t+(u?" live-start: "+c+" start-offset: "+u:"")),i)return this.createAsset(t,0,0,d,t.duration,i);var v=this.assetListLoader.loadAssetList(t,u);v&&(t.assetListLoader=v)}else if(!l&&n){for(var m=e;m<n;m++){var p=t.assetList[m],E=this.getAssetPlayerQueueIndex(p.identifier);E!==-1&&!this.playerQueue[E].destroyed||p.error||this.createAssetPlayer(t,p,m)}var T=t.assetList[e];if(T){var S=this.getAssetPlayer(T.identifier);return S&&S.loadSource(),S}}return null},r.flushFrontBuffer=function(t){var e=this,i=this.requiredTracks;i&&(this.log("Removing front buffer starting at "+t),Object.keys(i).forEach((function(n){e.hls.trigger(y.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:n})})))},r.getAssetPlayerQueueIndex=function(t){for(var e=this.playerQueue,i=0;i<e.length;i++)if(t===e[i].assetId)return i;return-1},r.getAssetPlayer=function(t){var e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null},r.getBufferingPlayer=function(){var t=this.playerQueue,e=this.primaryMedia;if(e){for(var i=0;i<t.length;i++)if(t[i].media===e)return t[i]}return null},r.createAsset=function(t,e,i,n,o,l){var u={parentIdentifier:t.identifier,identifier:bu(t,l,e),duration:o,startOffset:i,timelineStart:n,uri:l};return this.createAssetPlayer(t,u,e)},r.createAssetPlayer=function(t,e,i){var n=this,o=this.hls,l=o.userConfig,u=l.videoPreference,d=o.loadLevelObj||o.levels[o.currentLevel];(u||d)&&(u=mt({},u),d.videoCodec&&(u.videoCodec=d.videoCodec),d.videoRange&&(u.allowedVideoRanges=[d.videoRange]));var h=o.audioTracks[o.audioTrack],f=o.subtitleTracks[o.subtitleTrack],c=0;if(this.primaryLive||t.appendInPlace){var g=this.timelinePos-e.timelineStart;if(g>1){var v=e.duration;v&&g<v&&(c=g)}}var m=e.identifier,p=ft(ft({},l),{},{maxMaxBufferLength:Math.min(180,o.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:o.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:o.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:u,audioPreference:h||l.audioPreference,subtitlePreference:f||l.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(p.timelineOffset=e.timelineStart));var E=p.cmcd;E!=null&&E.sessionId&&E.contentId&&(p.cmcd=mt({},E,{contentId:pr(e.uri)})),this.getAssetPlayer(m)&&this.warn("Duplicate date range identifier "+t+" and asset "+m);var T=new _u(this.HlsPlayerClass,p,t,e);this.playerQueue.push(T),t.assetList[i]=e;var S=!0,R=function(b){if(b.live){var k,I=new Error("Interstitials MUST be VOD assets "+t),D={fatal:!0,type:K.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:I},P=((k=n.schedule)==null?void 0:k.findEventIndex(t.identifier))||-1;n.handleAssetItemError(D,t,P,i,I.message)}else{var M=b.edge-b.fragmentStart,O=e.duration;(S||O===null||M>O)&&(S=!1,n.log('Interstitial asset "'+m+'" duration change '+O+" > "+M),e.duration=M,n.updateSchedule())}};T.on(y.LEVEL_UPDATED,(function(b,k){var I=k.details;return R(I)})),T.on(y.LEVEL_PTS_UPDATED,(function(b,k){var I=k.details;return R(I)})),T.on(y.EVENT_CUE_ENTER,(function(){return n.onInterstitialCueEnter()}));var A=function(b,k){var I=n.getAssetPlayer(m);if(I&&k.tracks){I.off(y.BUFFER_CODECS,A),I.tracks=k.tracks;var D=n.primaryMedia;n.bufferingAsset===I.assetItem&&D&&!I.media&&n.bufferAssetPlayer(I,D)}};T.on(y.BUFFER_CODECS,A),T.on(y.BUFFERED_TO_END,(function(){var b,k=n.getAssetPlayer(m);if(n.log("buffered to end of asset "+k),k&&n.schedule){var I=n.schedule.findEventIndex(t.identifier),D=(b=n.schedule.items)==null?void 0:b[I];n.isInterstitial(D)&&n.advanceAssetBuffering(D,e)}}));var L=function(b){return function(){if(n.getAssetPlayer(m)&&n.schedule){n.shouldPlay=!0;var k=n.schedule.findEventIndex(t.identifier);n.advanceAfterAssetEnded(t,k,b)}}};return T.once(y.MEDIA_ENDED,L(i)),T.once(y.PLAYOUT_LIMIT_REACHED,L(1/0)),T.on(y.ERROR,(function(b,k){if(n.schedule){var I=n.getAssetPlayer(m);if(k.details===_.BUFFER_STALLED_ERROR)return I!=null&&I.appendInPlace?void n.handleInPlaceStall(t):(n.onTimeupdate(),void n.checkBuffer(!0));n.handleAssetItemError(k,t,n.schedule.findEventIndex(t.identifier),i,"Asset player error "+k.error+" "+t)}})),T.on(y.DESTROYING,(function(){if(n.getAssetPlayer(m)&&n.schedule){var b=new Error("Asset player destroyed unexpectedly "+m),k={fatal:!0,type:K.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};n.handleAssetItemError(k,t,n.schedule.findEventIndex(t.identifier),i,b.message)}})),this.log("INTERSTITIAL_ASSET_PLAYER_CREATED "+Ze(e)),this.hls.trigger(y.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:i,event:t,player:T}),T},r.clearInterstitial=function(t,e){var i=this;t.assetList.forEach((function(n){i.clearAssetPlayer(n.identifier,e)})),t.reset()},r.resetAssetPlayer=function(t){var e=this.getAssetPlayerQueueIndex(t);if(e!==-1){this.log('reset asset player "'+t+'" after error');var i=this.playerQueue[e];this.transferMediaFromPlayer(i,null),i.resetDetails()}},r.clearAssetPlayer=function(t,e){var i=this.getAssetPlayerQueueIndex(t);if(i!==-1){var n=this.playerQueue[i];this.log("clear "+n+" toSegment: "+(e&&se(e))),this.transferMediaFromPlayer(n,e),this.playerQueue.splice(i,1),n.destroy()}},r.emptyPlayerQueue=function(){for(var t;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]},r.startAssetPlayer=function(t,e,i,n,o){var l=t.interstitial,u=t.assetItem,d=t.assetId,h=l.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=u,f&&f.identifier===d||(f&&(this.clearAssetPlayer(f.identifier,i[n]),delete f.error),this.log("INTERSTITIAL_ASSET_STARTED "+(e+1)+"/"+h+" "+Ze(u)),this.hls.trigger(y.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:e,event:l,schedule:i.slice(0),scheduleIndex:n,player:t})),this.bufferAssetPlayer(t,o)},r.bufferAssetPlayer=function(t,e){var i,n;if(this.schedule){var o=t.interstitial,l=t.assetItem,u=this.schedule.findEventIndex(o.identifier),d=(i=this.schedule.items)==null?void 0:i[u];if(d){t.loadSource(),this.setBufferingItem(d),this.bufferingAsset=l;var h=this.getBufferingPlayer();if(h!==t){var f=o.appendInPlace;if(!f||h?.interstitial.appendInPlace!==!1){var c=h?.tracks||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(f&&l!==this.playingAsset){if(!t.tracks)return void this.log("Waiting for track info before buffering "+t);if(c&&!Mn(c,t.tracks)){var g=new Error("Asset "+Ze(l)+" SourceBuffer tracks ('"+Object.keys(t.tracks)+"') are not compatible with primary content tracks ('"+Object.keys(c)+"')"),v={fatal:!0,type:K.OTHER_ERROR,details:_.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},m=o.findAssetIndex(l);return void this.handleAssetItemError(v,o,u,m,g.message)}}this.transferMediaTo(t,e)}}}}},r.handleInPlaceStall=function(t){var e=this.schedule,i=this.primaryMedia;if(e&&i){var n=i.currentTime,o=e.findAssetIndex(t,n),l=t.assetList[o];if(l){var u=this.getAssetPlayer(l.identifier);if(u){var d=u.currentTime||n-l.timelineStart,h=u.duration-d;if(this.warn("Stalled at "+d+" of "+(d+h)+" in "+u+" "+t+" (media.currentTime: "+n+")"),d&&(h/i.playbackRate<.5||u.bufferedInPlaceToEnd(i))&&u.hls){var f=e.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,f,o)}}}}},r.advanceInPlace=function(t){var e=this.primaryMedia;e&&e.currentTime<t&&(e.currentTime=t)},r.handleAssetItemError=function(t,e,i,n,o){if(t.details!==_.BUFFER_STALLED_ERROR){var l=e.assetList[n]||null;if(this.warn("INTERSTITIAL_ASSET_ERROR "+(l&&Ze(l))+" "+t.error),this.schedule){var u=l?.identifier||"",d=this.getAssetPlayerQueueIndex(u),h=this.playerQueue[d]||null,f=this.schedule.items,c=mt({},t,{fatal:!1,errorAction:Ve(!0),asset:l,assetListIndex:n,event:e,schedule:f,scheduleIndex:i,player:h});if(this.hls.trigger(y.INTERSTITIAL_ASSET_ERROR,c),t.fatal){var g=this.playingAsset,v=this.bufferingAsset,m=new Error(o);if(l&&(this.clearAssetPlayer(u,null),l.error=m),e.assetList.some((function(E){return!E.error})))for(var p=n;p<e.assetList.length;p++)this.resetAssetPlayer(e.assetList[p].identifier);else e.error=m;this.updateSchedule(!0),e.error?this.primaryFallback(e):g&&g.identifier===u?this.advanceAfterAssetEnded(e,i,n):v&&v.identifier===u&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,v)}}}},r.primaryFallback=function(t){var e=t.timelineStart,i=this.effectivePlayingItem;if(i){this.log('Fallback to primary from event "'+t.identifier+'" start: '+e+" pos: "+this.timelinePos+" playing: "+se(i)+" error: "+t.error);var n=this.timelinePos;n===-1&&(n=this.hls.startPosition);var o=this.updateItem(i,n);if(this.itemsMatch(i,o)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e)),!this.schedule)return;var l=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(l)}else this.checkStart()},r.onAssetListLoaded=function(t,e){var i,n,o=this,l=e.event,u=l.identifier,d=e.assetListResponse.ASSETS;if((i=this.schedule)!=null&&i.hasEvent(u)){var h=l.timelineStart,f=l.duration,c=0;d.forEach((function(L,b){var k=parseFloat(L.DURATION);o.createAsset(l,b,c,h+c,k,L.URI),c+=k})),l.duration=c,this.log("Loaded asset-list with duration: "+c+" (was: "+f+") "+l);var g=this.waitingItem,v=g?.event.identifier===u;this.updateSchedule();var m=(n=this.bufferingItem)==null?void 0:n.event;if(v){var p,E=this.schedule.findEventIndex(u),T=(p=this.schedule.items)==null?void 0:p[E];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E)return l.error=new Error("Interstitial no longer within playback range "+this.timelinePos+" "+l),this.updateSchedule(!0),void this.primaryFallback(l);this.setBufferingItem(T)}this.setSchedulePosition(E)}else if(m?.identifier===u){var S=l.assetList[0];if(S){var R=this.getAssetPlayer(S.identifier);if(m.appendInPlace){var A=this.primaryMedia;R&&A&&this.bufferAssetPlayer(R,A)}else R&&R.loadSource()}}}},r.onError=function(t,e){if(this.schedule)switch(e.details){case _.ASSET_LIST_PARSING_ERROR:case _.ASSET_LIST_LOAD_ERROR:case _.ASSET_LIST_LOAD_TIMEOUT:var i=e.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break;case _.BUFFER_STALLED_ERROR:var n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace)return void this.handleInPlaceStall(n.event);this.log("Primary player stall @"+this.timelinePos+" bufferedPos: "+this.bufferedPos),this.onTimeupdate(),this.checkBuffer(!0)}},yt(s,[{key:"interstitialsManager",get:function(){if(!this.hls)return null;if(this.manager)return this.manager;var t=this,e=function(){return t.bufferingItem||t.waitingItem},i=function(f){return f&&t.getAssetPlayer(f.identifier)},n=function(f,c,g,v,m){if(f){var p=f[c].start,E=f.event;if(E){if(c==="playout"||E.timelineOccupancy!==$r.Point){var T=i(g);T?.interstitial===E&&(p+=T.assetItem.startOffset+T[m])}}else p+=(v==="bufferedPos"?o():t[v])-f.start;return p}return 0},o=function(){var f=t.bufferedPos;return f===Number.MAX_VALUE?l("primary"):Math.max(f,0)},l=function(f){var c,g;return(c=t.primaryDetails)!=null&&c.live?t.primaryDetails.edge:((g=t.schedule)==null?void 0:g.durations[f])||0},u=function(f,c){var g,v,m=t.effectivePlayingItem;if((m==null||(g=m.event)==null||!g.restrictions.skip)&&t.schedule){t.log("seek to "+f+' "'+c+'"');var p=t.effectivePlayingItem,E=t.schedule.findItemIndexAtTime(f,c),T=(v=t.schedule.items)==null?void 0:v[E],S=t.getBufferingPlayer(),R=S?.interstitial,A=R?.appendInPlace,L=p&&t.itemsMatch(p,T);if(p&&(A||L)){var b=i(t.playingAsset),k=b?.media||t.primaryMedia;if(k){var I=c==="primary"?k.currentTime:n(p,c,t.playingAsset,"timelinePos","currentTime"),D=f-I,P=(A?I:k.currentTime)+D;if(P>=0&&(!b||A||P<=b.duration))return void(k.currentTime=P)}}if(T){var M=f;if(c!=="primary"){var O=f-T[c].start;M=T.start+O}var w=!t.isInterstitial(T);if(t.isInterstitial(p)&&!p.event.appendInPlace||!w&&!T.event.appendInPlace){if(p){var F=t.findItemIndex(p);if(E>F){var x=t.schedule.findJumpRestrictedIndex(F+1,E);if(x>F)return void t.setSchedulePosition(x)}var N=0;if(w)t.timelinePos=M,t.checkBuffer();else for(var H=T.event.assetList,U=f-(T[c]||T).start,G=H.length;G--;){var X=H[G];if(X.duration&&U>=X.startOffset&&U<X.startOffset+X.duration){N=G;break}}t.setSchedulePosition(E,N)}}else{var $=t.media||(A?S?.media:null);$&&($.currentTime=M)}}}},d=function(){var f=t.effectivePlayingItem;if(t.isInterstitial(f))return f;var c=e();return t.isInterstitial(c)?c:null},h={get bufferedEnd(){var f,c=e(),g=t.bufferingItem;return g&&g===c&&(n(g,"playout",t.bufferingAsset,"bufferedPos","bufferedEnd")-g.playout.start||((f=t.bufferingAsset)==null?void 0:f.startOffset))||0},get currentTime(){var f=d(),c=t.effectivePlayingItem;return c&&c===f?n(c,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-c.playout.start:0},set currentTime(f){var c=d(),g=t.effectivePlayingItem;g&&g===c&&u(f+g.playout.start,"playout")},get duration(){var f=d();return f?f.playout.end-f.playout.start:0},get assetPlayers(){var f,c=(f=d())==null?void 0:f.event.assetList;return c?c.map((function(g){return t.getAssetPlayer(g.identifier)})):[]},get playingIndex(){var f,c=(f=d())==null?void 0:f.event;return c&&t.effectivePlayingAsset?c.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var f;return((f=t.schedule)==null||(f=f.events)==null?void 0:f.slice(0))||[]},get schedule(){var f;return((f=t.schedule)==null||(f=f.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return d()?h:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){var f=e();return t.findItemIndex(f)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){var f=t.effectivePlayingItem;return t.findItemIndex(f)},primary:{get bufferedEnd(){return o()},get currentTime(){var f=t.timelinePos;return f>0?f:0},set currentTime(f){u(f,"primary")},get duration(){return l("primary")},get seekableStart(){var f;return((f=t.primaryDetails)==null?void 0:f.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(f){u(f,"integrated")},get duration(){return l("integrated")},get seekableStart(){var f;return(function(c,g){var v;if(c!==0&&g!=="primary"&&(v=t.schedule)!=null&&v.length){var m,p=t.schedule.findItemIndexAtTime(c),E=(m=t.schedule.items)==null?void 0:m[p];if(E)return c+(E[g].start-E.start)}return c})(((f=t.primaryDetails)==null?void 0:f.fragmentStart)||0,"integrated")}},skip:function(){var f=t.effectivePlayingItem,c=f?.event;if(c&&!c.restrictions.skip){var g=t.findItemIndex(f);if(c.appendInPlace){var v=f.playout.start+f.event.duration;u(v+.001,"playout")}else t.advanceAfterAssetEnded(c,g,1/0)}}}}},{key:"effectivePlayingItem",get:function(){return this.waitingItem||this.playingItem||this.endedItem}},{key:"effectivePlayingAsset",get:function(){return this.playingAsset||this.endedAsset}},{key:"playingLastItem",get:function(){var t,e=this.playingItem,i=(t=this.schedule)==null?void 0:t.items;return!!(this.playbackStarted&&e&&i)&&this.findItemIndex(e)===i.length-1}},{key:"playbackStarted",get:function(){return this.effectivePlayingItem!==null}},{key:"currentTime",get:function(){var t,e;if(this.mediaSelection!==null){var i=this.waitingItem||this.playingItem;if(!this.isInterstitial(i)||i.event.appendInPlace){var n=this.media;!n&&(t=this.bufferingItem)!=null&&(t=t.event)!=null&&t.appendInPlace&&(n=this.primaryMedia);var o=(e=n)==null?void 0:e.currentTime;if(o!==void 0&&B(o))return o}}}},{key:"primaryMedia",get:function(){var t;return this.media||((t=this.detachedData)==null?void 0:t.media)||null}},{key:"playbackDisabled",get:function(){return this.hls.config.enableInterstitialPlayback===!1}},{key:"primaryDetails",get:function(){var t;return(t=this.mediaSelection)==null?void 0:t.main.details}},{key:"primaryLive",get:function(){var t;return!((t=this.primaryDetails)==null||!t.live)}}])})(ee),Ou=(function(a){function s(t,e,i){var n;return(n=a.call(this,t,e,i,"subtitle-stream-controller",te)||this).currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n.registerListeners(),n}ut(s,a);var r=s.prototype;return r.onHandlerDestroying=function(){this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this),this.mainDetails=null},r.registerListeners=function(){a.prototype.registerListeners.call(this);var t=this.hls;t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)},r.unregisterListeners=function(){a.prototype.unregisterListeners.call(this);var t=this.hls;t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this)},r.startLoad=function(t,e){this.stopLoad(),this.state=C.IDLE,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()},r.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.mainDetails=null},r.onMediaDetaching=function(t,e){this.tracksBuffered=[],a.prototype.onMediaDetaching.call(this,t,e)},r.onLevelLoaded=function(t,e){this.mainDetails=e.details},r.onSubtitleFragProcessed=function(t,e){var i=e.frag,n=e.success;if(this.fragContextChanged(i)||(wt(i)&&(this.fragPrevious=i),this.state=C.IDLE),n){var o=this.tracksBuffered[this.currentTrackId];if(o){for(var l,u=i.start,d=0;d<o.length;d++)if(u>=o[d].start&&u<=o[d].end){l=o[d];break}var h=i.start+i.duration;l?l.end=h:(l={start:u,end:h},o.push(l)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}}},r.onBufferFlushing=function(t,e){var i=e.startOffset,n=e.endOffset;if(i===0&&n!==Number.POSITIVE_INFINITY){var o=n-1;if(o<=0)return;e.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach((function(l){for(var u=0;u<l.length;)if(l[u].end<=o)l.shift();else{if(!(l[u].start<o))break;l[u].start=o,u++}})),this.fragmentTracker.removeFragmentsInRange(i,o,te)}},r.onError=function(t,e){var i=e.frag;i?.type===te&&(e.details===_.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==C.STOPPED&&(this.state=C.IDLE))},r.onSubtitleTracksUpdated=function(t,e){var i=this,n=e.subtitleTracks;this.levels&&Cs(this.levels,n)?this.levels=n.map((function(o){return new ar(o)})):(this.tracksBuffered=[],this.levels=n.map((function(o){var l=new ar(o);return i.tracksBuffered[l.id]=[],l})),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,te),this.fragPrevious=null,this.mediaBuffer=null)},r.onSubtitleTrackSwitch=function(t,e){var i;if(this.currentTrackId=e.id,(i=this.levels)!=null&&i.length&&this.currentTrackId!==-1){var n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==C.STOPPED&&this.setInterval(500)}else this.clearInterval()},r.onSubtitleTrackLoaded=function(t,e){var i,n=this.currentTrackId,o=this.levels,l=e.details,u=e.id;if(o){var d=o[u];if(!(u>=o.length)&&d){this.log("Subtitle track "+u+" loaded ["+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+",duration:"+l.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var h=0;if(l.live||(i=d.details)!=null&&i.live){if(l.deltaUpdateFailed)return;var f=this.mainDetails;if(!f)return void(this.startFragRequested=!1);var c,g=f.fragments[0];d.details?(h=this.alignPlaylists(l,d.details,(c=this.levelLastLoaded)==null?void 0:c.details))===0&&g&&Mi(l,h=g.start):l.hasProgramDateTime&&f.hasProgramDateTime?(Ur(l,f),h=l.fragmentStart):g&&Mi(l,h=g.start),f&&!this.startFragRequested&&this.setStartPosition(f,h)}d.details=l,this.levelLastLoaded=d,u===n&&(this.hls.trigger(y.SUBTITLE_TRACK_UPDATED,{details:l,id:u,groupId:e.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===C.IDLE&&(Ce(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}}else this.warn("Subtitle tracks were reset while loading level "+u)},r._handleFragmentLoadComplete=function(t){var e=this,i=t.frag,n=t.payload,o=i.decryptdata,l=this.hls;if(!this.fragContextChanged(i)&&n&&n.byteLength>0&&o!=null&&o.key&&o.iv&&je(o.method)){var u=performance.now();this.decrypter.decrypt(new Uint8Array(n),o.key.buffer,o.iv.buffer,bi(o.method)).catch((function(d){throw l.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d})).then((function(d){var h=performance.now();l.trigger(y.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:u,tdecrypt:h}})})).catch((function(d){e.warn(d.name+": "+d.message),e.state=C.IDLE}))}},r.doTick=function(){if(this.media){if(this.state===C.IDLE){var t=this.currentTrackId,e=this.levels,i=e?.[t];if(!i||!e.length||!i.details||this.waitForLive(i))return;var n=this.config,o=this.getLoadPosition(),l=tt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o,n.maxBufferHole),u=l.end,d=l.len,h=i.details;if(d>this.hls.maxBufferLength+h.levelTargetDuration)return;var f=h.fragments,c=f.length,g=h.edge,v=null,m=this.fragPrevious;if(u<g){var p=n.maxFragLookUpTolerance,E=u>g-p?0:p;!(v=Ce(m,f,Math.max(f[0].start,u),E))&&m&&m.start<f[0].start&&(v=f[0])}else v=f[c-1];if(!(v=this.filterReplacedPrimary(v,i.details)))return;var T=f[v.sn-h.startSN-1];if(T&&T.cc===v.cc&&this.fragmentTracker.getState(T)===or&&(v=T),this.fragmentTracker.getState(v)===or){var S=this.mapToInitFragWhenRequired(v);S&&this.loadFragment(S,i,u)}}}else this.state=C.IDLE},r.loadFragment=function(t,e,i){wt(t)?a.prototype.loadFragment.call(this,t,e,i):this._loadInitSegment(t,e)},yt(s,[{key:"mediaBufferTimeRanges",get:function(){return new xu(this.tracksBuffered[this.currentTrackId]||[])}}])})(Fi),xu=function(a){this.buffered=void 0;var s=function(r,t,e){if((t>>>=0)>e-1)throw new DOMException("Failed to execute '"+r+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+e+")");return a[t][r]};this.buffered={get length(){return a.length},end:function(r){return s("end",r,a.length)},start:function(r){return s("start",r,a.length)}}};function to(a,s){var r;try{r=new Event("addtrack")}catch{(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=a,s.dispatchEvent(r)}function eo(a,s){var r=a.mode;if(r==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(s.id))try{if(a.addCue(s),!a.cues.getCueById(s.id))throw new Error("addCue is failed for: "+s)}catch(e){ct.debug("[texttrack-utils]: "+e);try{var t=new self.TextTrackCue(s.startTime,s.endTime,s.text);t.id=s.id,a.addCue(t)}catch(i){ct.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+i)}}r==="disabled"&&(a.mode=r)}function Je(a,s){var r=a.mode;if(r==="disabled"&&(a.mode="hidden"),a.cues)for(var t=a.cues.length;t--;)s&&a.cues[t].removeEventListener("enter",s),a.removeCue(a.cues[t]);r==="disabled"&&(a.mode=r)}function un(a,s,r,t){var e=a.mode;if(e==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0)for(var i=(function(o,l,u){var d=[],h=(function(v,m){if(m<=v[0].startTime)return 0;var p=v.length-1;if(m>v[p].endTime)return-1;for(var E,T=0,S=p;T<=S;)if(m<v[E=Math.floor((S+T)/2)].startTime)S=E-1;else{if(!(m>v[E].startTime&&T<p))return E;T=E+1}return v[T].startTime-m<m-v[S].startTime?T:S})(o,l);if(h>-1)for(var f=h,c=o.length;f<c;f++){var g=o[f];if(g.startTime>=l&&g.endTime<=u)d.push(g);else if(g.startTime>u)return d}return d})(a.cues,s,r),n=0;n<i.length;n++)t&&!t(i[n])||a.removeCue(i[n]);e==="disabled"&&(a.mode=e)}function Jr(a){for(var s=[],r=0;r<a.length;r++){var t=a[r];t.kind!=="subtitles"&&t.kind!=="captions"||!t.label||s.push(a[r])}return s}var Mu=(function(a){function s(t){var e;return(e=a.call(this,t,"subtitle-track-controller")||this).media=null,e.tracks=[],e.groupIds=null,e.tracksInGroup=[],e.trackId=-1,e.currentTrack=null,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.onTextTracksChanged=function(){if(e.useTextTrackPolling||self.clearInterval(e.subtitlePollingInterval),e.media&&e.hls.config.renderTextTracksNatively){for(var i=null,n=Jr(e.media.textTracks),o=0;o<n.length;o++)if(n[o].mode==="hidden")i=n[o];else if(n[o].mode==="showing"){i=n[o];break}var l=e.findTrackForTextTrack(i);e.subtitleTrack!==l&&e.setSubtitleTrack(l)}},e.registerListeners(),e}ut(s,a);var r=s.prototype;return r.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,a.prototype.destroy.call(this)},r.registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(y.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(y.ERROR,this.onError,this)},r.onMediaAttached=function(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},r.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)},r.onMediaDetaching=function(t,e){var i=this.media;if(i){var n=!!e.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n||Jr(i.textTracks).forEach((function(o){Je(o)}))}},r.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},r.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},r.onSubtitleTrackLoaded=function(t,e){var i=e.id,n=e.groupId,o=e.details,l=this.tracksInGroup[i];if(l&&l.groupId===n){var u=l.details;l.details=e.details,this.log("Subtitle track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+n+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,e,u)}else this.warn("Subtitle track with id:"+i+" and group:"+n+" not found in active group "+l?.groupId)},r.onLevelLoading=function(t,e){this.switchLevel(e.level)},r.onLevelSwitching=function(t,e){this.switchLevel(e.level)},r.switchLevel=function(t){var e=this.hls.levels[t];if(e){var i=e.subtitleGroups||null,n=this.groupIds,o=this.currentTrack;if(!i||n?.length!==i?.length||i!=null&&i.some((function(g){return n?.indexOf(g)===-1}))){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var l=this.tracks.filter((function(g){return!i||i.indexOf(g.groupId)!==-1}));if(l.length)this.selectDefaultTrack&&!l.some((function(g){return g.default}))&&(this.selectDefaultTrack=!1),l.forEach((function(g,v){g.id=v}));else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=l;var u=this.hls.config.subtitlePreference;if(!o&&u){this.selectDefaultTrack=!1;var d=de(u,l);if(d>-1)o=l[d];else{var h=de(u,this.tracks);o=this.tracks[h]}}var f=this.findTrackId(o);f===-1&&o&&(f=this.findTrackId(null));var c={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+i?.join(",")+'" group-id'),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,c),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}},r.findTrackId=function(t){for(var e=this.tracksInGroup,i=this.selectDefaultTrack,n=0;n<e.length;n++){var o=e[n];if((!i||o.default)&&(i||t)&&(!t||_e(o,t)))return n}if(t){for(var l=0;l<e.length;l++){var u=e[l];if(mr(t.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(var d=0;d<e.length;d++){var h=e[d];if(mr(t.attrs,h.attrs,["LANGUAGE"]))return d}}return-1},r.findTrackForTextTrack=function(t){if(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++)if(Ji(e[i],t))return i}return-1},r.onError=function(t,e){!e.fatal&&e.context&&(e.context.type!==oe||e.context.id!==this.trackId||this.groupIds&&this.groupIds.indexOf(e.context.groupId)===-1||this.checkRetry(e))},r.setSubtitleOption=function(t){if(this.hls.config.subtitlePreference=t,t){if(t.id===-1)return this.setSubtitleTrack(-1),null;var e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){var i=this.currentTrack;if(i&&_e(t,i))return i;var n=de(t,this.tracksInGroup);if(n>-1){var o=this.tracksInGroup[n];return this.setSubtitleTrack(n),o}if(i)return null;var l=de(t,e);if(l>-1)return e[l]}}return null},r.loadPlaylist=function(t){a.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)},r.loadingPlaylist=function(t,e){a.prototype.loadingPlaylist.call(this,t,e);var i=t.id,n=t.groupId,o=this.getUrlWithDirectives(t.url,e),l=t.details,u=l?.age;this.log("Loading subtitle "+i+' "'+t.name+'" lang:'+t.lang+" group:"+n+(e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:"")+(u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):"")+" "+o),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:o,id:i,groupId:n,deliveryDirectives:e||null,track:t})},r.toggleTrackModes=function(){var t=this.media;if(t){var e,i=Jr(t.textTracks),n=this.currentTrack;if(n&&((e=i.filter((function(l){return Ji(n,l)}))[0])||this.warn('Unable to find subtitle TextTrack with name "'+n.name+'" and language "'+n.lang+'"')),[].slice.call(i).forEach((function(l){l.mode!=="disabled"&&l!==e&&(l.mode="disabled")})),e){var o=this.subtitleDisplay?"showing":"hidden";e.mode!==o&&(e.mode=o)}}},r.setSubtitleTrack=function(t){var e=this.tracksInGroup;if(this.media)if(t<-1||t>=e.length||!B(t))this.warn("Invalid subtitle track id: "+t);else{this.selectDefaultTrack=!1;var i=this.currentTrack,n=e[t]||null;if(this.trackId=t,this.currentTrack=n,this.toggleTrackModes(),n){var o=!!n.details&&!n.details.live;if(t!==this.trackId||n!==i||!o){this.log("Switching to subtitle-track "+t+(n?' "'+n.name+'" lang:'+n.lang+" group:"+n.groupId:""));var l=n.id,u=n.groupId,d=u===void 0?"":u,h=n.name,f=n.type,c=n.url;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:l,groupId:d,name:h,type:f,url:c});var g=this.switchParams(n.url,i?.details,n.details);this.loadPlaylist(g)}}else this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:t})}else this.queuedDefaultTrack=t},yt(s,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}}])})(Zi),Fu={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ro=function(a){return String.fromCharCode(Fu[a]||a)},Me=15,Te=100,Nu={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Uu={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Bu={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Gu={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ku=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Vu=(function(){function a(){this.time=null,this.verboseLevel=0}return a.prototype.log=function(s,r){if(this.verboseLevel>=s){var t=typeof r=="function"?r():r;ct.log(this.time+" ["+s+"] "+t)}},a})(),Fe=function(a){for(var s=[],r=0;r<a.length;r++)s.push(a[r].toString(16));return s},io=(function(){function a(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var s=a.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(r){for(var t=["foreground","underline","italics","background","flash"],e=0;e<t.length;e++){var i=t[e];r.hasOwnProperty(i)&&(this[i]=r[i])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},s.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a})(),Hu=(function(){function a(){this.uchar=" ",this.penState=new io}var s=a.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(r,t){this.uchar=r,this.penState.copy(t)},s.setPenState=function(r){this.penState.copy(r)},s.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},s.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},a})(),Yu=(function(){function a(r){this.chars=[],this.pos=0,this.currPenState=new io,this.cueStartTime=null,this.logger=void 0;for(var t=0;t<Te;t++)this.chars.push(new Hu);this.logger=r}var s=a.prototype;return s.equals=function(r){for(var t=0;t<Te;t++)if(!this.chars[t].equals(r.chars[t]))return!1;return!0},s.copy=function(r){for(var t=0;t<Te;t++)this.chars[t].copy(r.chars[t])},s.isEmpty=function(){for(var r=!0,t=0;t<Te;t++)if(!this.chars[t].isEmpty()){r=!1;break}return r},s.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Te&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Te)},s.moveCursor=function(r){var t=this.pos+r;if(r>1)for(var e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(r){var t=this;r>=144&&this.backSpace();var e=ro(r);this.pos>=Te?this.logger.log(0,(function(){return"Cannot insert "+r.toString(16)+" ("+e+") at position "+t.pos+". Skipping it!"})):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},s.clearFromPos=function(r){var t;for(t=r;t<Te;t++)this.chars[t].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var r=[],t=!0,e=0;e<Te;e++){var i=this.chars[e].uchar;i!==" "&&(t=!1),r.push(i)}return t?"":r.join("")},s.setPenStyles=function(r){this.currPenState.setStyles(r),this.chars[this.pos].setPenState(this.currPenState)},a})(),dn=(function(){function a(r){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var t=0;t<Me;t++)this.rows.push(new Yu(r));this.logger=r}var s=a.prototype;return s.reset=function(){for(var r=0;r<Me;r++)this.rows[r].clear();this.currRow=14},s.equals=function(r){for(var t=!0,e=0;e<Me;e++)if(!this.rows[e].equals(r.rows[e])){t=!1;break}return t},s.copy=function(r){for(var t=0;t<Me;t++)this.rows[t].copy(r.rows[t])},s.isEmpty=function(){for(var r=!0,t=0;t<Me;t++)if(!this.rows[t].isEmpty()){r=!1;break}return r},s.backSpace=function(){this.rows[this.currRow].backSpace()},s.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},s.insertChar=function(r){this.rows[this.currRow].insertChar(r)},s.setPen=function(r){this.rows[this.currRow].setPenStyles(r)},s.moveCursor=function(r){this.rows[this.currRow].moveCursor(r)},s.setCursor=function(r){this.logger.log(2,"setCursor: "+r),this.rows[this.currRow].setCursor(r)},s.setPAC=function(r){this.logger.log(2,(function(){return"pacData = "+Et(r)}));var t=r.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var e=0;e<Me;e++)this.rows[e].clear();var i=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var o=n.rows[i].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(var u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(n.rows[i+u])}}this.currRow=t;var d=this.rows[this.currRow];if(r.indent!==null){var h=r.indent,f=Math.max(h-1,0);d.setCursor(r.indent),r.color=d.chars[f].penState.foreground}var c={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(c)},s.setBkgData=function(r){this.logger.log(2,(function(){return"bkgData = "+Et(r)})),this.backSpace(),this.setPen(r),this.insertChar(32)},s.setRollUpRows=function(r){this.nrRollUpRows=r},s.rollUp=function(){var r=this;if(this.nrRollUpRows!==null){this.logger.log(1,(function(){return r.getDisplayText()}));var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},s.getDisplayText=function(r){r=r||!1;for(var t=[],e="",i=-1,n=0;n<Me;n++){var o=this.rows[n].getTextString();o&&(i=n+1,r?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e=r?"["+t.join(" | ")+"]":t.join(`
`)),e},s.getTextAndFormat=function(){return this.rows},a})(),no=(function(){function a(r,t,e){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=r,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new dn(e),this.nonDisplayedMemory=new dn(e),this.lastOutputScreen=new dn(e),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=e}var s=a.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(r){this.outputFilter=r},s.setPAC=function(r){this.writeScreen.setPAC(r)},s.setBkgData=function(r){this.writeScreen.setBkgData(r)},s.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(2,(function(){return"MODE="+r})),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},s.insertChars=function(r){for(var t=this,e=0;e<r.length;e++)this.writeScreen.insertChar(r[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,(function(){return i+": "+t.writeScreen.getDisplayText(!0)})),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(1,(function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(r){this.logger.log(2,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},s.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){var r=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,(function(){return"DISP: "+r.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)},s.ccTO=function(r){this.logger.log(2,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},s.ccMIDROW=function(r){var t={flash:!1};if(t.underline=r%2==1,t.italics=r>=46,t.italics)t.foreground="white";else{var e=Math.floor(r/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][e]}this.logger.log(2,"MIDROW: "+Et(t)),this.writeScreen.setPen(t)},s.outputDataUpdate=function(r){r===void 0&&(r=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},a})(),ao=(function(){function a(r,t,e){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;var i=this.logger=new Vu;this.channels=[null,new no(r,t,i),new no(r+1,e,i)]}var s=a.prototype;return s.getHandler=function(r){return this.channels[r].getHandler()},s.setHandler=function(r,t){this.channels[r].setHandler(t)},s.addData=function(r,t){var e=this;this.logger.time=r;for(var i=function(o){var l=127&t[o],u=127&t[o+1],d=!1,h=null;if(l===0&&u===0)return 0;e.logger.log(3,(function(){return"["+Fe([t[o],t[o+1]])+"] -> ("+Fe([l,u])+")"}));var f=e.cmdHistory;if(l>=16&&l<=31){if((function(g,v,m){return m.a===g&&m.b===v})(l,u,f))return ti(null,null,f),e.logger.log(3,(function(){return"Repeated command ("+Fe([l,u])+") is dropped"})),0;ti(l,u,e.cmdHistory),(d=e.parseCmd(l,u))||(d=e.parseMidrow(l,u)),d||(d=e.parsePAC(l,u)),d||(d=e.parseBackgroundAttributes(l,u))}else ti(null,null,f);if(!d&&(h=e.parseChars(l,u))){var c=e.currentChannel;c&&c>0?e.channels[c].insertChars(h):e.logger.log(2,"No channel found yet. TEXT-MODE?")}d||h||e.logger.log(2,(function(){return"Couldn't parse cleaned data "+Fe([l,u])+" orig: "+Fe([t[o],t[o+1]])}))},n=0;n<t.length;n+=2)i(n)},s.parseCmd=function(r,t){if(!((r===20||r===28||r===21||r===29)&&t>=32&&t<=47||(r===23||r===31)&&t>=33&&t<=35))return!1;var e=r===20||r===21||r===23?1:2,i=this.channels[e];return r===20||r===21||r===28||r===29?t===32?i.ccRCL():t===33?i.ccBS():t===34?i.ccAOF():t===35?i.ccAON():t===36?i.ccDER():t===37?i.ccRU(2):t===38?i.ccRU(3):t===39?i.ccRU(4):t===40?i.ccFON():t===41?i.ccRDC():t===42?i.ccTR():t===43?i.ccRTD():t===44?i.ccEDM():t===45?i.ccCR():t===46?i.ccENM():t===47&&i.ccEOC():i.ccTO(t-32),this.currentChannel=e,!0},s.parseMidrow=function(r,t){var e=0;if((r===17||r===25)&&t>=32&&t<=47){if((e=r===17?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[e];return!!i&&(i.ccMIDROW(t),this.logger.log(3,(function(){return"MIDROW ("+Fe([r,t])+")"})),!0)}return!1},s.parsePAC=function(r,t){var e;if(!((r>=17&&r<=23||r>=25&&r<=31)&&t>=64&&t<=127||(r===16||r===24)&&t>=64&&t<=95))return!1;var i=r<=23?1:2;e=t>=64&&t<=95?i===1?Nu[r]:Bu[r]:i===1?Uu[r]:Gu[r];var n=this.channels[i];return!!n&&(n.setPAC(this.interpretPAC(e,t)),this.currentChannel=i,!0)},s.interpretPAC=function(r,t){var e,i={color:null,italics:!1,indent:null,underline:!1,row:r};return e=t>95?t-96:t-64,i.underline=(1&e)==1,e<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(e/2)]:e<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((e-16)/2),i},s.parseChars=function(r,t){var e,i,n=null,o=null;return r>=25?(e=2,o=r-8):(e=1,o=r),o>=17&&o<=19?(i=o===17?t+80:o===18?t+112:t+144,this.logger.log(2,(function(){return"Special char '"+ro(i)+"' in channel "+e})),n=[i]):r>=32&&r<=127&&(n=t===0?[r]:[r,t]),n&&this.logger.log(3,(function(){return"Char codes =  "+Fe(n).join(",")})),n},s.parseBackgroundAttributes=function(r,t){var e;if(!((r===16||r===24)&&t>=32&&t<=47||(r===23||r===31)&&t>=45&&t<=47))return!1;var i={};r===16||r===24?(e=Math.floor((t-32)/2),i.background=Ku[e],t%2==1&&(i.background=i.background+"_semi")):t===45?i.background="transparent":(i.foreground="black",t===47&&(i.underline=!0));var n=r<=23?1:2;return this.channels[n].setBkgData(i),!0},s.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var t=this.channels[r];t&&t.reset()}ti(null,null,this.cmdHistory)},s.cueSplitAtTime=function(r){for(var t=0;t<this.channels.length;t++){var e=this.channels[t];e&&e.cueSplitAtTime(r)}},a})();function ti(a,s,r){r.a=a,r.b=s}var hn=(function(){if(wr!=null&&wr.VTTCue)return self.VTTCue;var a=["","lr","rl"],s=["start","middle","end","left","right"];function r(n,o){if(typeof o!="string"||!Array.isArray(n))return!1;var l=o.toLowerCase();return!!~n.indexOf(l)&&l}function t(n){return r(s,n)}function e(n){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];for(var d=1;d<arguments.length;d++){var h=arguments[d];for(var f in h)n[f]=h[f]}return n}function i(n,o,l){var u=this,d={enumerable:!0};u.hasBeenReset=!1;var h="",f=!1,c=n,g=o,v=l,m=null,p="",E=!0,T="auto",S="start",R=50,A="middle",L=50,b="middle";Object.defineProperty(u,"id",e({},d,{get:function(){return h},set:function(k){h=""+k}})),Object.defineProperty(u,"pauseOnExit",e({},d,{get:function(){return f},set:function(k){f=!!k}})),Object.defineProperty(u,"startTime",e({},d,{get:function(){return c},set:function(k){if(typeof k!="number")throw new TypeError("Start time must be set to a number.");c=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",e({},d,{get:function(){return g},set:function(k){if(typeof k!="number")throw new TypeError("End time must be set to a number.");g=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",e({},d,{get:function(){return v},set:function(k){v=""+k,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",e({},d,{get:function(){return m},set:function(k){m=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",e({},d,{get:function(){return p},set:function(k){var I=(function(D){return r(a,D)})(k);if(I===!1)throw new SyntaxError("An invalid or illegal string was specified.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",e({},d,{get:function(){return E},set:function(k){E=!!k,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",e({},d,{get:function(){return T},set:function(k){if(typeof k!="number"&&k!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",e({},d,{get:function(){return S},set:function(k){var I=t(k);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");S=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",e({},d,{get:function(){return R},set:function(k){if(k<0||k>100)throw new Error("Position must be between 0 and 100.");R=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",e({},d,{get:function(){return A},set:function(k){var I=t(k);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",e({},d,{get:function(){return L},set:function(k){if(k<0||k>100)throw new Error("Size must be between 0 and 100.");L=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",e({},d,{get:function(){return b},set:function(k){var I=t(k);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");b=I,this.hasBeenReset=!0}})),u.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i})(),Wu=(function(){function a(){}return a.prototype.decode=function(s,r){if(!s)return"";if(typeof s!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(s))},a})();function so(a){function s(t,e,i,n){return 3600*(0|t)+60*(0|e)+(0|i)+parseFloat(n||0)}var r=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?s(r[2],r[3],0,r[4]):s(r[1],r[2],r[3],r[4]):null}var ju=(function(){function a(){this.values=Object.create(null)}var s=a.prototype;return s.set=function(r,t){this.get(r)||t===""||(this.values[r]=t)},s.get=function(r,t,e){return e?this.has(r)?this.values[r]:t[e]:this.has(r)?this.values[r]:t},s.has=function(r){return r in this.values},s.alt=function(r,t,e){for(var i=0;i<e.length;++i)if(t===e[i]){this.set(r,t);break}},s.integer=function(r,t){/^-?\d+$/.test(t)&&this.set(r,parseInt(t,10))},s.percent=function(r,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var e=parseFloat(t);if(e>=0&&e<=100)return this.set(r,e),!0}return!1},a})();function oo(a,s,r,t){var e=t?a.split(t):[a];for(var i in e)if(typeof e[i]=="string"){var n=e[i].split(r);n.length===2&&s(n[0],n[1])}}var fn=new hn(0,0,""),ei=fn.align==="middle"?"middle":"center";function qu(a,s,r){var t=a;function e(){var n=so(a);if(n===null)throw new Error("Malformed timestamp: "+t);return a=a.replace(/^[^\sa-zA-Z-]+/,""),n}function i(){a=a.replace(/^\s+/,"")}if(i(),s.startTime=e(),i(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);a=a.slice(3),i(),s.endTime=e(),i(),(function(n,o){var l=new ju;oo(n,(function(h,f){var c;switch(h){case"region":for(var g=r.length-1;g>=0;g--)if(r[g].id===f){l.set(h,r[g].region);break}break;case"vertical":l.alt(h,f,["rl","lr"]);break;case"line":c=f.split(","),l.integer(h,c[0]),l.percent(h,c[0])&&l.set("snapToLines",!1),l.alt(h,c[0],["auto"]),c.length===2&&l.alt("lineAlign",c[1],["start",ei,"end"]);break;case"position":c=f.split(","),l.percent(h,c[0]),c.length===2&&l.alt("positionAlign",c[1],["start",ei,"end","line-left","line-right","auto"]);break;case"size":l.percent(h,f);break;case"align":l.alt(h,f,["start",ei,"end","left","right"])}}),/:/,/\s/),o.region=l.get("region",null),o.vertical=l.get("vertical","");var u=l.get("line","auto");u==="auto"&&fn.line===-1&&(u=-1),o.line=u,o.lineAlign=l.get("lineAlign","start"),o.snapToLines=l.get("snapToLines",!0),o.size=l.get("size",100),o.align=l.get("align",ei);var d=l.get("position","auto");d==="auto"&&fn.position===50&&(d=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=d})(a,s)}function lo(a){return a.replace(/<br(?: \/)?>/gi,`
`)}var Xu=(function(){function a(){this.state="INITIAL",this.buffer="",this.decoder=new Wu,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var s=a.prototype;return s.parse=function(r){var t=this;function e(){var u=t.buffer,d=0;for(u=lo(u);d<u.length&&u[d]!=="\r"&&u[d]!==`
`;)++d;var h=u.slice(0,d);return u[d]==="\r"&&++d,u[d]===`
`&&++d,t.buffer=u.slice(d),h}r&&(t.buffer+=t.decoder.decode(r,{stream:!0}));try{var i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var n=(i=e()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(n==null||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=e(),t.state){case"HEADER":/:/.test(i)?oo(i,(function(u,d){}),/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new hn(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{qu(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var l=i.indexOf("-->")!==-1;if(!i||l&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},s.flush=function(){var r=this;try{if((r.cue||r.state==="HEADER")&&(r.buffer+=`

`,r.parse()),r.state==="INITIAL"||r.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){r.onparsingerror&&r.onparsingerror(t)}return r.onflush&&r.onflush(),this},a})(),zu=/\r\n|\n\r|\n|\r/g,cn=function(a,s,r){return r===void 0&&(r=0),a.slice(r,r+s.length)===s};function gn(a,s,r){return pr(a.toString())+pr(s.toString())+pr(r)}function Qu(a,s,r,t,e,i,n){var o,l,u,d=new Xu,h=Xt(new Uint8Array(a)).trim().replace(zu,`
`).split(`
`),f=[],c=s?(o=s.baseTime,(l=s.timescale)===void 0&&(l=1),ji(o,As,1/l)):0,g="00:00.000",v=0,m=0,p=!0;d.oncue=function(E){var T=r[t],S=r.ccOffset,R=(v-c)/9e4;if(T!=null&&T.new&&(m!==void 0?S=r.ccOffset=T.start:(function(k,I,D){var P=k[I],M=k[P.prevCC];if(!M||!M.new&&P.new)return k.ccOffset=k.presentationOffset=P.start,void(P.new=!1);for(;(O=M)!=null&&O.new;){var O;k.ccOffset+=P.start-M.start,P.new=!1,M=k[(P=M).prevCC]}k.presentationOffset=D})(r,t,R)),R){if(!s)return void(u=new Error("Missing initPTS for VTT MPEGTS"));S=R-r.presentationOffset}var A=E.endTime-E.startTime,L=ie(9e4*(E.startTime+S-m),9e4*e)/9e4;E.startTime=Math.max(L,0),E.endTime=Math.max(L+A,0);var b=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(b)),E.id||(E.id=gn(E.startTime,E.endTime,b)),E.endTime>0&&f.push(E)},d.onparsingerror=function(E){u=E},d.onflush=function(){u?n(u):i(f)},h.forEach((function(E){if(p){if(cn(E,"X-TIMESTAMP-MAP=")){p=!1,E.slice(16).split(",").forEach((function(T){cn(T,"LOCAL:")?g=T.slice(6):cn(T,"MPEGTS:")&&(v=parseInt(T.slice(7)))}));try{m=(function(T){var S=parseInt(T.slice(-3)),R=parseInt(T.slice(-6,-4)),A=parseInt(T.slice(-9,-7)),L=T.length>9?parseInt(T.substring(0,T.indexOf(":"))):0;if(!(B(S)&&B(R)&&B(A)&&B(L)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+T);return S+=1e3*R,(S+=6e4*A)+36e5*L})(g)/1e3}catch(T){u=T}return}E===""&&(p=!1)}d.parse(E+`
`)})),d.flush()}var vn="stpp.ttml.im1t",uo=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ho=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,$u={left:"start",center:"center",right:"end",start:"start",end:"end"};function fo(a,s,r,t){var e=J(new Uint8Array(a),["mdat"]);if(e.length!==0){var i,n,o,l,u=e.map((function(h){return Xt(h)})),d=(i=s.baseTime,n=1,(o=s.timescale)===void 0&&(o=1),l===void 0&&(l=!1),ji(i,n,1/o,l));try{u.forEach((function(h){return r((function(f,c){var g=new DOMParser().parseFromString(f,"text/xml"),v=g.getElementsByTagName("tt")[0];if(!v)throw new Error("Invalid ttml");var m={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},p=Object.keys(m).reduce((function(A,L){return A[L]=v.getAttribute("ttp:"+L)||m[L],A}),{}),E=v.getAttribute("xml:space")!=="preserve",T=co(mn(v,"styling","style")),S=co(mn(v,"layout","region")),R=mn(v,"body","[begin]");return[].map.call(R,(function(A){var L=go(A,E);if(!L||!A.hasAttribute("begin"))return null;var b=yn(A.getAttribute("begin"),p),k=yn(A.getAttribute("dur"),p),I=yn(A.getAttribute("end"),p);if(b===null)throw vo(A);if(I===null){if(k===null)throw vo(A);I=b+k}var D=new hn(b-c,I-c,L);D.id=gn(D.startTime,D.endTime,D.text);var P=(function(w,F,x){var N="http://www.w3.org/ns/ttml#styling",H=null,U=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],G=w!=null&&w.hasAttribute("style")?w.getAttribute("style"):null;return G&&x.hasOwnProperty(G)&&(H=x[G]),U.reduce((function(X,$){var Y=pn(F,N,$)||pn(w,N,$)||pn(H,N,$);return Y&&(X[$]=Y),X}),{})})(S[A.getAttribute("region")],T[A.getAttribute("style")],T),M=P.textAlign;if(M){var O=$u[M];O&&(D.lineAlign=O),D.align=M}return mt(D,P),D})).filter((function(A){return A!==null}))})(h,d))}))}catch(h){t(h)}}else t(new Error("Could not parse IMSC1 mdat"))}function mn(a,s,r){var t=a.getElementsByTagName(s)[0];return t?[].slice.call(t.querySelectorAll(r)):[]}function co(a){return a.reduce((function(s,r){var t=r.getAttribute("xml:id");return t&&(s[t]=r),s}),{})}function go(a,s){return[].slice.call(a.childNodes).reduce((function(r,t,e){var i;return t.nodeName==="br"&&e?r+`
`:(i=t.childNodes)!=null&&i.length?go(t,s):s?r+t.textContent.trim().replace(/\s+/g," "):r+t.textContent}),"")}function pn(a,s,r){return a&&a.hasAttributeNS(s,r)?a.getAttributeNS(s,r):null}function vo(a){return new Error("Could not parse ttml timestamp "+a)}function yn(a,s){if(!a)return null;var r=so(a);return r===null&&(uo.test(a)?r=(function(t,e){var i=uo.exec(t),n=(0|i[4])+(0|i[5])/e.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+n/e.frameRate})(a,s):ho.test(a)&&(r=(function(t,e){var i=ho.exec(t),n=Number(i[1]);switch(i[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n})(a,s))),r}var ri=(function(){function a(r,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=r,this.trackName=t}var s=a.prototype;return s.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},s.newCue=function(r,t,e){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=t,this.screen=e,this.timelineController.createCaptionsTrack(this.trackName)},s.reset=function(){this.cueRanges=[],this.startTime=null},a})(),Zu=(function(){function a(r){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},r.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(y.FRAG_LOADING,this.onFragLoading,this),r.on(y.FRAG_LOADED,this.onFragLoaded,this),r.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}var s=a.prototype;return s.destroy=function(){var r=this.hls;r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(y.FRAG_LOADING,this.onFragLoading,this),r.off(y.FRAG_LOADED,this.onFragLoaded,this),r.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),r.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0},s.initCea608Parsers=function(){var r=new ri(this,"textTrack1"),t=new ri(this,"textTrack2"),e=new ri(this,"textTrack3"),i=new ri(this,"textTrack4");this.cea608Parser1=new ao(1,r,t),this.cea608Parser2=new ao(3,e,i)},s.addCues=function(r,t,e,i,n){for(var o,l,u,d,h=!1,f=n.length;f--;){var c=n[f],g=(o=c[0],l=c[1],u=t,d=e,Math.min(l,d)-Math.max(o,u));if(g>=0&&(c[0]=Math.min(c[0],t),c[1]=Math.max(c[1],e),h=!0,g/(e-t)>.5))return}if(h||n.push([t,e]),this.config.renderTextTracksNatively){var v=this.captionsTracks[r];this.Cues.newCue(v,t,e,i)}else{var m=this.Cues.newCue(null,t,e,i);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:m,track:r})}},s.onInitPtsFound=function(r,t){var e=this,i=t.frag,n=t.id,o=t.initPTS,l=t.timescale,u=t.trackId,d=this.unparsedVttFrags;n===Z&&(this.initPTS[i.cc]={baseTime:o,timescale:l,trackId:u}),d.length&&(this.unparsedVttFrags=[],d.forEach((function(h){e.initPTS[h.frag.cc]?e.onFragLoaded(y.FRAG_LOADED,h):e.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})})))},s.getExistingTrack=function(r,t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var n=e.textTracks[i];if(po(n,{name:r,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null},s.createCaptionsTrack=function(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)},s.createNativeTrack=function(r){if(!this.captionsTracks[r]){var t=this.captionsProperties,e=this.captionsTracks,i=this.media,n=t[r],o=n.label,l=n.languageCode,u=this.getExistingTrack(o,l);if(u)e[r]=u,Je(e[r]),to(e[r],i);else{var d=this.createTextTrack("captions",o,l);d&&(d[r]=!0,e[r]=d)}}},s.createNonNativeTrack=function(r){if(!this.nonNativeCaptionsTracks[r]){var t=this.captionsProperties[r];if(t){var e={_id:r,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[r]=e,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]})}}},s.createTextTrack=function(r,t,e){var i=this.media;if(i)return i.addTextTrack(r,t,e)},s.onMediaAttaching=function(r,t){this.media=t.media,t.mediaSource||this._cleanTracks()},s.onMediaDetaching=function(r,t){var e=!!t.transferMedia;if(this.media=null,!e){var i=this.captionsTracks;Object.keys(i).forEach((function(n){Je(i[n]),delete i[n]})),this.nonNativeCaptionsTracks={}}},s.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},s._cleanTracks=function(){var r=this.media;if(r){var t=r.textTracks;if(t)for(var e=0;e<t.length;e++)Je(t[e])}},s.onSubtitleTracksUpdated=function(r,t){var e=this,i=t.subtitleTracks||[],n=i.some((function(h){return h.textCodec===vn}));if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Cs(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var o=this.media,l=o?Jr(o.textTracks):null;if(this.tracks.forEach((function(h,f){var c;if(l){for(var g=null,v=0;v<l.length;v++)if(l[v]&&po(l[v],h)){g=l[v],l[v]=null;break}g&&(c=g)}if(c)Je(c);else{var m=mo(h);(c=e.createTextTrack(m,h.name,h.lang))&&(c.mode="disabled")}c&&e.textTracks.push(c)})),l!=null&&l.length){var u=l.filter((function(h){return h!==null})).map((function(h){return h.label}));u.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: "+u.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var d=this.tracks.map((function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}}));this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:d})}}},s.onManifestLoaded=function(r,t){var e=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(i){var n=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(n){var o="textTrack"+n[1],l=e.captionsProperties[o];l&&(l.label=i.name,i.lang&&(l.languageCode=i.lang),l.media=i)}}))},s.closedCaptionsForLevel=function(r){var t=this.hls.levels[r.level];return t?.attrs["CLOSED-CAPTIONS"]},s.onFragLoading=function(r,t){if(this.enabled&&t.frag.type===Z){var e,i,n=this.cea608Parser1,o=this.cea608Parser2,l=this.lastSn,u=t.frag,d=u.cc,h=u.sn,f=(e=(i=t.part)==null?void 0:i.index)!=null?e:-1;n&&o&&(h!==l+1||h===l&&f!==this.lastPartIndex+1||d!==this.lastCc)&&(n.reset(),o.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=f}},s.onFragLoaded=function(r,t){var e=t.frag,i=t.payload;if(e.type===te)if(i.byteLength){var n=e.decryptdata,o="stats"in t;if(n==null||!n.encrypted||o){var l=this.tracks[e.level],u=this.vttCCs;u[e.cc]||(u[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),l&&l.textCodec===vn?this._parseIMSC1(e,i):this._parseVTTs(t)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})},s._parseIMSC1=function(r,t){var e=this,i=this.hls;fo(t,this.initPTS[r.cc],(function(n){e._appendCues(n,r.level),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})}),(function(n){i.logger.log("Failed to parse IMSC1: "+n),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:n})}))},s._parseVTTs=function(r){var t,e=this,i=r.frag,n=r.payload,o=this.initPTS,l=this.unparsedVttFrags,u=o.length-1;if(o[i.cc]||u!==-1){var d=this.hls;Qu((t=i.initSegment)!=null&&t.data?re(i.initSegment.data,new Uint8Array(n)).buffer:n,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,(function(h){e._appendCues(h,i.level),d.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})}),(function(h){var f=h.message==="Missing initPTS for VTT MPEGTS";f?l.push(r):e._fallbackToIMSC1(i,n),d.logger.log("Failed to parse VTT cue: "+h),f&&u>i.cc||d.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:h})}))}else l.push(r)},s._fallbackToIMSC1=function(r,t){var e=this,i=this.tracks[r.level];i.textCodec||fo(t,this.initPTS[r.cc],(function(){i.textCodec=vn,e._parseIMSC1(r,t)}),(function(){i.textCodec="wvtt"}))},s._appendCues=function(r,t){var e=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||i.mode==="disabled")return;r.forEach((function(l){return eo(i,l)}))}else{var n=this.tracks[t];if(!n)return;var o=n.default?"default":"subtitles"+t;e.trigger(y.CUES_PARSED,{type:"subtitles",cues:r,track:o})}},s.onFragDecrypted=function(r,t){t.frag.type===te&&this.onFragLoaded(y.FRAG_LOADED,t)},s.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},s.onFragParsingUserdata=function(r,t){if(this.enabled&&this.config.enableCEA708Captions){var e=t.frag,i=t.samples;if(e.type!==Z||this.closedCaptionsForLevel(e)!=="NONE")for(var n=0;n<i.length;n++){var o=i[n].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();var l=this.extractCea608Data(o);this.cea608Parser1.addData(i[n].pts,l[0]),this.cea608Parser2.addData(i[n].pts,l[1])}}}},s.onBufferFlushing=function(r,t){var e=t.startOffset,i=t.endOffset,n=t.endOffsetSubtitles,o=t.type,l=this.media;if(l&&!(l.currentTime<i)){if(!o||o==="video"){var u=this.captionsTracks;Object.keys(u).forEach((function(h){return un(u[h],e,i)}))}if(this.config.renderTextTracksNatively&&e===0&&n!==void 0){var d=this.textTracks;Object.keys(d).forEach((function(h){return un(d[h],e,n)}))}}},s.extractCea608Data=function(r){for(var t=[[],[]],e=31&r[0],i=2,n=0;n<e;n++){var o=r[i++],l=127&r[i++],u=127&r[i++];if((l!==0||u!==0)&&(4&o)!=0){var d=3&o;d!==0&&d!==1||(t[d].push(l),t[d].push(u))}}return t},a})();function mo(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function po(a,s){return!!a&&a.kind===mo(s)&&Ji(s,a)}var Ju=/\s/,td={newCue:function(a,s,r,t){for(var e,i,n,o,l,u=[],d=self.VTTCue||self.TextTrackCue,h=0;h<t.rows.length;h++)if(n=!0,o=0,l="",!(e=t.rows[h]).isEmpty()){for(var f,c=0;c<e.chars.length;c++)Ju.test(e.chars[c].uchar)&&n?o++:(l+=e.chars[c].uchar,n=!1);e.cueStartTime=s,s===r&&(r+=1e-4),o>=16?o--:o++;var g=lo(l.trim()),v=gn(s,r,g);a!=null&&(f=a.cues)!=null&&f.getCueById(v)||((i=new d(s,r,g)).id=v,i.line=h+1,i.align="left",i.position=10+Math.min(80,10*Math.floor(8*o/32)),u.push(i))}return a&&u.length&&(u.sort((function(m,p){return m.line==="auto"||p.line==="auto"?0:m.line>8&&p.line>8?p.line-m.line:m.line-p.line})),u.forEach((function(m){return eo(a,m)}))),u}},ed=/(\d+)-(\d+)\/(\d+)/,yo=(function(){function a(r){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=r.fetchSetup||rd,this.controller=new self.AbortController,this.stats=new di}var s=a.prototype;return s.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},s.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},s.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},s.load=function(r,t,e){var i=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var o=(function(c,g){var v={method:"GET",mode:"cors",credentials:"same-origin",signal:g,headers:new self.Headers(mt({},c.headers))};return c.rangeEnd&&v.headers.set("Range","bytes="+c.rangeStart+"-"+String(c.rangeEnd-1)),v})(r,this.controller.signal),l=r.responseType==="arraybuffer",u=l?"byteLength":"length",d=t.loadPolicy,h=d.maxTimeToFirstByteMs,f=d.maxLoadTimeMs;this.context=r,this.config=t,this.callbacks=e,this.request=this.fetchSetup(r,o),self.clearTimeout(this.requestTimeout),t.timeout=h&&B(h)?h:f,this.requestTimeout=self.setTimeout((function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(n,r,i.response))}),t.timeout),(we(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then((function(c){var g;i.response=i.loader=c;var v=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=f,i.requestTimeout=self.setTimeout((function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(n,r,i.response))}),f-(v-n.loading.start)),!c.ok){var m=c.status,p=c.statusText;throw new id(p||"fetch, bad network response",m,c)}n.loading.first=v,n.total=(function(T){var S=T.get("Content-Range");if(S){var R=(function(L){var b=ed.exec(L);if(b)return parseInt(b[2])-parseInt(b[1])+1})(S);if(B(R))return R}var A=T.get("Content-Length");if(A)return parseInt(A)})(c.headers)||n.total;var E=(g=i.callbacks)==null?void 0:g.onProgress;return E&&B(t.highWaterMark)?i.loadProgressively(c,n,r,t.highWaterMark,E):l?c.arrayBuffer():r.responseType==="json"?c.json():c.text()})).then((function(c){var g,v,m=i.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(i.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);var p=c[u];p&&(n.loaded=n.total=p);var E={url:m.url,data:c,code:m.status},T=(g=i.callbacks)==null?void 0:g.onProgress;T&&!B(t.highWaterMark)&&T(n,r,c,m),(v=i.callbacks)==null||v.onSuccess(E,n,r,m)})).catch((function(c){var g;if(self.clearTimeout(i.requestTimeout),!n.aborted){var v=c&&c.code||0,m=c?c.message:null;(g=i.callbacks)==null||g.onError({code:v,text:m},r,c?c.details:null,n)}}))},s.getCacheAge=function(){var r=null;if(this.response){var t=this.response.headers.get("age");r=t?parseFloat(t):null}return r},s.getResponseHeader=function(r){return this.response?this.response.headers.get(r):null},s.loadProgressively=function(r,t,e,i,n){i===void 0&&(i=0);var o=new as,l=r.body.getReader(),u=function(){return l.read().then((function(d){if(d.done)return o.dataLength&&n(t,e,o.flush().buffer,r),Promise.resolve(new ArrayBuffer(0));var h=d.value,f=h.length;return t.loaded+=f,f<i||o.dataLength?(o.push(h),o.dataLength>=i&&n(t,e,o.flush().buffer,r)):n(t,e,h.buffer,r),u()})).catch((function(){return Promise.reject()}))};return u()},a})();function rd(a,s){return new self.Request(a.url,s)}var id=(function(a){function s(r,t,e){var i;return(i=a.call(this,r)||this).code=void 0,i.details=void 0,i.code=t,i.details=e,i}return ut(s,a),s})(Be(Error)),nd=/^age:\s*[\d.]+\s*$/im,Eo=(function(){function a(r){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=r&&r.xhrSetup||null,this.stats=new di,this.retryDelay=0}var s=a.prototype;return s.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},s.abortInternal=function(){var r=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),r&&(r.onreadystatechange=null,r.onprogress=null,r.readyState!==4&&(this.stats.aborted=!0,r.abort()))},s.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},s.load=function(r,t,e){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=r,this.config=t,this.callbacks=e,this.loadInternal()},s.loadInternal=function(){var r=this,t=this.config,e=this.context;if(t&&e){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;var o=this.xhrSetup;o?Promise.resolve().then((function(){if(r.loader===i&&!r.stats.aborted)return o(i,e.url)})).catch((function(l){if(r.loader===i&&!r.stats.aborted)return i.open("GET",e.url,!0),o(i,e.url)})).then((function(){r.loader!==i||r.stats.aborted||r.openAndSendXhr(i,e,t)})).catch((function(l){var u;(u=r.callbacks)==null||u.onError({code:i.status,text:l.message},e,i,n)})):this.openAndSendXhr(i,e,t)}},s.openAndSendXhr=function(r,t,e){r.readyState||r.open("GET",t.url,!0);var i=t.headers,n=e.loadPolicy,o=n.maxTimeToFirstByteMs,l=n.maxLoadTimeMs;if(i)for(var u in i)r.setRequestHeader(u,i[u]);t.rangeEnd&&r.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=t.responseType,self.clearTimeout(this.requestTimeout),e.timeout=o&&B(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),e.timeout),r.send()},s.readystatechange=function(){var r=this.context,t=this.loader,e=this.stats;if(r&&t){var i=t.readyState,n=this.config;if(!e.aborted&&i>=2&&(e.loading.first===0&&(e.loading.first=Math.max(self.performance.now(),e.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(e.loading.first-e.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var o=t.status,l=t.responseType==="text"?t.responseText:null;if(o>=200&&o<300){var u=l??t.response;if(u!=null){var d,h;e.loading.end=Math.max(self.performance.now(),e.loading.first);var f=t.responseType==="arraybuffer"?u.byteLength:u.length;e.loaded=e.total=f,e.bwEstimate=8e3*e.total/(e.loading.end-e.loading.first);var c=(d=this.callbacks)==null?void 0:d.onProgress;c&&c(e,r,u,t);var g={url:t.responseURL,data:u,code:o};return void((h=this.callbacks)==null||h.onSuccess(g,e,r,t))}}var v,m=n.loadPolicy.errorRetry;Dr(m,e.retry,!1,{url:r.url,data:void 0,code:o})?this.retry(m):(ct.error(o+" while loading "+r.url),(v=this.callbacks)==null||v.onError({code:o,text:t.statusText},r,t,e))}}},s.loadtimeout=function(){if(this.config){var r=this.config.loadPolicy.timeoutRetry;if(Dr(r,this.stats.retry,!0))this.retry(r);else{var t;ct.warn("timeout while loading "+((t=this.context)==null?void 0:t.url));var e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}},s.retry=function(r){var t=this.context,e=this.stats;this.retryDelay=Ti(r,e.retry),e.retry++,ct.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t?.url+", retrying "+e.retry+"/"+r.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},s.loadprogress=function(r){var t=this.stats;t.loaded=r.loaded,r.lengthComputable&&(t.total=r.total)},s.getCacheAge=function(){var r=null;if(this.loader&&nd.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");r=t?parseFloat(t):null}return r},s.getResponseHeader=function(r){return this.loader&&new RegExp("^"+r+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(r):null},a})(),ad=ft(ft({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Eo,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Qo,bufferController:ql,capLevelController:Xl,errorController:Jo,fpsController:ku,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:xa,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:td,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Ou,subtitleTrackController:Mu,timelineController:Zu,audioStreamController:Hl,audioTrackController:Yl,emeController:Qs,cmcdController:Lu,contentSteeringController:Iu,interstitialsController:wu});function En(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(En):Object.keys(a).reduce((function(s,r){return s[r]=En(a[r]),s}),{}):a}function sd(a,s){var r=a.loader;r!==yo&&r!==Eo?(s.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1})()&&(a.loader=yo,a.progressive=!0,a.enableSoftwareAES=!0,s.log("[config]: Progressive streaming enabled, using FetchLoader"))}var od=(function(a){function s(t,e){var i;return(i=a.call(this,"gap-controller",t.logger)||this).hls=void 0,i.fragmentTracker=void 0,i.media=null,i.mediaSource=void 0,i.nudgeRetry=0,i.stallReported=!1,i.stalled=null,i.moved=!1,i.seeking=!1,i.buffered={},i.lastCurrentTime=0,i.ended=0,i.waiting=0,i.onMediaPlaying=function(){i.ended=0,i.waiting=0},i.onMediaWaiting=function(){var n;(n=i.media)!=null&&n.seeking||(i.waiting=self.performance.now(),i.tick())},i.onMediaEnded=function(){var n;i.hls&&(i.ended=((n=i.media)==null?void 0:n.currentTime)||1,i.hls.trigger(y.MEDIA_ENDED,{stalled:!1}))},i.hls=t,i.fragmentTracker=e,i.registerListeners(),i}ut(s,a);var r=s.prototype;return r.registerListeners=function(){var t=this.hls;t&&(t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.BUFFER_APPENDED,this.onBufferAppended,this))},r.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.BUFFER_APPENDED,this.onBufferAppended,this))},r.destroy=function(){a.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},r.onMediaAttached=function(t,e){this.setInterval(100),this.mediaSource=e.mediaSource;var i=this.media=e.media;Bt(i,"playing",this.onMediaPlaying),Bt(i,"waiting",this.onMediaWaiting),Bt(i,"ended",this.onMediaEnded)},r.onMediaDetaching=function(t,e){this.clearInterval();var i=this.media;i&&(Ht(i,"playing",this.onMediaPlaying),Ht(i,"waiting",this.onMediaWaiting),Ht(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},r.onBufferAppended=function(t,e){this.buffered=e.timeRanges},r.tick=function(){var t;if((t=this.media)!=null&&t.readyState&&this.hasBuffered){var e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}},r.poll=function(t,e){var i,n,o=(i=this.hls)==null?void 0:i.config;if(o){var l=this.media;if(l){var u=l.seeking,d=this.seeking&&!u,h=!this.seeking&&u,f=l.paused&&!u||l.ended||l.playbackRate===0;if(this.seeking=u,t!==e)return e&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,o.nudgeOnVideoHole&&!f&&t>e&&this.nudgeOnVideoHole(t,e)),void(this.waiting===0&&this.stallResolved(t));if(h||d)d&&this.stallResolved(t);else{if(f)return this.nudgeRetry=0,this.stallResolved(t),void(!this.ended&&l.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!1})));if(tt.getBuffered(l).length){var c=tt.bufferInfo(l,t,0),g=c.nextStart||0,v=this.fragmentTracker;if(u&&v&&this.hls){var m=To(this.hls.inFlightFragments,t),p=c.len>2,E=!g||m||g-t>2&&!v.getPartialFragment(t);if(p||E)return;this.moved=!1}var T=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&v){if(!(c.len>0||g))return;var S=Math.max(g,c.start||0)-t,R=T!=null&&T.live?2*T.targetduration:2,A=ii(t,v);if(S>0&&(S<=R||A))return void(l.paused||this._trySkipBufferHole(A))}var L=o.detectStallWithCurrentTimeMs,b=self.performance.now(),k=this.waiting,I=this.stalled;if(I===null){if(!(k>0&&b-k<L))return void(this.stalled=b);I=this.stalled=k}var D=b-I;if(!u&&(D>=L||k)&&this.hls){var P;if(((P=this.mediaSource)==null?void 0:P.readyState)==="ended"&&(T==null||!T.live)&&Math.abs(t-(T?.edge||0))<1)return this.ended?void 0:(this.ended=t||1,void this.hls.trigger(y.MEDIA_ENDED,{stalled:!0}));if(this._reportStall(c),!this.media||!this.hls)return}var M=tt.bufferInfo(l,t,o.maxBufferHole);this._tryFixBufferStall(M,D,t)}else this.nudgeRetry=0}}}},r.stallResolved=function(t){var e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){var i=self.performance.now()-e;this.log("playback not stuck anymore @"+t+", after "+Math.round(i)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(y.STALL_RESOLVED,{})}},r.nudgeOnVideoHole=function(t,e){var i,n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&n&&n.length>1&&t>n.end(0)){var o=tt.bufferedInfo(tt.timeRangesToArray(this.buffered.audio),t,0);if(o.len>1&&e>=o.start){var l=tt.timeRangesToArray(n),u=tt.bufferedInfo(l,e,0).bufferedIndex;if(u>-1&&u<l.length-1){var d=tt.bufferedInfo(l,t,0).bufferedIndex,h=l[u].end,f=l[u+1].start;if((d===-1||d>u)&&f-h<1&&t-h<2){var c=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+t+" hole: "+h+" -> "+f+" buffered index: "+d);this.warn(c.message),this.media.currentTime+=1e-6;var g=ii(t,this.fragmentTracker);g&&"fragment"in g?g=g.fragment:g||(g=void 0);var v=tt.bufferInfo(this.media,t,0);this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:c,reason:c.message,frag:g,buffer:v.len,bufferInfo:v})}}}}},r._tryFixBufferStall=function(t,e,i){var n,o,l=this.fragmentTracker,u=this.media,d=(n=this.hls)==null?void 0:n.config;if(u&&l&&d){var h=(o=this.hls)==null?void 0:o.latestLevelDetails,f=ii(i,l);if((f||h!=null&&h.live&&i<h.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;var c=t.buffered,g=this.adjacentTraversal(t,i);(c&&c.length>1&&t.len>d.maxBufferHole||t.nextStart&&(t.nextStart-i<d.maxBufferHole||g))&&(e>1e3*d.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}},r.adjacentTraversal=function(t,e){var i=this.fragmentTracker,n=t.nextStart;if(i&&n){var o=i.getFragAtPos(e,Z),l=i.getFragAtPos(n,Z);if(o&&l)return l.sn-o.sn<2}return!1},r._reportStall=function(t){var e=this.hls,i=this.media,n=this.stallReported,o=this.stalled;if(!n&&o!==null&&i&&e){this.stallReported=!0;var l=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+Et(t)+")");this.warn(l.message),e.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:t.len,bufferInfo:t,stalled:{start:o}})}},r._trySkipBufferHole=function(t){var e,i=this.fragmentTracker,n=this.media,o=(e=this.hls)==null?void 0:e.config;if(!n||!i||!o)return 0;var l=n.currentTime,u=tt.bufferInfo(n,l,0),d=l<u.start?u.start:u.nextStart;if(d&&this.hls){var h=u.len<=o.maxBufferHole,f=u.len>0&&u.len<1&&n.readyState<3,c=d-l;if(c>0&&(h||f)){if(c>o.maxBufferHole){var g=!1;if(l===0){var v=i.getAppendedFrag(0,Z);v&&d<v.end&&(g=!0)}if(!g&&t){var m;if((m=this.hls.loadLevelObj)==null||!m.details||To(this.hls.inFlightFragments,d))return 0;for(var p=!1,E=t.end;E<d;){var T=ii(E,i);if(!T){p=!0;break}E+=T.duration}if(p)return 0}}var S=Math.max(d+.05,l+.1);if(this.warn("skipping hole, adjusting currentTime from "+l+" to "+S),this.moved=!0,n.currentTime=S,t==null||!t.gap){var R=new Error("fragment loaded with buffer holes, seeking from "+l+" to "+S),A={type:K.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:R,reason:R.message,buffer:u.len,bufferInfo:u};t&&("fragment"in t?A.part=t:A.frag=t),this.hls.trigger(y.ERROR,A)}return S}}return 0},r._tryNudgeBuffer=function(t){var e=this.hls,i=this.media,n=this.nudgeRetry,o=e?.config;if(!i||!o)return 0;var l=i.currentTime;if(this.nudgeRetry++,n<o.nudgeMaxRetry){var u=l+(n+1)*o.nudgeOffset,d=new Error("Nudging 'currentTime' from "+l+" to "+u);this.warn(d.message),i.currentTime=u,e.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:t.len,bufferInfo:t})}else{var h=new Error("Playhead still not moving while enough data buffered @"+l+" after "+o.nudgeMaxRetry+" nudges");this.error(h.message),e.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,error:h,fatal:!0,buffer:t.len,bufferInfo:t})}},yt(s,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])})(Ia);function To(a,s){var r=So(a.main);if(r&&r.start<=s)return r;var t=So(a.audio);return t&&t.start<=s?t:null}function So(a){if(!a)return null;switch(a.state){case C.IDLE:case C.STOPPED:case C.ENDED:case C.ERROR:return null}return a.frag}function ii(a,s){return s.getAppendedFrag(a,Z)||s.getPartialFragment(a)}function Tn(){if(typeof self<"u")return self.VTTCue||self.TextTrackCue}function Sn(a,s,r,t,e){var i=new a(s,r,"");try{i.value=t,e&&(i.type=e)}catch{i=new a(s,r,Et(e?ft({type:e},t):t))}return i}var ni=(function(){var a=Tn();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})(),ld=(function(){function a(r){var t=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=function(){t.hls&&t.hls.trigger(y.EVENT_CUE_ENTER,{})},this.hls=r,this._registerListeners()}var s=a.prototype;return s.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},s._registerListeners=function(){var r=this.hls;r&&(r.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))},s._unregisterListeners=function(){var r=this.hls;r&&(r.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))},s.onMediaAttaching=function(r,t){var e;this.media=t.media,((e=t.overrides)==null?void 0:e.cueRemoval)===!1&&(this.removeCues=!1)},s.onMediaAttached=function(){var r,t=(r=this.hls)==null?void 0:r.latestLevelDetails;t&&this.updateDateRangeCues(t)},s.onMediaDetaching=function(r,t){this.media=null,t.transferMedia||(this.id3Track&&(this.removeCues&&Je(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},s.onManifestLoading=function(){this.dateRangeCuesAppended={}},s.createTrack=function(r){var t=this.getID3Track(r.textTracks);return t.mode="hidden",t},s.getID3Track=function(r){if(this.media){for(var t=0;t<r.length;t++){var e=r[t];if(e.kind==="metadata"&&e.label==="id3")return to(e,this.media),e}return this.media.addTextTrack("metadata","id3")}},s.onFragParsingMetadata=function(r,t){if(this.media&&this.hls){var e=this.hls.config,i=e.enableEmsgMetadataCues,n=e.enableID3MetadataCues;if(i||n){var o=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var l=Tn();if(l)for(var u=0;u<o.length;u++){var d=o[u].type;if((d!==Qt.emsg||i)&&n){var h=fs(o[u].data),f=o[u].pts,c=f+o[u].duration;c>ni&&(c=ni),c-f<=0&&(c=f+.25);for(var g=0;g<h.length;g++){var v=h[g];if(!cs(v)){this.updateId3CueEnds(f,d);var m=Sn(l,f,c,v,d);m&&this.id3Track.addCue(m)}}}}}}},s.updateId3CueEnds=function(r,t){var e,i=(e=this.id3Track)==null?void 0:e.cues;if(i)for(var n=i.length;n--;){var o=i[n];o.type===t&&o.startTime<r&&o.endTime===ni&&(o.endTime=r)}},s.onBufferFlushing=function(r,t){var e=t.startOffset,i=t.endOffset,n=t.type,o=this.id3Track,l=this.hls;if(l){var u=l.config,d=u.enableEmsgMetadataCues,h=u.enableID3MetadataCues;o&&(d||h)&&un(o,e,i,n==="audio"?function(f){return f.type===Qt.audioId3&&h}:n==="video"?function(f){return f.type===Qt.emsg&&d}:function(f){return f.type===Qt.audioId3&&h||f.type===Qt.emsg&&d})}},s.onLevelUpdated=function(r,t){var e=t.details;this.updateDateRangeCues(e,!0)},s.onLevelPtsUpdated=function(r,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)},s.updateDateRangeCues=function(r,t){var e=this;if(this.hls&&this.media){var i=this.hls.config,n=i.assetPlayerId,o=i.timelineOffset,l=i.enableDateRangeMetadataCues,u=i.interstitialsController;if(l){var d=Tn();if(n&&o&&!u){var h=r.fragmentStart,f=r.fragmentEnd,c=this.assetCue;c?(c.startTime=h,c.endTime=f):d&&(c=this.assetCue=Sn(d,h,f,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"))&&(c.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(c),c.addEventListener("enter",this.onEventCueEnter))}if(r.hasProgramDateTime){var g,v=this.id3Track,m=r.dateRanges,p=Object.keys(m),E=this.dateRangeCuesAppended;if(v&&t)if((g=v.cues)!=null&&g.length)for(var T=Object.keys(E).filter((function(k){return!p.includes(k)})),S=function(){var k,I=T[R],D=(k=E[I])==null?void 0:k.cues;delete E[I],D&&Object.keys(D).forEach((function(P){var M=D[P];if(M){M.removeEventListener("enter",e.onEventCueEnter);try{v.removeCue(M)}catch{}}}))},R=T.length;R--;)S();else E=this.dateRangeCuesAppended={};var A=r.fragments[r.fragments.length-1];if(p.length!==0&&B(A?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var L=function(){var k=p[b],I=m[k],D=I.startTime,P=E[k],M=P?.cues||{},O=P?.durationKnown||!1,w=ni,F=I.duration;if(I.endDate&&F!==null)w=D+F,O=!0;else if(I.endOnNext&&!O){var x=p.reduce((function(dt,rt){if(rt!==I.id){var V=m[rt];if(V.class===I.class&&V.startDate>I.startDate&&(!dt||I.startDate<dt.startDate))return V}return dt}),null);x&&(w=x.startTime,O=!0)}for(var N,H=Object.keys(I.attr),U=0;U<H.length;U++){var G=H[U];if((N=G)!=="ID"&&N!=="CLASS"&&N!=="CUE"&&N!=="START-DATE"&&N!=="DURATION"&&N!=="END-DATE"&&N!=="END-ON-NEXT"){var X=M[G];if(X)!O||P!=null&&P.durationKnown?Math.abs(X.startTime-D)>.01&&(X.startTime=D,X.endTime=w):X.endTime=w;else if(d){var $=I.attr[G];ol(G)&&($=Fn($));var Y=Sn(d,D,w,{key:G,data:$},Qt.dateRange);Y&&(Y.id=k,e.id3Track.addCue(Y),M[G]=Y,u&&(G!=="X-ASSET-LIST"&&G!=="X-ASSET-URL"||Y.addEventListener("enter",e.onEventCueEnter)))}}}E[k]={cues:M,dateRange:I,durationKnown:O}},b=0;b<p.length;b++)L()}}}}},a})(),ud=(function(){function a(r){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var e=t.media,i=t.levelDetails;if(e&&i){t.currentTime=e.currentTime;var n=t.computeLatency();if(n!==null){t._latency=n;var o=t.config,l=o.lowLatencyMode,u=o.maxLiveSyncPlaybackRate;if(l&&u!==1&&i.live){var d=t.targetLatency;if(d!==null){var h=n-d;if(h<Math.min(t.maxLatency,d+i.targetduration)&&h>.05&&t.forwardBufferLength>1){var f=Math.min(2,Math.max(1,u)),c=Math.round(2/(1+Math.exp(-.75*h-t.edgeStalled))*20)/20,g=Math.min(f,Math.max(1,c));t.changeMediaPlaybackRate(e,g)}else e.playbackRate!==1&&e.playbackRate!==0&&t.changeMediaPlaybackRate(e,1)}}}}},this.hls=r,this.config=r.config,this.registerListeners()}var s=a.prototype;return s.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},s.registerListeners=function(){var r=this.hls;r&&(r.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(y.ERROR,this.onError,this))},s.unregisterListeners=function(){var r=this.hls;r&&(r.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(y.ERROR,this.onError,this))},s.onMediaAttached=function(r,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},s.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},s.onManifestLoading=function(){this._latency=null,this.stallCount=0},s.onLevelUpdated=function(r,t){var e=t.details;e.advanced&&this.onTimeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},s.onError=function(r,t){var e;t.details===_.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(e=this.levelDetails)!=null&&e.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},s.changeMediaPlaybackRate=function(r,t){var e,i;r.playbackRate!==t&&((e=this.hls)==null||e.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((i=this.targetLatency)==null?void 0:i.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+r.playbackRate+" to "+t),r.playbackRate=t)},s.estimateLiveEdge=function(){var r=this.levelDetails;return r===null?null:r.edge+r.age},s.computeLatency=function(){var r=this.estimateLiveEdge();return r===null?null:r-this.currentTime},yt(a,[{key:"levelDetails",get:function(){var r;return((r=this.hls)==null?void 0:r.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var r=this.config;if(r.liveMaxLatencyDuration!==void 0)return r.liveMaxLatencyDuration;var t=this.levelDetails;return t?r.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var r=this.levelDetails;if(r===null||this.hls===null)return null;var t=r.holdBack,e=r.partHoldBack,i=r.targetduration,n=this.config,o=n.liveSyncDuration,l=n.liveSyncDurationCount,u=n.lowLatencyMode,d=this.hls.userConfig,h=u&&e||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=o!==void 0?o:l*i);var f=i;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)},set:function(r){this.stallCount=0,this.config.liveSyncDuration=r,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var r=this.estimateLiveEdge(),t=this.targetLatency;if(r===null||t===null)return null;var e=this.levelDetails;if(e===null)return null;var i=e.edge,n=r-t-this.edgeStalled,o=i-e.totalduration,l=i-(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.min(Math.max(o,n),l)}},{key:"drift",get:function(){var r=this.levelDetails;return r===null?1:r.drift}},{key:"edgeStalled",get:function(){var r=this.levelDetails;if(r===null)return 0;var t=3*(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.max(r.age-t,0)}},{key:"forwardBufferLength",get:function(){var r=this.media,t=this.levelDetails;if(!r||!t)return 0;var e=r.buffered.length;return(e?r.buffered.end(e-1):t.edge)-this.currentTime}}])})(),dd=(function(a){function s(t,e){var i;return(i=a.call(this,t,"level-controller")||this)._levels=[],i._firstLevel=-1,i._maxAutoLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=e,i._registerListeners(),i}ut(s,a);var r=s.prototype;return r._registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this),t.on(y.ERROR,this.onError,this)},r._unregisterListeners=function(){var t=this.hls;t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this),t.off(y.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),a.prototype.destroy.call(this)},r.stopLoad=function(){this._levels.forEach((function(t){t.loadError=0,t.fragmentError=0})),a.prototype.stopLoad.call(this)},r.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},r.onManifestLoading=function(t,e){this.resetLevels()},r.onManifestLoaded=function(t,e){var i=this,n=this.hls.config.preferManagedMediaSource,o=[],l={},u={},d=!1,h=!1,f=!1;e.levels.forEach((function(c){var g=c.attrs,v=c.audioCodec,m=c.videoCodec;v&&(c.audioCodec=v=Lr(v,n)||void 0),m&&(m=c.videoCodec=(function(w){for(var F=w.split(","),x=0;x<F.length;x++){var N=F[x].split(".");N.length>2&&N[0]==="avc1"&&(F[x]="avc1."+parseInt(N[1]).toString(16)+("000"+parseInt(N[2]).toString(16)).slice(-4))}return F.join(",")})(m));var p=c.width,E=c.height,T=c.unknownCodecs,S=T?.length||0;if(d||(d=!(!p||!E)),h||(h=!!m),f||(f=!!v),S||v&&!i.isAudioSupported(v)||m&&!i.isVideoSupported(m))i.log('Some or all CODECS not supported "'+g.CODECS+'"');else{var R=g.CODECS,A=g["FRAME-RATE"],L=g["HDCP-LEVEL"],b=g["PATHWAY-ID"],k=g.RESOLUTION,I=g["VIDEO-RANGE"],D=(b||".")+"-"+c.bitrate+"-"+k+"-"+A+"-"+R+"-"+I+"-"+L;if(l[D])if(l[D].uri===c.url||c.attrs["PATHWAY-ID"])l[D].addGroupId("audio",g.AUDIO),l[D].addGroupId("text",g.SUBTITLES);else{var P=u[D]+=1;c.attrs["PATHWAY-ID"]=new Array(P+1).join(".");var M=i.createLevel(c);l[D]=M,o.push(M)}else{var O=i.createLevel(c);l[D]=O,u[D]=1,o.push(O)}}})),this.filterAndSortMediaOptions(o,e,d,h,f)},r.createLevel=function(t){var e=new ar(t),i=t.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){var n=new Error('SUPPLEMENTAL-CODECS not supported "'+i.videoCodec+'"');this.log(n.message),e.supportedResult=Jn(n,[])}return e},r.isAudioSupported=function(t){return ir(t,"audio",this.hls.config.preferManagedMediaSource)},r.isVideoSupported=function(t){return ir(t,"video",this.hls.config.preferManagedMediaSource)},r.filterAndSortMediaOptions=function(t,e,i,n,o){var l,u=this,d=[],h=[],f=t,c=((l=e.stats)==null?void 0:l.parsing)||{};if((i||n)&&o&&(f=f.filter((function(I){var D,P=I.videoCodec,M=I.videoRange,O=I.width,w=I.height;return(!!P||!(!O||!w))&&!!(D=M)&&Rr.indexOf(D)>-1}))),f.length===0)return Promise.resolve().then((function(){if(u.hls){var I="no level with compatible codecs found in manifest",D=I;e.levels.length&&(D="one or more CODECS in variant not supported: "+Et(e.levels.map((function(M){return M.attrs.CODECS})).filter((function(M,O,w){return w.indexOf(M)===O}))),u.warn(D),I+=" ("+D+")");var P=new Error(I);u.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:_.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:P,reason:D})}})),void(c.end=performance.now());e.audioTracks&&Ao(d=e.audioTracks.filter((function(I){return!I.audioCodec||u.isAudioSupported(I.audioCodec)}))),e.subtitles&&Ao(h=e.subtitles);var g=f.slice(0);f.sort((function(I,D){if(I.attrs["HDCP-LEVEL"]!==D.attrs["HDCP-LEVEL"])return(I.attrs["HDCP-LEVEL"]||"")>(D.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&I.height!==D.height)return I.height-D.height;if(I.frameRate!==D.frameRate)return I.frameRate-D.frameRate;if(I.videoRange!==D.videoRange)return Rr.indexOf(I.videoRange)-Rr.indexOf(D.videoRange);if(I.videoCodec!==D.videoCodec){var P=zn(I.videoCodec),M=zn(D.videoCodec);if(P!==M)return M-P}if(I.uri===D.uri&&I.codecSet!==D.codecSet){var O=Ar(I.codecSet),w=Ar(D.codecSet);if(O!==w)return w-O}return I.averageBitrate!==D.averageBitrate?I.averageBitrate-D.averageBitrate:0}));var v=g[0];if(this.steering&&(f=this.steering.filterParsedLevels(f)).length!==g.length){for(var m=0;m<g.length;m++)if(g[m].pathwayId===f[0].pathwayId){v=g[m];break}}this._levels=f;for(var p=0;p<f.length;p++)if(f[p]===v){var E;this._firstLevel=p;var T=v.bitrate,S=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+f.length+" level(s) found, first bitrate: "+T),((E=this.hls.userConfig)==null?void 0:E.abrEwmaDefaultEstimate)===void 0){var R=Math.min(T,this.hls.config.abrEwmaDefaultEstimateMax);R>S&&S===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=R)}break}var A=o&&!n,L=this.hls.config,b=!(!L.audioStreamController||!L.audioTrackController),k={levels:f,audioTracks:d,subtitleTracks:h,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:o,video:n,altAudio:b&&!A&&d.some((function(I){return!!I.url}))};c.end=performance.now(),this.hls.trigger(y.MANIFEST_PARSED,k)},r.onError=function(t,e){!e.fatal&&e.context&&e.context.type===me&&e.context.level===this.level&&this.checkRetry(e)},r.onFragBuffered=function(t,e){var i=e.frag;if(i!==void 0&&i.type===Z){var n=i.elementaryStreams;if(!Object.keys(n).some((function(l){return!!n[l]})))return;var o=this._levels[i.level];o!=null&&o.loadError&&(this.log("Resetting level error count of "+o.loadError+" on frag buffered"),o.loadError=0)}},r.onLevelLoaded=function(t,e){var i,n,o=e.level,l=e.details,u=e.levelInfo;if(!u)return this.warn("Invalid level index "+o),void((n=e.deliveryDirectives)!=null&&n.skip&&(l.deltaUpdateFailed=!0));if(u===this.currentLevel||e.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);var d=u.details;d===e.details&&d.advanced&&(d=void 0),this.playlistLoaded(o,e,d)}else(i=e.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},r.loadPlaylist=function(t){a.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)},r.loadingPlaylist=function(t,e){a.prototype.loadingPlaylist.call(this,t,e);var i=this.getUrlWithDirectives(t.uri,e),n=this.currentLevelIndex,o=t.attrs["PATHWAY-ID"],l=t.details,u=l?.age;this.log("Loading level index "+n+(e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:"")+(o?" Pathway "+o:"")+(u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):"")+" "+i),this.hls.trigger(y.LEVEL_LOADING,{url:i,level:n,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})},r.removeLevel=function(t){var e,i=this;if(this._levels.length!==1){var n=this._levels.filter((function(l,u){return u!==t||(i.steering&&i.steering.removeLevel(l),l===i.currentLevel&&(i.currentLevel=null,i.currentLevelIndex=-1,l.details&&l.details.fragments.forEach((function(d){return d.level=-1}))),!1)}));Ja(n),this._levels=n,this.currentLevelIndex>-1&&(e=this.currentLevel)!=null&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var o=n.length-1;this._firstLevel=Math.min(this._firstLevel,o),this._startLevel&&(this._startLevel=Math.min(this._startLevel,o)),this.hls.trigger(y.LEVELS_UPDATED,{levels:n})}},r.onLevelsUpdated=function(t,e){var i=e.levels;this._levels=i},r.checkMaxAutoUpdated=function(){var t=this.hls,e=t.autoLevelCapping,i=t.maxAutoLevel,n=t.maxHdcpLevel;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(y.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))},yt(s,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;if(e.length!==0){if(t<0||t>=e.length){var i=new Error("invalid level idx"),n=t<0;if(this.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.LEVEL_SWITCH_ERROR,level:t,fatal:n,error:i,reason:i.message}),n)return;t=Math.min(t,e.length-1)}var o=this.currentLevelIndex,l=this.currentLevel,u=l?l.attrs["PATHWAY-ID"]:void 0,d=e[t],h=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=d,o!==t||!l||u!==h){this.log("Switching to level "+t+" ("+(d.height?d.height+"p ":"")+(d.videoRange?d.videoRange+" ":"")+(d.codecSet?d.codecSet+" ":"")+"@"+d.bitrate+")"+(h?" with Pathway "+h:"")+" from level "+o+(u?" with Pathway "+u:""));var f={level:t,attrs:d.attrs,details:d.details,bitrate:d.bitrate,averageBitrate:d.averageBitrate,maxBitrate:d.maxBitrate,realBitrate:d.realBitrate,width:d.width,height:d.height,codecSet:d.codecSet,audioCodec:d.audioCodec,videoCodec:d.videoCodec,audioGroups:d.audioGroups,subtitleGroups:d.subtitleGroups,loaded:d.loaded,loadError:d.loadError,fragmentError:d.fragmentError,name:d.name,id:d.id,uri:d.uri,url:d.url,urlId:0,audioGroupIds:d.audioGroupIds,textGroupIds:d.textGroupIds};this.hls.trigger(y.LEVEL_SWITCHING,f);var c=d.details;if(!c||c.live){var g=this.switchParams(d.uri,l?.details,c);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this.hls.firstAutoLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(t){if(this.steering){var e=this.steering.pathways(),i=t.filter((function(n){return e.indexOf(n)!==-1}));if(t.length<1)return void this.warn("pathwayPriority "+t+" should contain at least one pathway from list: "+e);this.steering.pathwayPriority=i}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}])})(Zi);function Ao(a){var s={};a.forEach((function(r){var t=r.groupId||"";r.id=s[t]=s[t]||0,s[t]++}))}function Lo(){return self.SourceBuffer||self.WebKitSourceBuffer}function Io(){if(!ke())return!1;var a=Lo();return!a||a.prototype&&typeof a.prototype.appendBuffer=="function"&&typeof a.prototype.remove=="function"}var hd=(function(a){function s(t,e,i){var n;return(n=a.call(this,t,e,i,"stream-controller",Z)||this).audioCodecSwap=!1,n.level=-1,n._forceStartLoad=!1,n._hasEnoughToStart=!1,n.altAudio=0,n.audioOnly=!1,n.fragPlaying=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n.onMediaPlaying=function(){n.tick()},n.onMediaSeeked=function(){var o=n.media,l=o?o.currentTime:null;if(l!==null&&B(l)&&(n.log("Media seeked to "+l.toFixed(3)),n.getBufferedFrag(l))){var u=n.getFwdBufferInfoAtPos(o,l,Z,0);u!==null&&u.len!==0?n.tick():n.warn("Main forward buffer length at "+l+' on "seeked" event '+(u?u.len:"empty")+")")}},n.registerListeners(),n}ut(s,a);var r=s.prototype;return r.registerListeners=function(){a.prototype.registerListeners.call(this);var t=this.hls;t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(y.BUFFER_CREATED,this.onBufferCreated,this),t.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},r.unregisterListeners=function(){a.prototype.unregisterListeners.call(this);var t=this.hls;t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(y.BUFFER_CREATED,this.onBufferCreated,this),t.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),a.prototype.onHandlerDestroying.call(this)},r.startLoad=function(t,e){if(this.levels){var i=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var o=n.startLevel;o===-1&&(n.config.testBandwidth&&this.levels.length>1?(o=0,this.bitrateTest=!0):o=n.firstAutoLevel),n.nextLoadLevel=o,this.level=n.loadLevel,this._hasEnoughToStart=!!e}i>0&&t===-1&&!e&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),t=i),this.state=C.IDLE,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=C.STOPPED},r.stopLoad=function(){this._forceStartLoad=!1,a.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case C.WAITING_LEVEL:var t=this.levels,e=this.level,i=t?.[e],n=i?.details;if(n&&(!n.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(n))break;this.state=C.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=C.IDLE;break}break;case C.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate()}this.state===C.IDLE&&this.doTickIdle(),this.onTickEnd()},r.onTickEnd=function(){var t;a.prototype.onTickEnd.call(this),(t=this.media)!=null&&t.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},r.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,i=this.levels,n=this.media;if(e!==null&&(n||this.primaryPrefetch||!this.startFragRequested&&t.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)){var o=this.buffering?t.nextLoadLevel:t.loadLevel;if(i!=null&&i[o]){var l=i[o],u=this.getMainFwdBufferInfo();if(u!==null){var d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){var h={};return this.altAudio===2&&(h.type="video"),this.hls.trigger(y.BUFFER_EOS,h),void(this.state=C.ENDED)}if(this.buffering){t.loadLevel!==o&&t.manualLevel===-1&&this.log("Adapting to level "+o+" from level "+this.level),this.level=t.nextLoadLevel=o;var f=l.details;if(!f||this.state===C.WAITING_LEVEL||this.waitForLive(l))return this.level=o,this.state=C.WAITING_LEVEL,void(this.startFragRequested=!1);var c=u.len,g=this.getMaxBufferLength(l.maxBitrate);if(!(c>=g)){this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);var v=this.backtrackFragment?this.backtrackFragment.start:u.end,m=this.getNextFragment(v,f);if(this.couldBacktrack&&!this.fragPrevious&&m&&wt(m)&&this.fragmentTracker.getState(m)!==Ye){var p,E=((p=this.backtrackFragment)!=null?p:m).sn-f.startSN,T=f.fragments[E-1];T&&m.cc===T.cc&&(m=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,v)){if(!m.gap){var S=this.audioOnly&&!this.altAudio?zt:ae,R=(S===ae?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,S,Z)}m=this.getNextFragmentLoopLoading(m,f,u,Z,g)}m&&(!m.initSegment||m.initSegment.data||this.bitrateTest||(m=m.initSegment),this.loadFragment(m,l,v))}}}}}},r.loadFragment=function(t,e,i){var n=this.fragmentTracker.getState(t);n===or||n===He?wt(t)?this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,e)):a.prototype.loadFragment.call(this,t,e,i):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)},r.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,Z)},r.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(e!=null&&e.readyState){var i,n=this.getAppendedFrag(e.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);var o=this.getLevelDetails();if(o!=null&&o.live){var l=this.getMainFwdBufferInfo();if(!l||l.len<2*o.targetduration)return}if(!e.paused&&t){var u=t[this.hls.nextLoadLevel],d=this.fragLastKbps;i=d&&this.fragCurrent?this.fragCurrent.duration*u.maxBitrate/(1e3*d)+1:0}else i=0;var h=this.getBufferedFrag(e.currentTime+i);if(h){var f=this.followingBufferedFrag(h);if(f){this.abortCurrentFrag();var c=f.maxStartPTS?f.maxStartPTS:f.start,g=f.duration,v=Math.max(h.end,c+Math.min(Math.max(g-this.config.maxFragLookUpTolerance,g*(this.couldBacktrack?.5:.125)),g*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(v,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case C.KEY_LOADING:case C.FRAG_LOADING:case C.FRAG_LOADING_WAITING_RETRY:case C.PARSING:case C.PARSED:this.state=C.IDLE}this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(t,e){a.prototype.flushMainBuffer.call(this,t,e,this.altAudio===2?"video":null)},r.onMediaAttached=function(t,e){a.prototype.onMediaAttached.call(this,t,e);var i=e.media;Bt(i,"playing",this.onMediaPlaying),Bt(i,"seeked",this.onMediaSeeked)},r.onMediaDetaching=function(t,e){var i=this.media;i&&(Ht(i,"playing",this.onMediaPlaying),Ht(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,a.prototype.onMediaDetaching.call(this,t,e),e.transferMedia||(this._hasEnoughToStart=!1)},r.onManifestLoading=function(){a.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},r.onManifestParsed=function(t,e){for(var i,n,o=!1,l=!1,u=0;u<e.levels.length;u++){var d=e.levels[u].audioCodec;d&&(o=o||d.indexOf("mp4a.40.2")!==-1,l=l||d.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=o&&l&&typeof((n=Lo())==null||(i=n.prototype)==null?void 0:i.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},r.onLevelLoading=function(t,e){if(this.levels&&this.state===C.IDLE){var i=e.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=C.WAITING_LEVEL)}},r.onLevelLoaded=function(t,e){var i,n=this.levels,o=this.startFragRequested,l=e.level,u=e.details,d=u.totalduration;if(n){this.log("Level "+l+" loaded ["+u.startSN+","+u.endSN+"]"+(u.lastPartSn?"[part-"+u.lastPartSn+"-"+u.lastPartIndex+"]":"")+", cc ["+u.startCC+", "+u.endCC+"] duration:"+d);var h=e.levelInfo,f=this.fragCurrent;!f||this.state!==C.FRAG_LOADING&&this.state!==C.FRAG_LOADING_WAITING_RETRY||f.level!==e.level&&f.loader&&this.abortCurrentFrag();var c=0;if(u.live||(i=h.details)!=null&&i.live){var g;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;c=this.alignPlaylists(u,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(h.details=u,this.levelLastLoaded=h,o||this.setStartPosition(u,c),this.hls.trigger(y.LEVEL_UPDATED,{details:u,level:l}),this.state===C.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=C.IDLE}o&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}else this.warn("Levels were reset while loading level "+l)},r.synchronizeToLiveEdge=function(t){var e=this.config,i=this.media;if(i){var n=this.hls.liveSyncPosition,o=this.getLoadPosition(),l=t.fragmentStart,u=t.edge,d=o>=l-e.maxFragLookUpTolerance&&o<=u;if(n!==null&&i.duration>n&&(o<n||!d)){var h=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;if((!d&&i.readyState<4||o<u-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),i.readyState))if(this.warn("Playback: "+o.toFixed(3)+" is located too far from the end of live sliding playlist: "+u+", reset currentTime to : "+n.toFixed(3)),this.config.liveSyncMode==="buffered"){var f,c=tt.bufferInfo(i,n,0);if((f=c.buffered)==null||!f.length||c.start<=o)return void(i.currentTime=n);var g=tt.bufferedInfo(c.buffered,o,0).nextStart;g&&(i.currentTime=g)}else i.currentTime=n}}},r._handleFragmentLoadProgress=function(t){var e,i=t.frag,n=t.part,o=t.payload,l=this.levels;if(l){var u=l[i.level];if(u){var d=u.details;if(!d)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var h=u.videoCodec,f=d.PTSKnown||!d.live,c=(e=i.initSegment)==null?void 0:e.data,g=this._getAudioCodec(u),v=this.transmuxer=this.transmuxer||new Ps(this.hls,Z,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=n?n.index:-1,p=m!==-1,E=new Ii(i.level,i.sn,i.stats.chunkCount,o.byteLength,m,p),T=this.initPTS[i.cc];v.push(o,c,g,h,i,n,d.totalduration,f,E,T)}else this.warn("Level "+i.level+" not found on progress")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},r.onAudioTrackSwitching=function(t,e){var i=this,n=this.hls,o=this.altAudio===2;if(kr(e.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(o)return this.fragmentTracker.removeAllFragments(),n.once(y.BUFFER_FLUSHED,(function(){i.hls&&i.hls.trigger(y.AUDIO_TRACK_SWITCHED,e)})),void n.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(y.AUDIO_TRACK_SWITCHED,e)}},r.onAudioTrackSwitched=function(t,e){var i=kr(e.url,this.hls);if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i?2:0,this.tick()},r.onBufferCreated=function(t,e){var i,n,o=e.tracks,l=!1;for(var u in o){var d=o[u];if(d.id==="main"){if(n=u,i=d,u==="video"){var h=o[u];h&&(this.videoBuffer=h.buffer)}}else l=!0}l&&i?(this.log("Alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(t,e){var i=e.frag,n=e.part,o=i.type===Z;if(o){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===C.PARSED&&(this.state=C.IDLE));var l=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),wt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}var u=this.media;u&&(!this._hasEnoughToStart&&tt.getBuffered(u).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),o&&this.tick())},r.onError=function(t,e){var i;if(e.fatal)this.state=C.ERROR;else switch(e.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Z,e);break;case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:e.levelRetry||this.state!==C.WAITING_LEVEL||((i=e.context)==null?void 0:i.type)!==me||(this.state=C.IDLE);break;case _.BUFFER_ADD_CODEC_ERROR:case _.BUFFER_APPEND_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.resetLoadingState();break;case _.BUFFER_FULL_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(e)}},r.onFragLoadEmergencyAborted=function(){this.state=C.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},r.onBufferFlushed=function(t,e){var i=e.type;if(i!==zt||!this.altAudio){var n=(i===ae?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,i,Z),this.tick())}},r.onLevelsUpdated=function(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var t=this.media;if(t){var e=t.currentTime,i=this.startPosition;if(i>=0&&e<i){if(t.seeking)return void this.log("could not seek to "+i+", already seeking at "+e);var n=this.timelineOffset;n&&i&&(i+=n);var o=this.getLevelDetails(),l=tt.getBuffered(t),u=l.length?l.start(0):0,d=u-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<h||this.loadingParts&&d<2*(o?.partTarget||0)))&&(this.log("adjusting start position by "+d+" to match buffer start"),i+=d,this.startPosition=i),e<i&&(this.log("seek to target start position "+i+" from current time "+e+" buffer start "+u),t.currentTime=i)}}},r._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=e.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),e},r._loadBitrateTestFrag=function(t,e){var i=this;t.bitrateTest=!0,this._doFragLoad(t,e).then((function(n){var o=i.hls,l=n?.frag;if(l&&!i.fragContextChanged(l)){e.fragmentError=0,i.state=C.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var u=l.stats;u.parsing.start=u.parsing.end=u.buffering.start=u.buffering.end=self.performance.now(),o.trigger(y.FRAG_LOADED,n),l.bitrateTest=!1}})).catch((function(n){i.state!==C.STOPPED&&i.state!==C.ERROR&&(i.warn(n),i.resetFragmentLoading(t))}))},r._handleTransmuxComplete=function(t){var e=this.playlistType,i=this.hls,n=t.remuxResult,o=t.chunkMeta,l=this.getCurrentContext(o);if(l){var u=l.frag,d=l.part,h=l.level,f=n.video,c=n.text,g=n.id3,v=n.initSegment,m=h.details,p=this.altAudio?void 0:n.audio;if(this.fragContextChanged(u))this.fragmentTracker.removeFragment(u);else{if(this.state=C.PARSING,v){var E=v.tracks;if(E){var T=u.initSegment||u;if(this.unhandledEncryptionError(v,u))return;this._bufferInitSegment(h,E,T,o),i.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:e,tracks:E})}var S=v.initPTS,R=v.timescale,A=this.initPTS[u.cc];if(B(S)&&(!A||A.baseTime!==S||A.timescale!==R)){var L=v.trackId;this.initPTS[u.cc]={baseTime:S,timescale:R,trackId:L},i.trigger(y.INIT_PTS_FOUND,{frag:u,id:e,initPTS:S,timescale:R,trackId:L})}}if(f&&m){p&&f.type==="audiovideo"&&this.logMuxedErr(u);var b=m.fragments[u.sn-1-m.startSN],k=u.sn===m.startSN,I=!b||u.cc>b.cc;if(n.independent!==!1){var D=f.startPTS,P=f.endPTS,M=f.startDTS,O=f.endDTS;if(d)d.elementaryStreams[f.type]={startPTS:D,endPTS:P,startDTS:M,endDTS:O};else if(f.firstKeyFrame&&f.independent&&o.id===1&&!I&&(this.couldBacktrack=!0),f.dropped&&f.independent){var w=this.getMainFwdBufferInfo(),F=(w?w.end:this.getLoadPosition())+this.config.maxBufferHole,x=f.firstKeyFramePTS?f.firstKeyFramePTS:D;if(!k&&F<x-this.config.maxBufferHole&&!I)return void this.backtrack(u);I&&(u.gap=!0),u.setElementaryStreamInfo(f.type,u.start,P,u.start,O,!0)}else k&&D-(m.appliedTimelineOffset||0)>2&&(u.gap=!0);u.setElementaryStreamInfo(f.type,D,P,M,O),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(f,u,d,o,k||I)}else{if(!k&&!I)return void this.backtrack(u);u.gap=!0}}if(p){var N=p.startPTS,H=p.endPTS,U=p.startDTS,G=p.endDTS;d&&(d.elementaryStreams[zt]={startPTS:N,endPTS:H,startDTS:U,endDTS:G}),u.setElementaryStreamInfo(zt,N,H,U,G),this.bufferFragmentData(p,u,d,o)}if(m&&g!=null&&g.samples.length){var X={id:e,frag:u,details:m,samples:g.samples};i.trigger(y.FRAG_PARSING_METADATA,X)}if(m&&c){var $={id:e,frag:u,details:m,samples:c.samples};i.trigger(y.FRAG_PARSING_USERDATA,$)}}}else this.resetWhenMissingContext(o)},r.logMuxedErr=function(t){this.warn((wt(t)?"Media":"Init")+" segment with muxed audiovideo where only video expected: "+t.url)},r._bufferInitSegment=function(t,e,i,n){var o=this;if(this.state===C.PARSING){this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(i));var l=e.audio,u=e.video,d=e.audiovideo;if(l){var h=t.audioCodec,f=Ir(l.codec,h);f==="mp4a"&&(f="mp4a.40.5");var c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f=f.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5");var g=l.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log("Android: force audio codec to "+f)),h&&h!==f&&this.log('Swapping manifest audio codec "'+h+'" for "'+f+'"'),l.levelCodec=f,l.id=Z,this.log("Init audio buffer, container:"+l.container+", codecs[selected/level/parsed]=["+(f||"")+"/"+(h||"")+"/"+l.codec+"]"),delete e.audiovideo}if(u){u.levelCodec=t.videoCodec,u.id=Z;var v=u.codec;if(v?.length===4)switch(v){case"hvc1":case"hev1":u.codec="hvc1.1.6.L120.90";break;case"av01":u.codec="av01.0.04M.08";break;case"avc1":u.codec="avc1.42e01e"}this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+v+"]"+(u.codec!==v?" parsed-corrected="+u.codec:"")+(u.supplemental?" supplemental="+u.supplemental:"")),delete e.audiovideo}d&&(this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+t.codecs+"/"+d.codec+"]"),delete e.video,delete e.audio);var m=Object.keys(e);if(m.length){if(this.hls.trigger(y.BUFFER_CODECS,e),!this.hls)return;m.forEach((function(p){var E=e[p].initSegment;E!=null&&E.byteLength&&o.hls.trigger(y.BUFFER_APPENDING,{type:p,data:E,frag:i,part:null,chunkMeta:n,parent:i.type})}))}this.tickImmediate()}},r.getMainFwdBufferInfo=function(){var t=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,Z)},r.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=C.IDLE},r.checkFragmentChanged=function(){var t=this.media,e=null;if(t&&t.readyState>1&&t.seeking===!1){var i=t.currentTime;if(tt.isBuffered(t,i)?e=this.getAppendedFrag(i):tt.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;var n=this.fragPlaying,o=e.level;n&&e.sn===n.sn&&n.level===o||(this.fragPlaying=e,this.hls.trigger(y.FRAG_CHANGED,{frag:e}),n&&n.level===o||this.hls.trigger(y.LEVEL_SWITCHED,{level:o}))}}},yt(s,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var t=this.levels,e=this.level,i=t?.[e];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t;if(this.fragPlaying)return this.fragPlaying;var e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;return B(e)?this.getAppendedFrag(e):null}},{key:"currentProgramDateTime",get:function(){var t,e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;if(B(e)){var i=this.getLevelDetails(),n=this.currentFrag||(i?Ce(null,i.fragments,e):null);if(n){var o=n.programDateTime;if(o!==null){var l=o+1e3*(e-n.start);return new Date(l)}}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])})(Fi),fd=(function(a){function s(t,e){var i;return(i=a.call(this,"key-loader",e)||this).config=void 0,i.keyIdToKeyInfo={},i.emeController=null,i.config=t,i}ut(s,a);var r=s.prototype;return r.abort=function(t){for(var e in this.keyIdToKeyInfo){var i=this.keyIdToKeyInfo[e].loader;if(i){var n;if(t&&t!==((n=i.context)==null?void 0:n.frag.type))return;i.abort()}}},r.detach=function(){for(var t in this.keyIdToKeyInfo){var e=this.keyIdToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[t]}},r.destroy=function(){for(var t in this.detach(),this.keyIdToKeyInfo){var e=this.keyIdToKeyInfo[t].loader;e&&e.destroy()}this.keyIdToKeyInfo={}},r.createKeyLoadError=function(t,e,i,n,o){return e===void 0&&(e=_.KEY_LOAD_ERROR),new pe({type:K.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:o,error:i,networkDetails:n})},r.loadClear=function(t,e,i){var n=this;if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length){for(var o,l=function(){var f=e[u];if(t.cc<=f.cc&&(!wt(t)||!wt(f)||t.sn<f.sn)||!i&&u==d-1)return{v:n.emeController.selectKeySystemFormat(f).then((function(c){if(n.emeController){f.setKeyFormat(c);var g=Fr(c);return g?n.emeController.getKeySystemAccess([g]):void 0}}))}},u=0,d=e.length;u<d;u++)if(o=l())return o.v}if(this.config.requireKeySystemAccessOnStart){var h=ur(this.config);if(h.length)return this.emeController.getKeySystemAccess(h)}}return null},r.load=function(t){var e=this;return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then((function(i){return e.loadInternal(t,i)})):this.loadInternal(t)},r.loadInternal=function(t,e){var i,n;e&&t.setKeyFormat(e);var o=t.decryptdata;if(!o){var l=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: "+(this.emeController&&this.config.emeEnabled)+")");return Promise.reject(this.createKeyLoadError(t,_.KEY_LOAD_ERROR,l))}var u=o.uri;if(!u)return Promise.reject(this.createKeyLoadError(t,_.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+u+'"')));var d=An(o),h=this.keyIdToKeyInfo[d];if((i=h)!=null&&i.decryptdata.key)return o.key=h.decryptdata.key,Promise.resolve({frag:t,keyInfo:h});if(this.emeController&&(n=h)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then((function(f){var c=f.keyInfo;return o.key=c.decryptdata.key,{frag:t,keyInfo:c}}))}switch(this.log((this.keyIdToKeyInfo[d]?"Rel":"L")+"oading"+(o.keyId?" keyId: "+Vt(o.keyId):"")+" URI: "+o.uri+" from "+t.type+" "+t.level),h=this.keyIdToKeyInfo[d]={decryptdata:o,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},o.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return o.keyFormat==="identity"?this.loadKeyHTTP(h,t):this.loadKeyEME(h,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,t);default:return Promise.reject(this.createKeyLoadError(t,_.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+o.method+'"')))}},r.loadKeyEME=function(t,e){var i={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(i);return(t.keyLoadPromise=n.then((function(o){return t.mediaKeySessionContext=o,i}))).catch((function(o){throw t.keyLoadPromise=null,"data"in o&&(o.data.frag=e),o}))}return Promise.resolve(i)},r.loadKeyHTTP=function(t,e){var i=this,n=this.config,o=new n.loader(n);return e.keyLoader=t.loader=o,t.keyLoadPromise=new Promise((function(l,u){var d={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},h=n.keyLoadPolicy.default,f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(g,v,m,p){var E=m.frag,T=m.keyInfo,S=An(T.decryptdata);if(!E.decryptdata||T!==i.keyIdToKeyInfo[S])return u(i.createKeyLoadError(E,_.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));T.decryptdata.key=E.decryptdata.key=new Uint8Array(g.data),E.keyLoader=null,T.loader=null,l({frag:E,keyInfo:T})},onError:function(g,v,m,p){i.resetLoader(v),u(i.createKeyLoadError(e,_.KEY_LOAD_ERROR,new Error("HTTP Error "+g.code+" loading key "+g.text),m,ft({url:d.url,data:void 0},g)))},onTimeout:function(g,v,m){i.resetLoader(v),u(i.createKeyLoadError(e,_.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:function(g,v,m){i.resetLoader(v),u(i.createKeyLoadError(e,_.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};o.load(d,f,c)}))},r.resetLoader=function(t){var e=t.frag,i=t.keyInfo,n=t.url,o=i.loader;e.keyLoader===o&&(e.keyLoader=null,i.loader=null);var l=An(i.decryptdata)||n;delete this.keyIdToKeyInfo[l],o&&o.destroy()},s})(ee);function An(a){if(a.keyFormat!==Or){var s=a.keyId;if(s)return Vt(s)}return a.uri}function Ro(a){switch(a.type){case ne:return Kt;case oe:return te;default:return Z}}function Ln(a,s){var r=a.url;return r!==void 0&&r.indexOf("data:")!==0||(r=s.url),r}var cd=(function(){function a(r){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=r,this.registerListeners()}var s=a.prototype;return s.startLoad=function(r){},s.stopLoad=function(){this.destroyInternalLoaders()},s.registerListeners=function(){var r=this.hls;r.on(y.MANIFEST_LOADING,this.onManifestLoading,this),r.on(y.LEVEL_LOADING,this.onLevelLoading,this),r.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this)},s.unregisterListeners=function(){var r=this.hls;r.off(y.MANIFEST_LOADING,this.onManifestLoading,this),r.off(y.LEVEL_LOADING,this.onLevelLoading,this),r.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),r.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this)},s.createInternalLoader=function(r){var t=this.hls.config,e=t.pLoader,i=t.loader,n=new(e||i)(t);return this.loaders[r.type]=n,n},s.getInternalLoader=function(r){return this.loaders[r.type]},s.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},s.destroyInternalLoaders=function(){for(var r in this.loaders){var t=this.loaders[r];t&&t.destroy(),this.resetInternalLoader(r)}},s.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},s.onManifestLoading=function(r,t){var e=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ie,url:e,deliveryDirectives:null,levelOrTrack:null})},s.onLevelLoading=function(r,t){var e=t.id,i=t.level,n=t.pathwayId,o=t.url,l=t.deliveryDirectives,u=t.levelInfo;this.load({id:e,level:i,pathwayId:n,responseType:"text",type:me,url:o,deliveryDirectives:l,levelOrTrack:u})},s.onAudioTrackLoading=function(r,t){var e=t.id,i=t.groupId,n=t.url,o=t.deliveryDirectives,l=t.track;this.load({id:e,groupId:i,level:null,responseType:"text",type:ne,url:n,deliveryDirectives:o,levelOrTrack:l})},s.onSubtitleTrackLoading=function(r,t){var e=t.id,i=t.groupId,n=t.url,o=t.deliveryDirectives,l=t.track;this.load({id:e,groupId:i,level:null,responseType:"text",type:oe,url:n,deliveryDirectives:o,levelOrTrack:l})},s.onLevelsUpdated=function(r,t){var e=this.loaders[me];if(e){var i=e.context;i&&!t.levels.some((function(n){return n===i.levelOrTrack}))&&(e.abort(),delete this.loaders[me])}},s.load=function(r){var t,e,i,n=this,o=this.hls.config,l=this.getInternalLoader(r);if(l){var u=this.hls.logger,d=l.context;if(d&&d.levelOrTrack===r.levelOrTrack&&(d.url===r.url||d.deliveryDirectives&&!r.deliveryDirectives))return void(d.url===r.url?u.log("[playlist-loader]: ignore "+r.url+" ongoing request"):u.log("[playlist-loader]: ignore "+r.url+" in favor of "+d.url));u.log("[playlist-loader]: aborting previous loader for type: "+r.type),l.abort()}if(e=r.type===Ie?o.manifestLoadPolicy.default:mt({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),l=this.createInternalLoader(r),B((t=r.deliveryDirectives)==null?void 0:t.part)&&(r.type===me&&r.level!==null?i=this.hls.levels[r.level].details:r.type===ne&&r.id!==null?i=this.hls.audioTracks[r.id].details:r.type===oe&&r.id!==null&&(i=this.hls.subtitleTracks[r.id].details),i)){var h=i.partTarget,f=i.targetduration;if(h&&f){var c=1e3*Math.max(3*h,.8*f);e=mt({},e,{maxTimeToFirstByteMs:Math.min(c,e.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(c,e.maxTimeToFirstByteMs)})}}var g=e.errorRetry||e.timeoutRetry||{},v={loadPolicy:e,timeout:e.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},m={onSuccess:function(p,E,T,S){var R=n.getInternalLoader(T);n.resetInternalLoader(T.type);var A=p.data;E.parsing.start=performance.now(),dr.isMediaPlaylist(A)||T.type!==Ie?n.handleTrackOrLevelPlaylist(p,E,T,S||null,R):n.handleMasterPlaylist(p,E,T,S)},onError:function(p,E,T,S){n.handleNetworkError(E,T,!1,p,S)},onTimeout:function(p,E,T){n.handleNetworkError(E,T,!0,void 0,p)}};l.load(r,v,m)},s.checkAutostartLoad=function(){if(this.hls){var r=this.hls,t=r.config,e=t.autoStartLoad,i=t.startPosition,n=r.forceStartLoad;(e||n)&&(this.hls.logger.log((e?"auto":"force")+" startLoad with configured startPosition "+i),this.hls.startLoad(i))}},s.handleMasterPlaylist=function(r,t,e,i){var n=this,o=this.hls,l=r.data,u=Ln(r,e),d=dr.parseMasterPlaylist(l,u);if(d.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(r,e,d.playlistParsingError,i,t);var h=d.contentSteering,f=d.levels,c=d.sessionData,g=d.sessionKeys,v=d.startTimeOffset,m=d.variableList;this.variableList=m,f.forEach((function(A){var L=A.unknownCodecs;if(L)for(var b=n.hls.config.preferManagedMediaSource,k=A.audioCodec,I=A.videoCodec,D=L.length;D--;){var P=L[D];ir(P,"audio",b)?(A.audioCodec=k=k?k+","+P:P,Ke.audio[k.substring(0,4)]=2,L.splice(D,1)):ir(P,"video",b)&&(A.videoCodec=I=I?I+","+P:P,Ke.video[I.substring(0,4)]=2,L.splice(D,1))}}));var p=dr.parseMasterPlaylistMedia(l,u,d),E=p.AUDIO,T=E===void 0?[]:E,S=p.SUBTITLES,R=p["CLOSED-CAPTIONS"];T.length&&(T.some((function(A){return!A.url}))||!f[0].audioCodec||f[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Pt({}),bitrate:0,url:""}))),o.trigger(y.MANIFEST_LOADED,{levels:f,audioTracks:T,subtitles:S,captions:R,contentSteering:h,url:u,stats:t,networkDetails:i,sessionData:c,sessionKeys:g,startTimeOffset:v,variableList:m})},s.handleTrackOrLevelPlaylist=function(r,t,e,i,n){var o=this.hls,l=e.id,u=e.level,d=e.type,h=Ln(r,e),f=B(u)?u:B(l)?l:0,c=Ro(e),g=dr.parseLevelPlaylist(r.data,h,f,c,0,this.variableList);if(d===Ie){var v={attrs:new Pt({}),bitrate:0,details:g,name:"",url:h};g.requestScheduled=t.loading.start+za(g,0),o.trigger(y.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),e.levelDetails=g,this.handlePlaylistLoaded(g,r,t,e,i,n)},s.handleManifestParsingError=function(r,t,e,i,n){this.hls.trigger(y.ERROR,{type:K.NETWORK_ERROR,details:_.MANIFEST_PARSING_ERROR,fatal:t.type===Ie,url:r.url,err:e,error:e,reason:e.message,response:r,context:t,networkDetails:i,stats:n})},s.handleNetworkError=function(r,t,e,i,n){e===void 0&&(e=!1);var o="A network "+(e?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+r.type;r.type===me?o+=": "+r.level+" id: "+r.id:r.type!==ne&&r.type!==oe||(o+=" id: "+r.id+' group-id: "'+r.groupId+'"');var l=new Error(o);this.hls.logger.warn("[playlist-loader]: "+o);var u=_.UNKNOWN,d=!1,h=this.getInternalLoader(r);switch(r.type){case Ie:u=e?_.MANIFEST_LOAD_TIMEOUT:_.MANIFEST_LOAD_ERROR,d=!0;break;case me:u=e?_.LEVEL_LOAD_TIMEOUT:_.LEVEL_LOAD_ERROR,d=!1;break;case ne:u=e?_.AUDIO_TRACK_LOAD_TIMEOUT:_.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case oe:u=e?_.SUBTITLE_TRACK_LOAD_TIMEOUT:_.SUBTITLE_LOAD_ERROR,d=!1}h&&this.resetInternalLoader(r.type);var f={type:K.NETWORK_ERROR,details:u,fatal:d,url:r.url,loader:h,context:r,error:l,networkDetails:t,stats:n};if(i){var c=t?.url||r.url;f.response=ft({url:c,data:void 0},i)}this.hls.trigger(y.ERROR,f)},s.handlePlaylistLoaded=function(r,t,e,i,n,o){var l=this.hls,u=i.type,d=i.level,h=i.levelOrTrack,f=i.id,c=i.groupId,g=i.deliveryDirectives,v=Ln(t,i),m=Ro(i),p=typeof i.level=="number"&&m===Z?d:void 0,E=r.playlistParsingError;if(E){if(this.hls.logger.warn(E+" "+r.url),!l.config.ignorePlaylistParsingErrors)return void l.trigger(y.ERROR,{type:K.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:E,reason:E.message,response:t,context:i,level:p,parent:m,networkDetails:n,stats:e});r.playlistParsingError=null}if(r.fragments.length)switch(r.live&&o&&(o.getCacheAge&&(r.ageHeader=o.getCacheAge()||0),o.getCacheAge&&!isNaN(r.ageHeader)||(r.ageHeader=0)),u){case Ie:case me:if(p)if(h){if(h!==l.levels[p]){var T=l.levels.indexOf(h);T>-1&&(p=T)}}else p=0;l.trigger(y.LEVEL_LOADED,{details:r,levelInfo:h||l.levels[0],level:p||0,id:f||0,stats:e,networkDetails:n,deliveryDirectives:g,withoutMultiVariant:u===Ie});break;case ne:l.trigger(y.AUDIO_TRACK_LOADED,{details:r,track:h,id:f||0,groupId:c||"",stats:e,networkDetails:n,deliveryDirectives:g});break;case oe:l.trigger(y.SUBTITLE_TRACK_LOADED,{details:r,track:h,id:f||0,groupId:c||"",stats:e,networkDetails:n,deliveryDirectives:g})}else{var S=r.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(y.ERROR,{type:K.NETWORK_ERROR,details:_.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:S,reason:S.message,response:t,context:i,level:p,parent:m,networkDetails:n,stats:e})}},a})(),ko=(function(){function a(r){r===void 0&&(r={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new yr,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var t=this.logger=xn(r.debug||!1,"Hls instance",r.assetPlayerId),e=this.config=(function(w,F,x){if((F.liveSyncDurationCount||F.liveMaxLatencyDurationCount)&&(F.liveSyncDuration||F.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(F.liveMaxLatencyDurationCount!==void 0&&(F.liveSyncDurationCount===void 0||F.liveMaxLatencyDurationCount<=F.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(F.liveMaxLatencyDuration!==void 0&&(F.liveSyncDuration===void 0||F.liveMaxLatencyDuration<=F.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var N=En(w),H=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach((function(U){var G=(U==="level"?"playlist":U)+"LoadPolicy",X=F[G]===void 0,$=[];H.forEach((function(Y){var dt=U+"Loading"+Y,rt=F[dt];if(rt!==void 0&&X){$.push(dt);var V=N[G].default;switch(F[G]={default:V},Y){case"TimeOut":V.maxLoadTimeMs=rt,V.maxTimeToFirstByteMs=rt;break;case"MaxRetry":V.errorRetry.maxNumRetry=rt,V.timeoutRetry.maxNumRetry=rt;break;case"RetryDelay":V.errorRetry.retryDelayMs=rt,V.timeoutRetry.retryDelayMs=rt;break;case"MaxRetryTimeout":V.errorRetry.maxRetryDelayMs=rt,V.timeoutRetry.maxRetryDelayMs=rt}}})),$.length&&x.warn('hls.js config: "'+$.join('", "')+'" setting(s) are deprecated, use "'+G+'": '+Et(F[G]))})),ft(ft({},N),F)})(a.DefaultConfig,r,t);this.userConfig=r,e.progressive&&sd(e,t);var i=e.abrController,n=e.bufferController,o=e.capLevelController,l=e.errorController,u=e.fpsController,d=new l(this),h=this.abrController=new i(this),f=new tl(this),c=e.interstitialsController,g=c?this.interstitialsController=new c(this,a):null,v=this.bufferController=new n(this,f),m=this.capLevelController=new o(this),p=new u(this),E=new cd(this),T=e.contentSteeringController,S=T?new T(this):null,R=this.levelController=new dd(this,S),A=new ld(this),L=new fd(this.config,this.logger),b=this.streamController=new hd(this,f,L),k=this.gapController=new od(this,f);m.setStreamController(b),p.setStreamController(b);var I=[E,R,b];g&&I.splice(1,0,g),S&&I.splice(1,0,S),this.networkControllers=I;var D=[h,v,k,m,p,A,f];this.audioTrackController=this.createController(e.audioTrackController,I);var P=e.audioStreamController;P&&I.push(this.audioStreamController=new P(this,f,L)),this.subtitleTrackController=this.createController(e.subtitleTrackController,I);var M=e.subtitleStreamController;M&&I.push(this.subtititleStreamController=new M(this,f,L)),this.createController(e.timelineController,D),L.emeController=this.emeController=this.createController(e.emeController,D),this.cmcdController=this.createController(e.cmcdController,D),this.latencyController=this.createController(ud,D),this.coreComponents=D,I.push(d);var O=d.onErrorOut;typeof O=="function"&&this.on(y.ERROR,O,d),this.on(y.MANIFEST_LOADED,E.onManifestLoaded,E)}a.isMSESupported=function(){return Io()},a.isSupported=function(){return(function(){if(!Io())return!1;var r=ke();return typeof r?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some((function(t){return r.isTypeSupported(nr(t,"video"))}))||["mp4a.40.2","fLaC"].some((function(t){return r.isTypeSupported(nr(t,"audio"))})))})()},a.getMediaSource=function(){return ke()};var s=a.prototype;return s.createController=function(r,t){if(r){var e=new r(this);return t&&t.push(e),e}return null},s.on=function(r,t,e){e===void 0&&(e=this),this._emitter.on(r,t,e)},s.once=function(r,t,e){e===void 0&&(e=this),this._emitter.once(r,t,e)},s.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},s.off=function(r,t,e,i){e===void 0&&(e=this),this._emitter.off(r,t,e,i)},s.listeners=function(r){return this._emitter.listeners(r)},s.emit=function(r,t,e){return this._emitter.emit(r,t,e)},s.trigger=function(r,t){if(this.config.debug)return this.emit(r,r,t);try{return this.emit(r,r,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+r+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;var e=r===y.ERROR;this.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:e,event:r,error:i}),this.triggeringException=!1}}return!1},s.listenerCount=function(r){return this._emitter.listenerCount(r)},s.destroy=function(){this.logger.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0;var r=this.config;r.xhrSetup=r.fetchSetup=void 0,this.userConfig=null},s.attachMedia=function(r){if(!r||"media"in r&&!r.media){var t=new Error("attachMedia failed: invalid argument ("+r+")");this.trigger(y.ERROR,{type:K.OTHER_ERROR,details:_.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}else{this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var e="media"in r,i=e?r.media:r,n=e?r:{media:i};this._media=i,this.trigger(y.MEDIA_ATTACHING,n)}},s.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,{}),this._media=null},s.transferMedia=function(){this._media=null;var r=this.bufferController.transferMedia();return this.trigger(y.MEDIA_DETACHING,{transferMedia:r}),r},s.loadSource=function(r){this.stopLoad();var t=this.media,e=this._url,i=this._url=oi.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+i),t&&e&&(e!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(y.MANIFEST_LOADING,{url:r})},s.startLoad=function(r,t){r===void 0&&(r=-1),this.logger.log("startLoad("+r+(t?", <skip seek to start>":"")+")"),this.started=!0,this.resumeBuffering();for(var e=0;e<this.networkControllers.length&&(this.networkControllers[e].startLoad(r,t),this.started&&this.networkControllers);e++);},s.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var r=0;r<this.networkControllers.length&&(this.networkControllers[r].stopLoad(),!this.started&&this.networkControllers);r++);},s.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach((function(r){r.resumeBuffering&&r.resumeBuffering()})))},s.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach((function(r){r.pauseBuffering&&r.pauseBuffering()})))},s.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){this.logger.log("recoverMediaError");var r=this._media,t=r?.currentTime;this.detachMedia(),r&&(this.attachMedia(r),t&&this.startLoad(t))},s.removeLevel=function(r){this.levelController.removeLevel(r)},s.setAudioOption=function(r){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(r))||null},s.setSubtitleOption=function(r){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(r))||null},s.getMediaDecodingInfo=function(r,t){return t===void 0&&(t=this.allAudioTracks),ta(r,sa(t),navigator.mediaCapabilities)},yt(a,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var r,t=((r={})[Z]=this.streamController.inFlightFrag,r);return this.audioStreamController&&(t[Kt]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[te]=this.subtititleStreamController.inFlightFrag),t}},{key:"sessionId",get:function(){var r=this._sessionId;return r||(r=this._sessionId=(function(){try{return crypto.randomUUID()}catch{try{var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch{var i=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(l){var u=(i+16*Math.random())%16|0;return i=Math.floor(i/16),(l=="x"?u:3&u|8).toString(16)}))}}})()),r}},{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){this.logger.log("set currentLevel:"+r),this.levelController.manualLevel=r,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){this.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){this.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){this.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){var r=this.levelController.startLevel;return r===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:r},set:function(r){this.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var t=!!r;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(this.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN},set:function(r){this.abrController.resetEstimator(r)}},{key:"abrEwmaDefaultEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(r){(function(t){return Ei.indexOf(t)>-1})(r)&&this._maxHdcpLevel!==r&&(this._maxHdcpLevel=r,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,t=this.config.minAutoBitrate;if(!r)return 0;for(var e=r.length,i=0;i<e;i++)if(r[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var r,t=this.levels,e=this.autoLevelCapping,i=this.maxHdcpLevel;if(r=e===-1&&t!=null&&t.length?t.length-1:e,i)for(var n=r;n--;){var o=t[n].attrs["HDCP-LEVEL"];if(o&&o<=i)return n}return r}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(r){this.abrController.nextAutoLevel=r}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var r=this.audioTrackController;return r?r.allAudioTracks:[]}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var t=this.audioTrackController;t&&(t.audioTrack=r)}},{key:"allSubtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var t=this.subtitleTrackController;t&&(t.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return!!r&&r.subtitleDisplay},set:function(r){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(r){this.latencyController.targetLatency=r}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(r){this.levelController.pathwayPriority=r}},{key:"bufferedToEnd",get:function(){var r;return!((r=this.bufferController)==null||!r.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var r;return((r=this.interstitialsController)==null?void 0:r.interstitialsManager)||null}}],[{key:"version",get:function(){return vr}},{key:"Events",get:function(){return y}},{key:"MetadataSchema",get:function(){return Qt}},{key:"ErrorTypes",get:function(){return K}},{key:"ErrorDetails",get:function(){return _}},{key:"DefaultConfig",get:function(){return a.defaultConfig?a.defaultConfig:ad},set:function(r){a.defaultConfig=r}}])})();return ko.defaultConfig=void 0,ko},tr.exports=Le()})(!1)})(Rn)),Rn.exports}var Do=md();const pd=gd(Do),Ed=vd({__proto__:null,default:pd},[Do]);export{Ed as h};
