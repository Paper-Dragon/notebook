import{aq as i,ar as a,aw as n,av as l}from"./app-B4yzktGM.js";const e="/assets/image-20240218180231563-BRHnjSRd.png",t="/assets/image-20240218175104892-Bgw0yXmA.png",h={};function p(k,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="nginx作为推流服务器" tabindex="-1"><a class="header-anchor" href="#nginx作为推流服务器"><span>Nginx作为推流服务器</span></a></h1><blockquote><p>本文档参考文档制作： https://www.fnmqs.work/archives/161/</p><p>教程里使用的 https://github.com/arut/nginx-rtmp-module.git 这个模块太老了，3年之前更新过，所以重新更改方案使用了https://github.com/winshining/nginx-http-flv-module，这个模块在实现前者的功能的同时还实现了flv拉流量的功能，功能上强很多，而且更新及时。</p></blockquote><h2 id="功能对比" tabindex="-1"><a class="header-anchor" href="#功能对比"><span>功能对比</span></a></h2><ul><li><a href="https://github.com/arut/nginx-rtmp-module" target="_blank" rel="noopener noreferrer">nginx-rtmp-module</a> 提供的所有功能。</li><li>nginx-http-flv-module 的其他功能与 <a href="https://github.com/arut/nginx-rtmp-module" target="_blank" rel="noopener noreferrer">nginx-rtmp-module</a> 的对比：</li></ul><table><thead><tr><th>功能</th><th>nginx-http-flv-module</th><th>nginx-rtmp-module</th><th>备注</th></tr></thead><tbody><tr><td>HTTP-FLV (播放)</td><td>√</td><td>x</td><td>支持 HTTPS-FLV 和 chunked 回复</td></tr><tr><td>GOP 缓存</td><td>√</td><td>x</td><td></td></tr><tr><td>虚拟主机</td><td>√</td><td>x</td><td></td></tr><tr><td>省略 <code>listen</code> 配置项</td><td>√</td><td>见备注</td><td>配置中必须有一个 <code>listen</code></td></tr><tr><td>RTMP/HTTP-FLV 纯音频支持</td><td>√</td><td>见备注</td><td><code>wait_video</code> 或 <code>wait_key</code> 开启后无法工作</td></tr><tr><td>HLS 单轨支持</td><td>√</td><td>x</td><td></td></tr><tr><td><code>reuseport</code> 支持</td><td>√</td><td>x</td><td></td></tr><tr><td>定时打印访问记录</td><td>√</td><td>x</td><td></td></tr><tr><td>JSON 风格的数据信息</td><td>√</td><td>x</td><td></td></tr><tr><td>录制的数据信息</td><td>√</td><td>x</td><td></td></tr><tr><td>大小端无关</td><td>√</td><td>见备注</td><td><code>big-endian</code> 分支部分支持</td></tr></tbody></table><h2 id="兼容性" tabindex="-1"><a class="header-anchor" href="#兼容性"><span>兼容性</span></a></h2><p><a href="http://nginx.org" target="_blank" rel="noopener noreferrer">NGINX</a> 的版本<strong>应该</strong>大于或者等于 1.2.6，与其他版本的兼容性未知。</p><h2 id="编译nginx时需要的依赖和库" tabindex="-1"><a class="header-anchor" href="#编译nginx时需要的依赖和库"><span>编译Nginx时需要的依赖和库</span></a></h2><ol><li>编译工具链：gcc、g++或clang等编译器工具；</li><li>PCRE（Perl Compatible Regular Expressions）库：用于正则表达式支持；</li><li>OpenSSL库：用于支持HTTPS和加密功能；</li><li>zlib库：用于压缩和解压缩支持；</li><li>libxml2库：用于WebDAV模块的XML解析支持</li><li>libxslt库：用于XSLT转换支持。</li></ol><p>也可以直接输入以下代码安装依赖和库</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">apt</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> update</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">apt</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> install</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> gcc</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> make</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">apt</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> install</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> libpcre3</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">dev</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> zlib1g</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">dev</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> libssl</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">dev</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> libxml2</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">dev</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> libxslt1</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述命令适用于Ubuntu系统，对于其他Linux发行版，可以使用相应的包管理器来安装这些依赖和库。</p><h2 id="下载源代码" tabindex="-1"><a class="header-anchor" href="#下载源代码"><span>下载源代码</span></a></h2><p>Nginx官网:https://nginx.org/en/download.html 可以从官网找到很多版本的源代码， 这里示范为Nginx 1.22版本</p><h3 id="下载nginx和nginx-http-flv-module源代码" tabindex="-1"><a class="header-anchor" href="#下载nginx和nginx-http-flv-module源代码"><span>下载Nginx和Nginx-http-flv-module源代码</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://nginx.org/download/nginx-1.25.4.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -xvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx-1.25.4.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/winshining/nginx-http-flv-module.git</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="过程" tabindex="-1"><a class="header-anchor" href="#过程"><span>过程</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@user-VirtualBox:/home/user/Desktop/nginx-flv#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://nginx.org/download/nginx-1.25.4.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--2024-02-18</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 17:05:07--</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  http://nginx.org/download/nginx-1.25.4.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Resolving</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx.org</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (nginx.org)... 3.125.197.172, 52.58.199.22, 2a05:d014:5c0:2601::6, ...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Connecting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx.org</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (nginx.org)|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">3.125.197.172</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">:80...</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> connected.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HTTP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> request</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sent,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> awaiting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> response...</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 200</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OK</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1236273</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (1.2M) [application/octet-stream]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Saving</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ‘nginx-1.25.4.tar.gz’</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4.tar.gz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               100%[============================================================</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">]</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   1.18M</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   697KB/s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1.7s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2024-02-18</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 17:05:10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (697 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KB/s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) - ‘nginx-1.25.4.tar.gz’ saved [1236273/1236273]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@user-VirtualBox:/home/user/Desktop/nginx-flv#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -xvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nginx-1.25.4.tar.gz</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/man/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/LICENSE</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/configure</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/auto/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/CHANGES</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/CHANGES.ru</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/html/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/contrib/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nginx-1.25.4/README</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@user-VirtualBox:/home/user/Desktop/nginx-flv#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clone</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/winshining/nginx-http-flv-module.git</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cloning</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;nginx-http-flv-module&#39;...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">remote:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Enumerating</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> objects:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2514,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> done.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">remote:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Counting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> objects:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (163/163), done.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">remote:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Compressing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> objects:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (97/97), done.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">remote:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Total</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2514</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (delta </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">86</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), reused 92 (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">delta</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 66</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">), pack-reused 2351</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Receiving</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> objects:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (2514/2514), 3.86 MiB | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">3.18</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MiB/s,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> done.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Resolving</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deltas:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 100%</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (1720/1720), done.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">root@user-VirtualBox:/home/user/Desktop/nginx-flv#</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="编译安装" tabindex="-1"><a class="header-anchor" href="#编译安装"><span>编译安装</span></a></h2><p>完成后会安装在/usr/local/nginx-flv下</p><pre><code>mv ../nginx-http-flv-module .
./configure --prefix=/usr/local/nginx-flv --with-http_ssl_module --with-http_secure_link_module --add-module=nginx-http-flv-module
make 
make install
</code></pre><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><p>Nginx配置文件 nginx.conf</p><div class="language-nginx line-numbers-mode" data-highlighter="shiki" data-ext="nginx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#user  nobody;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">worker_processes </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> auto;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#error_log  logs/error.log  info;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">error_log </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> logs/error.log </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">warn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">pid </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">       logs/nginx.pid;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">events</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    worker_connections </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10240</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    use </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">epoll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    multi_accept </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    include </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      mime.types;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default_type </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> application/octet-stream;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_names_hash_bucket_size </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    client_header_buffer_size </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">32k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    large_client_header_buffers </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 32k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    client_max_body_size </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">50m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    log_format </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">nginx_json </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;{    &quot;time&quot;: &quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">time_local</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;remote_ip&quot;: &quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">remote_addr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;remote_user&quot;: &quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">remote_user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;domain&quot;:&quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;responsetime&quot;:$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">request_time</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;request&quot;: &quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">request</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;response&quot;: &quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;bytes&quot;: $</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">body_bytes_sent</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;referrer&quot;: &quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http_referer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;upstreamtime&quot;:&quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">upstream_response_time</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;upstreamaddr&quot;:&quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">upstream_addr</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;x_forwarded_for&quot;:&quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http_x_forwarded_for</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;, &#39;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                               &#39;&quot;agent&quot;: &quot;$</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">http_user_agent</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot; }&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    access_log </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> logs/access.log  nginx_json;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    sendfile </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">       on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    tcp_nopush </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server_tokens </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    keepalive_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 65</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip_min_length </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip_buffers </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">   4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 16k</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip_http_version </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip_comp_level </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip_types </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">     text/plain application/x-javascript text/css application/xml;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    gzip_vary </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    client_header_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    client_body_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    client_body_buffer_size </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10K</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    proxy_buffering </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    reset_timedout_connection </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    send_timeout </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    charset </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">utf-8;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        listen </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">      80</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        server_name </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> localhost;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #charset koi8-r;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> / {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            index </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> index.html index.htm;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #error_page  404              /404.html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        error_page </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  500</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 502</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 503</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 504</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> = </span><span style="--shiki-light:#0184BC;--shiki-dark:#E06C75;">/50x.html </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  html;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /live {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            flv_live</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            chunked_transfer_encoding </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#支持&#39;Transfer-Encoding: chunked&#39;方式回复</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Origin&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#添加额外的HTTP头</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            add_header </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Credentials&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;true&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#添加额外的HTTP头</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /flv {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">             flv_live</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">             chunked_transfer_encoding </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">             add_header </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Origin&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;*&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">             add_header </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Credentials&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;true&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#添加额外的HTTP头</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /stat {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            #推流播放和录制统计数据的配置</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            rtmp_stat</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> all</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            rtmp_stat_stylesheet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> stat.xsl;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /stat.xsl {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            root </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">html; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#指定 stat.xsl 的位置</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #如果需要 JSON 风格的 stat, 不用指定 stat.xsl</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #但是需要指定一个新的配置项 rtmp_stat_format</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #location /stat {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #    rtmp_stat all;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #    rtmp_stat_format json;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        #}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>lv配置 conf/lv.conf</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rtmp_auto_push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rtmp_auto_push_reconnect</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rtmp_socket_dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /tmp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rtmp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    out_queue</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">           4096</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    out_cork</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">            8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    max_streams</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">         128</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    timeout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             15s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    drop_idle_publisher</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    log_interval</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#interval used by log module to log in access.log, it is very useful for debug</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    log_size</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     1m</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#buffer size used by log module to log in access.log</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        listen</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1935</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        application</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> live</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            #开启直播</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            live</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            record</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> off</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            #可以把转完码的视频放在这个文件里，这样可以拉这个视频进行播放</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            #play /opt/video;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # 允许从任何源push流</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            allow</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> publish</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # 允许从任何地方来播放流</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            allow</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> play</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # 20秒内没有push，就断开链接。</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            drop_idle_publisher</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 20s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            ##打开 GOP 缓存，减少首屏等待时间</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">            gop_cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="启动nginx服务" tabindex="-1"><a class="header-anchor" href="#启动nginx服务"><span>启动Nginx服务</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#检测配置文件语法，如果正常，提示(syntax is ok)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/local/nginx-flv/sbin/nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#运行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/usr/local/nginx-flv/sbin/nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/nginx-flv/conf/nginx.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="测试推流和拉流服务" tabindex="-1"><a class="header-anchor" href="#测试推流和拉流服务"><span>测试推流和拉流服务</span></a></h2><h3 id="推流服务" tabindex="-1"><a class="header-anchor" href="#推流服务"><span>推流服务</span></a></h3><p>可以在本地服务器下载安装ffmpeg后，读取一个mp4文件，推流到上面搭建的直播服务，来进行试验。 命令如下，test-video.mp4就是你本地的视频文件名称，live是前面配置的application名称，test就是自定义的流名称。</p><p>注意</p><p>一些旧版本的 FFmpeg 不支持选项 -c copy，可以使用选项 -vcodec copy -acodec copy 替代。</p><p>appname 用于匹配 rtmp 配置块中的 application 块，具体可以参考（nginx-http-flv-module: 基于nginx-rtmp-module的流媒体服务器。具备nginx-rtmp-module的所有功能，增加了HTTP-FLV，GOP缓存和VHOST（一个IP对应多个域名）的功能。Media streaming server based on nginx-rtmp-module. In addtion to the features nginx-rtmp-module provides, HTTP-FLV, GOP cache and VHOST (one IP for multi domain names) are supported now.）。</p><p>streamname 可以随意指定，但是不能省略。</p><p>RTMP 默认端口为 1935，如果要使用其他端口，必须指定 :port。</p><p>ffmpeg -re -i test-video.mp4 -c copy -f flv rtmp://192.168.10.111:1936/live/test</p><p>#看到如下信息，就是开始推流了</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">fmpeg</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3.4.11-0ubuntu0.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Copyright</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (c) 2000-2022 the FFmpeg developers</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  built</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gcc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Ubuntu </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">7.5.0-3ubuntu1~18.04</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  configuration:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prefix=/usr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --extra-version=0ubuntu0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --toolchain=hardened</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --libdir=/usr/lib/x86_64-linux-gnu</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --incdir=/usr/include/x86_64-linux-gnu</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-gpl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --disable-stripping</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-avresample</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-avisynth</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-gnutls</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-ladspa</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libass</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libbluray</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libbs2b</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libcaca</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libcdio</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libflite</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libfontconfig</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libfreetype</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libfribidi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libgme</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libgsm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libmp3lame</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libmysofa</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libopenjpeg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libopenmpt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libopus</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libpulse</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-librubberband</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-librsvg</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libshine</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libsnappy</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libsoxr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libspeex</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libssh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libtheora</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libtwolame</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libvorbis</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libvpx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libwavpack</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libwebp</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libx265</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libxml2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libxvid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libzmq</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libzvbi</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-omx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-openal</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-opengl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-sdl2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libdc1394</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libdrm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libiec61883</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-chromaprint</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-frei0r</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libopencv</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-libx264</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --enable-shared</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libavutil</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      55.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 78.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 55.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 78.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libavcodec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     57.107.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 57.107.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libavformat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    57.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 83.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 57.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 83.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libavdevice</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    57.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 57.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libavfilter</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">     6.107.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  6.107.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libavresample</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   3.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  7.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  3.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  7.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libswscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      4.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  8.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  4.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  8.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libswresample</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   2.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  9.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  2.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  9.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  libpostproc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    54.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  7.100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 54.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  7.100</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Input</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;test-video.mp4&#39;:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Metadata:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    major_brand</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">     :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> isom</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    minor_version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">   :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 512</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    compatible_brands:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> isomiso2avc1mp41</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    encoder</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">         :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Lavf57.56.101</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Duration:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 00:01:25.27,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0.000000,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bitrate:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 166</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kb/s</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    Stream</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p(tv, bt709), 1280x638, 156 kb/s, 29.01 fps, 29 tbr, 1000k tbn, 2000k tbc (default)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拉流测试" tabindex="-1"><a class="header-anchor" href="#拉流测试"><span>拉流测试</span></a></h3><p>windwos下拉RTMP流可以下载一个<a href="https://www.videolan.org/" target="_blank" rel="noopener noreferrer">VLC播放器</a>，会比较方便</p><h4 id="rtmp拉流地址" tabindex="-1"><a class="header-anchor" href="#rtmp拉流地址"><span>RTMP拉流地址</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#自定流，要看推流时取的名字。我前面取的是test，那这边就取test</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rtmp://192.168.10.111:1936/live/test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+e+'" alt="image-20240218180231563"></p><p>http://192.168.10.111:89/live?port=1936&amp;app=live&amp;stream=test</p><p>http://example.com[:port]/dir?[port=xxx&amp;]app=appname&amp;stream=streamname</p><p>注意</p><ul><li><p>如果使用 ffplay 命令行方式播放流，那么必须为上述的 url 加上引号，否则 url 中的参数会被丢弃（有些不太智能的 shell 会把 &quot;&amp;&quot; 解释为&quot;后台运行&quot;）。</p></li><li><p>如果使用 flv.js 播放流，那么请保证发布的流被正确编码，因为 flv.js 只支持 H.264 编码的视频和 AAC/MP3 编码的音频。</p></li></ul><p>参数 dir 用于匹配 http 配置块中的 location 块</p><ul><li><p>HTTP 默认端口为 80, 如果使用了其他端口，必须指定 :port。</p></li><li><p>RTMP 默认端口为 1935，如果使用了其他端口，必须指定 port=xxx。</p></li></ul><p>参数 app 的值（appname）用来匹配 application 块，但是如果请求的 app 出现在多个 server 块中，并且这些 server 块有相同的地址和端口配置，那么还需要用匹配主机名的 server_name 配置项来区分请求的是哪个 application 块，否则，将匹配第一个 application 块。</p><p>参数 stream 的值（streamname）用来匹配发布的流的名称。</p><h2 id="查看统计" tabindex="-1"><a class="header-anchor" href="#查看统计"><span>查看统计</span></a></h2><p>#前提需要在Nginx主配置文件里配置了stat服务，并且需要在nginx-http-flv-module-master源码包里把统计代码<strong>stat.xsl</strong>文件copy到Nginx配置的目录里</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">http://192.168.10.111:89/stat</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+t+'" alt="image-20240218175104892"></p>',56)]))}const r=i(h,[["render",p],["__file","Nginx作为推流服务器.html.vue"]]),g=JSON.parse('{"path":"/note-book/Nginx-OpenResty/Nginx%E4%BD%9C%E4%B8%BA%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8.html","title":"Nginx作为推流服务器","lang":"zh-CN","frontmatter":{"description":"Nginx作为推流服务器 本文档参考文档制作： https://www.fnmqs.work/archives/161/ 教程里使用的 https://github.com/arut/nginx-rtmp-module.git 这个模块太老了，3年之前更新过，所以重新更改方案使用了https://github.com/winshining/nginx-...","head":[["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/Nginx-OpenResty/Nginx%E4%BD%9C%E4%B8%BA%E6%8E%A8%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"Nginx作为推流服务器"}],["meta",{"property":"og:description","content":"Nginx作为推流服务器 本文档参考文档制作： https://www.fnmqs.work/archives/161/ 教程里使用的 https://github.com/arut/nginx-rtmp-module.git 这个模块太老了，3年之前更新过，所以重新更改方案使用了https://github.com/winshining/nginx-..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-10-09T07:06:37.000Z"}],["meta",{"property":"article:modified_time","content":"2024-10-09T07:06:37.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Nginx作为推流服务器\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-10-09T07:06:37.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"PaperDragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"]]},"git":{"createdTime":1708251032000,"updatedTime":1728457597000,"contributors":[{"name":"PaperDragon","username":"PaperDragon","email":"2678885646@qq.com","commits":2,"url":"https://github.com/PaperDragon"},{"name":"Paper-Dragon","username":"Paper-Dragon","email":"2678885646@qq.com","commits":1,"url":"https://github.com/Paper-Dragon"},{"name":"PaperDragon-SH","username":"PaperDragon-SH","email":"2678885646@qq.com","commits":1,"url":"https://github.com/PaperDragon-SH"}]},"readingTime":{"minutes":7.09,"words":2126},"filePathRelative":"note-book/Nginx-OpenResty/Nginx作为推流服务器.md","localizedDate":"2024年2月18日","excerpt":"\\n<blockquote>\\n<p>本文档参考文档制作： https://www.fnmqs.work/archives/161/</p>\\n<p>教程里使用的 https://github.com/arut/nginx-rtmp-module.git 这个模块太老了，3年之前更新过，所以重新更改方案使用了https://github.com/winshining/nginx-http-flv-module，这个模块在实现前者的功能的同时还实现了flv拉流量的功能，功能上强很多，而且更新及时。</p>\\n</blockquote>\\n<h2>功能对比</h2>\\n<ul>\\n<li><a href=\\"https://github.com/arut/nginx-rtmp-module\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">nginx-rtmp-module</a> 提供的所有功能。</li>\\n<li>nginx-http-flv-module 的其他功能与 <a href=\\"https://github.com/arut/nginx-rtmp-module\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">nginx-rtmp-module</a> 的对比：</li>\\n</ul>","autoDesc":true}');export{r as comp,g as data};
