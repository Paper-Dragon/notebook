import{aq as e,ar as a,aw as s,av as n}from"./app-cAKe9ARJ.js";const t={};function l(d,i){return n(),a("div",null,i[0]||(i[0]=[s(`<h1 id="为docker安装nvidiaruntime" tabindex="-1"><a class="header-anchor" href="#为docker安装nvidiaruntime"><span>为Docker安装NvidiaRuntime</span></a></h1><blockquote><p>参考链接</p><ul><li>https://nvidia.github.io/nvidia-container-runtime/</li><li>https://github.com/NVIDIA/nvidia-container-runtime</li></ul></blockquote><h2 id="导入软件库" tabindex="-1"><a class="header-anchor" href="#导入软件库"><span>导入软件库</span></a></h2><h3 id="根据操作系统分类导入" tabindex="-1"><a class="header-anchor" href="#根据操作系统分类导入"><span>根据操作系统分类导入</span></a></h3><h4 id="基于debian的操作系统" tabindex="-1"><a class="header-anchor" href="#基于debian的操作系统"><span>基于Debian的操作系统</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>curl -s -L https://nvidia.github.io/nvidia-container-runtime/gpgkey | \\</span></span>
<span class="line"><span>  sudo apt-key add -</span></span>
<span class="line"><span>distribution=$(. /etc/os-release;echo $ID$VERSION_ID)</span></span>
<span class="line"><span>curl -s -L https://nvidia.github.io/nvidia-container-runtime/$distribution/nvidia-container-runtime.list | \\</span></span>
<span class="line"><span>  sudo tee /etc/apt/sources.list.d/nvidia-container-runtime.list</span></span>
<span class="line"><span>sudo apt-get update</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For pre-releases, you need to enable the experimental repos of all dependencies:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo sed -i -e &#39;/experimental/ s/^#//g&#39; /etc/apt/sources.list.d/nvidia-container-runtime.list</span></span>
<span class="line"><span>sudo apt-get update</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>To later disable the experimental repos of all dependencies, you can run:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo sed -i -e &#39;/experimental/ s/^/#/g&#39; /etc/apt/sources.list.d/nvidia-container-runtime.list</span></span>
<span class="line"><span>sudo apt-get update</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="基于rhel的操作系统" tabindex="-1"><a class="header-anchor" href="#基于rhel的操作系统"><span>基于RHEL的操作系统</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>distribution=$(. /etc/os-release;echo $ID$VERSION_ID)</span></span>
<span class="line"><span>curl -s -L https://nvidia.github.io/nvidia-container-runtime/$distribution/nvidia-container-runtime.repo | \\</span></span>
<span class="line"><span>  sudo tee /etc/yum.repos.d/nvidia-container-runtime.repo</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For pre-releases, you need to enable the experimental repos of all dependencies:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo yum-config-manager --enable libnvidia-container-experimental</span></span>
<span class="line"><span>sudo yum-config-manager --enable nvidia-container-experimental</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>To later disable the experimental repos of all dependencies, you can run:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo yum-config-manager --disable libnvidia-container-experimental</span></span>
<span class="line"><span>sudo yum-config-manager --disable nvidia-container-runtime-experimental</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="更新仓库的验证key" tabindex="-1"><a class="header-anchor" href="#更新仓库的验证key"><span>更新仓库的验证key</span></a></h3><p>In order to update the nvidia-container-runtime repository key for your distribution, follow the instructions below.</p><h4 id="基于rhel的操作系统-1" tabindex="-1"><a class="header-anchor" href="#基于rhel的操作系统-1"><span>基于RHEL的操作系统</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>DIST=$(sed -n &#39;s/releasever=//p&#39; /etc/yum.conf)</span></span>
<span class="line"><span>DIST=\${DIST:-$(. /etc/os-release; echo $VERSION_ID)}</span></span>
<span class="line"><span>sudo rpm -e gpg-pubkey-f796ecb0</span></span>
<span class="line"><span>sudo gpg --homedir /var/lib/yum/repos/$(uname -m)/$DIST/nvidia-container-runtime/gpgdir --delete-key f796ecb0</span></span>
<span class="line"><span>sudo yum makecache</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="基于debian的操作系统-1" tabindex="-1"><a class="header-anchor" href="#基于debian的操作系统-1"><span>基于Debian的操作系统</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>curl -s -L https://nvidia.github.io/nvidia-container-runtime/gpgkey | \\</span></span>
<span class="line"><span>  sudo apt-key add -</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装nvidia-runtime" tabindex="-1"><a class="header-anchor" href="#安装nvidia-runtime"><span>安装Nvidia Runtime</span></a></h2><h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h3><h4 id="基于debian的操作系统-2" tabindex="-1"><a class="header-anchor" href="#基于debian的操作系统-2"><span>基于Debian的操作系统</span></a></h4><ol><li>Install the repository for your distribution by following the instructions <a href="http://nvidia.github.io/nvidia-container-runtime/" target="_blank" rel="noopener noreferrer">here</a>.</li><li>Install the <code>nvidia-container-runtime</code> package:</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo apt-get install nvidia-container-runtime</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="基于rhel的操作系统-2" tabindex="-1"><a class="header-anchor" href="#基于rhel的操作系统-2"><span>基于RHEL的操作系统</span></a></h4><ol><li>Install the repository for your distribution by following the instructions <a href="http://nvidia.github.io/nvidia-container-runtime/" target="_blank" rel="noopener noreferrer">here</a>.</li><li>Install the <code>nvidia-container-runtime</code> package:</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo yum install nvidia-container-runtime</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="配置docker引擎" tabindex="-1"><a class="header-anchor" href="#配置docker引擎"><span>配置Docker引擎</span></a></h3><h4 id="方法一" tabindex="-1"><a class="header-anchor" href="#方法一"><span>方法一</span></a></h4><blockquote><p>直接将Runtime增加进Docker</p></blockquote><h5 id="systemd-drop-in-file" tabindex="-1"><a class="header-anchor" href="#systemd-drop-in-file"><span>Systemd drop-in file</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo mkdir -p /etc/systemd/system/docker.service.d</span></span>
<span class="line"><span>sudo tee /etc/systemd/system/docker.service.d/override.conf &lt;&lt;EOF</span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>ExecStart=</span></span>
<span class="line"><span>ExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtime</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>sudo systemctl daemon-reload</span></span>
<span class="line"><span>sudo systemctl restart docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="daemon-configuration-file" tabindex="-1"><a class="header-anchor" href="#daemon-configuration-file"><span>Daemon configuration file</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo tee /etc/docker/daemon.json &lt;&lt;EOF</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    &quot;runtimes&quot;: {</span></span>
<span class="line"><span>        &quot;nvidia&quot;: {</span></span>
<span class="line"><span>            &quot;path&quot;: &quot;/usr/bin/nvidia-container-runtime&quot;,</span></span>
<span class="line"><span>            &quot;runtimeArgs&quot;: []</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>sudo pkill -SIGHUP dockerd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can optionally reconfigure the default runtime by adding the following to <code>/etc/docker/daemon.json</code>:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>&quot;default-runtime&quot;: &quot;nvidia&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="command-line" tabindex="-1"><a class="header-anchor" href="#command-line"><span>Command line</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>sudo dockerd --add-runtime=nvidia=/usr/bin/nvidia-container-runtime [...]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="方法二" tabindex="-1"><a class="header-anchor" href="#方法二"><span>方法二</span></a></h4><blockquote><p>在docker 运行时增加nvidia设备</p></blockquote><p>example</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8000:8000</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jupyterhub</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --restart=always</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --gpus</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> muaimingjun/jupyterhub:1.0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="重启dockerd进程" tabindex="-1"><a class="header-anchor" href="#重启dockerd进程"><span>重启Dockerd进程</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>`,47)]))}const p=e(t,[["render",l],["__file","为Docker安装NvidiaRuntime.html.vue"]]),h=JSON.parse('{"path":"/note-book/AI-Training/%E4%B8%BADocker%E5%AE%89%E8%A3%85NvidiaRuntime.html","title":"为Docker安装NvidiaRuntime","lang":"zh-CN","frontmatter":{"description":"为Docker安装NvidiaRuntime 参考链接 https://nvidia.github.io/nvidia-container-runtime/ https://github.com/NVIDIA/nvidia-container-runtime 导入软件库 根据操作系统分类导入 基于Debian的操作系统 For pre-releases...","head":[["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/AI-Training/%E4%B8%BADocker%E5%AE%89%E8%A3%85NvidiaRuntime.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"为Docker安装NvidiaRuntime"}],["meta",{"property":"og:description","content":"为Docker安装NvidiaRuntime 参考链接 https://nvidia.github.io/nvidia-container-runtime/ https://github.com/NVIDIA/nvidia-container-runtime 导入软件库 根据操作系统分类导入 基于Debian的操作系统 For pre-releases..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-03-25T08:29:56.000Z"}],["meta",{"property":"article:modified_time","content":"2024-03-25T08:29:56.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"为Docker安装NvidiaRuntime\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-03-25T08:29:56.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"PaperDragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"]]},"git":{"createdTime":1691939318000,"updatedTime":1711355396000,"contributors":[{"name":"PaperDragon","username":"PaperDragon","email":"2678885646@qq.com","commits":1,"url":"https://github.com/PaperDragon"},{"name":"PaperDragon-SH","username":"PaperDragon-SH","email":"2678885646@qq.com","commits":2,"url":"https://github.com/PaperDragon-SH"}]},"readingTime":{"minutes":1.76,"words":528},"filePathRelative":"note-book/AI-Training/为Docker安装NvidiaRuntime.md","localizedDate":"2023年8月13日","excerpt":"\\n<blockquote>\\n<p>参考链接</p>\\n<ul>\\n<li>https://nvidia.github.io/nvidia-container-runtime/</li>\\n<li>https://github.com/NVIDIA/nvidia-container-runtime</li>\\n</ul>\\n</blockquote>\\n<h2>导入软件库</h2>\\n<h3>根据操作系统分类导入</h3>\\n<h4>基于Debian的操作系统</h4>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>curl -s -L https://nvidia.github.io/nvidia-container-runtime/gpgkey | \\\\</span></span>\\n<span class=\\"line\\"><span>  sudo apt-key add -</span></span>\\n<span class=\\"line\\"><span>distribution=$(. /etc/os-release;echo $ID$VERSION_ID)</span></span>\\n<span class=\\"line\\"><span>curl -s -L https://nvidia.github.io/nvidia-container-runtime/$distribution/nvidia-container-runtime.list | \\\\</span></span>\\n<span class=\\"line\\"><span>  sudo tee /etc/apt/sources.list.d/nvidia-container-runtime.list</span></span>\\n<span class=\\"line\\"><span>sudo apt-get update</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{p as comp,h as data};
