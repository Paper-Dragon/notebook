import{g as Uu}from"./commonjsHelpers-CqkleIqs.js";function Bu(Ve,Yr){for(var Ye=0;Ye<Yr.length;Ye++){const ve=Yr[Ye];if(typeof ve!="string"&&!Array.isArray(ve)){for(const me in ve)if(me!=="default"&&!(me in Ve)){const De=Object.getOwnPropertyDescriptor(ve,me);De&&Object.defineProperty(Ve,me,De.get?De:{enumerable:!0,get:()=>ve[me]})}}}return Object.freeze(Object.defineProperty(Ve,Symbol.toStringTag,{value:"Module"}))}var fn={exports:{}},no;function Gu(){return no||(no=1,function(Ve,Yr){(function Ye(ve){var me;me=function(){function De(s,a){(a==null||a>s.length)&&(a=s.length);for(var e=0,t=Array(a);e<a;e++)t[e]=s[e];return t}function cn(s,a){for(var e=0;e<a.length;e++){var t=a[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,mn(t.key),t)}}function dt(s,a,e){return a&&cn(s.prototype,a),e&&cn(s,e),Object.defineProperty(s,"prototype",{writable:!1}),s}function so(s,a){var e=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(e)return(e=e.call(s)).next.bind(e);if(Array.isArray(s)||(e=function(r,i){if(r){if(typeof r=="string")return De(r,i);var n={}.toString.call(r).slice(8,-1);return n==="Object"&&r.constructor&&(n=r.constructor.name),n==="Map"||n==="Set"?Array.from(r):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?De(r,i):void 0}}(s))||a){e&&(s=e);var t=0;return function(){return t>=s.length?{done:!0}:{done:!1,value:s[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oo(s,a,e){return(a=mn(a))in s?Object.defineProperty(s,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[a]=e,s}function ot(){return ot=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var t in e)({}).hasOwnProperty.call(e,t)&&(s[t]=e[t])}return s},ot.apply(null,arguments)}function Wr(s){return Wr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Wr(s)}function ut(s,a){s.prototype=Object.create(a.prototype),s.prototype.constructor=s,We(s,a)}function gn(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gn=function(){return!!s})()}function vn(s,a){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),e.push.apply(e,t)}return e}function at(s){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?arguments[a]:{};a%2?vn(Object(e),!0).forEach(function(t){oo(s,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):vn(Object(e)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(e,t))})}return s}function We(s,a){return We=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},We(s,a)}function mn(s){var a=function(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}(s,"string");return typeof a=="symbol"?a:a+""}function _e(s){var a=typeof Map=="function"?new Map:void 0;return _e=function(e){if(e===null||!function(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(a!==void 0){if(a.has(e))return a.get(e);a.set(e,t)}function t(){return function(r,i,n){if(gn())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,i);var l=new(r.bind.apply(r,o));return n&&We(l,n.prototype),l}(e,arguments,Wr(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),We(t,e)},_e(s)}function lo(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var pn,yn,En={exports:{}},uo=(pn||(pn=1,function(s){var a=Object.prototype.hasOwnProperty,e="~";function t(){}function r(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function i(l,u,d,h,c){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new r(d,h||l,c),g=e?e+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function n(l,u){--l._eventsCount==0?l._events=new t:delete l._events[u]}function o(){this._events=new t,this._eventsCount=0}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(e=!1)),o.prototype.eventNames=function(){var l,u,d=[];if(this._eventsCount===0)return d;for(u in l=this._events)a.call(l,u)&&d.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(l)):d},o.prototype.listeners=function(l){var u=e?e+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,c=d.length,f=new Array(c);h<c;h++)f[h]=d[h].fn;return f},o.prototype.listenerCount=function(l){var u=e?e+l:l,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,u,d,h,c,f){var g=e?e+l:l;if(!this._events[g])return!1;var v,m,y=this._events[g],E=arguments.length;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),E){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,u),!0;case 3:return y.fn.call(y.context,u,d),!0;case 4:return y.fn.call(y.context,u,d,h),!0;case 5:return y.fn.call(y.context,u,d,h,c),!0;case 6:return y.fn.call(y.context,u,d,h,c,f),!0}for(m=1,v=new Array(E-1);m<E;m++)v[m-1]=arguments[m];y.fn.apply(y.context,v)}else{var T,S=y.length;for(m=0;m<S;m++)switch(y[m].once&&this.removeListener(l,y[m].fn,void 0,!0),E){case 1:y[m].fn.call(y[m].context);break;case 2:y[m].fn.call(y[m].context,u);break;case 3:y[m].fn.call(y[m].context,u,d);break;case 4:y[m].fn.call(y[m].context,u,d,h);break;default:if(!v)for(T=1,v=new Array(E-1);T<E;T++)v[T-1]=arguments[T];y[m].fn.apply(y[m].context,v)}}return!0},o.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},o.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},o.prototype.removeListener=function(l,u,d,h){var c=e?e+l:l;if(!this._events[c])return this;if(!u)return n(this,c),this;var f=this._events[c];if(f.fn)f.fn!==u||h&&!f.once||d&&f.context!==d||n(this,c);else{for(var g=0,v=[],m=f.length;g<m;g++)(f[g].fn!==u||h&&!f[g].once||d&&f[g].context!==d)&&v.push(f[g]);v.length?this._events[c]=v.length===1?v[0]:v:n(this,c)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&n(this,u)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o}(En)),En.exports),lr=lo(uo),Tn={exports:{}},jr=(yn||(yn=1,function(s,a){var e,t,r,i,n;e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n={buildAbsoluteURL:function(o,l,u){if(u=u||{},o=o.trim(),!(l=l.trim())){if(!u.alwaysNormalize)return o;var d=n.parseURL(o);if(!d)throw new Error("Error trying to parse base URL.");return d.path=n.normalizePath(d.path),n.buildURLFromParts(d)}var h=n.parseURL(l);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=n.normalizePath(h.path),n.buildURLFromParts(h)):l;var c=n.parseURL(o);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var f=t.exec(c.path);c.netLoc=f[1],c.path=f[2]}c.netLoc&&!c.path&&(c.path="/");var g={scheme:c.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=c.netLoc,h.path[0]!=="/"))if(h.path){var v=c.path,m=v.substring(0,v.lastIndexOf("/")+1)+h.path;g.path=n.normalizePath(m)}else g.path=c.path,h.params||(g.params=c.params,h.query||(g.query=c.query));return g.path===null&&(g.path=u.alwaysNormalize?n.normalizePath(h.path):h.path),n.buildURLFromParts(g)},parseURL:function(o){var l=e.exec(o);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(r,"");o.length!==(o=o.replace(i,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}},s.exports=n}(Tn)),Tn.exports),B=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},ho=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=fo},fo=Number.MAX_SAFE_INTEGER||9007199254740991,K=function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s}({}),D=function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",s.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",s.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.ASSET_LIST_LOAD_ERROR="assetListLoadError",s.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",s.ASSET_LIST_PARSING_ERROR="assetListParsingError",s.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.ATTACH_MEDIA_ERROR="attachMediaError",s.UNKNOWN="unknown",s}({}),p=function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.MEDIA_ENDED="hlsMediaEnded",s.STALL_RESOLVED="hlsStallResolved",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFERED_TO_END="hlsBufferedToEnd",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s.ASSET_LIST_LOADING="hlsAssetListLoading",s.ASSET_LIST_LOADED="hlsAssetListLoaded",s.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",s.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",s.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",s.INTERSTITIAL_STARTED="hlsInterstitialStarted",s.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",s.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",s.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",s.INTERSTITIAL_ENDED="hlsInterstitialEnded",s.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",s.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",s.EVENT_CUE_ENTER="hlsEventCueEnter",s}({}),pe="manifest",se="level",zt="audioTrack",$t="subtitleTrack",J="main",Mt="audio",Qt="subtitle",Pe=function(){function s(e,t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var a=s.prototype;return a.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},a.getTotalWeight=function(){return this.totalWeight_},a.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},s}(),co=function(){function s(e,t,r,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Pe(e),this.fast_=new Pe(t),this.defaultTTFB_=i,this.ttfb_=new Pe(e)}var a=s.prototype;return a.update=function(e,t){var r=this.slow_,i=this.fast_,n=this.ttfb_;r.halfLife!==e&&(this.slow_=new Pe(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Pe(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Pe(e,n.getEstimate(),n.getTotalWeight()))},a.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},a.sampleTTFB=function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))},a.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},a.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},a.destroy=function(){},dt(s,[{key:"defaultEstimate",get:function(){return this.defaultEstimate_}}])}(),oe=function(s,a){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;var e="["+s+"]:";this.trace=ye,this.debug=a.debug.bind(null,e),this.log=a.log.bind(null,e),this.warn=a.warn.bind(null,e),this.info=a.info.bind(null,e),this.error=a.error.bind(null,e)},ye=function(){},go={trace:ye,debug:ye,log:ye,warn:ye,info:ye,error:ye};function qr(){return ot({},go)}function Sn(s,a,e){return a[s]?a[s].bind(a):function(t,r){var i=self.console[t];return i?i.bind(self.console,(r?"["+r+"] ":"")+"["+t+"] >"):ye}(s,e)}var Xr=qr();function Ln(s,a,e){var t=qr();if(typeof console=="object"&&s===!0||typeof s=="object"){var r=["debug","log","info","warn","error"];r.forEach(function(i){t[i]=Sn(i,s,e)});try{t.log('Debug logs enabled for "'+a+'" in hls.js version 1.6.2')}catch{return qr()}r.forEach(function(i){Xr[i]=Sn(i,s)})}else ot(Xr,t);return t}var Z=Xr;function Ee(s){if(s===void 0&&(s=!0),typeof self<"u")return(s||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function An(s,a){var e=Object.keys(s),t=Object.keys(a),r=e.length,i=t.length;return!r||!i||r===i&&!e.some(function(n){return t.indexOf(n)===-1})}function Gt(s,a){if(a===void 0&&(a=!1),typeof TextDecoder<"u"){var e=new TextDecoder("utf-8").decode(s);if(a){var t=e.indexOf("\0");return t!==-1?e.substring(0,t):e}return e.replace(/\0/g,"")}for(var r,i,n,o=s.length,l="",u=0;u<o;){if((r=s[u++])===0&&a)return l;if(r!==0&&r!==3)switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(r);break;case 12:case 13:i=s[u++],l+=String.fromCharCode((31&r)<<6|63&i);break;case 14:i=s[u++],n=s[u++],l+=String.fromCharCode((15&r)<<12|(63&i)<<6|(63&n)<<0)}}return l}var Jt={hexDump:function(s){for(var a="",e=0;e<s.length;e++){var t=s[e].toString(16);t.length<2&&(t="0"+t),a+=t}return a}},zr=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},Ft="audio",Ht="video",Qr="audiovideo",Rn=function(){function s(e){var t,r,i;this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,(i=In(t=this,r="stats"))&&(i.enumerable=!0,Object.defineProperty(t,r,i))}var a=s.prototype;return a.setByteRange=function(e,t){var r,i=e.split("@",2);r=i.length===1?(t==null?void 0:t.byteRangeEndOffset)||0:parseInt(i[1]),this._byteRange=[r,parseInt(i[0])+r]},a.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[Ft]=null,e[Ht]=null,e[Qr]=null},dt(s,[{key:"baseurl",get:function(){return this.base.url}},{key:"byteRange",get:function(){return this._byteRange===null?[]:this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"elementaryStreams",get:function(){var e;return this._streams===null&&(this._streams=((e={})[Ft]=null,e[Ht]=null,e[Qr]=null,e)),this._streams},set:function(e){this._streams=e}},{key:"hasStats",get:function(){return this._stats!==null}},{key:"hasStreams",get:function(){return this._streams!==null}},{key:"stats",get:function(){return this._stats===null&&(this._stats=new zr),this._stats},set:function(e){this._stats=e}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=jr.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}])}();function Dt(s){return s.sn!=="initSegment"}var $r=function(s){function a(t,r){var i;return(i=s.call(this,r)||this)._decryptdata=null,i._programDateTime=null,i._ref=null,i._bitrate=void 0,i.rawProgramDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.playlistOffset=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.urlId=0,i.type=t,i}ut(a,s);var e=a.prototype;return e.addStart=function(t){this.setStart(this.start+t)},e.setStart=function(t){this.start=t,this._ref&&(this._ref.start=t)},e.setDuration=function(t){this.duration=t,this._ref&&(this._ref.duration=t)},e.setKeyFormat=function(t){if(this.levelkeys){var r=this.levelkeys[t];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}},e.abortRequests=function(){var t,r;(t=this.loader)==null||t.abort(),(r=this.keyLoader)==null||r.abort()},e.setElementaryStreamInfo=function(t,r,i,n,o,l){l===void 0&&(l=!1);var u=this.elementaryStreams,d=u[t];d?(d.startPTS=Math.min(d.startPTS,r),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,n),d.endDTS=Math.max(d.endDTS,o)):u[t]={startPTS:r,endPTS:i,startDTS:n,endDTS:o,partial:l}},dt(a,[{key:"byteLength",get:function(){if(this.hasStats){var t=this.stats.total;if(t)return t}if(this.byteRange){var r=this.byteRange[0],i=this.byteRange[1];if(B(r)&&B(i))return i-r}return null}},{key:"bitrate",get:function(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null},set:function(t){this._bitrate=t}},{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null)return null;var t=B(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}},{key:"programDateTime",get:function(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime},set:function(t){B(t)?this._programDateTime=t:this._programDateTime=this.rawProgramDateTime=null}},{key:"ref",get:function(){return Dt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}}])}(Rn),vo=function(s){function a(e,t,r,i,n){var o;(o=s.call(this,r)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=t,o.index=i;var l=e.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,n),n&&(o.fragOffset=n.fragOffset+n.duration),o}return ut(a,s),dt(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}])}(Rn);function In(s,a){var e=Object.getPrototypeOf(s);if(e){var t=Object.getOwnPropertyDescriptor(e,a);return t||In(e,a)}}var ur=Math.pow(2,32)-1,mo=[].push,kn={video:1,audio:2,id3:3,text:4};function kt(s){return String.fromCharCode.apply(null,s)}function bn(s,a){var e=s[a]<<8|s[a+1];return e<0?65536+e:e}function V(s,a){var e=_n(s,a);return e<0?4294967296+e:e}function Dn(s,a){var e=V(s,a);return e*=Math.pow(2,32),e+=V(s,a+4)}function _n(s,a){return s[a]<<24|s[a+1]<<16|s[a+2]<<8|s[a+3]}function Jr(s,a,e){s[a]=e>>24,s[a+1]=e>>16&255,s[a+2]=e>>8&255,s[a+3]=255&e}function W(s,a){var e=[];if(!a.length)return e;for(var t=s.byteLength,r=0;r<t;){var i=V(s,r),n=i>1?r+i:t;if(kt(s.subarray(r+4,r+8))===a[0])if(a.length===1)e.push(s.subarray(r+8,n));else{var o=W(s.subarray(r+8,n),a.slice(1));o.length&&mo.apply(e,o)}r=n}return e}function po(s){var a=[],e=s[0],t=8,r=V(s,t);t+=4;var i=0,n=0;e===0?(i=V(s,t),n=V(s,t+4),t+=8):(i=Dn(s,t),n=Dn(s,t+8),t+=16),t+=2;var o=s.length+n,l=bn(s,t);t+=2;for(var u=0;u<l;u++){var d=t,h=V(s,d);d+=4;var c=2147483647&h;if((2147483648&h)>>>31==1)return Z.warn("SIDX has hierarchical references (not supported)"),null;var f=V(s,d);d+=4,a.push({referenceSize:c,subsegmentDuration:f,info:{duration:f/r,start:o,end:o+c-1}}),o+=c,t=d+=4}return{earliestPresentationTime:i,timescale:r,version:e,referencesCount:l,references:a}}function Pn(s){for(var a=[],e=W(s,["moov","trak"]),t=0;t<e.length;t++){var r=e[t],i=W(r,["tkhd"])[0];if(i){var n=i[0],o=V(i,n===0?12:20),l=W(r,["mdia","mdhd"])[0];if(l){var u=V(l,(n=l[0])===0?12:20),d=W(r,["mdia","hdlr"])[0];if(d){var h=kt(d.subarray(8,12)),c={soun:Ft,vide:Ht}[h],f=yo(W(r,["mdia","minf","stbl","stsd"])[0]);c?(a[o]={timescale:u,type:c,stsd:f},a[c]=at({timescale:u,id:o},f)):a[o]={timescale:u,type:h,stsd:f}}}}}return W(s,["moov","mvex","trex"]).forEach(function(g){var v=V(g,4),m=a[v];m&&(m.default={duration:V(g,12),flags:V(g,20)})}),a}function yo(s){var a,e=s.subarray(8),t=e.subarray(86),r=kt(e.subarray(4,8)),i=r,n=r==="enca"||r==="encv";if(n){var o=W(e,[r])[0];W(o.subarray(r==="enca"?28:78),["sinf"]).forEach(function(q){var Et=W(q,["schm"])[0];if(Et){var nt=kt(Et.subarray(4,8));if(nt==="cbcs"||nt==="cenc"){var $=W(q,["frma"])[0];$&&(i=kt($))}}})}var l=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":var u=W(t,["avcC"])[0];u&&u.length>3&&(i+="."+hr(u[1])+hr(u[2])+hr(u[3]),a=dr(l==="avc1"?"dva1":"dvav",t));break;case"mp4a":var d=W(e,[r])[0],h=W(d.subarray(28),["esds"])[0];if(h&&h.length>7){var c=4;if(h[c++]!==3)break;c=Zr(h,c),c+=2;var f=h[c++];if(128&f&&(c+=2),64&f&&(c+=h[c++]),h[c++]!==4)break;c=Zr(h,c);var g=h[c++];if(g!==64||(i+="."+hr(g),c+=12,h[c++]!==5))break;c=Zr(h,c);var v=h[c++],m=(248&v)>>3;m===31&&(m+=1+((7&v)<<3)+((224&h[c])>>5)),i+="."+m}break;case"hvc1":case"hev1":var y=W(t,["hvcC"])[0];if(y&&y.length>12){var E=y[1],T=["","A","B","C"][E>>6],S=31&E,I=V(y,2),L=(32&E)>>5?"H":"L",A=y[12],b=y.subarray(6,12);i+="."+T+S,i+="."+I.toString(16).toUpperCase(),i+="."+L+A;for(var R="",k=b.length;k--;){var _=b[k];(_||R)&&(R="."+_.toString(16).toUpperCase()+R)}i+=R}a=dr(l=="hev1"?"dvhe":"dvh1",t);break;case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":i=dr(i,t)||i;break;case"vp09":var C=W(t,["vpcC"])[0];if(C&&C.length>6){var x=C[4],w=C[5],P=C[6]>>4&15;i+="."+Zt(x)+"."+Zt(w)+"."+Zt(P)}break;case"av01":var M=W(t,["av1C"])[0];if(M&&M.length>2){var F=M[1]>>>5,U=31&M[1],G=M[2]>>>7?"H":"M",N=(64&M[2])>>6,H=(32&M[2])>>5,j=F===2&&N?H?12:10:N?10:8,et=(16&M[2])>>4,X=(8&M[2])>>3,ht=(4&M[2])>>2,rt=3&M[2];i+="."+F+"."+Zt(U)+G+"."+Zt(j)+"."+et+"."+X+ht+rt+"."+Zt(1)+"."+Zt(1)+"."+Zt(1)+".0",a=dr("dav1",t)}}return{codec:i,encrypted:n,supplemental:a}}function dr(s,a){var e=W(a,["dvvC"]),t=e.length?e[0]:W(a,["dvcC"])[0];if(t){var r=t[2]>>1&127,i=t[2]<<5&32|t[3]>>3&31;return s+"."+Zt(r)+"."+Zt(i)}}function Zr(s,a){for(var e=a+5;128&s[a++]&&a<e;);return a}function hr(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function Zt(s){return(s<10?"0":"")+s}function Cn(s){var a=W(s,["schm"])[0];if(a){var e=kt(a.subarray(4,8));if(e==="cbcs"||e==="cenc")return W(s,["schi","tenc"])[0]}return null}function Eo(s){var a=V(s,0),e=8;1&a&&(e+=4),4&a&&(e+=4);for(var t=0,r=V(s,4),i=0;i<r;i++)256&a&&(t+=V(s,e),e+=4),512&a&&(e+=4),1024&a&&(e+=4),2048&a&&(e+=4);return t}function Vt(s,a){var e=new Uint8Array(s.length+a.length);return e.set(s),e.set(a,s.length),e}function wn(s,a){var e=[],t=a.samples,r=a.timescale,i=a.id,n=!1;return W(t,["moof"]).map(function(o){var l=o.byteOffset-8;W(o,["traf"]).map(function(u){var d=W(u,["tfdt"]).map(function(h){var c=h[0],f=V(h,4);return c===1&&(f*=Math.pow(2,32),f+=V(h,8)),f/r})[0];return d!==void 0&&(s=d),W(u,["tfhd"]).map(function(h){var c=V(h,4),f=16777215&V(h,0),g=0,v=(16&f)!=0,m=0,y=(32&f)!=0,E=8;c===i&&((1&f)!=0&&(E+=8),(2&f)!=0&&(E+=4),(8&f)!=0&&(g=V(h,E),E+=4),v&&(m=V(h,E),E+=4),y&&(E+=4),a.type==="video"&&(n=fr(a.codec)),W(u,["trun"]).map(function(T){var S=T[0],I=16777215&V(T,0),L=(1&I)!=0,A=0,b=(4&I)!=0,R=(256&I)!=0,k=0,_=(512&I)!=0,C=0,x=(1024&I)!=0,w=(2048&I)!=0,P=0,M=V(T,4),F=8;L&&(A=V(T,F),F+=4),b&&(F+=4);for(var U=A+l,G=0;G<M;G++){if(R?(k=V(T,F),F+=4):k=g,_?(C=V(T,F),F+=4):C=m,x&&(F+=4),w&&(P=S===0?V(T,F):_n(T,F),F+=4),a.type===Ht)for(var N=0;N<C;){var H=V(t,U);To(n,t[U+=4])&&ti(t.subarray(U,U+H),n?2:1,s+P/r,e),U+=H,N+=H+4}s+=k/r}}))})})}),e}function fr(s){if(!s)return!1;var a=s.substring(0,4);return a==="hvc1"||a==="hev1"||a==="dvh1"||a==="dvhe"}function To(s,a){if(s){var e=a>>1&63;return e===39||e===40}return(31&a)==6}function ti(s,a,e,t){var r=xn(s),i=0;i+=a;for(var n=0,o=0,l=0;i<r.length;){n=0;do{if(i>=r.length)break;n+=l=r[i++]}while(l===255);o=0;do{if(i>=r.length)break;o+=l=r[i++]}while(l===255);var u=r.length-i,d=i;if(o<u)i+=o;else if(o>u){Z.error("Malformed SEI payload. "+o+" is too small, only "+u+" bytes left to parse.");break}if(n===4){if(r[d++]===181){var h=bn(r,d);if(d+=2,h===49){var c=V(r,d);if(d+=4,c===1195456820){var f=r[d++];if(f===3){var g=r[d++],v=64&g,m=v?2+3*(31&g):0,y=new Uint8Array(m);if(v){y[0]=g;for(var E=1;E<m;E++)y[E]=r[d++]}t.push({type:f,payloadType:n,pts:e,bytes:y})}}}}}else if(n===5&&o>16){for(var T=[],S=0;S<16;S++){var I=r[d++].toString(16);T.push(I.length==1?"0"+I:I),S!==3&&S!==5&&S!==7&&S!==9||T.push("-")}for(var L=o-16,A=new Uint8Array(L),b=0;b<L;b++)A[b]=r[d++];t.push({payloadType:n,pts:e,uuid:T.join(""),userData:Gt(A),userDataBytes:A})}}}function xn(s){for(var a=s.byteLength,e=[],t=1;t<a-2;)s[t]===0&&s[t+1]===0&&s[t+2]===3?(e.push(t+2),t+=2):t++;if(e.length===0)return s;var r=a-e.length,i=new Uint8Array(r),n=0;for(t=0;t<r;n++,t++)n===e[0]&&(n++,e.shift()),i[t]=s[n];return i}function So(s,a,e){if(s.byteLength!==16)throw new RangeError("Invalid system id");var t,r;t=new Uint8Array,r=new Uint8Array;var i=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(i.buffer).setUint32(0,e.byteLength,!1),function(n){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];for(var d=l.length,h=8,c=d;c--;)h+=l[c].byteLength;var f=new Uint8Array(h);for(f[0]=h>>24&255,f[1]=h>>16&255,f[2]=h>>8&255,f[3]=255&h,f.set(n,4),c=0,h=8;c<d;c++)f.set(l[c],h),h+=l[c].byteLength;return f}([112,115,115,104],new Uint8Array([0,0,0,0]),s,r,t,i,e||new Uint8Array)}function Lo(s){var a=s.getUint32(0),e=s.byteOffset,t=s.byteLength;if(t<a)return{offset:e,size:t};if(s.getUint32(4)!==1886614376)return{offset:e,size:a};var r=s.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:e,size:a};var i=s.buffer,n=Jt.hexDump(new Uint8Array(i,e+12,16)),o=s.getUint32(28),l=null,u=null;if(r===0){if(a-32<o||o<22)return{offset:e,size:a};u=new Uint8Array(i,e+32,o)}else if(r===1){if(!o||t<e+32+16*o+16)return{offset:e,size:a};l=[];for(var d=0;d<o;d++)l.push(new Uint8Array(i,e+32+16*d,16))}return{version:r,systemId:n,kids:l,data:u,offset:e,size:a}}var On=function(){return/\(Windows.+Firefox\//i.test(navigator.userAgent)},Ce={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Mn(s,a){var e=Ce[a];return!!e&&!!e[s.slice(0,4)]}function ei(s,a,e){return e===void 0&&(e=!0),!s.split(",").some(function(t){return!Fn(t,a,e)})}function Fn(s,a,e){var t;e===void 0&&(e=!0);var r=Ee(e);return(t=r==null?void 0:r.isTypeSupported(je(s,a)))!=null&&t}function je(s,a){return a+"/mp4;codecs="+s}function Nn(s){if(s){var a=s.substring(0,4);return Ce.video[a]}return 2}function cr(s){var a=On();return s.split(",").reduce(function(e,t){var r=a&&fr(t)?9:Ce.video[t];return r?(2*r+e)/(e?3:2):(Ce.audio[t]+e)/(e?2:1)},0)}var ri={},Ao=/flac|opus|mp4a\.40\.34/i;function gr(s,a){return a===void 0&&(a=!0),s.replace(Ao,function(e){return function(t,r){if(r===void 0&&(r=!0),ri[t])return ri[t];for(var i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[t],n=0;n<i.length;n++){var o;if(Fn(i[n],"audio",r))return ri[t]=i[n],i[n];if(i[n]==="mp3"&&(o=Ee(r))!=null&&o.isTypeSupported("audio/mpeg"))return""}return t}(e.toLowerCase(),a)})}function vr(s,a){if(s&&(s.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(s)!==-1))return s;if(a){var e=a.split(",");if(e.length>1){if(s){for(var t=e.length;t--;)if(e[t].substring(0,4)===s.substring(0,4))return e[t]}return e[0]}}return a||s}function Ro(s){if(s.startsWith("av01.")){for(var a=s.split("."),e=["0","111","01","01","01","0"],t=a.length;t>4&&t<10;t++)a[t]=e[t-4];return a.join(".")}return s}function Un(s){var a=Ee(s)||{isTypeSupported:function(){return!1}};return{mpeg:a.isTypeSupported("audio/mpeg"),mp3:a.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:a.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Bn(s){return s.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}var Gn={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function Kn(s,a){return{supported:!1,configurations:a,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:s}}var Hn={};function Vn(s,a,e){var t=s.videoCodec,r=s.audioCodec;if(!t&&!r||!e)return Promise.resolve(Gn);var i=[];if(t){var n={width:s.width,height:s.height,bitrate:Math.ceil(Math.max(.9*s.bitrate,s.averageBitrate)),framerate:s.frameRate||30},o=s.videoRange;o!=="SDR"&&(n.transferFunction=o.toLowerCase());var l=t.split(","),u=navigator.userAgent;if(l.some(function(d){return fr(d)})&&On())return Promise.resolve(Kn(new Error("Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: ("+u+")"),i));i.push.apply(i,l.map(function(d){return{type:"media-source",video:at(at({},n),{},{contentType:je(Ro(d),"video")})}}))}return r&&s.audioGroups&&s.audioGroups.forEach(function(d){var h;d&&((h=a.groups[d])==null||h.tracks.forEach(function(c){if(c.groupId===d){var f=c.channels||"",g=parseFloat(f);B(g)&&g>2&&i.push.apply(i,r.split(",").map(function(v){return{type:"media-source",audio:{contentType:je(v,"audio"),channels:""+g}}}))}}))}),Promise.all(i.map(function(d){var h=function(c){var f=c.audio,g=c.video,v=g||f;if(v){var m=Bn(v.contentType);if(g)return"r"+g.height+"x"+g.width+"f"+Math.ceil(g.framerate)+(g.transferFunction||"sd")+"_"+m+"_"+Math.ceil(g.bitrate/1e5);if(f)return"c"+f.channels+(f.spatialRendering?"s":"n")+"_"+m}return""}(d);return Hn[h]||(Hn[h]=e.decodingInfo(d))})).then(function(d){return{supported:!d.some(function(h){return!h.supported}),configurations:i,decodingInfoResults:d}}).catch(function(d){return{supported:!1,configurations:i,decodingInfoResults:[],error:d}})}var ii=["NONE","TYPE-0","TYPE-1",null],mr=["SDR","PQ","HLG"],Yn="",Io="YES",ko="v2";function Wn(s){var a=s.canSkipUntil,e=s.canSkipDateRanges,t=s.age;return a&&t<a/2?e?ko:Io:Yn}var jn=function(){function s(a,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=e,this.skip=t}return s.prototype.addDirectives=function(a){var e=new self.URL(a);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},s}(),qe=function(){function s(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(function(i){return!!i}).map(function(i){return i.substring(0,4)}).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;var r=(t=e.supplemental)==null?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=","+r.substring(0,4))}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}var a=s.prototype;return a.hasAudioGroup=function(e){return qn(this._audioGroups,e)},a.hasSubtitleGroup=function(e){return qn(this._subtitleGroups,e)},a.addGroupId=function(e,t){if(t){if(e==="audio"){var r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}},a.addFallback=function(){},dt(s,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(e){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var e;return(e=this.audioGroups)==null?void 0:e[0]}},{key:"textGroupId",get:function(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}}])}();function qn(s,a){return!(!a||!s)&&s.indexOf(a)!==-1}function bo(s,a){var e=!1,t=[];if(s&&(e=s!=="SDR",t=[s]),a){var r=(t=a.allowedVideoRanges||mr.slice(0)).join("")!=="SDR"&&!a.videoCodec;(e=a.preferHDR!==void 0?a.preferHDR:r&&function(){if(typeof matchMedia=="function"){var i=matchMedia("(dynamic-range: high)"),n=matchMedia("bad query");if(i.media!==n.media)return i.matches===!0}return!1}())||(t=["SDR"])}return{preferHDR:e,allowedVideoRanges:t}}var pt=function(s,a){return JSON.stringify(s,function(e){var t=new WeakSet;return function(r,i){if(e&&(i=e(r,i)),typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}}(a))};function te(s,a){Z.log('[abr] start candidates with "'+s+'" ignored because '+a)}function Xn(s){return s.reduce(function(a,e){var t=a.groups[e.groupId];t||(t=a.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),t.tracks.push(e);var r=e.channels||"2";return t.channels[r]=(t.channels[r]||0)+1,t.hasDefault=t.hasDefault||e.default,t.hasAutoSelect=t.hasAutoSelect||e.autoselect,t.hasDefault&&(a.hasDefaultAudio=!0),t.hasAutoSelect&&(a.hasAutoSelectAudio=!0),a},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function zn(s){if(!s)return s;var a=s;return{lang:a.lang,assocLang:a.assocLang,characteristics:a.characteristics,channels:a.channels,audioCodec:a.audioCodec}}function ee(s,a,e){if("attrs"in s){var t=a.indexOf(s);if(t!==-1)return t}for(var r=0;r<a.length;r++)if(Le(s,a[r],e))return r;return-1}function Le(s,a,e){var t,r,i=s.groupId,n=s.name,o=s.lang,l=s.assocLang,u=s.default,d=s.forced;return(i===void 0||a.groupId===i)&&(n===void 0||a.name===n)&&(o===void 0||(t=o,(r=a.lang)===void 0&&(r="--"),t.length===r.length?t===r:t.startsWith(r)||r.startsWith(t)))&&(o===void 0||a.assocLang===l)&&(u===void 0||a.default===u)&&(d===void 0||a.forced===d)&&(!("characteristics"in s)||function(h,c){c===void 0&&(c="");var f=h.split(","),g=c.split(",");return f.length===g.length&&!f.some(function(v){return g.indexOf(v)===-1})}(s.characteristics||"",a.characteristics))&&(e===void 0||e(s,a))}function Ae(s,a){var e=s.audioCodec,t=s.channels;return!(e!==void 0&&(a.audioCodec||"").substring(0,4)!==e.substring(0,4)||t!==void 0&&t!==(a.channels||"2"))}function Qn(s,a,e){for(var t=a;t>-1;t--)if(e(s[t]))return t;for(var r=a+1;r<s.length;r++)if(e(s[r]))return r;return-1}function pr(s,a){var e;return!!s&&s!==((e=a.loadLevelObj)==null?void 0:e.uri)}var Do=function(s){function a(t){var r;return(r=s.call(this,"abr",t.logger)||this).hls=void 0,r.lastLevelLoadSec=0,r.lastLoadedFragLevel=-1,r.firstSelection=-1,r._nextAutoLevel=-1,r.nextAutoLevelKey="",r.audioTracksByGroup=null,r.codecTiers=null,r.timer=-1,r.fragCurrent=null,r.partCurrent=null,r.bitrateTestDelay=0,r.rebufferNotice=-1,r.bwEstimator=void 0,r._abandonRulesCheck=function(i){var n,o=r,l=o.fragCurrent,u=o.partCurrent,d=o.hls,h=d.autoLevelEnabled,c=d.media;if(l&&c){var f=performance.now(),g=u?u.stats:l.stats,v=u?u.duration:l.duration,m=f-g.loading.start,y=d.minAutoLevel,E=l.level,T=r._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||E<=y)return r.clearTimer(),void(r._nextAutoLevel=-1);if(h){var S=T>-1&&T!==E,I=!!i||S;if(I||!c.paused&&c.playbackRate&&c.readyState){var L=d.mainForwardBufferInfo;if(I||L!==null){var A=r.bwEstimator.getEstimateTTFB(),b=Math.abs(c.playbackRate);if(!(m<=Math.max(A,v/(2*b)*1e3))){var R=L?L.len/b:0,k=g.loading.first?g.loading.first-g.loading.start:-1,_=g.loaded&&k>-1,C=r.getBwEstimate(),x=d.levels,w=x[E],P=Math.max(g.loaded,Math.round(v*(l.bitrate||w.averageBitrate)/8)),M=_?m-k:m;M<1&&_&&(M=Math.min(m,8*g.loaded/C));var F=_?1e3*g.loaded/M:0,U=A/1e3,G=F?(P-g.loaded)/F:8*P/C+U;if(!(G<=R)){var N,H=F?8*F:C,j=((n=(i==null?void 0:i.details)||r.hls.latestLevelDetails)==null?void 0:n.live)===!0,et=r.hls.config.abrBandWidthUpFactor,X=Number.POSITIVE_INFINITY;for(N=E-1;N>y;N--){var ht=x[N].maxBitrate,rt=!x[N].details||j;if((X=r.getTimeToLoadFrag(U,H,v*ht,rt))<Math.min(R,v+U))break}if(!(X>=G||X>10*v)){_?r.bwEstimator.sample(m-Math.min(A,k),g.loaded):r.bwEstimator.sampleTTFB(m);var q=x[N].maxBitrate;r.getBwEstimate()*et>q&&r.resetEstimator(q);var Et=r.findBestLevel(q,y,N,0,R,1,1);Et>-1&&(N=Et),r.warn("Fragment "+l.sn+(u?" part "+u.index:"")+" of level "+E+` is loading too slowly;
      Fragment duration: `+l.duration.toFixed(3)+`
      Time to underbuffer: `+R.toFixed(3)+` s
      Estimated load time for current fragment: `+G.toFixed(3)+` s
      Estimated load time for down switch fragment: `+X.toFixed(3)+` s
      TTFB estimate: `+(0|k)+` ms
      Current BW estimate: `+(B(C)?0|C:"Unknown")+` bps
      New BW estimate: `+(0|r.getBwEstimate())+` bps
      Switching to level `+N+" @ "+(0|q)+" bps"),d.nextLoadLevel=d.nextAutoLevel=N,r.clearTimer();var nt=function(){if(r.clearTimer(),r.fragCurrent===l&&r.hls.loadLevel===N&&N>0){var $=r.getStarvationDelay();if(r.warn("Aborting inflight request "+(N>0?"and switching down":"")+`
      Fragment duration: `+l.duration.toFixed(3)+` s
      Time to underbuffer: `+$.toFixed(3)+" s"),l.abortRequests(),r.fragCurrent=r.partCurrent=null,N>y){var Y=r.findBestLevel(r.hls.levels[y].bitrate,y,N,0,$,1,1);Y===-1&&(Y=y),r.hls.nextLoadLevel=r.hls.nextAutoLevel=Y,r.resetEstimator(r.hls.levels[Y].bitrate)}}};S||G>2*X?nt():r.timer=self.setInterval(nt,1e3*X),d.trigger(p.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:u,stats:g})}}}}}}}},r.hls=t,r.bwEstimator=r.initEstimator(),r.registerListeners(),r}ut(a,s);var e=a.prototype;return e.resetEstimator=function(t){t&&(this.log("setting initial bwe to "+t),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},e.initEstimator=function(){var t=this.hls.config;return new co(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)},e.registerListeners=function(){var t=this.hls;t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.FRAG_LOADING,this.onFragLoading,this),t.on(p.FRAG_LOADED,this.onFragLoaded,this),t.on(p.FRAG_BUFFERED,this.onFragBuffered,this),t.on(p.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(p.LEVEL_LOADED,this.onLevelLoaded,this),t.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(p.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(p.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.FRAG_LOADING,this.onFragLoading,this),t.off(p.FRAG_LOADED,this.onFragLoaded,this),t.off(p.FRAG_BUFFERED,this.onFragBuffered,this),t.off(p.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(p.LEVEL_LOADED,this.onLevelLoaded,this),t.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(p.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(p.ERROR,this.onError,this))},e.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},e.onManifestLoading=function(t,r){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},e.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},e.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},e.onFragLoading=function(t,r){var i,n=r.frag;this.ignoreFragment(n)||(n.bitrateTest||(this.fragCurrent=n,this.partCurrent=(i=r.part)!=null?i:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))},e.onLevelSwitching=function(t,r){this.clearTimer()},e.onError=function(t,r){if(!r.fatal)switch(r.details){case D.BUFFER_ADD_CODEC_ERROR:case D.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case D.FRAG_LOAD_TIMEOUT:var i=r.frag,n=this.fragCurrent,o=this.partCurrent;if(i&&n&&i.sn===n.sn&&i.level===n.level){var l=performance.now(),u=o?o.stats:i.stats,d=l-u.loading.start,h=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&h>-1){var c=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(c,h),u.loaded)}else this.bwEstimator.sampleTTFB(d)}}},e.getTimeToLoadFrag=function(t,r,i,n){return t+i/r+(n?t+this.lastLevelLoadSec:0)},e.onLevelLoaded=function(t,r){var i=this.hls.config,n=r.stats.loading,o=n.end-n.first;B(o)&&(this.lastLevelLoadSec=o/1e3),r.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(r.levelInfo)},e.onFragLoaded=function(t,r){var i=r.frag,n=r.part,o=n?n.stats:i.stats;if(i.type===J&&this.bwEstimator.sampleTTFB(o.loading.first-o.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),i.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var l=n?n.duration:i.duration,u=this.hls.levels[i.level],d=(u.loaded?u.loaded.bytes:0)+o.loaded,h=(u.loaded?u.loaded.duration:0)+l;u.loaded={bytes:d,duration:h},u.realBitrate=Math.round(8*d/h)}if(i.bitrateTest){var c={stats:o,frag:i,part:n,id:i.type};this.onFragBuffered(p.FRAG_BUFFERED,c),i.bitrateTest=!1}else this.lastLoadedFragLevel=i.level}},e.onFragBuffered=function(t,r){var i=r.frag,n=r.part,o=n!=null&&n.stats.loaded?n.stats:i.stats;if(!o.aborted&&!this.ignoreFragment(i)){var l=o.parsing.end-o.loading.start-Math.min(o.loading.first-o.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,o.loaded),o.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},e.ignoreFragment=function(t){return t.type!==J||t.sn==="initSegment"},e.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},e.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},e.getNextABRAutoLevel=function(){var t=this.fragCurrent,r=this.partCurrent,i=this.hls;if(i.levels.length<=1)return i.loadLevel;var n=i.maxAutoLevel,o=i.config,l=i.minAutoLevel,u=r?r.duration:t?t.duration:0,d=this.getBwEstimate(),h=this.getStarvationDelay(),c=o.abrBandWidthFactor,f=o.abrBandWidthUpFactor;if(h){var g=this.findBestLevel(d,l,n,h,0,c,f);if(g>=0)return this.rebufferNotice=-1,g}var v=u?Math.min(u,o.maxStarvationDelay):o.maxStarvationDelay;if(!h){var m=this.bitrateTestDelay;m&&(v=(u?Math.min(u,o.maxLoadingDelay):o.maxLoadingDelay)-m,this.info("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),c=f=1)}var y=this.findBestLevel(d,l,n,h,v,c,f);if(this.rebufferNotice!==y&&(this.rebufferNotice=y,this.info((h?"rebuffering expected":"buffer is empty")+", optimal quality level "+y)),y>-1)return y;var E=i.levels[l],T=i.loadLevelObj;return T&&(E==null?void 0:E.bitrate)<T.bitrate?l:i.loadLevel},e.getStarvationDelay=function(){var t=this.hls,r=t.media;if(!r)return 1/0;var i=r&&r.playbackRate!==0?Math.abs(r.playbackRate):1,n=t.mainForwardBufferInfo;return(n?n.len:0)/i},e.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},e.findBestLevel=function(t,r,i,n,o,l,u){var d,h=this,c=n+o,f=this.lastLoadedFragLevel,g=f===-1?this.hls.firstLevel:f,v=this.fragCurrent,m=this.partCurrent,y=this.hls,E=y.levels,T=y.allAudioTracks,S=y.loadLevel,I=y.config;if(E.length===1)return 0;var L,A=E[g],b=!((d=this.hls.latestLevelDetails)==null||!d.live),R=S===-1||f===-1,k="SDR",_=(A==null?void 0:A.frameRate)||0,C=I.audioPreference,x=I.videoPreference,w=this.audioTracksByGroup||(this.audioTracksByGroup=Xn(T)),P=-1;if(R){if(this.firstSelection!==-1)return this.firstSelection;var M=this.codecTiers||(this.codecTiers=function($,Y,lt,St){return $.slice(lt,St+1).reduce(function(yt,Q,vt){if(!Q.codecSet)return yt;var At=Q.audioGroups,z=yt[Q.codecSet];z||(yt[Q.codecSet]=z={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:vt,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!At,fragmentError:0}),z.minBitrate=Math.min(z.minBitrate,Q.bitrate);var _t=Math.min(Q.height,Q.width);return z.minHeight=Math.min(z.minHeight,_t),z.minFramerate=Math.min(z.minFramerate,Q.frameRate),z.minIndex=Math.min(z.minIndex,vt),z.maxScore=Math.max(z.maxScore,Q.score),z.fragmentError+=Q.fragmentError,z.videoRanges[Q.videoRange]=(z.videoRanges[Q.videoRange]||0)+1,At&&At.forEach(function(it){if(it){var mt=Y.groups[it];mt&&(z.hasDefaultAudio=z.hasDefaultAudio||Y.hasDefaultAudio?mt.hasDefault:mt.hasAutoSelect||!Y.hasDefaultAudio&&!Y.hasAutoSelectAudio,Object.keys(mt.channels).forEach(function(ft){z.channels[ft]=(z.channels[ft]||0)+mt.channels[ft]}))}}),yt},{})}(E,w,r,i)),F=function($,Y,lt,St,yt){for(var Q=Object.keys($),vt=St==null?void 0:St.channels,At=St==null?void 0:St.audioCodec,z=yt==null?void 0:yt.videoCodec,_t=vt&&parseInt(vt)===2,it=!1,mt=!1,ft=1/0,bt=1/0,It=1/0,Pt=1/0,Ct=0,Ut=[],jt=bo(Y,yt),ge=jt.preferHDR,Bt=jt.allowedVideoRanges,Ot=function(){var ct=$[Q[Rt]];it||(it=ct.channels[2]>0),ft=Math.min(ft,ct.minHeight),bt=Math.min(bt,ct.minFramerate),It=Math.min(It,ct.minBitrate),Bt.filter(function(Tt){return ct.videoRanges[Tt]>0}).length>0&&(mt=!0)},Rt=Q.length;Rt--;)Ot();ft=B(ft)?ft:0,bt=B(bt)?bt:0;var qt=Math.max(1080,ft),Xt=Math.max(30,bt);It=B(It)?It:lt,lt=Math.max(It,lt),mt||(Y=void 0);var He=Q.length>1;return{codecSet:Q.reduce(function(ct,Tt){var gt=$[Tt];if(Tt===ct)return ct;if(Ut=mt?Bt.filter(function(ae){return gt.videoRanges[ae]>0}):[],He){if(gt.minBitrate>lt)return te(Tt,"min bitrate of "+gt.minBitrate+" > current estimate of "+lt),ct;if(!gt.hasDefaultAudio)return te(Tt,"no renditions with default or auto-select sound found"),ct;if(At&&Tt.indexOf(At.substring(0,4))%5!=0)return te(Tt,'audio codec preference "'+At+'" not found'),ct;if(vt&&!_t){if(!gt.channels[vt])return te(Tt,"no renditions with "+vt+" channel sound found (channels options: "+Object.keys(gt.channels)+")"),ct}else if((!At||_t)&&it&&gt.channels[2]===0)return te(Tt,"no renditions with stereo sound found"),ct;if(gt.minHeight>qt)return te(Tt,"min resolution of "+gt.minHeight+" > maximum of "+qt),ct;if(gt.minFramerate>Xt)return te(Tt,"min framerate of "+gt.minFramerate+" > maximum of "+Xt),ct;if(!Ut.some(function(ae){return gt.videoRanges[ae]>0}))return te(Tt,"no variants with VIDEO-RANGE of "+pt(Ut)+" found"),ct;if(z&&Tt.indexOf(z.substring(0,4))%5!=0)return te(Tt,'video codec preference "'+z+'" not found'),ct;if(gt.maxScore<Ct)return te(Tt,"max score of "+gt.maxScore+" < selected max of "+Ct),ct}return ct&&(cr(Tt)>=cr(ct)||gt.fragmentError>$[ct].fragmentError)?ct:(Pt=gt.minIndex,Ct=gt.maxScore,Tt)},void 0),videoRanges:Ut,preferHDR:ge,minFramerate:bt,minBitrate:It,minIndex:Pt}}(M,k,t,C,x),U=F.codecSet,G=F.videoRanges,N=F.minFramerate,H=F.minBitrate,j=F.minIndex,et=F.preferHDR;P=j,L=U,k=et?G[G.length-1]:G[0],_=N,t=Math.max(t,H),this.log("picked start tier "+pt(F))}else L=A==null?void 0:A.codecSet,k=A==null?void 0:A.videoRange;for(var X,ht=m?m.duration:v?v.duration:0,rt=this.bwEstimator.getEstimateTTFB()/1e3,q=[],Et=function(){var $,Y=E[nt],lt=nt>g;if(!Y)return 0;if(I.useMediaCapabilities&&!Y.supportedResult&&!Y.supportedPromise){var St=navigator.mediaCapabilities;typeof(St==null?void 0:St.decodingInfo)=="function"&&(function(it,mt,ft,bt,It,Pt){var Ct=it.audioCodec?it.audioGroups:null,Ut=Pt==null?void 0:Pt.audioCodec,jt=Pt==null?void 0:Pt.channels,ge=jt?parseInt(jt):Ut?1/0:2,Bt=null;if(Ct!=null&&Ct.length)try{Bt=Ct.length===1&&Ct[0]?mt.groups[Ct[0]].channels:Ct.reduce(function(Ot,Rt){if(Rt){var qt=mt.groups[Rt];if(!qt)throw new Error("Audio track group "+Rt+" not found");Object.keys(qt.channels).forEach(function(Xt){Ot[Xt]=(Ot[Xt]||0)+qt.channels[Xt]})}return Ot},{2:0})}catch{return!0}return it.videoCodec!==void 0&&(it.width>1920&&it.height>1088||it.height>1920&&it.width>1088||it.frameRate>Math.max(bt,30)||it.videoRange!=="SDR"&&it.videoRange!==ft||it.bitrate>Math.max(It,8e6))||!!Bt&&B(ge)&&Object.keys(Bt).some(function(Ot){return parseInt(Ot)>ge})}(Y,w,k,_,t,C)||fr(Y.videoCodec))?(Y.supportedPromise=Vn(Y,w,St),Y.supportedPromise.then(function(it){if(h.hls){Y.supportedResult=it;var mt=h.hls.levels,ft=mt.indexOf(Y);it.error?h.warn('MediaCapabilities decodingInfo error: "'+it.error+'" for level '+ft+" "+pt(it)):it.supported||(h.warn("Unsupported MediaCapabilities decodingInfo result for level "+ft+" "+pt(it)),ft>-1&&mt.length>1&&(h.log("Removing unsupported level "+ft),h.hls.removeLevel(ft),h.hls.loadLevel===-1&&(h.hls.nextLoadLevel=0)))}})):Y.supportedResult=Gn}if((L&&Y.codecSet!==L||k&&Y.videoRange!==k||lt&&_>Y.frameRate||!lt&&_>0&&_<Y.frameRate||Y.supportedResult&&(($=Y.supportedResult.decodingInfoResults)==null||!$[0].smooth))&&(!R||nt!==P))return q.push(nt),0;var yt,Q=Y.details,vt=(m?Q==null?void 0:Q.partTarget:Q==null?void 0:Q.averagetargetduration)||ht;yt=lt?u*t:l*t;var At=ht&&n>=2*ht&&o===0?Y.averageBitrate:Y.maxBitrate,z=h.getTimeToLoadFrag(rt,yt,At*vt,Q===void 0);if(yt>=At&&(nt===f||Y.loadError===0&&Y.fragmentError===0)&&(z<=rt||!B(z)||b&&!h.bitrateTestDelay||z<c)){var _t=h.forcedAutoLevel;return nt===S||_t!==-1&&_t===S||(q.length&&h.trace("Skipped level(s) "+q.join(",")+" of "+i+' max with CODECS and VIDEO-RANGE:"'+E[q[0]].codecs+'" '+E[q[0]].videoRange+'; not compatible with "'+L+'" '+k),h.info("switch candidate:"+g+"->"+nt+" adjustedbw("+Math.round(yt)+")-bitrate="+Math.round(yt-At)+" ttfb:"+rt.toFixed(1)+" avgDuration:"+vt.toFixed(1)+" maxFetchDuration:"+c.toFixed(1)+" fetchDuration:"+z.toFixed(1)+" firstSelection:"+R+" codecSet:"+Y.codecSet+" videoRange:"+Y.videoRange+" hls.loadLevel:"+S)),R&&(h.firstSelection=nt),{v:nt}}},nt=i;nt>=r;nt--)if((X=Et())!==0&&X)return X.v;return-1},e.deriveNextAutoLevel=function(t){var r=this.hls,i=r.maxAutoLevel,n=r.minAutoLevel;return Math.min(Math.max(t,n),i)},dt(a,[{key:"firstAutoLevel",get:function(){var t=this.hls,r=t.maxAutoLevel,i=t.minAutoLevel,n=this.getBwEstimate(),o=this.hls.config.maxStarvationDelay,l=this.findBestLevel(n,i,r,0,o,1,1);if(l>-1)return l;var u=this.hls.firstLevel,d=Math.min(Math.max(u,i),r);return this.warn("Could not find best starting auto level. Defaulting to first in playlist "+u+" clamped to "+d),d}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var t=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(!(t===-1||r&&i&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;var n=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){var o=this.hls.levels;if(o.length>Math.max(t,n)&&o[t].loadError<=o[n].loadError)return t}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n},set:function(t){var r=this.deriveNextAutoLevel(t);this._nextAutoLevel!==r&&(this.nextAutoLevelKey="",this._nextAutoLevel=r)}}])}(oe),ni=function(s,a){for(var e=0,t=s.length-1,r=null,i=null;e<=t;){var n=a(i=s[r=(e+t)/2|0]);if(n>0)e=r+1;else{if(!(n<0))return i;t=r-1}}return null};function Re(s,a,e,t,r){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=.005);var i=null;if(s){i=a[1+s.sn-a[0].sn]||null;var n=s.endDTS-e;n>0&&n<15e-7&&(e+=15e-7),i&&s.level!==i.level&&i.end<=s.end&&(i=a[2+s.sn-a[0].sn]||null)}else e===0&&a[0].start===0&&(i=a[0]);if(i&&((!s||s.level===i.level)&&$n(e,t,i)===0||function(l,u,d){if(u&&u.start===0&&u.level<l.level&&(u.endPTS||0)>0){var h=u.tagList.reduce(function(c,f){return f[0]==="INF"&&(c+=parseFloat(f[1])),c},d);return l.start<=h}return!1}(i,s,Math.min(r,t))))return i;var o=ni(a,$n.bind(null,e,t));return!o||o===s&&i?i:o}function $n(s,a,e){if(s===void 0&&(s=0),a===void 0&&(a=0),e.start<=s&&e.start+e.duration>s)return 0;var t=Math.min(a,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=s?1:e.start-t>s&&e.start?-1:0}function _o(s,a,e){var t=1e3*Math.min(a,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>s}function Jn(s,a){return ni(s,function(e){return e.cc<a?1:e.cc>a?-1:0})}function yr(s){switch(s.details){case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_TIMEOUT:case D.LEVEL_LOAD_TIMEOUT:case D.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Zn(s,a){var e=yr(a);return s.default[(e?"timeout":"error")+"Retry"]}function ai(s,a){var e=s.backoff==="linear"?1:Math.pow(2,a);return Math.min(e*s.retryDelayMs,s.maxRetryDelayMs)}function ta(s){return at(at({},s),{errorRetry:null,timeoutRetry:null})}function Er(s,a,e,t){if(!s)return!1;var r=t==null?void 0:t.code,i=a<s.maxNumRetry&&(function(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}(r)||!!e);return s.shouldRetry?s.shouldRetry(s,a,e,t,i):i}var ea=0,le=2,Po=3,Tr=5,Xe=0,Sr=1,ra=2,Co=function(s){function a(t){var r;return(r=s.call(this,"error-controller",t.logger)||this).hls=void 0,r.playlistError=0,r.penalizedRenditions={},r.hls=t,r.registerListeners(),r}ut(a,s);var e=a.prototype;return e.registerListeners=function(){var t=this.hls;t.on(p.ERROR,this.onError,this),t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.LEVEL_UPDATED,this.onLevelUpdated,this)},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(p.ERROR,this.onError,this),t.off(p.ERROR,this.onErrorOut,this),t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.LEVEL_UPDATED,this.onLevelUpdated,this))},e.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},e.startLoad=function(t){},e.stopLoad=function(){this.playlistError=0},e.getVariantLevelIndex=function(t){return(t==null?void 0:t.type)===J?t.level:this.hls.loadLevel},e.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},e.onLevelUpdated=function(){this.playlistError=0},e.onError=function(t,r){var i;if(!r.fatal){var n=this.hls,o=r.context;switch(r.details){case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:return void(r.errorAction=this.getFragRetryOrSwitchAction(r));case D.FRAG_PARSING_ERROR:if((i=r.frag)!=null&&i.gap)return void(r.errorAction=ze());case D.FRAG_GAP:case D.FRAG_DECRYPT_ERROR:return r.errorAction=this.getFragRetryOrSwitchAction(r),void(r.errorAction.action=le);case D.LEVEL_EMPTY_ERROR:case D.LEVEL_PARSING_ERROR:var l,u,d=r.parent===J?r.level:n.loadLevel;return void(r.details===D.LEVEL_EMPTY_ERROR&&(l=r.context)!=null&&(u=l.levelDetails)!=null&&u.live?r.errorAction=this.getPlaylistRetryOrSwitchAction(r,d):(r.levelRetry=!1,r.errorAction=this.getLevelSwitchAction(r,d)));case D.LEVEL_LOAD_ERROR:case D.LEVEL_LOAD_TIMEOUT:return void(typeof(o==null?void 0:o.level)=="number"&&(r.errorAction=this.getPlaylistRetryOrSwitchAction(r,o.level)));case D.AUDIO_TRACK_LOAD_ERROR:case D.AUDIO_TRACK_LOAD_TIMEOUT:case D.SUBTITLE_LOAD_ERROR:case D.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){var h=n.loadLevelObj;if(h&&(o.type===zt&&h.hasAudioGroup(o.groupId)||o.type===$t&&h.hasSubtitleGroup(o.groupId)))return r.errorAction=this.getPlaylistRetryOrSwitchAction(r,n.loadLevel),r.errorAction.action=le,void(r.errorAction.flags=Sr)}return;case D.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var c=n.loadLevelObj,f=c==null?void 0:c.attrs["HDCP-LEVEL"];return void(f?r.errorAction={action:le,flags:ra,hdcpLevel:f}:this.keySystemError(r));case D.BUFFER_ADD_CODEC_ERROR:case D.REMUX_ALLOC_ERROR:case D.BUFFER_APPEND_ERROR:var g;return void(r.errorAction||(r.errorAction=this.getLevelSwitchAction(r,(g=r.level)!=null?g:n.loadLevel)));case D.INTERNAL_EXCEPTION:case D.BUFFER_APPENDING_ERROR:case D.BUFFER_FULL_ERROR:case D.LEVEL_SWITCH_ERROR:case D.BUFFER_STALLED_ERROR:case D.BUFFER_SEEK_OVER_HOLE:case D.BUFFER_NUDGE_ON_STALL:return void(r.errorAction=ze())}r.type===K.KEY_SYSTEM_ERROR&&this.keySystemError(r)}},e.keySystemError=function(t){var r=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,r)},e.getPlaylistRetryOrSwitchAction=function(t,r){var i=Zn(this.hls.config.playlistLoadPolicy,t),n=this.playlistError++;if(Er(i,n,yr(t),t.response))return{action:Tr,flags:Xe,retryConfig:i,retryCount:n};var o=this.getLevelSwitchAction(t,r);return i&&(o.retryConfig=i,o.retryCount=n),o},e.getFragRetryOrSwitchAction=function(t){var r=this.hls,i=this.getVariantLevelIndex(t.frag),n=r.levels[i],o=r.config,l=o.fragLoadPolicy,u=o.keyLoadPolicy,d=Zn(t.details.startsWith("key")?u:l,t),h=r.levels.reduce(function(f,g){return f+g.fragmentError},0);if(n&&(t.details!==D.FRAG_GAP&&n.fragmentError++,Er(d,h,yr(t),t.response)))return{action:Tr,flags:Xe,retryConfig:d,retryCount:h};var c=this.getLevelSwitchAction(t,i);return d&&(c.retryConfig=d,c.retryCount=h),c},e.getLevelSwitchAction=function(t,r){var i=this.hls;r==null&&(r=i.loadLevel);var n=this.hls.levels[r];if(n){var o,l,u=t.details;n.loadError++,u===D.BUFFER_APPEND_ERROR&&n.fragmentError++;var d=-1,h=i.levels,c=i.loadLevel,f=i.minAutoLevel,g=i.maxAutoLevel;i.autoLevelEnabled||(i.loadLevel=-1);for(var v,m=(o=t.frag)==null?void 0:o.type,y=(m===Mt&&u===D.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(u===D.BUFFER_ADD_CODEC_ERROR||u===D.BUFFER_APPEND_ERROR))&&h.some(function(b){var R=b.audioCodec;return n.audioCodec!==R}),E=t.sourceBufferName==="video"&&(u===D.BUFFER_ADD_CODEC_ERROR||u===D.BUFFER_APPEND_ERROR)&&h.some(function(b){var R=b.codecSet,k=b.audioCodec;return n.codecSet!==R&&n.audioCodec===k}),T=(l=t.context)!=null?l:{},S=T.type,I=T.groupId,L=function(){var b=(A+c)%h.length;if(b!==c&&b>=f&&b<=g&&h[b].loadError===0){var R,k,_=h[b];if(u===D.FRAG_GAP&&m===J&&t.frag){var C=h[b].details;if(C){var x=Re(t.frag,C.fragments,t.frag.start);if(x!=null&&x.gap)return 0}}else if(S===zt&&_.hasAudioGroup(I)||S===$t&&_.hasSubtitleGroup(I)||m===Mt&&(R=n.audioGroups)!=null&&R.some(function(w){return _.hasAudioGroup(w)})||m===Qt&&(k=n.subtitleGroups)!=null&&k.some(function(w){return _.hasSubtitleGroup(w)})||y&&n.audioCodec===_.audioCodec||!y&&n.audioCodec!==_.audioCodec||E&&n.codecSet===_.codecSet)return 0;return d=b,1}},A=h.length;A--&&((v=L())===0||v!==1););if(d>-1&&i.loadLevel!==d)return t.levelRetry=!0,this.playlistError=0,{action:le,flags:Xe,nextAutoLevel:d}}return{action:le,flags:Sr}},e.onErrorOut=function(t,r){var i;switch((i=r.errorAction)==null?void 0:i.action){case ea:break;case le:this.sendAlternateToPenaltyBox(r),r.errorAction.resolved||r.details===D.FRAG_GAP?/MediaSource readyState: ended/.test(r.error.message)&&(this.warn('MediaSource ended after "'+r.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError()):r.fatal=!0}r.fatal&&this.hls.stopLoad()},e.sendAlternateToPenaltyBox=function(t){var r=this.hls,i=t.errorAction;if(i){var n=i.flags,o=i.hdcpLevel,l=i.nextAutoLevel;switch(n){case Xe:this.switchLevel(t,l);break;case ra:o&&(r.maxHdcpLevel=ii[ii.indexOf(o)-1],i.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+r.maxHdcpLevel+'" or lower')}i.resolved||this.switchLevel(t,l)}},e.switchLevel=function(t,r){if(r!==void 0&&t.errorAction&&(this.warn("switching to level "+r+" after "+t.details),this.hls.nextAutoLevel=r,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===D.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&t.sourceBufferName!=="audiovideo"))for(var i=Bn(t.mimeType),n=this.hls.levels,o=n.length;o--;)n[o][t.sourceBufferName+"Codec"]===i&&this.hls.removeLevel(o)},a}(oe);function ze(s){var a={action:ea,flags:Xe};return s&&(a.resolved=!0),a}var Qe="NOT_LOADED",ia="APPENDING",we="PARTIAL",xe="OK",wo=function(){function s(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var a=s.prototype;return a._registerListeners=function(){var e=this.hls;e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.BUFFER_APPENDED,this.onBufferAppended,this),e.on(p.FRAG_BUFFERED,this.onFragBuffered,this),e.on(p.FRAG_LOADED,this.onFragLoaded,this)},a._unregisterListeners=function(){var e=this.hls;e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.BUFFER_APPENDED,this.onBufferAppended,this),e.off(p.FRAG_BUFFERED,this.onFragBuffered,this),e.off(p.FRAG_LOADED,this.onFragLoaded,this)},a.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},a.getAppendedFrag=function(e,t){var r=this.activePartLists[t];if(r)for(var i=r.length;i--;){var n=r[i];if(!n)break;var o=n.end;if(n.start<=e&&o!==null&&e<=o)return n}return this.getBufferedFrag(e,t)},a.getBufferedFrag=function(e,t){return this.getFragAtPos(e,t,!0)},a.getFragAtPos=function(e,t,r){for(var i=this.fragments,n=Object.keys(i),o=n.length;o--;){var l=i[n[o]];if((l==null?void 0:l.body.type)===t&&(!r||l.buffered)){var u=l.body;if(u.start<=e&&e<=u.end)return u}}return null},a.detectEvictedFragments=function(e,t,r,i,n){var o=this;this.timeRanges&&(this.timeRanges[e]=t);var l=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(u){var d=o.fragments[u];if(d&&!(l>=d.body.sn))if(d.buffered||d.loaded&&!n){var h=d.range[e];h&&(h.time.length!==0?h.time.some(function(c){var f=!o.isTimeBuffered(c.startPTS,c.endPTS,t);return f&&o.removeFragment(d.body),f}):o.removeFragment(d.body))}else d.body.type===r&&o.removeFragment(d.body)})},a.detectPartialFragments=function(e){var t=this,r=this.timeRanges;if(r&&e.frag.sn!=="initSegment"){var i=e.frag,n=Oe(i),o=this.fragments[n];if(!(!o||o.buffered&&i.gap)){var l=!i.relurl;Object.keys(r).forEach(function(u){var d=i.elementaryStreams[u];if(d){var h=r[u],c=l||d.partial===!0;o.range[u]=t.getBufferedTimes(i,e.part,c,h)}}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=i.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),Lr(o)||this.removeParts(i.sn-1,i.type)):this.removeFragment(o.body)}}},a.removeParts=function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=na(r,function(i){return i.fragment.sn>=e}))},a.fragBuffered=function(e,t){var r=Oe(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},a.getBufferedTimes=function(e,t,r,i){for(var n={time:[],partial:r},o=e.start,l=e.end,u=e.minEndPTS||l,d=e.maxStartPTS||o,h=0;h<i.length;h++){var c=i.start(h)-this.bufferPadding,f=i.end(h)+this.bufferPadding;if(d>=c&&u<=f){n.time.push({startPTS:Math.max(o,i.start(h)),endPTS:Math.min(l,i.end(h))});break}if(o<f&&l>c){var g=Math.max(o,i.start(h)),v=Math.min(l,i.end(h));v>g&&(n.partial=!0,n.time.push({startPTS:g,endPTS:v}))}else if(l<=c)break}return n},a.getPartialFragment=function(e){var t,r,i,n=null,o=0,l=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(d){var h=u[d];h&&Lr(h)&&(r=h.body.start-l,i=h.body.end+l,e>=r&&e<=i&&(t=Math.min(e-r,i-e),o<=t&&(n=h.body,o=t)))}),n},a.isEndListAppended=function(e){var t=this.endListFragments[e];return t!==void 0&&(t.buffered||Lr(t))},a.getState=function(e){var t=Oe(e),r=this.fragments[t];return r?r.buffered?Lr(r)?we:xe:ia:Qe},a.isTimeBuffered=function(e,t,r){for(var i,n,o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,n=r.end(o)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1},a.onManifestLoading=function(){this.removeAllFragments()},a.onFragLoaded=function(e,t){if(t.frag.sn!=="initSegment"&&!t.frag.bitrateTest){var r=t.frag,i=t.part?null:t,n=Oe(r);this.fragments[n]={body:r,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}},a.onBufferAppended=function(e,t){var r=t.frag,i=t.part,n=t.timeRanges,o=t.type;if(r.sn!=="initSegment"){var l=r.type;if(i){var u=this.activePartLists[l];u||(this.activePartLists[l]=u=[]),u.push(i)}this.timeRanges=n;var d=n[o];this.detectEvictedFragments(o,d,l,i)}},a.onFragBuffered=function(e,t){this.detectPartialFragments(t)},a.hasFragment=function(e){var t=Oe(e);return!!this.fragments[t]},a.hasFragments=function(e){var t=this.fragments,r=Object.keys(t);if(!e)return r.length>0;for(var i=r.length;i--;){var n=t[r[i]];if((n==null?void 0:n.body.type)===e)return!0}return!1},a.hasParts=function(e){var t;return!((t=this.activePartLists[e])==null||!t.length)},a.removeFragmentsInRange=function(e,t,r,i,n){var o=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(l){var u=o.fragments[l];if(u){var d=u.body;d.type!==r||i&&!d.gap||d.start<t&&d.end>e&&(u.buffered||n)&&o.removeFragment(d)}})},a.removeFragment=function(e){var t=Oe(e);e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var i=e.sn;this.activePartLists[e.type]=na(r,function(n){return n.fragment.sn!==i})}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},a.removeAllFragments=function(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;var r=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;r&&r.forEach(function(i){return i.clearElementaryStreamInfo()})},s}();function Lr(s){var a,e,t;return s.buffered&&(s.body.gap||((a=s.range.video)==null?void 0:a.partial)||((e=s.range.audio)==null?void 0:e.partial)||((t=s.range.audiovideo)==null?void 0:t.partial))}function Oe(s){return s.type+"_"+s.level+"_"+s.sn}function na(s,a){return s.filter(function(e){var t=a(e);return t||e.clearElementaryStreamInfo(),t})}var $e=0,si=1,xo=function(){function s(a,e,t){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=a,this.aesIV=e,this.aesMode=t}return s.prototype.decrypt=function(a,e){switch(this.aesMode){case $e:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,a);case si:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,a);default:throw new Error("[AESCrypto] invalid aes mode "+this.aesMode)}},s}(),Oo=function(){function s(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var a=s.prototype;return a.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},a.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],o=r[2],l=r[3],u=this.invSubMix,d=u[0],h=u[1],c=u[2],f=u[3],g=new Uint32Array(256),v=0,m=0,y=0;for(y=0;y<256;y++)g[y]=y<128?y<<1:y<<1^283;for(y=0;y<256;y++){var E=m^m<<1^m<<2^m<<3^m<<4;E=E>>>8^255&E^99,e[v]=E,t[E]=v;var T=g[v],S=g[T],I=g[S],L=257*g[E]^16843008*E;i[v]=L<<24|L>>>8,n[v]=L<<16|L>>>16,o[v]=L<<8|L>>>24,l[v]=L,L=16843009*I^65537*S^257*T^16843008*v,d[E]=L<<24|L>>>8,h[E]=L<<16|L>>>16,c[E]=L<<8|L>>>24,f[E]=L,v?(v=T^g[g[g[I^T]]],m^=g[g[m]]):v=m=1}},a.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);var o,l,u,d,h=this.ksRows=4*(n+6+1),c=this.keySchedule=new Uint32Array(h),f=this.invKeySchedule=new Uint32Array(h),g=this.sBox,v=this.rcon,m=this.invSubMix,y=m[0],E=m[1],T=m[2],S=m[3];for(o=0;o<h;o++)o<n?u=c[o]=t[o]:(d=u,o%n==0?(d=g[(d=d<<8|d>>>24)>>>24]<<24|g[d>>>16&255]<<16|g[d>>>8&255]<<8|g[255&d],d^=v[o/n|0]<<24):n>6&&o%n==4&&(d=g[d>>>24]<<24|g[d>>>16&255]<<16|g[d>>>8&255]<<8|g[255&d]),c[o]=u=(c[o-n]^d)>>>0);for(l=0;l<h;l++)o=h-l,d=3&l?c[o]:c[o-4],f[l]=l<4||o<=4?d:y[g[d>>>24]]^E[g[d>>>16&255]]^T[g[d>>>8&255]]^S[g[255&d]],f[l]=f[l]>>>0}},a.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},a.decrypt=function(e,t,r){for(var i,n,o,l,u,d,h,c,f,g,v,m,y,E,T=this.keySize+6,S=this.invKeySchedule,I=this.invSBox,L=this.invSubMix,A=L[0],b=L[1],R=L[2],k=L[3],_=this.uint8ArrayToUint32Array_(r),C=_[0],x=_[1],w=_[2],P=_[3],M=new Int32Array(e),F=new Int32Array(M.length),U=this.networkToHostOrderSwap;t<M.length;){for(f=U(M[t]),g=U(M[t+1]),v=U(M[t+2]),m=U(M[t+3]),u=f^S[0],d=m^S[1],h=v^S[2],c=g^S[3],y=4,E=1;E<T;E++)i=A[u>>>24]^b[d>>16&255]^R[h>>8&255]^k[255&c]^S[y],n=A[d>>>24]^b[h>>16&255]^R[c>>8&255]^k[255&u]^S[y+1],o=A[h>>>24]^b[c>>16&255]^R[u>>8&255]^k[255&d]^S[y+2],l=A[c>>>24]^b[u>>16&255]^R[d>>8&255]^k[255&h]^S[y+3],u=i,d=n,h=o,c=l,y+=4;i=I[u>>>24]<<24^I[d>>16&255]<<16^I[h>>8&255]<<8^I[255&c]^S[y],n=I[d>>>24]<<24^I[h>>16&255]<<16^I[c>>8&255]<<8^I[255&u]^S[y+1],o=I[h>>>24]<<24^I[c>>16&255]<<16^I[u>>8&255]<<8^I[255&d]^S[y+2],l=I[c>>>24]<<24^I[u>>16&255]<<16^I[d>>8&255]<<8^I[255&h]^S[y+3],F[t]=U(i^C),F[t+1]=U(l^x),F[t+2]=U(o^w),F[t+3]=U(n^P),C=f,x=g,w=v,P=m,t+=4}return F.buffer},s}(),Mo=function(){function s(a,e,t){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=a,this.key=e,this.aesMode=t}return s.prototype.expandKey=function(){var a=function(e){switch(e){case $e:return"AES-CBC";case si:return"AES-CTR";default:throw new Error("[FastAESKey] invalid aes mode "+e)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:a},!1,["encrypt","decrypt"])},s}(),oi=function(){function s(e,t){var r=(t===void 0?{}:t).removePKCS7Padding,i=r===void 0||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var a=s.prototype;return a.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},a.isSync=function(){return this.useSoftware},a.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,i,n,o=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(r=o).byteLength,(n=i&&new DataView(r.buffer).getUint8(i-1))?r.slice(0,i-n):r):o},a.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},a.decrypt=function(e,t,r,i){var n=this;return this.useSoftware?new Promise(function(o,l){var u=ArrayBuffer.isView(e)?e:new Uint8Array(e);n.softwareDecrypt(u,t,r,i);var d=n.flush();d?o(d.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,i)},a.softwareDecrypt=function(e,t,r,i){var n=this.currentIV,o=this.currentResult,l=this.remainderData;if(i!==$e||t.byteLength!==16)return Z.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(e=Vt(l,e),this.remainderData=null);var u=this.getValidChunk(e);if(!u.length)return null;n&&(r=n);var d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new Oo),d.expandKey(t);var h=o;return this.currentResult=d.decrypt(u.buffer,0,r),this.currentIV=u.slice(-16).buffer,h||null},a.webCryptoDecrypt=function(e,t,r,i){var n=this;if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,i));this.key=t,this.fastAesKey=new Mo(this.subtle,t,i)}return this.fastAesKey.expandKey().then(function(o){return n.subtle?(n.logOnce("WebCrypto AES decrypt"),new xo(n.subtle,new Uint8Array(r),i).decrypt(e.buffer,o)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(o){return Z.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+o.name+": "+o.message),n.onWebCryptoError(e,t,r,i)})},a.onWebCryptoError=function(e,t,r,i){var n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,i);var o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")},a.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t},a.logOnce=function(e){this.logEnabled&&(Z.log("[decrypter]: "+e),this.logEnabled=!1)},s}(),aa=Math.pow(2,17),Fo=function(){function s(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var a=s.prototype;return a.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},a.abort=function(){this.loader&&this.loader.abort()},a.load=function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new ue({type:K.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var n=this.config,o=n.fLoader,l=n.loader;return new Promise(function(u,d){if(r.loader&&r.loader.destroy(),e.gap){if(e.tagList.some(function(m){return m[0]==="GAP"}))return void d(oa(e));e.gap=!1}var h=r.loader=o?new o(n):new l(n),c=sa(e);e.loader=h;var f=ta(n.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:aa};e.stats=h.stats;var v={onSuccess:function(m,y,E,T){r.resetLoader(e,h);var S=m.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(S.slice(0,16)),S=S.slice(16)),u({frag:e,part:null,payload:S,networkDetails:T})},onError:function(m,y,E,T){r.resetLoader(e,h),d(new ue({type:K.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:at({url:i,data:void 0},m),error:new Error("HTTP Error "+m.code+" "+m.text),networkDetails:E,stats:T}))},onAbort:function(m,y,E){r.resetLoader(e,h),d(new ue({type:K.NETWORK_ERROR,details:D.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:m}))},onTimeout:function(m,y,E){r.resetLoader(e,h),d(new ue({type:K.NETWORK_ERROR,details:D.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:E,stats:m}))}};t&&(v.onProgress=function(m,y,E,T){return t({frag:e,part:null,payload:E,networkDetails:T})}),h.load(c,g,v)})},a.loadPart=function(e,t,r){var i=this;this.abort();var n=this.config,o=n.fLoader,l=n.loader;return new Promise(function(u,d){if(i.loader&&i.loader.destroy(),e.gap||t.gap)d(oa(e,t));else{var h=i.loader=o?new o(n):new l(n),c=sa(e,t);e.loader=h;var f=ta(n.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:aa};t.stats=h.stats,h.load(c,g,{onSuccess:function(v,m,y,E){i.resetLoader(e,h),i.updateStatsFromPart(e,t);var T={frag:e,part:t,payload:v.data,networkDetails:E};r(T),u(T)},onError:function(v,m,y,E){i.resetLoader(e,h),d(new ue({type:K.NETWORK_ERROR,details:D.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:at({url:c.url,data:void 0},v),error:new Error("HTTP Error "+v.code+" "+v.text),networkDetails:y,stats:E}))},onAbort:function(v,m,y){e.stats.aborted=t.stats.aborted,i.resetLoader(e,h),d(new ue({type:K.NETWORK_ERROR,details:D.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:y,stats:v}))},onTimeout:function(v,m,y){i.resetLoader(e,h),d(new ue({type:K.NETWORK_ERROR,details:D.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:y,stats:v}))}})}})},a.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){var o=Math.round(e.duration/t.duration),l=Math.min(Math.round(r.loaded/n),o),u=(o-l)*Math.round(r.loaded/l);r.total=r.loaded+u}else r.total=Math.max(r.loaded,r.total);var d=r.loading,h=i.loading;d.start?d.first+=h.first-h.start:(d.start=h.start,d.first=h.first),d.end=h.end},a.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},s}();function sa(s,a){a===void 0&&(a=null);var e,t=a||s,r={frag:s,part:a,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(B(i)&&B(n)){var o,l=i,u=n;if(s.sn==="initSegment"&&((e=(o=s.decryptdata)==null?void 0:o.method)==="AES-128"||e==="AES-256")){var d=n-i;d%16&&(u=n+(16-d%16)),i!==0&&(r.resetIV=!0,l=i-16)}r.rangeStart=l,r.rangeEnd=u}return r}function oa(s,a){var e=new Error("GAP "+(s.gap?"tag":"attribute")+" found"),t={type:K.MEDIA_ERROR,details:D.FRAG_GAP,fatal:!1,frag:s,error:e,networkDetails:null};return a&&(t.part=a),(a||s).stats.aborted=!0,new ue(t)}var ue=function(s){function a(e){var t;return(t=s.call(this,e.error.message)||this).data=void 0,t.data=e,t}return ut(a,s),a}(_e(Error)),la=function(s){function a(t,r){var i;return(i=s.call(this,t,r)||this)._boundTick=void 0,i._tickTimer=null,i._tickInterval=null,i._tickCallCount=0,i._boundTick=i.tick.bind(i),i}ut(a,s);var e=a.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},a}(oe),li=function(s,a,e,t,r,i){t===void 0&&(t=0),r===void 0&&(r=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=s,this.sn=a,this.id=e,this.size=t,this.part=r,this.partial=i},ua={length:0,start:function(){return 0},end:function(){return 0}},tt=function(){function s(){}return s.isBuffered=function(a,e){if(a){for(var t=s.getBuffered(a),r=t.length;r--;)if(e>=t.start(r)&&e<=t.end(r))return!0}return!1},s.bufferedRanges=function(a){if(a){var e=s.getBuffered(a);return s.timeRangesToArray(e)}return[]},s.timeRangesToArray=function(a){for(var e=[],t=0;t<a.length;t++)e.push({start:a.start(t),end:a.end(t)});return e},s.bufferInfo=function(a,e,t){if(a){var r=s.bufferedRanges(a);if(r.length)return s.bufferedInfo(r,e,t)}return{len:0,start:e,end:e,bufferedIndex:-1}},s.bufferedInfo=function(a,e,t){e=Math.max(0,e),a.length>1&&a.sort(function(m,y){return m.start-y.start||y.end-m.end});var r=-1,i=[];if(t)for(var n=0;n<a.length;n++){e>=a[n].start&&e<=a[n].end&&(r=n);var o=i.length;if(o){var l=i[o-1].end;a[n].start-l<t?a[n].end>l&&(i[o-1].end=a[n].end):i.push(a[n])}else i.push(a[n])}else i=a;for(var u,d=0,h=e,c=e,f=0;f<i.length;f++){var g=i[f].start,v=i[f].end;if(r===-1&&e>=g&&e<=v&&(r=f),e+t>=g&&e<v)h=g,d=(c=v)-e;else if(e+t<g){u=g;break}}return{len:d,start:h||0,end:c||0,nextStart:u,buffered:a,bufferedIndex:r}},s.getBuffered=function(a){try{return a.buffered||ua}catch(e){return Z.log("failed to get media.buffered",e),ua}},s}(),da=/\{\$([a-zA-Z0-9-_]+)\}/g;function ha(s){return da.test(s)}function ui(s,a){if(s.variableList!==null||s.hasVariableRefs){var e=s.variableList;return a.replace(da,function(t){var r=t.substring(2,t.length-1),i=e==null?void 0:e[r];return i===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+r+'"')),t):i})}return a}function fa(s,a,e){var t,r,i=s.variableList;if(i||(s.variableList=i={}),"QUERYPARAM"in a){t=a.QUERYPARAM;try{var n=new self.URL(e).searchParams;if(!n.has(t))throw new Error('"'+t+'" does not match any query parameter in URI: "'+e+'"');r=n.get(t)}catch(o){s.playlistParsingError||(s.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+o.message))}}else t=a.NAME,r=a.VALUE;t in i?s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+t+'"')):i[t]=r||""}function No(s,a,e){var t=a.IMPORT;if(e&&t in e){var r=s.variableList;r||(s.variableList=r={}),r[t]=e[t]}else s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+t+'"'))}var Uo=/^(\d+)x(\d+)$/,ca=/(.+?)=(".*?"|.*?)(?:,|$)/g,Lt=function(){function s(e,t){typeof e=="string"&&(e=s.parseAttrList(e,t)),ot(this,e)}var a=s.prototype;return a.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},a.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},a.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},a.decimalFloatingPoint=function(e){return parseFloat(this[e])},a.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},a.enumeratedString=function(e){return this[e]},a.enumeratedStringList=function(e,t){var r=this[e];return(r?r.split(/[ ,]+/):[]).reduce(function(i,n){return i[n.toLowerCase()]=!0,i},t)},a.bool=function(e){return this[e]==="YES"},a.decimalResolution=function(e){var t=Uo.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},s.parseAttrList=function(e,t){var r,i={};for(ca.lastIndex=0;(r=ca.exec(e))!==null;){var n=r[1].trim(),o=r[2],l=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1,u=!1;if(l)o=o.slice(1,-1);else switch(n){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=ui(t,o);else if(!u&&!l)switch(n){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Z.warn(e+": attribute "+n+" is missing quotes")}i[n]=o}return i},dt(s,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(e){return e.substring(0,2)==="X-"})}}])}();function Bo(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"||s==="SCTE35-CMD"}var ga=function(){return dt(function(s,a,e){var t;if(e===void 0&&(e=0),this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(a==null?void 0:a.tagAnchor)||null,this.tagOrder=(t=a==null?void 0:a.tagOrder)!=null?t:e,a){var r=a.attr;for(var i in r)if(Object.prototype.hasOwnProperty.call(s,i)&&s[i]!==r[i]){Z.warn('DATERANGE tag attribute: "'+i+'" does not match for tags with ID: "'+s.ID+'"'),this._badValueForSameId=i;break}s=ot(new Lt({}),r,s)}if(this.attr=s,a?(this._startDate=a._startDate,this._cue=a._cue,this._endDate=a._endDate,this._dateAtEnd=a._dateAtEnd):this._startDate=new Date(s["START-DATE"]),"END-DATE"in this.attr){var n=(a==null?void 0:a.endDate)||new Date(this.attr["END-DATE"]);B(n.getTime())&&(this._endDate=n)}},[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"cue",get:function(){var s=this._cue;return s===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):s}},{key:"startTime",get:function(){var s=this.tagAnchor;return s===null||s.programDateTime===null?(Z.warn('Expected tagAnchor Fragment with PDT set for DateRange "'+this.id+'": '+s),NaN):s.start+(this.startDate.getTime()-s.programDateTime)/1e3}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){var s=this._endDate||this._dateAtEnd;if(s)return s;var a=this.duration;return a!==null?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*a):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var s=this.attr.decimalFloatingPoint("DURATION");if(B(s))return s}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isInterstitial",get:function(){return this.class==="com.apple.hls.interstitial"}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&B(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}])}(),Go=function(){function s(a){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=a}return s.prototype.reloaded=function(a){if(!a)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-a.lastPartSn,t=this.lastPartIndex-a.lastPartIndex;this.updated=this.endSN!==a.endSN||!!t||!!e||!this.live,this.advanced=this.endSN>a.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(.6*a.misses):this.misses=a.misses+1},dt(s,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&B(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var a=this.driftEndTime-this.driftStartTime;return a>0?1e3*(this.driftEnd-this.driftStart)/a:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var a;return(a=this.fragments)!=null&&a.length?this.fragments[this.fragments.length-1].end:0}},{key:"fragmentStart",get:function(){var a;return(a=this.fragments)!=null&&a.length?this.fragments[0].start:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].index:-1}},{key:"maxPartIndex",get:function(){var a=this.partList;if(a){var e=this.lastPartIndex;if(e!==-1){for(var t=a.length;t--;)if(a[t].index>e)return a[t].index;return e}}return 0}},{key:"lastPartSn",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}},{key:"expired",get:function(){if(this.live&&this.age&&this.misses<3){var a=this.partEnd-this.fragmentStart;return this.age>Math.max(a,this.totalduration)+this.levelTargetDuration}return!1}}])}();function Me(s){return s==="AES-128"||s==="AES-256"||s==="AES-256-CTR"}function di(s){switch(s){case"AES-128":case"AES-256":return $e;case"AES-256-CTR":return si;default:throw new Error("invalid full segment method "+s)}}function hi(s){return Uint8Array.from(atob(s),function(a){return a.charCodeAt(0)})}function fi(s){return Uint8Array.from(unescape(encodeURIComponent(s)),function(a){return a.charCodeAt(0)})}function Ko(s){var a,e,t=s.split(":"),r=null;if(t[0]==="data"&&t.length===2){var i=t[1].split(";"),n=i[i.length-1].split(",");if(n.length===2){var o=n[0]==="base64",l=n[1];o?(i.splice(-1,1),r=hi(l)):(a=fi(l).subarray(0,16),(e=new Uint8Array(16)).set(a,16-a.length),r=e)}}return r}var Ar=typeof self<"u"?self:void 0,st={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ci="org.w3.clearkey",gi="com.apple.streamingkeydelivery",Rr="com.microsoft.playready",Ir="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function vi(s){switch(s){case gi:return st.FAIRPLAY;case Rr:return st.PLAYREADY;case Ir:return st.WIDEVINE;case ci:return st.CLEARKEY}}var Ho="1077efecc0b24d02ace33c1e52e2fb4b",Vo="e2719d58a985b3c9781ab030af78d30e",Yo="9a04f07998404286ab92e65be0885f95",Wo="edef8ba979d64acea3c827dcd51d21ed";function mi(s){return s===Wo?st.WIDEVINE:s===Yo?st.PLAYREADY:s===Ho||s===Vo?st.CLEARKEY:void 0}function pi(s){switch(s){case st.FAIRPLAY:return gi;case st.PLAYREADY:return Rr;case st.WIDEVINE:return Ir;case st.CLEARKEY:return ci}}function kr(s){var a=s.drmSystems,e=s.widevineLicenseUrl,t=a?[st.FAIRPLAY,st.WIDEVINE,st.PLAYREADY,st.CLEARKEY].filter(function(r){return!!a[r]}):[];return!t[st.WIDEVINE]&&e&&t.push(st.WIDEVINE),t}var va,ma=Ar!=null&&(va=Ar.navigator)!=null&&va.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function pa(s){var a=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),e=String.fromCharCode.apply(null,Array.from(a)),t=e.substring(e.indexOf("<"),e.length),r=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("KID")[0];if(r){var i=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(i){var n=hi(i).subarray(0,16);return function(o){var l=function(u,d,h){var c=u[d];u[d]=u[h],u[h]=c};l(o,0,3),l(o,1,2),l(o,4,5),l(o,6,7)}(n),n}}return null}var br={},yi=function(){function s(e,t,r,i,n){i===void 0&&(i=[1]),n===void 0&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!e&&e!=="NONE",this.isCommonEncryption=this.encrypted&&!Me(e)}s.clearKeyUriToKeyIdMap=function(){br={}};var a=s.prototype;return a.isSupported=function(){if(this.method){if(Me(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case gi:case Ir:case Rr:case ci:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},a.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(Me(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Z.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var t=function(d){for(var h=new Uint8Array(16),c=12;c<16;c++)h[c]=d>>8*(15-c)&255;return h}(e);return new s(this.method,this.uri,"identity",this.keyFormatVersions,t)}var r=Ko(this.uri);if(r)switch(this.keyFormat){case Ir:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case Rr:var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=So(i,0,r),this.keyId=pa(r);break;default:var n=r.subarray(0,16);if(n.length!==16){var o=new Uint8Array(16);o.set(n,16-n.length),n=o}this.keyId=n}if(!this.keyId||this.keyId.byteLength!==16){var l=br[this.uri];if(!l){var u=Object.keys(br).length%Number.MAX_SAFE_INTEGER;l=new Uint8Array(16),new DataView(l.buffer,12,4).setUint32(0,u),br[this.uri]=l}this.keyId=l}return this},s}(),ya=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Ea=/#EXT-X-MEDIA:(.*)/g,jo=/^#EXT(?:INF|-X-TARGETDURATION):/m,Ei=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),qo=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Je=function(){function s(){}return s.findGroup=function(a,e){for(var t=0;t<a.length;t++){var r=a[t];if(r.id===e)return r}},s.resolve=function(a,e){return jr.buildAbsoluteURL(e,a,{alwaysNormalize:!0})},s.isMediaPlaylist=function(a){return jo.test(a)},s.parseMasterPlaylist=function(a,e){var t,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:ha(a)},i=[];for(ya.lastIndex=0;(t=ya.exec(a))!=null;)if(t[1]){var n,o=new Lt(t[1],r),l=ui(r,t[2]),u={attrs:o,bitrate:o.decimalInteger("BANDWIDTH")||o.decimalInteger("AVERAGE-BANDWIDTH"),name:o.NAME,url:s.resolve(l,e)},d=o.decimalResolution("RESOLUTION");d&&(u.width=d.width,u.height=d.height),Aa(o.CODECS,u);var h=o["SUPPLEMENTAL-CODECS"];h&&(u.supplemental={},Aa(h,u.supplemental)),(n=u.unknownCodecs)!=null&&n.length||i.push(u),r.levels.push(u)}else if(t[3]){var c=t[3],f=t[4];switch(c){case"SESSION-DATA":var g=new Lt(f,r),v=g["DATA-ID"];v&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[v]=g);break;case"SESSION-KEY":var m=Sa(f,e,r);m.encrypted&&m.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(m)):Z.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+f+'"');break;case"DEFINE":fa(r,new Lt(f,r),e);break;case"CONTENT-STEERING":var y=new Lt(f,r);r.contentSteering={uri:s.resolve(y["SERVER-URI"],e),pathwayId:y["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=La(f)}}var E=i.length>0&&i.length<r.levels.length;return r.levels=E?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},s.parseMasterPlaylistMedia=function(a,e,t){var r,i={},n=t.levels,o={AUDIO:n.map(function(S){return{id:S.attrs.AUDIO,audioCodec:S.audioCodec}}),SUBTITLES:n.map(function(S){return{id:S.attrs.SUBTITLES,textCodec:S.textCodec}}),"CLOSED-CAPTIONS":[]},l=0;for(Ea.lastIndex=0;(r=Ea.exec(a))!==null;){var u=new Lt(r[1],t),d=u.TYPE;if(d){var h=o[d],c=i[d]||[];i[d]=c;var f=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],v=u.CHANNELS,m=u.CHARACTERISTICS,y=u["INSTREAM-ID"],E={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||f||"",type:d,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:f,url:u.URI?s.resolve(u.URI,e):""};if(g&&(E.assocLang=g),v&&(E.channels=v),m&&(E.characteristics=m),y&&(E.instreamId=y),h!=null&&h.length){var T=s.findGroup(h,E.groupId)||h[0];Ra(E,T,"audioCodec"),Ra(E,T,"textCodec")}c.push(E)}}return i},s.parseLevelPlaylist=function(a,e,t,r,i,n){var o,l,u,d,h,c={url:e},f=new Go(e),g=f.fragments,v=[],m=null,y=0,E=0,T=0,S=0,I=0,L=null,A=new $r(r,c),b=-1,R=!1,k=null;if(Ei.lastIndex=0,f.m3u8=a,f.hasVariableRefs=ha(a),((o=Ei.exec(a))==null?void 0:o[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(l=Ei.exec(a))!==null;){R&&(R=!1,(A=new $r(r,c)).playlistOffset=T,A.start=T,A.sn=y,A.cc=S,I&&(A.bitrate=I),A.level=t,m&&(A.initSegment=m,m.rawProgramDateTime&&(A.rawProgramDateTime=m.rawProgramDateTime,m.rawProgramDateTime=null),k&&(A.setByteRange(k),k=null)));var _=l[1];if(_){A.duration=parseFloat(_);var C=(" "+l[2]).slice(1);A.title=C||null,A.tagList.push(C?["INF",_,C]:["INF",_])}else if(l[3]){if(B(A.duration)){A.playlistOffset=T,A.start=T,d&&ka(A,d,f),A.sn=y,A.level=t,A.cc=S,g.push(A);var x=(" "+l[3]).slice(1);A.relurl=ui(f,x),Ti(A,L,v),L=A,T+=A.duration,y++,E=0,R=!0}}else{if(!(l=l[0].match(qo))){Z.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<l.length&&l[u]===void 0;u++);var w=(" "+l[u]).slice(1),P=(" "+l[u+1]).slice(1),M=l[u+2]?(" "+l[u+2]).slice(1):null;switch(w){case"BYTERANGE":L?A.setByteRange(P,L):A.setByteRange(P);break;case"PROGRAM-DATE-TIME":A.rawProgramDateTime=P,A.tagList.push(["PROGRAM-DATE-TIME",P]),b===-1&&(b=g.length);break;case"PLAYLIST-TYPE":f.type&&de(f,w,l),f.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?de(f,w,l):g.length>0&&ba(f,w,l),y=f.startSN=parseInt(P);break;case"SKIP":f.skippedSegments&&de(f,w,l);var F=new Lt(P,f),U=F.decimalInteger("SKIPPED-SEGMENTS");if(B(U)){f.skippedSegments+=U;for(var G=U;G--;)g.push(null);y+=U}var N=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");N&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(N.split("	")));break;case"TARGETDURATION":f.targetduration!==0&&de(f,w,l),f.targetduration=Math.max(parseInt(P),1);break;case"VERSION":f.version!==null&&de(f,w,l),f.version=parseInt(P);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||de(f,w,l),f.live=!1;break;case"#":(P||M)&&A.tagList.push(M?[P,M]:[P]);break;case"DISCONTINUITY":S++,A.tagList.push(["DIS"]);break;case"GAP":A.gap=!0,A.tagList.push([w]);break;case"BITRATE":A.tagList.push([w,P]),I=1e3*parseInt(P),B(I)?A.bitrate=I:I=0;break;case"DATERANGE":var H=new Lt(P,f),j=new ga(H,f.dateRanges[H.ID],f.dateRangeTagCount);f.dateRangeTagCount++,j.isValid||f.skippedSegments?f.dateRanges[j.id]=j:Z.warn('Ignoring invalid DATERANGE tag: "'+P+'"'),A.tagList.push(["EXT-X-DATERANGE",P]);break;case"DEFINE":var et=new Lt(P,f);"IMPORT"in et?No(f,et,n):fa(f,et,e);break;case"DISCONTINUITY-SEQUENCE":f.startCC!==0?de(f,w,l):g.length>0&&ba(f,w,l),f.startCC=S=parseInt(P);break;case"KEY":var X=Sa(P,e,f);if(X.isSupported()){if(X.method==="NONE"){d=void 0;break}d||(d={}),d[X.keyFormat]&&(d=ot({},d)),d[X.keyFormat]=X}else Z.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+P+'"');break;case"START":f.startTimeOffset=La(P);break;case"MAP":var ht=new Lt(P,f);if(A.duration){var rt=new $r(r,c);Ia(rt,ht,t,d),m=rt,A.initSegment=m,m.rawProgramDateTime&&!A.rawProgramDateTime&&(A.rawProgramDateTime=m.rawProgramDateTime)}else{var q=A.byteRangeEndOffset;if(q){var Et=A.byteRangeStartOffset;k=q-Et+"@"+Et}else k=null;Ia(A,ht,t,d),m=A,R=!0}m.cc=S;break;case"SERVER-CONTROL":h&&de(f,w,l),h=new Lt(P),f.canBlockReload=h.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=h.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&h.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=h.optionalFloat("PART-HOLD-BACK",0),f.holdBack=h.optionalFloat("HOLD-BACK",0);break;case"PART-INF":f.partTarget&&de(f,w,l);var nt=new Lt(P);f.partTarget=nt.decimalFloatingPoint("PART-TARGET");break;case"PART":var $=f.partList;$||($=f.partList=[]);var Y=E>0?$[$.length-1]:void 0,lt=E++,St=new Lt(P,f),yt=new vo(St,A,c,lt,Y);$.push(yt),A.duration+=yt.duration;break;case"PRELOAD-HINT":var Q=new Lt(P,f);f.preloadHint=Q;break;case"RENDITION-REPORT":var vt=new Lt(P,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(vt);break;default:Z.warn("line parsed but not handled: "+l)}}}L&&!L.relurl?(g.pop(),T-=L.duration,f.partList&&(f.fragmentHint=L)):f.partList&&(Ti(A,L,v),A.cc=S,f.fragmentHint=A,d&&ka(A,d,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));var At=g.length,z=g[0],_t=g[At-1];if((T+=f.skippedSegments*f.targetduration)>0&&At&&_t){f.averagetargetduration=T/At;var it=_t.sn;f.endSN=it!=="initSegment"?it:0,f.live||(_t.endList=!0),z&&f.startCC===void 0&&(f.startCC=z.cc),b>0&&(function(mt,ft){for(var bt=mt[ft],It=ft;It--;){var Pt=mt[It];if(!Pt)return;Pt.programDateTime=bt.programDateTime-1e3*Pt.duration,bt=Pt}}(g,b),z&&v.unshift(z))}else f.endSN=0,f.startCC=0;return f.fragmentHint&&(T+=f.fragmentHint.duration),f.totalduration=T,v.length&&f.dateRangeTagCount&&z&&Ta(v,f),f.endCC=S,f},s}();function Ta(s,a){for(var e=s.length,t=s[e-1],r=a.live?1/0:a.totalduration,i=Object.keys(a.dateRanges),n=i.length;n--;){var o=a.dateRanges[i[n]],l=o.startDate.getTime();o.tagAnchor=t.ref;for(var u=e;u--;){var d=Xo(a,l,s,u,r);if(d!==-1){o.tagAnchor=a.fragments[d].ref;break}}}}function Xo(s,a,e,t,r){var i=e[t];if(i){var n,o=i.programDateTime;if((a>=o||t===0)&&a<=o+1e3*((((n=e[t+1])==null?void 0:n.start)||r)-i.start)){var l=e[t].sn-s.startSN,u=s.fragments;if(u.length>e.length)for(var d=(e[t+1]||u[u.length-1]).sn-s.startSN;d>l;d--){var h=u[d].programDateTime;if(a>=h&&a<h+1e3*u[d].duration)return d}return l}}return-1}function Sa(s,a,e){var t,r,i=new Lt(s,e),n=(t=i.METHOD)!=null?t:"",o=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,d=(r=i.KEYFORMAT)!=null?r:"identity";o&&i.IV&&!l&&Z.error("Invalid IV: "+i.IV);var h=o?Je.resolve(o,a):"",c=(u||"1").split("/").map(Number).filter(Number.isFinite);return new yi(n,h,d,c,l)}function La(s){var a=new Lt(s).decimalFloatingPoint("TIME-OFFSET");return B(a)?a:null}function Aa(s,a){var e=(s||"").split(/[ ,]+/).filter(function(t){return t});["video","audio","text"].forEach(function(t){var r=e.filter(function(i){return Mn(i,t)});r.length&&(a[t+"Codec"]=r.map(function(i){return i.split("/")[0]}).join(","),e=e.filter(function(i){return r.indexOf(i)===-1}))}),a.unknownCodecs=e}function Ra(s,a,e){var t=a[e];t&&(s[e]=t)}function Ti(s,a,e){s.rawProgramDateTime?e.push(s):a!=null&&a.programDateTime&&(s.programDateTime=a.endProgramDateTime)}function Ia(s,a,e,t){s.relurl=a.URI,a.BYTERANGE&&s.setByteRange(a.BYTERANGE),s.level=e,s.sn="initSegment",t&&(s.levelkeys=t),s.initSegment=null}function ka(s,a,e){s.levelkeys=a;var t=e.encryptedFragments;t.length&&t[t.length-1].levelkeys===a||!Object.keys(a).some(function(r){return a[r].isCommonEncryption})||t.push(s)}function de(s,a,e){s.playlistParsingError=new Error("#EXT-X-"+a+" must not appear more than once ("+e[0]+")")}function ba(s,a,e){s.playlistParsingError=new Error("#EXT-X-"+a+" must appear before the first Media Segment ("+e[0]+")")}function Si(s,a){var e=a.startPTS;if(B(e)){var t,r=0;a.sn>s.sn?(r=e-s.start,t=s):(r=s.start-e,t=a),t.duration!==r&&t.setDuration(r)}else a.sn>s.sn?s.cc===a.cc&&s.minEndPTS?a.setStart(s.start+(s.minEndPTS-s.start)):a.setStart(s.start+s.duration):a.setStart(Math.max(s.start-a.duration,0))}function Da(s,a,e,t,r,i){t-e<=0&&(Z.warn("Fragment should have a positive duration",a),t=e+a.duration,i=r+a.duration);var n=e,o=t,l=a.startPTS,u=a.endPTS;if(B(l)){var d=Math.abs(l-e);B(a.deltaPTS)?a.deltaPTS=Math.max(d,a.deltaPTS):a.deltaPTS=d,n=Math.max(e,l),e=Math.min(e,l),r=Math.min(r,a.startDTS),o=Math.min(t,u),t=Math.max(t,u),i=Math.max(i,a.endDTS)}var h=e-a.start;a.start!==0&&a.setStart(e),a.setDuration(t-a.start),a.startPTS=e,a.maxStartPTS=n,a.startDTS=r,a.endPTS=t,a.minEndPTS=o,a.endDTS=i;var c,f=a.sn;if(!s||f<s.startSN||f>s.endSN)return 0;var g=f-s.startSN,v=s.fragments;for(v[g]=a,c=g;c>0;c--)Si(v[c],v[c-1]);for(c=g;c<v.length-1;c++)Si(v[c],v[c+1]);return s.fragmentHint&&Si(v[v.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,h}function zo(s,a){if(s!==a){for(var e,t=null,r=s.fragments,i=r.length-1;i>=0;i--){var n=r[i].initSegment;if(n){t=n;break}}s.fragmentHint&&delete s.fragmentHint.endPTS,function(g,v,m){for(var y=v.skippedSegments,E=Math.max(g.startSN,v.startSN)-v.startSN,T=(g.fragmentHint?1:0)+(y?v.endSN:Math.min(g.endSN,v.endSN))-v.startSN,S=v.startSN-g.startSN,I=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,L=g.fragmentHint?g.fragments.concat(g.fragmentHint):g.fragments,A=E;A<=T;A++){var b=L[S+A],R=I[A];if(y&&!R&&b&&(R=v.fragments[A]=b),b&&R){if(m(b,R,A,I),b.url&&b.url!==R.url)return void(v.playlistParsingError=_a("media sequence mismatch "+R.sn+":",g,v,0,R));if(b.cc!==R.cc)return void(v.playlistParsingError=_a("discontinuity sequence mismatch ("+b.cc+"!="+R.cc+")",g,v,0,R))}}}(s,a,function(g,v,m,y){if(!a.startCC&&v.cc!==g.cc){for(var E,T,S=g.cc-v.cc,I=m;I<y.length;I++)y[I].cc+=S;a.startCC=(E=(T=wa(s,a.startSN-1))==null?void 0:T.cc)!=null?E:y[0].cc,a.endCC=y[y.length-1].cc}B(g.startPTS)&&B(g.endPTS)&&(v.setStart(v.startPTS=g.startPTS),v.startDTS=g.startDTS,v.maxStartPTS=g.maxStartPTS,v.endPTS=g.endPTS,v.endDTS=g.endDTS,v.minEndPTS=g.minEndPTS,v.setDuration(g.endPTS-g.startPTS),v.duration&&(e=v),a.PTSKnown=a.alignedSliding=!0),g.hasStreams&&(v.elementaryStreams=g.elementaryStreams),v.loader=g.loader,g.hasStats&&(v.stats=g.stats),g.initSegment&&(v.initSegment=g.initSegment,t=g.initSegment)});var o=a.fragments,l=a.fragmentHint?o.concat(a.fragmentHint):o;if(t&&l.forEach(function(g){var v;!g||g.initSegment&&g.initSegment.relurl!==((v=t)==null?void 0:v.relurl)||(g.initSegment=t)}),a.skippedSegments)if(a.deltaUpdateFailed=o.some(function(g){return!g}),a.deltaUpdateFailed){Z.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=a.skippedSegments;u--;)o.shift();a.startSN=o[0].sn}else{a.endCC=o[o.length-1].cc,a.canSkipDateRanges&&(a.dateRanges=function(g,v){var m=v.dateRanges,y=v.recentlyRemovedDateranges,E=ot({},g);y&&y.forEach(function(S){delete E[S]});var T=Object.keys(E).length;return T&&Object.keys(m).forEach(function(S){var I=E[S],L=new ga(m[S].attr,I);L.isValid?(E[S]=L,I||(L.tagOrder+=T)):Z.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+pt(m[S].attr)+'"')}),E}(s.dateRanges,a));var d=s.fragments.filter(function(g){return g.rawProgramDateTime});if(s.hasProgramDateTime&&!a.hasProgramDateTime)for(var h=1;h<l.length;h++)l[h].programDateTime===null&&Ti(l[h],l[h-1],d);Ta(d,a)}(function(g,v,m){if(g&&v)for(var y=0,E=0,T=g.length;E<=T;E++){var S=g[E],I=v[E+y];S&&I&&S.index===I.index&&S.fragment.sn===I.fragment.sn?m(S,I):y--}})(s.partList,a.partList,function(g,v){v.elementaryStreams=g.elementaryStreams,v.stats=g.stats}),e?Da(a,e,e.startPTS,e.endPTS,e.startDTS,e.endDTS):Pa(s,a),o.length&&(a.totalduration=a.edge-o[0].start),a.driftStartTime=s.driftStartTime,a.driftStart=s.driftStart;var c=a.advancedDateTime;if(a.advanced&&c){var f=a.edge;a.driftStart||(a.driftStartTime=c,a.driftStart=f),a.driftEndTime=c,a.driftEnd=f}else a.driftEndTime=s.driftEndTime,a.driftEnd=s.driftEnd,a.advancedDateTime=s.advancedDateTime;a.requestScheduled===-1&&(a.requestScheduled=s.requestScheduled)}}function _a(s,a,e,t,r){return new Error(s+" "+r.url+`
Playlist starting @`+a.startSN+`
`+a.m3u8+`

Playlist starting @`+e.startSN+`
`+e.m3u8)}function Pa(s,a,e){e===void 0&&(e=!0);var t=a.startSN+a.skippedSegments-s.startSN,r=s.fragments,i=t>=0,n=0;if(i&&t<r.length)n=r[t].start;else if(i&&a.startSN===s.endSN+1)n=s.fragmentEnd;else if(i&&e)n=s.fragmentStart+t*a.levelTargetDuration;else{if(a.skippedSegments||a.fragmentStart!==0)return;n=s.fragmentStart}Li(a,n)}function Li(s,a){if(a){for(var e=s.fragments,t=s.skippedSegments;t<e.length;t++)e[t].addStart(a);s.fragmentHint&&s.fragmentHint.addStart(a)}}function Ca(s,a){a===void 0&&(a=1/0);var e=1e3*s.targetduration;if(s.updated){var t=s.fragments;if(t.length&&4*e>a){var r=1e3*t[t.length-1].duration;r<e&&(e=r)}}else e/=2;return Math.round(e)}function wa(s,a,e){if(!s)return null;var t=s.fragments[a-s.startSN];return t||((t=s.fragmentHint)&&t.sn===a?t:a<s.startSN&&e&&e.sn===a?e:null)}function xa(s,a,e){return s?Oa(s.partList,a,e):null}function Oa(s,a,e){if(s)for(var t=s.length;t--;){var r=s[t];if(r.index===e&&r.fragment.sn===a)return r}return null}function Ma(s){s.forEach(function(a,e){var t;(t=a.details)==null||t.fragments.forEach(function(r){r.level=e,r.initSegment&&(r.initSegment.level=e)})})}function Ze(s,a){for(var e=0,t=s.length;e<t;e++){var r;if(((r=s[e])==null?void 0:r.cc)===a)return s[e]}return null}function Fa(s,a){if(s){var e=s.start+a;s.start=s.startPTS=e,s.endPTS=e+s.duration}}function Na(s,a){for(var e=a.fragments,t=0,r=e.length;t<r;t++)Fa(e[t],s);a.fragmentHint&&Fa(a.fragmentHint,s),a.alignedSliding=!0}function Ua(s,a){if(function(i,n){return!!(i&&n.startCC<i.endCC&&n.endCC>i.startCC)}(a,s)){var e=Math.min(a.endCC,s.endCC),t=Ze(a.fragments,e),r=Ze(s.fragments,e);t&&r&&(Z.log("Aligning playlist at start of dicontinuity sequence "+e),Na(t.start-r.start,s))}}function Dr(s,a){if(s.hasProgramDateTime&&a.hasProgramDateTime){var e=s.fragments,t=a.fragments;if(e.length&&t.length){var r,i,n=Math.min(a.endCC,s.endCC);a.startCC<n&&s.startCC<n&&(r=Ze(t,n),i=Ze(e,n)),r&&i||(i=Ze(e,(r=t[Math.floor(t.length/2)]).cc)||e[Math.floor(e.length/2)]);var o=r.programDateTime,l=i.programDateTime;o&&l&&Na((l-o)/1e3-(i.start-r.start),s)}}}var Qo=function(s){for(var a="",e=s.length,t=0;t<e;t++)a+="["+s.start(t).toFixed(3)+"-"+s.end(t).toFixed(3)+"]";return a},O={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Ai=function(s){function a(t,r,i,n,o){var l;return(l=s.call(this,n,t.logger)||this).hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=O.STOPPED,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.buffering=!0,l.loadingParts=!1,l.loopSn=void 0,l.onMediaSeeking=function(){var u=l,d=u.config,h=u.fragCurrent,c=u.media,f=u.mediaBuffer,g=u.state,v=c?c.currentTime:0,m=tt.bufferInfo(f||c,v,d.maxBufferHole);if(l.log("media seeking to "+(B(v)?v.toFixed(3):v)+", state: "+g),l.state===O.ENDED)l.resetLoadingState();else if(h){var y=d.maxFragLookUpTolerance,E=h.start-y,T=h.start+h.duration+y;if(!m.len||T<m.start||E>m.end){var S=v>T;(v<E||S)&&(S&&h.loader&&(l.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),h.abortRequests(),l.resetLoadingState()),l.fragPrevious=null)}}if(c&&(l.fragmentTracker.removeFragmentsInRange(v,1/0,l.playlistType,!0),v>l.lastCurrentTime&&(l.lastCurrentTime=v),!l.loadingParts)){var I=Math.max(m.end,v),L=l.shouldLoadParts(l.getLevelDetails(),I);L&&(l.log("LL-Part loading ON after seeking to "+v.toFixed(2)+" with buffer @"+I.toFixed(2)),l.loadingParts=L)}l.hls.hasEnoughToStart||m.len||(l.log("setting startPosition to "+v+" because of seek before start"),l.nextLoadPosition=l.startPosition=v),l.tickImmediate()},l.onMediaEnded=function(){l.log("setting startPosition to 0 because media ended"),l.startPosition=l.lastCurrentTime=0},l.playlistType=o,l.hls=t,l.fragmentLoader=new Fo(t.config),l.keyLoader=i,l.fragmentTracker=r,l.config=t.config,l.decrypter=new oi(t.config),l}ut(a,s);var e=a.prototype;return e.registerListeners=function(){var t=this.hls;t.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(p.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(p.ERROR,this.onError,this)},e.doTick=function(){this.onTickEnd()},e.onTickEnd=function(){},e.startLoad=function(t){},e.stopLoad=function(){if(this.state!==O.STOPPED){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=O.STOPPED}},e.pauseBuffering=function(){this.buffering=!1},e.resumeBuffering=function(){this.buffering=!0},e._streamEnded=function(t,r){if(r.live||!this.media)return!1;var i=t.end||0,n=this.config.timelineOffset||0;if(i<=n)return!1;var o=t.nextStart;if(o&&o>n&&o<r.edge||this.media.currentTime<t.start)return!1;var l=r.partList;if(l!=null&&l.length){var u=l[l.length-1];return tt.isBuffered(this.media,u.start+u.duration/2)}var d=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)},e.getLevelDetails=function(){var t;if(this.levels&&this.levelLastLoaded!==null)return(t=this.levelLastLoaded)==null?void 0:t.details},e.onMediaAttached=function(t,r){var i=this.media=this.mediaBuffer=r.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);var n=this.config;this.levels&&n.autoStartLoad&&this.state===O.STOPPED&&this.startLoad(n.startPosition)},e.onMediaDetaching=function(t,r){var i=!!r.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}},e.onManifestLoading=function(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1},e.onError=function(t,r){},e.onManifestLoaded=function(t,r){this.startTimeOffset=r.startTimeOffset},e.onHandlerDestroying=function(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),s.prototype.onHandlerDestroying.call(this),this.hls=this.onMediaSeeking=this.onMediaEnded=null},e.onHandlerDestroyed=function(){this.state=O.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},e.loadFragment=function(t,r,i){this.startFragRequested=!0,this._loadFragForPlayback(t,r,i)},e._loadFragForPlayback=function(t,r,i){var n=this;this._doFragLoad(t,r,i,function(o){var l=o.frag;if(n.fragContextChanged(l))return n.warn(l.type+" sn: "+l.sn+(o.part?" part: "+o.part.index:"")+" of "+n.fragInfo(l,!1,o.part)+") was dropped during download."),void n.fragmentTracker.removeFragment(l);l.stats.chunkCount++,n._handleFragmentLoadProgress(o)}).then(function(o){if(o){var l=n.state,u=o.frag;n.fragContextChanged(u)?(l===O.FRAG_LOADING||!n.fragCurrent&&l===O.PARSING)&&(n.fragmentTracker.removeFragment(u),n.state=O.IDLE):("payload"in o&&(n.log("Loaded "+u.type+" sn: "+u.sn+" of "+n.playlistLabel()+" "+u.level),n.hls.trigger(p.FRAG_LOADED,o)),n._handleFragmentLoadComplete(o))}}).catch(function(o){n.state!==O.STOPPED&&n.state!==O.ERROR&&(n.warn("Frag error: "+((o==null?void 0:o.message)||o)),n.resetFragmentLoading(t))})},e.clearTrackerIfNeeded=function(t){var r,i=this.fragmentTracker;if(i.getState(t)===ia){var n=t.type,o=this.getFwdBufferInfo(this.mediaBuffer,n),l=Math.max(t.duration,o?o.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?t.sn-u.sn:0)==1||this.reduceMaxBufferLength(l,t.duration))&&i.removeFragment(t)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===we&&i.removeFragment(t))},e.checkLiveUpdate=function(t){if(t.updated&&!t.live){var r=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:r,part:null,stats:r.stats,id:r.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)},e.waitForLive=function(t){var r=t.details;return(r==null?void 0:r.live)&&r.type!=="EVENT"&&(this.levelLastLoaded!==t||r.expired)},e.flushMainBuffer=function(t,r,i){if(i===void 0&&(i=null),t-r){var n={startOffset:t,endOffset:r,type:i};this.hls.trigger(p.BUFFER_FLUSHING,n)}},e._loadInitSegment=function(t,r){var i=this;this._doFragLoad(t,r).then(function(n){var o=n==null?void 0:n.frag;if(!o||i.fragContextChanged(o)||!i.levels)throw new Error("init load aborted");return n}).then(function(n){var o=i.hls,l=n.frag,u=n.payload,d=l.decryptdata;if(u&&u.byteLength>0&&d!=null&&d.key&&d.iv&&Me(d.method)){var h=self.performance.now();return i.decrypter.decrypt(new Uint8Array(u),d.key.buffer,d.iv.buffer,di(d.method)).catch(function(c){throw o.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:l}),c}).then(function(c){var f=self.performance.now();return o.trigger(p.FRAG_DECRYPTED,{frag:l,payload:c,stats:{tstart:h,tdecrypt:f}}),n.payload=c,i.completeInitSegmentLoad(n)})}return i.completeInitSegmentLoad(n)}).catch(function(n){i.state!==O.STOPPED&&i.state!==O.ERROR&&(i.warn(n),i.resetFragmentLoading(t))})},e.completeInitSegmentLoad=function(t){if(!this.levels)throw new Error("init load aborted, missing levels");var r=t.frag.stats;this.state!==O.STOPPED&&(this.state=O.IDLE),t.frag.data=new Uint8Array(t.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()},e.fragContextChanged=function(t){var r=this.fragCurrent;return!t||!r||t.sn!==r.sn||t.level!==r.level},e.fragBufferedComplete=function(t,r){var i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+t.type+" sn: "+t.sn+(r?" part: "+r.index:"")+" of "+this.fragInfo(t,!1,r)+" > buffer:"+(i?Qo(tt.getBuffered(i)):"(detached)")+")"),Dt(t)){var n;if(t.type!==Qt){var o=t.elementaryStreams;if(!Object.keys(o).some(function(u){return!!o[u]}))return void(this.state=O.IDLE)}var l=(n=this.levels)==null?void 0:n[t.level];l!=null&&l.fragmentError&&(this.log("Resetting level fragment error count of "+l.fragmentError+" on frag buffered"),l.fragmentError=0)}this.state=O.IDLE},e._handleFragmentLoadComplete=function(t){var r=this.transmuxer;if(r){var i=t.frag,n=t.part,o=t.partsLoaded,l=!o||o.length===0||o.some(function(d){return!d}),u=new li(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!l);r.flush(u)}},e._handleFragmentLoadProgress=function(t){},e._doFragLoad=function(t,r,i,n){var o,l=this;i===void 0&&(i=null),this.fragCurrent=t;var u=r==null?void 0:r.details;if(!this.levels||!u)throw new Error("frag load aborted, missing level"+(u?"":" detail")+"s");var d=null;!t.encrypted||(o=t.decryptdata)!=null&&o.key?!t.encrypted&&u.encryptedFragments.length&&this.keyLoader.loadClear(t,u.encryptedFragments):(this.log("Loading key for "+t.sn+" of ["+u.startSN+"-"+u.endSN+"], "+this.playlistLabel()+" "+t.level),this.state=O.KEY_LOADING,this.fragCurrent=t,d=this.keyLoader.load(t).then(function(T){if(!l.fragContextChanged(T.frag))return l.hls.trigger(p.KEY_LOADED,T),l.state===O.KEY_LOADING&&(l.state=O.IDLE),T}),this.hls.trigger(p.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(d=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING"))));var h=this.fragPrevious;if(Dt(t)&&(!h||t.sn!==h.sn)){var c=this.shouldLoadParts(r.details,t.end);c!==this.loadingParts&&(this.log("LL-Part loading "+(c?"ON":"OFF")+" loading sn "+(h==null?void 0:h.sn)+"->"+t.sn),this.loadingParts=c)}if(i=Math.max(t.start,i||0),this.loadingParts&&Dt(t)){var f=u.partList;if(f&&n){i>t.end&&u.fragmentHint&&(t=u.fragmentHint);var g=this.getNextPart(f,t,i);if(g>-1){var v,m=f[g];return t=this.fragCurrent=m.fragment,this.log("Loading "+t.type+" sn: "+t.sn+" part: "+m.index+" ("+g+"/"+(f.length-1)+") of "+this.fragInfo(t,!1,m)+") cc: "+t.cc+" ["+u.startSN+"-"+u.endSN+"], target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=m.start+m.duration,this.state=O.FRAG_LOADING,v=d?d.then(function(T){return!T||l.fragContextChanged(T.frag)?null:l.doFragPartsLoad(t,m,r,n)}).catch(function(T){return l.handleFragLoadError(T)}):this.doFragPartsLoad(t,m,r,n).catch(function(T){return l.handleFragLoadError(T)}),this.hls.trigger(p.FRAG_LOADING,{frag:t,part:m,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):v}if(!t.url||this.loadedEndOfParts(f,i))return Promise.resolve(null)}}if(Dt(t)&&this.loadingParts)this.log("LL-Part loading OFF after next part miss @"+i.toFixed(2)),this.loadingParts=!1;else if(!t.url)return Promise.resolve(null);this.log("Loading "+t.type+" sn: "+t.sn+" of "+this.fragInfo(t,!1)+") cc: "+t.cc+" "+(u?"["+u.startSN+"-"+u.endSN+"]":"")+", target: "+parseFloat(i.toFixed(3))),B(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=O.FRAG_LOADING;var y,E=this.config.progressive;return y=E&&d?d.then(function(T){return!T||l.fragContextChanged(T==null?void 0:T.frag)?null:l.fragmentLoader.load(t,n)}).catch(function(T){return l.handleFragLoadError(T)}):Promise.all([this.fragmentLoader.load(t,E?n:void 0),d]).then(function(T){var S=T[0];return!E&&S&&n&&n(S),S}).catch(function(T){return l.handleFragLoadError(T)}),this.hls.trigger(p.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):y},e.doFragPartsLoad=function(t,r,i,n){var o=this;return new Promise(function(l,u){var d,h=[],c=(d=i.details)==null?void 0:d.partList,f=function(g){o.fragmentLoader.loadPart(t,g,n).then(function(v){h[g.index]=v;var m=v.part;o.hls.trigger(p.FRAG_LOADED,v);var y=xa(i.details,t.sn,g.index+1)||Oa(c,t.sn,g.index+1);if(!y)return l({frag:t,part:m,partsLoaded:h});f(y)}).catch(u)};f(r)})},e.handleFragLoadError=function(t){if("data"in t){var r=t.data;t.data&&r.details===D.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(p.ERROR,r)}else this.hls.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},e._handleTransmuxerFlush=function(t){var r=this.getCurrentContext(t);if(r&&this.state===O.PARSING){var i=r.frag,n=r.part,o=r.level,l=self.performance.now();i.stats.parsing.end=l,n&&(n.stats.parsing.end=l);var u=this.getLevelDetails(),d=u&&i.sn>u.endSN||this.shouldLoadParts(u,i.end);d!==this.loadingParts&&(this.log("LL-Part loading "+(d?"ON":"OFF")+" after parsing segment ending @"+i.end.toFixed(2)),this.loadingParts=d),this.updateLevelTiming(i,n,o,t.partial)}else this.fragCurrent||this.state===O.STOPPED||this.state===O.ERROR||(this.state=O.IDLE)},e.shouldLoadParts=function(t,r){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t!=null&&t.partList){var i,n,o=t.partList[0];if(r>=o.end+(((i=t.fragmentHint)==null?void 0:i.duration)||0)&&(this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>o.start-o.fragment.duration)return!0}}return!1},e.getCurrentContext=function(t){var r=this.levels,i=this.fragCurrent,n=t.level,o=t.sn,l=t.part;if(r==null||!r[n])return this.warn("Levels object was unset while buffering fragment "+o+" of "+this.playlistLabel()+" "+n+". The current chunk will not be buffered."),null;var u=r[n],d=u.details,h=l>-1?xa(d,o,l):null,c=h?h.fragment:wa(d,o,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:h,level:u}):null},e.bufferFragmentData=function(t,r,i,n,o){var l;if(t&&this.state===O.PARSING){var u=t.data1,d=t.data2,h=u;if(u&&d&&(h=Vt(u,d)),(l=h)!=null&&l.length){var c={type:t.type,frag:r,part:i,chunkMeta:n,parent:r.type,data:h};if(this.hls.trigger(p.BUFFER_APPENDING,c),t.dropped&&t.independent&&!i){if(o)return;this.flushBufferGap(r)}}}},e.flushBufferGap=function(t){var r=this.media;if(r)if(tt.isBuffered(r,r.currentTime)){var i=r.currentTime,n=tt.bufferInfo(r,i,0),o=t.duration,l=Math.min(2*this.config.maxFragLookUpTolerance,.25*o),u=Math.max(Math.min(t.start-l,n.end-l),i+l);t.start-u>l&&this.flushMainBuffer(u,t.start)}else this.flushMainBuffer(0,t.start)},e.getFwdBufferInfo=function(t,r){var i,n=this.getLoadPosition();if(!B(n))return null;var o=this.lastCurrentTime>n||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,n,r,o)},e.getFwdBufferInfoAtPos=function(t,r,i,n){var o=tt.bufferInfo(t,r,n);if(o.len===0&&o.nextStart!==void 0){var l=this.fragmentTracker.getBufferedFrag(r,i);if(l&&(o.nextStart<=l.end||l.gap)){var u=Math.max(Math.min(o.nextStart,l.end)-r,n);return tt.bufferInfo(t,r,u)}}return o},e.getMaxBufferLength=function(t){var r,i=this.config;return r=t?Math.max(8*i.maxBufferSize/t,i.maxBufferLength):i.maxBufferLength,Math.min(r,i.maxMaxBufferLength)},e.reduceMaxBufferLength=function(t,r){var i=this.config,n=Math.max(Math.min(t-r,i.maxBufferLength),r),o=Math.max(t-3*r,i.maxMaxBufferLength/2,n);return o>=n&&(i.maxMaxBufferLength=o,this.warn("Reduce max buffer length to "+o+"s"),!0)},e.getAppendedFrag=function(t,r){var i;r===void 0&&(r=J);var n=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(t,r);return n&&"fragment"in n?n.fragment:n},e.getNextFragment=function(t,r){var i=r.fragments,n=i.length;if(!n)return null;var o=this.config,l=i[0].start,u=o.lowLatencyMode&&!!r.partList,d=null;if(r.live){var h=o.initialLiveManifestSize;if(n<h)return this.warn("Not enough fragments to start playback (have: "+n+", need: "+h+")"),null;if(!r.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||t<l){var c;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(r,i);var f=this.hls.startPosition,g=this.hls.liveSyncPosition,v=d?(f!==-1&&f>=l?f:g)||d.start:t;this.log("Setting startPosition to "+v+" to match start frag at live edge. mainStart: "+f+" liveSyncPosition: "+g+" frag.start: "+((c=d)==null?void 0:c.start)),this.startPosition=this.nextLoadPosition=v}}else t<=l&&(d=i[0]);if(!d){var m=this.loadingParts?r.partEnd:r.fragmentEnd;d=this.getFragmentAtPosition(t,m,r)}var y=this.filterReplacedPrimary(d,r);if(!y&&d){var E=d.sn-r.startSN;y=this.filterReplacedPrimary(i[E+1]||null,r)}return this.mapToInitFragWhenRequired(y)},e.isLoopLoading=function(t,r){var i=this.fragmentTracker.getState(t);return(i===xe||i===we&&!!t.gap)&&this.nextLoadPosition>r},e.getNextFragmentLoopLoading=function(t,r,i,n,o){var l=null;if(t.gap&&(l=this.getNextFragment(this.nextLoadPosition,r))&&!l.gap&&i.nextStart){var u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n,0);if(u!==null&&i.len+u.len>=o){var d=l.sn;return this.loopSn!==d&&(this.log('buffer full after gaps in "'+n+'" playlist starting at sn: '+d),this.loopSn=d),null}}return this.loopSn=void 0,l},e.filterReplacedPrimary=function(t,r){if(!t)return t;if(Ba(this.hls.config)&&t.type!==Qt){var i=this.hls.interstitialsManager,n=i==null?void 0:i.bufferingItem;if(n){var o=n.event;if(o){if(o.appendInPlace||Math.abs(t.start-n.start)>1||n.start===0)return null}else if(t.end<=n.start&&(r==null?void 0:r.live)===!1||t.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||t.start-n.end>1))return null}var l=i==null?void 0:i.playerQueue;if(l)for(var u=l.length;u--;){var d=l[u].interstitial;if(d.appendInPlace&&t.start>=d.startTime&&t.end<=d.resumeTime)return null}}return t},e.mapToInitFragWhenRequired=function(t){return t==null||!t.initSegment||t!=null&&t.initSegment.data||this.bitrateTest?t:t.initSegment},e.getNextPart=function(t,r,i){for(var n=-1,o=!1,l=!0,u=0,d=t.length;u<d;u++){var h=t[u];if(l=l&&!h.independent,n>-1&&i<h.start)break;var c=h.loaded;c?n=-1:(o||h.independent||l)&&h.fragment===r&&(n=u),o=c}return n},e.loadedEndOfParts=function(t,r){var i=t[t.length-1];return i&&r>i.start&&i.loaded},e.getInitialLiveFragment=function(t,r){var i=this.fragPrevious,n=null;if(i){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),n=function(d,h,c){if(h===null||!Array.isArray(d)||!d.length||!B(h)||h<(d[0].programDateTime||0)||h>=(d[d.length-1].endProgramDateTime||0))return null;c=c||0;for(var f=0;f<d.length;++f){var g=d[f];if(_o(h,c,g))return g}return null}(r,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var o=i.sn+1;if(o>=t.startSN&&o<=t.endSN){var l=r[o-t.startSN];i.cc===l.cc&&(n=l,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))}n||(n=Jn(r,i.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn)}}else{var u=this.hls.liveSyncPosition;u!==null&&(n=this.getFragmentAtPosition(u,this.bitrateTest?t.fragmentEnd:t.edge,t))}return n},e.getFragmentAtPosition=function(t,r,i){var n,o,l=this.config,u=this.fragPrevious,d=i.fragments,h=i.endSN,c=i.fragmentHint,f=l.maxFragLookUpTolerance,g=i.partList,v=!!(this.loadingParts&&g!=null&&g.length&&c);if(v&&c&&!this.bitrateTest&&g[g.length-1].fragment.sn===c.sn&&(d=d.concat(c),h=c.sn),n=t<r?Re(u,d,t,t<this.lastCurrentTime||t>r-f||(o=this.media)!=null&&o.paused||!this.startFragRequested?0:f):d[d.length-1]){var m=n.sn-i.startSN,y=this.fragmentTracker.getState(n);if((y===xe||y===we&&n.gap)&&(u=n),u&&n.sn===u.sn&&(!v||g[0].fragment.sn>n.sn||!i.live&&!v)&&u&&n.level===u.level){var E=d[m+1];n=n.sn<h&&this.fragmentTracker.getState(E)!==xe?E:null}}return n},e.alignPlaylists=function(t,r,i){var n=t.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;var o=t.fragmentStart,l=!r,u=t.alignedSliding&&B(o);if(l||!u&&!o){(function(h,c){h&&(Ua(c,h),!c.alignedSliding&&h&&Dr(c,h),c.alignedSliding||!h||c.skippedSegments||Pa(h,c,!1))})(i,t);var d=t.fragmentStart;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+t.startSN+" fragments: "+n),d}return o},e.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},e.setStartPosition=function(t,r){var i=this.startPosition;i<r&&(i=-1);var n=this.timelineOffset;if(i===-1){var o=this.startTimeOffset!==null,l=o?this.startTimeOffset:t.startTimeOffset;l!==null&&B(l)?(i=r+l,l<0&&(i+=t.edge),i=Math.min(Math.max(r,i),r+t.totalduration),this.log("Setting startPosition to "+i+" for start time offset "+l+" found in "+(o?"multivariant":"media")+" playlist"),this.startPosition=i):t.live?(i=this.hls.liveSyncPosition||r,this.log("Setting startPosition to -1 to start at live edge "+i),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+n}this.nextLoadPosition=i+n},e.getLoadPosition=function(){var t,r=this.media,i=0;return(t=this.hls)!=null&&t.hasEnoughToStart&&r?i=r.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i},e.handleFragLoadAborted=function(t,r){this.transmuxer&&t.type===this.playlistType&&Dt(t)&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(r?" part "+r.index:"")+" of "+this.playlistLabel()+" "+t.level+" was aborted"),this.resetFragmentLoading(t))},e.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===O.FRAG_LOADING_WAITING_RETRY)||(this.state=O.IDLE)},e.onFragmentOrKeyLoadError=function(t,r){if(r.chunkMeta&&!r.frag){var i=this.getCurrentContext(r.chunkMeta);i&&(r.frag=i.frag)}var n=r.frag;if(n&&n.type===t&&this.levels)if(this.fragContextChanged(n)){var o;this.warn("Frag load error must match current frag to retry "+n.url+" > "+((o=this.fragCurrent)==null?void 0:o.url))}else{var l=r.details===D.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(n,!0);var u=r.errorAction,d=u||{},h=d.action,c=d.flags,f=d.retryCount,g=f===void 0?0:f,v=d.retryConfig,m=!!u&&!!v,y=m&&h===Tr,E=m&&!u.resolved&&c===Sr;if(!y&&E&&Dt(n)&&!n.endList)this.resetFragmentErrors(t),this.treatAsGap(n),u.resolved=!0;else if((y||E)&&g<v.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);var T=ai(v,g);this.warn("Fragment "+n.sn+" of "+t+" "+n.level+" errored with "+r.details+", retrying loading "+(g+1)+"/"+v.maxNumRetry+" in "+T+"ms"),u.resolved=!0,this.retryDate=self.performance.now()+T,this.state=O.FRAG_LOADING_WAITING_RETRY}else if(v&&u){if(this.resetFragmentErrors(t),!(g<v.maxNumRetry))return void this.warn(r.details+" reached or exceeded max retry ("+g+")");l||h===Po||(u.resolved=!0)}else this.state=h===le?O.WAITING_LEVEL:O.ERROR;this.tickImmediate()}},e.reduceLengthAndFlushBuffer=function(t){if(this.state===O.PARSING||this.state===O.PARSED){var r=t.frag,i=t.parent,n=this.getFwdBufferInfo(this.mediaBuffer,i),o=n&&n.len>.5;o&&this.reduceMaxBufferLength(n.len,(r==null?void 0:r.duration)||10);var l=!o;return l&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+i+" buffer"),r&&(this.fragmentTracker.removeFragment(r),this.nextLoadPosition=r.start),this.resetLoadingState(),l}return!1},e.resetFragmentErrors=function(t){t===Mt&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==O.STOPPED&&(this.state=O.IDLE)},e.afterBufferFlushed=function(t,r,i){if(t){var n=tt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(r,n,i),this.state===O.ENDED&&this.resetLoadingState()}},e.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==O.STOPPED&&(this.state=O.IDLE)},e.resetStartWhenNotLoaded=function(t){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;var r=t?t.details:null;r!=null&&r.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(r,r.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},e.resetWhenMissingContext=function(t){this.warn("The loading context changed while buffering fragment "+t.sn+" of "+this.playlistLabel()+" "+t.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},e.removeUnbufferedFrags=function(t){t===void 0&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},e.updateLevelTiming=function(t,r,i,n){var o=this,l=i.details;if(l){var u;if(!Object.keys(t.elementaryStreams).reduce(function(h,c){var f=t.elementaryStreams[c];if(f){var g=f.endPTS-f.startPTS;if(g<=0)return o.warn("Could not parse fragment "+t.sn+" "+c+" duration reliably ("+g+")"),h||!1;var v=n?0:Da(l,t,f.startPTS,f.endPTS,f.startDTS,f.endDTS);return o.hls.trigger(p.LEVEL_PTS_UPDATED,{details:l,level:i,drift:v,type:c,frag:t,start:f.startPTS,end:f.endPTS}),!0}return h},!1)&&(i.fragmentError===0&&this.treatAsGap(t,i),((u=this.transmuxer)==null?void 0:u.error)===null)){var d=new Error("Found no media in fragment "+t.sn+" of "+this.playlistLabel()+" "+t.level+" resetting transmuxer to fallback to playlist timing");if(this.warn(d.message),this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:t,reason:"Found no media in msn "+t.sn+" of "+this.playlistLabel()+' "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=O.PARSED,this.log("Parsed "+t.type+" sn: "+t.sn+(r?" part: "+r.index:"")+" of "+this.fragInfo(t,!1,r)+")"),this.hls.trigger(p.FRAG_PARSED,{frag:t,part:r})}else this.warn("level.details undefined")},e.playlistLabel=function(){return this.playlistType===J?"level":"track"},e.fragInfo=function(t,r,i){var n,o;return r===void 0&&(r=!0),this.playlistLabel()+" "+t.level+" ("+(i?"part":"frag")+":["+((n=r&&!i?t.startPTS:(i||t).start)!=null?n:NaN).toFixed(3)+"-"+((o=r&&!i?t.endPTS:(i||t).end)!=null?o:NaN).toFixed(3)+"]"+(i&&t.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):"")},e.treatAsGap=function(t,r){r&&r.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)},e.resetTransmuxer=function(){var t;(t=this.transmuxer)==null||t.reset()},e.recoverWorkerError=function(t){t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},dt(a,[{key:"startPositionValue",get:function(){var t=this.nextLoadPosition,r=this.startPosition;return r===-1&&t?t:r}},{key:"bufferingEnabled",get:function(){return this.buffering}},{key:"inFlightFrag",get:function(){return{frag:this.fragCurrent,state:this.state}}},{key:"timelineOffset",get:function(){var t,r=this.config.timelineOffset;return r?((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||r:0}},{key:"primaryPrefetch",get:function(){var t,r;return!(!Ba(this.hls.config)||!(!((t=this.hls.interstitialsManager)==null||(r=t.playingItem)==null)&&r.event))}},{key:"state",get:function(){return this._state},set:function(t){var r=this._state;r!==t&&(this._state=t,this.log(r+"->"+t))}}])}(la);function Ba(s){return!!s.interstitialsController&&s.enableInterstitialPlayback!==!1}var Ga=function(){function s(){this.chunks=[],this.dataLength=0}var a=s.prototype;return a.push=function(e){this.chunks.push(e),this.dataLength+=e.length},a.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=t.length===1?t[0]:function(i,n){for(var o=new Uint8Array(n),l=0,u=0;u<i.length;u++){var d=i[u];o.set(d,l),l+=d.length}return o}(t,r),this.reset(),e):new Uint8Array(0)},a.reset=function(){this.chunks.length=0,this.dataLength=0},s}();function Ka(s,a){return a+10<=s.length&&s[a]===51&&s[a+1]===68&&s[a+2]===73&&s[a+3]<255&&s[a+4]<255&&s[a+6]<128&&s[a+7]<128&&s[a+8]<128&&s[a+9]<128}function Ri(s,a){return a+10<=s.length&&s[a]===73&&s[a+1]===68&&s[a+2]===51&&s[a+3]<255&&s[a+4]<255&&s[a+6]<128&&s[a+7]<128&&s[a+8]<128&&s[a+9]<128}function _r(s,a){var e=0;return e=(127&s[a])<<21,e|=(127&s[a+1])<<14,e|=(127&s[a+2])<<7,e|=127&s[a+3]}function tr(s,a){for(var e=a,t=0;Ri(s,a);)t+=10,t+=_r(s,a+6),Ka(s,a+10)&&(t+=10),a+=t;if(t>0)return s.subarray(e,e+t)}function Ha(s,a){return s[a]===255&&(246&s[a+1])==240}function Va(s,a){return 1&s[a+1]?7:9}function Ii(s,a){return(3&s[a+3])<<11|s[a+4]<<3|(224&s[a+5])>>>5}function Pr(s,a){return a+1<s.length&&Ha(s,a)}function $o(s,a){if(Pr(s,a)){var e=Va(s,a);if(a+e>=s.length)return!1;var t=Ii(s,a);if(t<=e)return!1;var r=a+t;return r===s.length||Pr(s,r)}return!1}function Ya(s,a,e,t,r){if(!s.samplerate){var i=function(n,o,l,u){var d=o[l+2],h=d>>2&15;if(!(h>12)){var c=1+(d>>6&3),f=o[l+3]>>6&3|(1&d)<<2,g="mp4a.40."+c,v=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][h],m=h;c!==5&&c!==29||(m-=3);var y=[c<<3|(14&m)>>1,(1&m)<<7|f<<3];return Z.log("manifest codec:"+u+", parsed codec:"+g+", channels:"+f+", rate:"+v+" (ADTS object type:"+c+" sampling index:"+h+")"),{config:y,samplerate:v,channelCount:f,codec:g,parsedCodec:g,manifestCodec:u}}var E=new Error("invalid ADTS sampling index:"+h);n.emit(p.ERROR,p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message})}(a,e,t,r);if(!i)return;ot(s,i)}}function Wa(s){return 9216e4/s}function ja(s,a,e,t,r){var i,n=t+r*Wa(s.samplerate),o=function(g,v){var m=Va(g,v);if(v+m<=g.length){var y=Ii(g,v)-m;if(y>0)return{headerLength:m,frameLength:y}}}(a,e);if(o){var l=o.frameLength,u=o.headerLength,d=u+l,h=Math.max(0,e+d-a.length);h?(i=new Uint8Array(d-u)).set(a.subarray(e+u,a.length),0):i=a.subarray(e+u,e+d);var c={unit:i,pts:n};return h||s.samples.push(c),{sample:c,length:d,missing:h}}var f=a.length-e;return(i=new Uint8Array(f)).set(a.subarray(e,a.length),0),{sample:{unit:i,pts:n},length:f,missing:-1}}function Jo(s,a){return Ri(s,a)&&_r(s,a+6)+10<=s.length-a}function qa(s,a){if(s<0)return-qa(-s,a);var e=Math.pow(10,a);if(Math.abs(s*e%1-.5)<Number.EPSILON){var t=Math.floor(s*e);return(t%2==0?t:t+1)/e}return Math.round(s*e)/e}function ki(s,a,e){return a===void 0&&(a=0),e===void 0&&(e=1/0),function(t,r,i,n){var o=function(v){return v instanceof ArrayBuffer?v:v.buffer}(t),l=1;"BYTES_PER_ELEMENT"in n&&(l=n.BYTES_PER_ELEMENT);var u,d=(u=t)&&u.buffer instanceof ArrayBuffer&&u.byteLength!==void 0&&u.byteOffset!==void 0?t.byteOffset:0,h=(d+t.byteLength)/l,c=(d+r)/l,f=Math.floor(Math.max(0,Math.min(c,h))),g=Math.floor(Math.min(f+Math.max(i,0),h));return new n(o,f,g-f)}(s,a,e,Uint8Array)}function Zo(s){var a={key:s.type,description:"",data:"",mimeType:null,pictureType:null};if(!(s.size<2))if(s.data[0]===3){var e=s.data.subarray(1).indexOf(0);if(e!==-1){var t=Gt(ki(s.data,1,e)),r=s.data[2+e],i=s.data.subarray(3+e).indexOf(0);if(i!==-1){var n,o=Gt(ki(s.data,3+e,i));return n=t==="-->"?Gt(ki(s.data,4+e+i)):function(l){return l instanceof ArrayBuffer?l:l.byteOffset==0&&l.byteLength==l.buffer.byteLength?l.buffer:new Uint8Array(l).buffer}(s.data.subarray(4+e+i)),a.mimeType=t,a.pictureType=r,a.description=o,a.data=n,a}}}else console.log("Ignore frame with unrecognized character encoding")}function tl(s){return s.type==="PRIV"?function(a){if(!(a.size<2)){var e=Gt(a.data,!0),t=new Uint8Array(a.data.subarray(e.length+1));return{key:a.type,info:e,data:t.buffer}}}(s):s.type[0]==="W"?function(a){if(a.type==="WXXX"){if(a.size<2)return;var e=1,t=Gt(a.data.subarray(e),!0);e+=t.length+1;var r=Gt(a.data.subarray(e));return{key:a.type,info:t,data:r}}var i=Gt(a.data);return{key:a.type,info:"",data:i}}(s):s.type==="APIC"?Zo(s):function(a){if(!(a.size<2)){if(a.type==="TXXX"){var e=1,t=Gt(a.data.subarray(e),!0);e+=t.length+1;var r=Gt(a.data.subarray(e));return{key:a.type,info:t,data:r}}var i=Gt(a.data.subarray(1));return{key:a.type,info:"",data:i}}}(s)}function el(s){var a=String.fromCharCode(s[0],s[1],s[2],s[3]),e=_r(s,4);return{type:a,size:e,data:s.subarray(10,10+e)}}var Cr=10,rl=10;function Xa(s){for(var a=0,e=[];Ri(s,a);){var t=_r(s,a+6);s[a+5]>>6&1&&(a+=Cr);for(var r=(a+=Cr)+t;a+rl<r;){var i=el(s.subarray(a)),n=tl(i);n&&e.push(n),a+=i.size+Cr}Ka(s,a)&&(a+=Cr)}return e}function za(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"}function il(s){if(s.data.byteLength===8){var a=new Uint8Array(s.data),e=1&a[3],t=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return t/=45,e&&(t+=4772185884e-2),Math.round(t)}}function bi(s){for(var a=Xa(s),e=0;e<a.length;e++){var t=a[e];if(za(t))return il(t)}}var Kt=function(s){return s.audioId3="org.id3",s.dateRange="com.apple.quicktime.HLS",s.emsg="https://aomedia.org/emsg/ID3",s.misbklv="urn:misb:KLV:bin:1910.1",s}({});function re(s,a){return s===void 0&&(s=""),a===void 0&&(a=9e4),{type:s,id:-1,pid:-1,inputTimeScale:a,sequenceNumber:-1,samples:[],dropped:0}}var Di=function(){function s(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var a=s.prototype;return a.resetInitSegment=function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},a.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},a.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},a.canParse=function(e,t){return!1},a.appendFrame=function(e,t,r){},a.demux=function(e,t){this.cachedData&&(e=Vt(this.cachedData,e),this.cachedData=null);var r,i=tr(e,0),n=i?i.length:0,o=this._audioTrack,l=this._id3Track,u=i?bi(i):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&B(u))&&(this.basePTS=nl(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Kt.audioId3,duration:Number.POSITIVE_INFINITY});n<d;){if(this.canParse(e,n)){var h=this.appendFrame(o,e,n);h?(this.frameIndex++,this.lastPTS=h.sample.pts,r=n+=h.length):n=d}else Jo(e,n)?(i=tr(e,n),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Kt.audioId3,duration:Number.POSITIVE_INFINITY}),r=n+=i.length):n++;if(n===d&&r!==d){var c=e.slice(r);this.cachedData?this.cachedData=Vt(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:re(),id3Track:l,textTrack:re()}},a.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},a.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:re(),id3Track:this._id3Track,textTrack:re()}},a.destroy=function(){this.cachedData=null,this._audioTrack=this._id3Track=void 0},s}(),nl=function(s,a,e){return B(s)?90*s:9e4*a+(e?9e4*e.baseTime/e.timescale:0)},wr=null,al=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],sl=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ol=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],ll=[0,1,1,4];function Qa(s,a,e,t,r){if(!(e+24>a.length)){var i=$a(a,e);if(i&&e+i.frameLength<=a.length){var n=t+r*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:a.subarray(e,e+i.frameLength),pts:n,dts:n};return s.config=[],s.channelCount=i.channelCount,s.samplerate=i.sampleRate,s.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}}function $a(s,a){var e=s[a+1]>>3&3,t=s[a+1]>>1&3,r=s[a+2]>>4&15,i=s[a+2]>>2&3;if(e!==1&&r!==0&&r!==15&&i!==3){var n=s[a+2]>>1&1,o=s[a+3]>>6,l=1e3*al[14*(e===3?3-t:t===3?3:4)+r-1],u=sl[3*(e===3?0:e===2?1:2)+i],d=o===3?1:2,h=ol[e][t],c=ll[t],f=8*h*c,g=Math.floor(h*l/u+n)*c;if(wr===null){var v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);wr=v?parseInt(v[1]):0}return wr&&wr<=87&&t===2&&l>=224e3&&o===0&&(s[a+3]=128|s[a+3]),{sampleRate:u,channelCount:d,frameLength:g,samplesPerFrame:f}}}function _i(s,a){return s[a]===255&&(224&s[a+1])==224&&(6&s[a+1])!=0}function Ja(s,a){return a+1<s.length&&_i(s,a)}function Za(s,a){if(a+1<s.length&&_i(s,a)){var e=$a(s,a),t=4;e!=null&&e.frameLength&&(t=e.frameLength);var r=a+t;return r===s.length||Ja(s,r)}return!1}var ul=function(s){function a(t,r){var i;return(i=s.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}ut(a,s);var e=a.prototype;return e.resetInitSegment=function(t,r,i,n){s.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},a.probe=function(t,r){if(!t)return!1;var i=tr(t,0),n=(i==null?void 0:i.length)||0;if(Za(t,n))return!1;for(var o=t.length;n<o;n++)if($o(t,n))return r.log("ADTS sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,n){return function(o,l){return l+5<o.length}(i,n)&&Ha(i,n)&&Ii(i,n)<=i.length-n}(t,r)},e.appendFrame=function(t,r,i){Ya(t,this.observer,r,i,t.manifestCodec);var n=ja(t,r,i,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n},a}(Di),ts=function(s,a){var e=0,t=5;a+=t;for(var r=new Uint32Array(1),i=new Uint32Array(1),n=new Uint8Array(1);t>0;){n[0]=s[a];var o=Math.min(t,8),l=8-o;i[0]=4278190080>>>24+l<<l,r[0]=(n[0]&i[0])>>l,e=e?e<<o|r[0]:r[0],a+=1,t-=o}return e},dl=function(s){function a(t){var r;return(r=s.call(this)||this).observer=void 0,r.observer=t,r}ut(a,s);var e=a.prototype;return e.resetInitSegment=function(t,r,i,n){s.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},e.canParse=function(t,r){return r+64<t.length},e.appendFrame=function(t,r,i){var n=es(t,r,i,this.basePTS,this.frameIndex);if(n!==-1)return{sample:t.samples[t.samples.length-1],length:n,missing:0}},a.probe=function(t){if(!t)return!1;var r=tr(t,0);if(!r)return!1;var i=r.length;return t[i]===11&&t[i+1]===119&&bi(r)!==void 0&&ts(t,i)<16},a}(Di);function es(s,a,e,t,r){if(e+8>a.length||a[e]!==11||a[e+1]!==119)return-1;var i=a[e+4]>>6;if(i>=3)return-1;var n=[48e3,44100,32e3][i],o=63&a[e+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+i];if(e+l>a.length)return-1;var u=a[e+6]>>5,d=0;u===2?d+=2:(1&u&&u!==1&&(d+=2),4&u&&(d+=2));var h=(a[e+6]<<8|a[e+7])>>12-d&1,c=[2,1,2,3,3,4,4,5][u]+h,f=a[e+5]>>3,g=7&a[e+5],v=new Uint8Array([i<<6|f<<1|g>>2,(3&g)<<6|u<<3|h<<2|o>>4,o<<4&224]),m=t+r*(1536/n*9e4),y=a.subarray(e,e+l);return s.config=v,s.channelCount=c,s.samplerate=n,s.samples.push({unit:y,pts:m}),l}var hl=function(s){function a(){return s.apply(this,arguments)||this}ut(a,s);var e=a.prototype;return e.resetInitSegment=function(t,r,i,n){s.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},a.probe=function(t){if(!t)return!1;var r=tr(t,0),i=(r==null?void 0:r.length)||0;if(r&&t[i]===11&&t[i+1]===119&&bi(r)!==void 0&&ts(t,i)<=16)return!1;for(var n=t.length;i<n;i++)if(Za(t,i))return Z.log("MPEG Audio sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,n){return _i(i,n)&&4<=i.length-n}(t,r)},e.appendFrame=function(t,r,i){if(this.basePTS!==null)return Qa(t,r,i,this.basePTS,this.frameIndex)},a}(Di),fl=/\/emsg[-/]ID3/i,cl=function(){function s(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var a=s.prototype;return a.resetTimeStamp=function(){},a.resetInitSegment=function(e,t,r,i){var n=this.videoTrack=re("video",1),o=this.audioTrack=re("audio",1),l=this.txtTrack=re("text",1);if(this.id3Track=re("id3",1),this.timeOffset=0,e!=null&&e.byteLength){var u=Pn(e);if(u.video){var d=u.video,h=d.id,c=d.timescale,f=d.codec,g=d.supplemental;n.id=h,n.timescale=l.timescale=c,n.codec=f,n.supplemental=g}if(u.audio){var v=u.audio,m=v.id,y=v.timescale,E=v.codec;o.id=m,o.timescale=y,o.codec=E}l.id=kn.text,n.sampleDuration=0,n.duration=o.duration=i}},a.resetContiguity=function(){this.remainderData=null},s.probe=function(e){return function(t){for(var r=t.byteLength,i=0;i<r;){var n=V(t,i);if(n>8&&t[i+4]===109&&t[i+5]===111&&t[i+6]===111&&t[i+7]===102)return!0;i=n>1?i+n:r}return!1}(e)},a.demux=function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Vt(this.remainderData,e));var o=function(u){var d={valid:null,remainder:null},h=W(u,["moof"]);if(h.length<2)return d.remainder=u,d;var c=h[h.length-1];return d.valid=u.slice(0,c.byteOffset-8),d.remainder=u.slice(c.byteOffset-8),d}(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;var l=this.extractID3Track(i,t);return n.samples=wn(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},a.flush=function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=wn(e,t),{videoTrack:t,audioTrack:re(),id3Track:i,textTrack:re()}},a.extractID3Track=function(e,t){var r=this,i=this.id3Track;if(e.samples.length){var n=W(e.samples,["emsg"]);n&&n.forEach(function(o){var l=function(f){var g=f[0],v="",m="",y=0,E=0,T=0,S=0,I=0,L=0;if(g===0){for(;kt(f.subarray(L,L+1))!=="\0";)v+=kt(f.subarray(L,L+1)),L+=1;for(v+=kt(f.subarray(L,L+1)),L+=1;kt(f.subarray(L,L+1))!=="\0";)m+=kt(f.subarray(L,L+1)),L+=1;m+=kt(f.subarray(L,L+1)),L+=1,y=V(f,12),E=V(f,16),S=V(f,20),I=V(f,24),L=28}else if(g===1){y=V(f,L+=4);var A=V(f,L+=4),b=V(f,L+=4);for(L+=4,T=Math.pow(2,32)*A+b,ho(T)||(T=Number.MAX_SAFE_INTEGER,Z.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),S=V(f,L),I=V(f,L+=4),L+=4;kt(f.subarray(L,L+1))!=="\0";)v+=kt(f.subarray(L,L+1)),L+=1;for(v+=kt(f.subarray(L,L+1)),L+=1;kt(f.subarray(L,L+1))!=="\0";)m+=kt(f.subarray(L,L+1)),L+=1;m+=kt(f.subarray(L,L+1)),L+=1}return{schemeIdUri:v,value:m,timeScale:y,presentationTime:T,presentationTimeDelta:E,eventDuration:S,id:I,payload:f.subarray(L,f.byteLength)}}(o);if(fl.test(l.schemeIdUri)){var u=rs(l,t),d=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var h=l.payload;i.samples.push({data:h,len:h.byteLength,dts:u,pts:u,type:Kt.emsg,duration:d})}else if(r.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){var c=rs(l,t);i.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:Kt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i},a.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},a.destroy=function(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0},s}();function rs(s,a){return B(s.presentationTime)?s.presentationTime/s.timeScale:a+s.presentationTimeDelta/s.timeScale}var gl=function(){function s(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new oi(t,{removePKCS7Padding:!1})}var a=s.prototype;return a.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,$e)},a.decryptAacSample=function(e,t,r){var i=this,n=e[t].unit;if(!(n.length<=16)){var o=n.subarray(16,n.length-n.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then(function(u){var d=new Uint8Array(u);n.set(d,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,r)})}},a.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}},a.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r},a.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e},a.decryptAvcSample=function(e,t,r,i,n){var o=this,l=xn(n.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(function(d){n.data=o.getAvcDecryptedUnit(l,d),o.decrypter.isSync()||o.decryptAvcSamples(e,t,r+1,i)})},a.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var o=n[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5||(this.decryptAvcSample(e,t,r,i,o),this.decrypter.isSync())))return}}},s}(),is=function(){function s(){this.VideoSample=null}var a=s.prototype;return a.createVideoSample=function(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}},a.getLastNalUnit=function(e){var t,r,i=this.VideoSample;if(i&&i.units.length!==0||(i=e[e.length-1]),(t=i)!=null&&t.units){var n=i.units;r=n[n.length-1]}return r},a.pushAccessUnit=function(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){var r=t.samples,i=r.length;if(!i)return void t.dropped++;var n=r[i-1];e.pts=n.pts,e.dts=n.dts}t.samples.push(e)}},a.parseNALu=function(e,t,r){var i,n,o=t.byteLength,l=e.naluState||0,u=l,d=[],h=0,c=-1,f=0;for(l===-1&&(c=0,f=this.getNALuType(t,0),l=0,h=1);h<o;)if(i=t[h++],l)if(l!==1)if(i)if(i===1){if(n=h-l-1,c>=0){var g={data:t.subarray(c,n),type:f};d.push(g)}else{var v=this.getLastNalUnit(e.samples);v&&(u&&h<=4-u&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-u)),n>0&&(v.data=Vt(v.data,t.subarray(0,n)),v.state=0))}h<o?(c=h,f=this.getNALuType(t,h),l=0):l=-1}else l=0;else l=3;else l=i?0:2;else l=i?0:1;if(c>=0&&l>=0){var m={data:t.subarray(c,o),type:f,state:l};d.push(m)}if(d.length===0){var y=this.getLastNalUnit(e.samples);y&&(y.data=Vt(y.data,t))}return e.naluState=l,d},s}(),er=function(){function s(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var a=s.prototype;return a.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},a.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},a.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&Z.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},a.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!=0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},a.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.skipEG=function(){this.skipBits(1+this.skipLZ())},a.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},a.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},a.readBoolean=function(){return this.readBits(1)===1},a.readUByte=function(){return this.readBits(8)},a.readUShort=function(){return this.readBits(16)},a.readUInt=function(){return this.readBits(32)},s}(),ns=function(s){function a(){return s.apply(this,arguments)||this}ut(a,s);var e=a.prototype;return e.parsePES=function(t,r,i,n){var o,l=this,u=this.parseNALu(t,i.data,n),d=this.VideoSample,h=!1;i.data=null,d&&u.length&&!t.audFound&&(this.pushAccessUnit(d,t),d=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var f,g;switch(c.type){case 1:var v=!1;o=!0;var m,y=c.data;if(h&&y.length>4){var E=l.readSliceType(y);E!==2&&E!==4&&E!==7&&E!==9||(v=!0)}v&&(m=d)!=null&&m.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.frame=!0,d.key=v;break;case 5:o=!0,(f=d)!=null&&f.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0,d.frame=!0;break;case 6:o=!0,ti(c.data,1,i.pts,r.samples);break;case 7:var T,S;o=!0,h=!0;var I=c.data,L=l.readSPS(I);if(!t.sps||t.width!==L.width||t.height!==L.height||((T=t.pixelRatio)==null?void 0:T[0])!==L.pixelRatio[0]||((S=t.pixelRatio)==null?void 0:S[1])!==L.pixelRatio[1]){t.width=L.width,t.height=L.height,t.pixelRatio=L.pixelRatio,t.sps=[I];for(var A=I.subarray(1,4),b="avc1.",R=0;R<3;R++){var k=A[R].toString(16);k.length<2&&(k="0"+k),b+=k}t.codec=b}break;case 8:o=!0,t.pps=[c.data];break;case 9:o=!0,t.audFound=!0,(g=d)!=null&&g.frame&&(l.pushAccessUnit(d,t),d=null),d||(d=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;case 12:o=!0;break;default:o=!1}d&&o&&d.units.push(c)}),n&&d&&(this.pushAccessUnit(d,t),this.VideoSample=null)},e.getNALuType=function(t,r){return 31&t[r]},e.readSliceType=function(t){var r=new er(t);return r.readUByte(),r.readUEG(),r.readUEG()},e.skipScalingList=function(t,r){for(var i=8,n=8,o=0;o<t;o++)n!==0&&(n=(i+r.readEG()+256)%256),i=n===0?i:n},e.readSPS=function(t){var r,i,n,o=new er(t),l=0,u=0,d=0,h=0,c=o.readUByte.bind(o),f=o.readBits.bind(o),g=o.readUEG.bind(o),v=o.readBoolean.bind(o),m=o.skipBits.bind(o),y=o.skipEG.bind(o),E=o.skipUEG.bind(o),T=this.skipScalingList.bind(this);c();var S=c();if(f(5),m(3),c(),E(),S===100||S===110||S===122||S===244||S===44||S===83||S===86||S===118||S===128){var I=g();if(I===3&&m(1),E(),E(),m(1),v())for(i=I!==3?8:12,n=0;n<i;n++)v()&&T(n<6?16:64,o)}E();var L=g();if(L===0)g();else if(L===1)for(m(1),y(),y(),r=g(),n=0;n<r;n++)y();E(),m(1);var A=g(),b=g(),R=f(1);R===0&&m(1),m(1),v()&&(l=g(),u=g(),d=g(),h=g());var k=[1,1];if(v()&&v())switch(c()){case 1:k=[1,1];break;case 2:k=[12,11];break;case 3:k=[10,11];break;case 4:k=[16,11];break;case 5:k=[40,33];break;case 6:k=[24,11];break;case 7:k=[20,11];break;case 8:k=[32,11];break;case 9:k=[80,33];break;case 10:k=[18,11];break;case 11:k=[15,11];break;case 12:k=[64,33];break;case 13:k=[160,99];break;case 14:k=[4,3];break;case 15:k=[3,2];break;case 16:k=[2,1];break;case 255:k=[c()<<8|c(),c()<<8|c()]}return{width:Math.ceil(16*(A+1)-2*l-2*u),height:(2-R)*(b+1)*16-(R?2:4)*(d+h),pixelRatio:k}},a}(is),as=function(s){function a(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(t=s.call.apply(s,[this].concat(i))||this).initVPS=null,t}ut(a,s);var e=a.prototype;return e.parsePES=function(t,r,i,n){var o,l=this,u=this.parseNALu(t,i.data,n),d=this.VideoSample,h=!1;i.data=null,d&&u.length&&!t.audFound&&(this.pushAccessUnit(d,t),d=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),u.forEach(function(c){var f,g;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:d||(d=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts)),d.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:var v;o=!0,h&&(v=d)!=null&&v.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0,d.frame=!0;break;case 19:case 20:o=!0,(f=d)!=null&&f.frame&&!d.key&&(l.pushAccessUnit(d,t),d=l.VideoSample=null),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0,d.frame=!0;break;case 39:o=!0,ti(c.data,2,i.pts,r.samples);break;case 32:o=!0,t.vps||(typeof t.params!="object"&&(t.params={}),t.params=ot(t.params,l.readVPS(c.data)),l.initVPS=c.data),t.vps=[c.data];break;case 33:if(o=!0,h=!0,t.vps===void 0||t.vps[0]===l.initVPS||t.sps===void 0||l.matchSPS(t.sps[0],c.data)||(l.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){var m=l.readSPS(c.data);for(var y in t.width=m.width,t.height=m.height,t.pixelRatio=m.pixelRatio,t.codec=m.codecString,t.sps=[],typeof t.params!="object"&&(t.params={}),m.params)t.params[y]=m.params[y]}l.pushParameterSet(t.sps,c.data,t.vps),d||(d=l.VideoSample=l.createVideoSample(!0,i.pts,i.dts)),d.key=!0;break;case 34:if(o=!0,typeof t.params=="object"){if(!t.pps){t.pps=[];var E=l.readPPS(c.data);for(var T in E)t.params[T]=E[T]}l.pushParameterSet(t.pps,c.data,t.vps)}break;case 35:o=!0,t.audFound=!0,(g=d)!=null&&g.frame&&(l.pushAccessUnit(d,t),d=null),d||(d=l.VideoSample=l.createVideoSample(!1,i.pts,i.dts));break;default:o=!1}d&&o&&d.units.push(c)}),n&&d&&(this.pushAccessUnit(d,t),this.VideoSample=null)},e.pushParameterSet=function(t,r,i){(i&&i[0]===this.initVPS||!i&&!t.length)&&t.push(r)},e.getNALuType=function(t,r){return(126&t[r])>>>1},e.ebsp2rbsp=function(t){for(var r=new Uint8Array(t.byteLength),i=0,n=0;n<t.byteLength;n++)n>=2&&t[n]===3&&t[n-1]===0&&t[n-2]===0||(r[i]=t[n],i++);return new Uint8Array(r.buffer,0,i)},e.pushAccessUnit=function(t,r){s.prototype.pushAccessUnit.call(this,t,r),this.initVPS&&(this.initVPS=null)},e.readVPS=function(t){var r=new er(t);return r.readUByte(),r.readUByte(),r.readBits(4),r.skipBits(2),r.readBits(6),{numTemporalLayers:r.readBits(3)+1,temporalIdNested:r.readBoolean()}},e.readSPS=function(t){var r=new er(this.ebsp2rbsp(t));r.readUByte(),r.readUByte(),r.readBits(4);var i=r.readBits(3);r.readBoolean();for(var n=r.readBits(2),o=r.readBoolean(),l=r.readBits(5),u=r.readUByte(),d=r.readUByte(),h=r.readUByte(),c=r.readUByte(),f=r.readUByte(),g=r.readUByte(),v=r.readUByte(),m=r.readUByte(),y=r.readUByte(),E=r.readUByte(),T=r.readUByte(),S=[],I=[],L=0;L<i;L++)S.push(r.readBoolean()),I.push(r.readBoolean());if(i>0)for(var A=i;A<8;A++)r.readBits(2);for(var b=0;b<i;b++)S[b]&&(r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte(),r.readUByte()),I[b]&&r.readUByte();r.readUEG();var R=r.readUEG();R==3&&r.skipBits(1);var k=r.readUEG(),_=r.readUEG(),C=r.readBoolean(),x=0,w=0,P=0,M=0;C&&(x+=r.readUEG(),w+=r.readUEG(),P+=r.readUEG(),M+=r.readUEG());for(var F=r.readUEG(),U=r.readUEG(),G=r.readUEG(),N=r.readBoolean()?0:i;N<=i;N++)r.skipUEG(),r.skipUEG(),r.skipUEG();if(r.skipUEG(),r.skipUEG(),r.skipUEG(),r.skipUEG(),r.skipUEG(),r.skipUEG(),r.readBoolean()&&r.readBoolean())for(var H=0;H<4;H++)for(var j=0;j<(H===3?2:6);j++)if(r.readBoolean()){var et=Math.min(64,1<<4+(H<<1));H>1&&r.readEG();for(var X=0;X<et;X++)r.readEG()}else r.readUEG();r.readBoolean(),r.readBoolean(),r.readBoolean()&&(r.readUByte(),r.skipUEG(),r.skipUEG(),r.readBoolean());for(var ht=r.readUEG(),rt=0,q=0;q<ht;q++){var Et=!1;if(q!==0&&(Et=r.readBoolean()),Et){q===ht&&r.readUEG(),r.readBoolean(),r.readUEG();for(var nt=0,$=0;$<=rt;$++){var Y=r.readBoolean(),lt=!1;Y||(lt=r.readBoolean()),(Y||lt)&&nt++}rt=nt}else{var St=r.readUEG(),yt=r.readUEG();rt=St+yt;for(var Q=0;Q<St;Q++)r.readUEG(),r.readBoolean();for(var vt=0;vt<yt;vt++)r.readUEG(),r.readBoolean()}}if(r.readBoolean())for(var At=r.readUEG(),z=0;z<At;z++){for(var _t=0;_t<G+4;_t++)r.readBits(1);r.readBits(1)}var it=0,mt=1,ft=1,bt=!0,It=1,Pt=0;r.readBoolean(),r.readBoolean();var Ct=!1;if(r.readBoolean()){if(r.readBoolean()){var Ut=r.readUByte();Ut>0&&Ut<16?(mt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][Ut-1],ft=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][Ut-1]):Ut===255&&(mt=r.readBits(16),ft=r.readBits(16))}if(r.readBoolean()&&r.readBoolean(),r.readBoolean()&&(r.readBits(3),r.readBoolean(),r.readBoolean()&&(r.readUByte(),r.readUByte(),r.readUByte())),r.readBoolean()&&(r.readUEG(),r.readUEG()),r.readBoolean(),r.readBoolean(),r.readBoolean(),(Ct=r.readBoolean())&&(x+=r.readUEG(),w+=r.readUEG(),P+=r.readUEG(),M+=r.readUEG()),r.readBoolean()&&(It=r.readBits(32),Pt=r.readBits(32),r.readBoolean()&&r.readUEG(),r.readBoolean())){var jt=r.readBoolean(),ge=r.readBoolean(),Bt=!1;(jt||ge)&&((Bt=r.readBoolean())&&(r.readUByte(),r.readBits(5),r.readBoolean(),r.readBits(5)),r.readBits(4),r.readBits(4),Bt&&r.readBits(4),r.readBits(5),r.readBits(5),r.readBits(5));for(var Ot=0;Ot<=i;Ot++){var Rt=!1;(bt=r.readBoolean())||r.readBoolean()?r.readEG():Rt=r.readBoolean();var qt=Rt?1:r.readUEG()+1;if(jt)for(var Xt=0;Xt<qt;Xt++)r.readUEG(),r.readUEG(),Bt&&(r.readUEG(),r.readUEG()),r.skipBits(1);if(ge)for(var He=0;He<qt;He++)r.readUEG(),r.readUEG(),Bt&&(r.readUEG(),r.readUEG()),r.skipBits(1)}}r.readBoolean()&&(r.readBoolean(),r.readBoolean(),r.readBoolean(),it=r.readUEG())}var ct=k,Tt=_;if(C||Ct){var gt=1,ae=1;R===1?gt=ae=2:R==2&&(gt=2),ct=k-gt*w-gt*x,Tt=_-ae*M-ae*P}for(var ln=n?["A","B","C"][n]:"",un=u<<24|d<<16|h<<8|c,dn=0,Vr=0;Vr<32;Vr++)dn=(dn|(un>>Vr&1)<<31-Vr)>>>0;var hn=dn.toString(16);return l===1&&hn==="2"&&(hn="6"),{codecString:"hvc1."+ln+l+"."+hn+"."+(o?"H":"L")+T+".B0",params:{general_tier_flag:o,general_profile_idc:l,general_profile_space:n,general_profile_compatibility_flags:[u,d,h,c],general_constraint_indicator_flags:[f,g,v,m,y,E],general_level_idc:T,bit_depth:F+8,bit_depth_luma_minus8:F,bit_depth_chroma_minus8:U,min_spatial_segmentation_idc:it,chroma_format_idc:R,frame_rate:{fixed:bt,fps:Pt/It}},width:ct,height:Tt,pixelRatio:[mt,ft]}},e.readPPS=function(t){var r=new er(this.ebsp2rbsp(t));r.readUByte(),r.readUByte(),r.skipUEG(),r.skipUEG(),r.skipBits(2),r.skipBits(3),r.skipBits(2),r.skipUEG(),r.skipUEG(),r.skipEG(),r.skipBits(2),r.readBoolean()&&r.skipUEG(),r.skipEG(),r.skipEG(),r.skipBits(4);var i=r.readBoolean(),n=r.readBoolean(),o=1;return n&&i?o=0:n?o=3:i&&(o=2),{parallelismType:o}},e.matchSPS=function(t,r){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,r).substr(3)},a}(is),xt=188,vl=function(){function s(e,t,r,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.videoParser=null}s.probe=function(e,t){var r=s.syncOffset(e);return r>0&&t.warn("MPEG2-TS detected but first sync word found @ offset "+r),r!==-1},s.syncOffset=function(e){for(var t=e.length,r=Math.min(940,t-xt)+1,i=0;i<r;){for(var n=!1,o=-1,l=0,u=i;u<t;u+=xt){if(e[u]!==71||t-u!==xt&&e[u+xt]!==71){if(l)return-1;break}if(l++,o===-1&&(o=u)!==0&&(r=Math.min(o+18612,e.length-xt)+1),n||(n=Pi(e,u)===0),n&&l>1&&(o===0&&l>2||u+xt>r))return o}i++}return-1},s.createTrack=function(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:kn[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}};var a=s.prototype;return a.resetInitSegment=function(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=s.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=s.createTrack("audio",i),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r},a.resetTimeStamp=function(){},a.resetContiguity=function(){var e=this._audioTrack,t=this._videoTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null},a.demux=function(e,t,r,i){var n;r===void 0&&(r=!1),i===void 0&&(i=!1),r||(this.sampleAes=null);var o=this._videoTrack,l=this._audioTrack,u=this._id3Track,d=this._txtTrack,h=o.pid,c=o.pesData,f=l.pid,g=u.pid,v=l.pesData,m=u.pesData,y=null,E=this.pmtParsed,T=this._pmtId,S=e.length;if(this.remainderData&&(S=(e=Vt(this.remainderData,e)).length,this.remainderData=null),S<xt&&!i)return this.remainderData=e,{audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};var I=Math.max(0,s.syncOffset(e));(S-=(S-I)%xt)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,S,e.buffer.byteLength-S));for(var L=0,A=I;A<S;A+=xt)if(e[A]===71){var b=!!(64&e[A+1]),R=Pi(e,A),k=void 0;if((48&e[A+3])>>4>1){if((k=A+5+e[A+4])===A+xt)continue}else k=A+4;switch(R){case h:if(b){if(c&&(n=Fe(c,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new ns;break;case"hevc":this.videoParser=new as}this.videoParser!==null&&this.videoParser.parsePES(o,d,n,!1)}c={data:[],size:0}}c&&(c.data.push(e.subarray(k,A+xt)),c.size+=A+xt-k);break;case f:if(b){if(v&&(n=Fe(v,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,n);break;case"mp3":this.parseMPEGPES(l,n);break;case"ac3":this.parseAC3PES(l,n)}v={data:[],size:0}}v&&(v.data.push(e.subarray(k,A+xt)),v.size+=A+xt-k);break;case g:b&&(m&&(n=Fe(m,this.logger))&&this.parseID3PES(u,n),m={data:[],size:0}),m&&(m.data.push(e.subarray(k,A+xt)),m.size+=A+xt-k);break;case 0:b&&(k+=e[k]+1),T=this._pmtId=ml(e,k);break;case T:b&&(k+=e[k]+1);var _=pl(e,k,this.typeSupported,r,this.observer,this.logger);(h=_.videoPid)>0&&(o.pid=h,o.segmentCodec=_.segmentVideoCodec),(f=_.audioPid)>0&&(l.pid=f,l.segmentCodec=_.segmentAudioCodec),(g=_.id3Pid)>0&&(u.pid=g),y===null||E||(this.logger.warn("MPEG-TS PMT found at "+A+" after unknown PID '"+y+"'. Backtracking to sync byte @"+I+" to parse all TS packets."),y=null,A=I-188),E=this.pmtParsed=!0;break;case 17:case 8191:break;default:y=R}}else L++;L>0&&Ci(this.observer,new Error("Found "+L+" TS packet/s that do not start with 0x47"),void 0,this.logger),o.pesData=c,l.pesData=v,u.pesData=m;var C={audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};return i&&this.extractRemainingSamples(C),C},a.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},a.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.videoTrack,n=e.id3Track,o=e.textTrack,l=i.pesData,u=r.pesData,d=n.pesData;if(l&&(t=Fe(l,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new ns;break;case"hevc":this.videoParser=new as}this.videoParser!==null&&(this.videoParser.parsePES(i,o,t,!0),i.pesData=null)}else i.pesData=l;if(u&&(t=Fe(u,this.logger))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t);break;case"ac3":this.parseAC3PES(r,t)}r.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=u;d&&(t=Fe(d,this.logger))?(this.parseID3PES(n,t),n.pesData=null):n.pesData=d},a.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new gl(this.observer,this.config,t);return this.decrypt(i,n)},a.decrypt=function(e,t){return new Promise(function(r){var i=e.audioTrack,n=e.videoTrack;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,function(){n.samples?t.decryptAvcSamples(n.samples,0,0,function(){r(e)}):r(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,function(){r(e)})})},a.destroy=function(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0},a.parseAACPES=function(e,t){var r,i,n,o=0,l=this.aacOverFlow,u=t.data;if(l){this.aacOverFlow=null;var d=l.missing,h=l.sample.unit.byteLength;if(d===-1)u=Vt(l.sample.unit,u);else{var c=h-d;l.sample.unit.set(u.subarray(0,d),c),e.samples.push(l.sample),o=l.missing}}for(r=o,i=u.length;r<i-1&&!Pr(u,r);r++);if(r!==o){var f,g=r<i-1;if(f=g?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES",Ci(this.observer,new Error(f),g,this.logger),!g)return}if(Ya(e,this.observer,u,r,this.audioCodec),t.pts!==void 0)n=t.pts;else{if(!l)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var v=Wa(e.samplerate);n=l.sample.pts+v}for(var m,y=0;r<i;){if(r+=(m=ja(e,u,r,n,y)).length,m.missing){this.aacOverFlow=m;break}for(y++;r<i-1&&!Pr(u,r);r++);}},a.parseMPEGPES=function(e,t){var r=t.data,i=r.length,n=0,o=0,l=t.pts;if(l!==void 0)for(;o<i;)if(Ja(r,o)){var u=Qa(e,r,o,l,n);if(!u)break;o+=u.length,n++}else o++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},a.parseAC3PES=function(e,t){var r=t.data,i=t.pts;if(i!==void 0)for(var n,o=r.length,l=0,u=0;u<o&&(n=es(e,r,u,i,l++))>0;)u+=n;else this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS")},a.parseID3PES=function(e,t){if(t.pts!==void 0){var r=ot({},t,{type:this._videoTrack?Kt.emsg:Kt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},s}();function Pi(s,a){return((31&s[a+1])<<8)+s[a+2]}function ml(s,a){return(31&s[a+10])<<8|s[a+11]}function pl(s,a,e,t,r,i){var n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=a+3+((15&s[a+1])<<8|s[a+2])-4;for(a+=12+((15&s[a+10])<<8|s[a+11]);a<o;){var l=Pi(s,a),u=(15&s[a+3])<<8|s[a+4];switch(s[a]){case 207:if(!t){wi("ADTS AAC",i);break}case 15:n.audioPid===-1&&(n.audioPid=l);break;case 21:n.id3Pid===-1&&(n.id3Pid=l);break;case 219:if(!t){wi("H.264",i);break}case 27:n.videoPid===-1&&(n.videoPid=l);break;case 3:case 4:e.mpeg||e.mp3?n.audioPid===-1&&(n.audioPid=l,n.segmentAudioCodec="mp3"):i.log("MPEG audio found, not supported in this browser");break;case 193:if(!t){wi("AC-3",i);break}case 129:e.ac3?n.audioPid===-1&&(n.audioPid=l,n.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(n.audioPid===-1&&u>0)for(var d=a+5,h=u;h>2;){s[d]===106&&(e.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=l,n.segmentAudioCodec="ac3"));var c=s[d+1]+2;d+=c,h-=c}break;case 194:case 135:return Ci(r,new Error("Unsupported EC-3 in M2TS found"),void 0,i),n;case 36:n.videoPid===-1&&(n.videoPid=l,n.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"))}a+=u+5}return n}function Ci(s,a,e,t){t.warn("parsing error: "+a.message),s.emit(p.ERROR,p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:a,reason:a.message})}function wi(s,a){a.log(s+" with AES-128-CBC encryption found in unencrypted stream")}function Fe(s,a){var e,t,r,i,n,o=0,l=s.data;if(!s||s.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=Vt(l[0],l[1]),l.splice(1,1);if(((e=l[0])[0]<<16)+(e[1]<<8)+e[2]===1){if((t=(e[4]<<8)+e[5])&&t>s.size-6)return null;var u=e[7];192&u&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&u?i-(n=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(a.warn(Math.round((i-n)/9e4)+"s delta between PTS and DTS, align them"),i=n):n=i);var d=(r=e[8])+9;if(s.size<=d)return null;s.size-=d;for(var h=new Uint8Array(s.size),c=0,f=l.length;c<f;c++){var g=(e=l[c]).byteLength;if(d){if(d>g){d-=g;continue}e=e.subarray(d),g-=d,d=0}h.set(e,o),o+=g}return t&&(t-=r+3),{data:h,pts:i,dts:n,len:t}}return null}var yl=function(){function s(){}return s.getSilentFrame=function(a,e){if(a==="mp4a.40.2"){if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},s}(),Te=Math.pow(2,32)-1,wt=function(){function s(){}return s.init=function(){var a;for(a in s.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},s.types)s.types.hasOwnProperty(a)&&(s.types[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);s.HDLR_TYPES={video:e,audio:t};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);s.STTS=s.STSC=s.STCO=i,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var n=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);s.FTYP=s.box(s.types.ftyp,n,l,n,o),s.DINF=s.box(s.types.dinf,s.box(s.types.dref,r))},s.box=function(a){for(var e=8,t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var n=r.length,o=n;n--;)e+=r[n].byteLength;var l=new Uint8Array(e);for(l[0]=e>>24&255,l[1]=e>>16&255,l[2]=e>>8&255,l[3]=255&e,l.set(a,4),n=0,e=8;n<o;n++)l.set(r[n],e),e+=r[n].byteLength;return l},s.hdlr=function(a){return s.box(s.types.hdlr,s.HDLR_TYPES[a])},s.mdat=function(a){return s.box(s.types.mdat,a)},s.mdhd=function(a,e){e*=a;var t=Math.floor(e/(Te+1)),r=Math.floor(e%(Te+1));return s.box(s.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,255&a,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},s.mdia=function(a){return s.box(s.types.mdia,s.mdhd(a.timescale||0,a.duration||0),s.hdlr(a.type),s.minf(a))},s.mfhd=function(a){return s.box(s.types.mfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a]))},s.minf=function(a){return a.type==="audio"?s.box(s.types.minf,s.box(s.types.smhd,s.SMHD),s.DINF,s.stbl(a)):s.box(s.types.minf,s.box(s.types.vmhd,s.VMHD),s.DINF,s.stbl(a))},s.moof=function(a,e,t){return s.box(s.types.moof,s.mfhd(a),s.traf(t,e))},s.moov=function(a){for(var e=a.length,t=[];e--;)t[e]=s.trak(a[e]);return s.box.apply(null,[s.types.moov,s.mvhd(a[0].timescale||0,a[0].duration||0)].concat(t).concat(s.mvex(a)))},s.mvex=function(a){for(var e=a.length,t=[];e--;)t[e]=s.trex(a[e]);return s.box.apply(null,[s.types.mvex].concat(t))},s.mvhd=function(a,e){e*=a;var t=Math.floor(e/(Te+1)),r=Math.floor(e%(Te+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,255&a,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.box(s.types.mvhd,i)},s.sdtp=function(a){var e,t,r=a.samples||[],i=new Uint8Array(4+r.length);for(e=0;e<r.length;e++)t=r[e].flags,i[e+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return s.box(s.types.sdtp,i)},s.stbl=function(a){return s.box(s.types.stbl,s.stsd(a),s.box(s.types.stts,s.STTS),s.box(s.types.stsc,s.STSC),s.box(s.types.stsz,s.STSZ),s.box(s.types.stco,s.STCO))},s.avc1=function(a){var e,t,r,i=[],n=[];for(e=0;e<a.sps.length;e++)r=(t=a.sps[e]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(t));for(e=0;e<a.pps.length;e++)r=(t=a.pps[e]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(t));var o=s.box(s.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|a.sps.length].concat(i).concat([a.pps.length]).concat(n))),l=a.width,u=a.height,d=a.pixelRatio[0],h=a.pixelRatio[1];return s.box(s.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))},s.esds=function(a){var e=a.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2].concat(e,[6,1,2]))},s.audioStsd=function(a){var e=a.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount||0,0,16,0,0,0,0,e>>8&255,255&e,0,0])},s.mp4a=function(a){return s.box(s.types.mp4a,s.audioStsd(a),s.box(s.types.esds,s.esds(a)))},s.mp3=function(a){return s.box(s.types[".mp3"],s.audioStsd(a))},s.ac3=function(a){return s.box(s.types["ac-3"],s.audioStsd(a),s.box(s.types.dac3,a.config))},s.stsd=function(a){var e=a.segmentCodec;if(a.type==="audio"){if(e==="aac")return s.box(s.types.stsd,s.STSD,s.mp4a(a));if(e==="ac3"&&a.config)return s.box(s.types.stsd,s.STSD,s.ac3(a));if(e==="mp3"&&a.codec==="mp3")return s.box(s.types.stsd,s.STSD,s.mp3(a))}else{if(!a.pps||!a.sps)throw new Error("video track missing pps or sps");if(e==="avc")return s.box(s.types.stsd,s.STSD,s.avc1(a));if(e==="hevc"&&a.vps)return s.box(s.types.stsd,s.STSD,s.hvc1(a))}throw new Error("unsupported "+a.type+" segment codec ("+e+"/"+a.codec+")")},s.tkhd=function(a){var e=a.id,t=(a.duration||0)*(a.timescale||0),r=a.width||0,i=a.height||0,n=Math.floor(t/(Te+1)),o=Math.floor(t%(Te+1));return s.box(s.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))},s.traf=function(a,e){var t=s.sdtp(a),r=a.id,i=Math.floor(e/(Te+1)),n=Math.floor(e%(Te+1));return s.box(s.types.traf,s.box(s.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),s.box(s.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n])),s.trun(a,t.length+16+20+8+16+8+8),t)},s.trak=function(a){return a.duration=a.duration||4294967295,s.box(s.types.trak,s.tkhd(a),s.mdia(a))},s.trex=function(a){var e=a.id;return s.box(s.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},s.trun=function(a,e){var t,r,i,n,o,l,u=a.samples||[],d=u.length,h=12+16*d,c=new Uint8Array(h);for(e+=8+h,c.set([a.type==="video"?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),t=0;t<d;t++)i=(r=u[t]).duration,n=r.size,o=r.flags,l=r.cts,c.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*t);return s.box(s.types.trun,c)},s.initSegment=function(a){s.types||s.init();var e=s.moov(a);return Vt(s.FTYP,e)},s.hvc1=function(a){for(var e=a.params,t=[a.vps,a.sps,a.pps],r=new Uint8Array([1,e.general_profile_space<<6|(e.general_tier_flag?32:0)|e.general_profile_idc,e.general_profile_compatibility_flags[0],e.general_profile_compatibility_flags[1],e.general_profile_compatibility_flags[2],e.general_profile_compatibility_flags[3],e.general_constraint_indicator_flags[0],e.general_constraint_indicator_flags[1],e.general_constraint_indicator_flags[2],e.general_constraint_indicator_flags[3],e.general_constraint_indicator_flags[4],e.general_constraint_indicator_flags[5],e.general_level_idc,240|e.min_spatial_segmentation_idc>>8,255&e.min_spatial_segmentation_idc,252|e.parallelismType,252|e.chroma_format_idc,248|e.bit_depth_luma_minus8,248|e.bit_depth_chroma_minus8,0,parseInt(e.frame_rate.fps),3|e.temporal_id_nested<<2|e.num_temporal_layers<<3|(e.frame_rate.fixed?64:0),t.length]),i=r.length,n=0;n<t.length;n+=1){i+=3;for(var o=0;o<t[n].length;o+=1)i+=2+t[n][o].length}var l=new Uint8Array(i);l.set(r,0),i=r.length;for(var u=t.length-1,d=0;d<t.length;d+=1){l.set(new Uint8Array([32+d|(d===u?128:0),0,t[d].length]),i),i+=3;for(var h=0;h<t[d].length;h+=1)l.set(new Uint8Array([t[d][h].length>>8,255&t[d][h].length]),i),i+=2,l.set(t[d][h],i),i+=t[d][h].length}var c=s.box(s.types.hvcC,l),f=a.width,g=a.height,v=a.pixelRatio[0],m=a.pixelRatio[1];return s.box(s.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,255&f,g>>8&255,255&g,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,255&v,m>>24,m>>16&255,m>>8&255,255&m])))},s}();wt.types=void 0,wt.HDLR_TYPES=void 0,wt.STTS=void 0,wt.STSC=void 0,wt.STCO=void 0,wt.STSZ=void 0,wt.VMHD=void 0,wt.SMHD=void 0,wt.STSD=void 0,wt.FTYP=void 0,wt.DINF=void 0;var ss=9e4;function xi(s,a,e,t){e===void 0&&(e=1),t===void 0&&(t=!1);var r=s*a*e;return t?Math.round(r):r}function rr(s,a){return xi(s,1e3,1/ss,a)}var Ne=null,Oi=null;function os(s,a,e,t){return{duration:a,size:e,cts:t,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}}}var xr=function(){function s(e,t,r,i){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=i,this.ISGenerated=!1,Ne===null){var n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ne=n?parseInt(n[1]):0}if(Oi===null){var o=navigator.userAgent.match(/Safari\/(\d+)/i);Oi=o?parseInt(o[1]):0}}var a=s.prototype;return a.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},a.resetTimeStamp=function(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},a.resetNextTimestamp=function(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},a.getVideoStartPts=function(e){var t=!1,r=e[0].pts,i=e.reduce(function(n,o){var l=o.pts,u=l-n;return u<-4294967296&&(t=!0,u=(l=Yt(l,r))-n),u>0?n:l},r);return t&&this.logger.debug("PTS rollover detected"),i},a.remux=function(e,t,r,i,n,o,l,u){var d,h,c,f,g,v,m=n,y=n,E=e.pid>-1,T=t.pid>-1,S=t.samples.length,I=e.samples.length>0,L=l&&S>0||S>1;if((!E||I)&&(!T||L)||this.ISGenerated||l){if(this.ISGenerated){var A,b,R,k,_=this.videoTrackConfig;(_&&(t.width!==_.width||t.height!==_.height||((A=t.pixelRatio)==null?void 0:A[0])!==((b=_.pixelRatio)==null?void 0:b[0])||((R=t.pixelRatio)==null?void 0:R[1])!==((k=_.pixelRatio)==null?void 0:k[1]))||!_&&L||this.nextAudioPts===null&&I)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(e,t,n,o));var C,x=this.isVideoContiguous,w=-1;if(L&&(w=function(G){for(var N=0;N<G.length;N++)if(G[N].key)return N;return-1}(t.samples),!x&&this.config.forceKeyFrameOnDiscontinuity))if(v=!0,w>0){this.logger.warn("[mp4-remuxer]: Dropped "+w+" out of "+S+" video samples due to a missing keyframe");var P=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(w),t.dropped+=w,C=y+=(t.samples[0].pts-P)/t.inputTimeScale}else w===-1&&(this.logger.warn("[mp4-remuxer]: No keyframe found out of "+S+" video samples"),v=!1);if(this.ISGenerated){if(I&&L){var M=this.getVideoStartPts(t.samples),F=(Yt(e.samples[0].pts,M)-M)/t.inputTimeScale;m+=Math.max(0,F),y+=Math.max(0,-F)}if(I){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,n,o)),h=this.remuxAudio(e,m,this.isAudioContiguous,o,T||L||u===Mt?y:void 0),L){var U=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,n,o)),d=this.remuxVideo(t,y,x,U)}}else L&&(d=this.remuxVideo(t,y,x,0));d&&(d.firstKeyFrame=w,d.independent=w!==-1,d.firstKeyFramePTS=C)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(g=ls(r,n,this._initPTS,this._initDTS)),i.samples.length&&(f=us(i,n,this._initPTS))),{audio:h,video:d,initSegment:c,independent:v,text:f,id3:g}},a.generateIS=function(e,t,r,i){var n,o,l,u=e.samples,d=t.samples,h=this.typeSupported,c={},f=this._initPTS,g=!f||i,v="audio/mp4";if(g&&(n=o=1/0),e.config&&u.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":h.mpeg?(v="audio/mpeg",e.codec=""):h.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}c.audio={id:"audio",container:v,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&h.mpeg?new Uint8Array(0):wt.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(l=e.inputTimeScale,f&&l===f.timescale?g=!1:n=o=u[0].pts-Math.round(l*r))}if(t.sps&&t.pps&&d.length){if(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:wt.initSegment([t]),metadata:{width:t.width,height:t.height}},g)if(l=t.inputTimeScale,f&&l===f.timescale)g=!1;else{var m=this.getVideoStartPts(d),y=Math.round(l*r);o=Math.min(o,Yt(d[0].dts,m)-y),n=Math.min(n,m-y)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(c).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:n,timescale:l},this._initDTS={baseTime:o,timescale:l}):n=l=void 0,{tracks:c,initPTS:n,timescale:l}},a.remuxVideo=function(e,t,r,i){var n,o,l=e.inputTimeScale,u=e.samples,d=[],h=u.length,c=this._initPTS,f=this.nextAvcDts,g=8,v=this.videoSampleDuration,m=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,E=!1;if(!r||f===null){var T=t*l,S=u[0].pts-Yt(u[0].dts,u[0].pts);Ne&&f!==null&&Math.abs(T-S-f)<15e3?r=!0:f=T-S}for(var I=c.baseTime*l/c.timescale,L=0;L<h;L++){var A=u[L];A.pts=Yt(A.pts-I,f),A.dts=Yt(A.dts-I,f),A.dts<u[L>0?L-1:L].dts&&(E=!0)}E&&u.sort(function(gt,ae){var ln=gt.dts-ae.dts,un=gt.pts-ae.pts;return ln||un}),n=u[0].dts;var b=(o=u[u.length-1].dts)-n,R=b?Math.round(b/(h-1)):v||e.inputTimeScale/30;if(r){var k=n-f,_=k>R,C=k<-1;if((_||C)&&(_?this.logger.warn((e.segmentCodec||"").toUpperCase()+": "+rr(k,!0)+" ms ("+k+"dts) hole between fragments detected at "+t.toFixed(3)):this.logger.warn((e.segmentCodec||"").toUpperCase()+": "+rr(-k,!0)+" ms ("+k+"dts) overlapping between fragments detected at "+t.toFixed(3)),!C||f>=u[0].pts||Ne)){n=f;var x=u[0].pts-k;if(_)u[0].dts=n,u[0].pts=x;else for(var w=!0,P=0;P<u.length&&!(u[P].dts>x&&w);P++){var M=u[P].pts;if(u[P].dts-=k,u[P].pts-=k,P<u.length-1){var F=u[P+1].pts;w=F<=u[P].pts==F<=M}}this.logger.log("Video: Initial PTS/DTS adjusted: "+rr(x,!0)+"/"+rr(n,!0)+", delta: "+rr(k,!0)+" ms")}}for(var U=0,G=0,N=n=Math.max(0,n),H=0;H<h;H++){for(var j=u[H],et=j.units,X=et.length,ht=0,rt=0;rt<X;rt++)ht+=et[rt].data.length;G+=ht,U+=X,j.length=ht,j.dts<N?(j.dts=N,N+=R/4|0||1):N=j.dts,m=Math.min(j.pts,m),y=Math.max(j.pts,y)}o=u[h-1].dts;var q,Et=G+4*U+8;try{q=new Uint8Array(Et)}catch(gt){return void this.observer.emit(p.ERROR,p.ERROR,{type:K.MUX_ERROR,details:D.REMUX_ALLOC_ERROR,fatal:!1,error:gt,bytes:Et,reason:"fail allocating video mdat "+Et})}var nt=new DataView(q.buffer);nt.setUint32(0,Et),q.set(wt.types.mdat,4);for(var $=!1,Y=Number.POSITIVE_INFINITY,lt=Number.POSITIVE_INFINITY,St=Number.NEGATIVE_INFINITY,yt=Number.NEGATIVE_INFINITY,Q=0;Q<h;Q++){for(var vt=u[Q],At=vt.units,z=0,_t=0,it=At.length;_t<it;_t++){var mt=At[_t],ft=mt.data,bt=mt.data.byteLength;nt.setUint32(g,bt),g+=4,q.set(ft,g),g+=bt,z+=4+bt}var It=void 0;if(Q<h-1)v=u[Q+1].dts-vt.dts,It=u[Q+1].pts-vt.pts;else{var Pt=this.config,Ct=Q>0?vt.dts-u[Q-1].dts:R;if(It=Q>0?vt.pts-u[Q-1].pts:R,Pt.stretchShortVideoTrack&&this.nextAudioPts!==null){var Ut=Math.floor(Pt.maxBufferHole*l),jt=(i?m+i*l:this.nextAudioPts)-vt.pts;jt>Ut?((v=jt-Ct)<0?v=Ct:$=!0,this.logger.log("[mp4-remuxer]: It is approximately "+jt/90+" ms to the next segment; using duration "+v/90+" ms for the last video frame.")):v=Ct}else v=Ct}var ge=Math.round(vt.pts-vt.dts);Y=Math.min(Y,v),St=Math.max(St,v),lt=Math.min(lt,It),yt=Math.max(yt,It),d.push(os(vt.key,v,z,ge))}if(d.length){if(Ne){if(Ne<70){var Bt=d[0].flags;Bt.dependsOn=2,Bt.isNonSync=0}}else if(Oi&&yt-lt<St-Y&&R/St<.025&&d[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ot=n,Rt=0,qt=d.length;Rt<qt;Rt++){var Xt=Ot+d[Rt].duration,He=Ot+d[Rt].cts;if(Rt<qt-1){var ct=Xt+d[Rt+1].cts;d[Rt].duration=ct-He}else d[Rt].duration=Rt?d[Rt-1].duration:R;d[Rt].cts=0,Ot=Xt}}}v=$||!v?R:v,this.nextAvcDts=f=o+v,this.videoSampleDuration=v,this.isVideoContiguous=!0;var Tt={data1:wt.moof(e.sequenceNumber++,n,ot(e,{samples:d})),data2:q,startPTS:m/l,endPTS:(y+v)/l,startDTS:n/l,endDTS:f/l,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Tt},a.getSamplesPerFrame=function(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}},a.remuxAudio=function(e,t,r,i,n){var o=e.inputTimeScale,l=o/(e.samplerate?e.samplerate:o),u=this.getSamplesPerFrame(e),d=u*l,h=this._initPTS,c=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,f=[],g=n!==void 0,v=e.samples,m=c?0:8,y=this.nextAudioPts||-1,E=t*o,T=h.baseTime*o/h.timescale;if(this.isAudioContiguous=r=r||v.length&&y>0&&(i&&Math.abs(E-y)<9e3||Math.abs(Yt(v[0].pts-T,E)-y)<20*d),v.forEach(function(lt){lt.pts=Yt(lt.pts-T,E)}),!r||y<0){if(v=v.filter(function(lt){return lt.pts>=0}),!v.length)return;y=n===0?0:i&&!g?Math.max(0,E):v[0].pts}if(e.segmentCodec==="aac")for(var S=this.config.maxAudioFramesDrift,I=0,L=y;I<v.length;I++){var A=v[I],b=A.pts,R=b-L,k=Math.abs(1e3*R/o);if(R<=-S*d&&g)I===0&&(this.logger.warn("Audio frame @ "+(b/o).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*R/o)+" ms."),this.nextAudioPts=y=L=b);else if(R>=S*d&&k<1e4&&g){var _=Math.round(R/d);(L=b-_*d)<0&&(_--,L+=d),I===0&&(this.nextAudioPts=y=L),this.logger.warn("[mp4-remuxer]: Injecting "+_+" audio frame @ "+(L/o).toFixed(3)+"s due to "+Math.round(1e3*R/o)+" ms gap.");for(var C=0;C<_;C++){var x=Math.max(L,0),w=yl.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);w||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),w=A.unit.subarray()),v.splice(I,0,{unit:w,pts:x}),L+=d,I++}}A.pts=L,L+=d}for(var P,M=null,F=null,U=0,G=v.length;G--;)U+=v[G].unit.byteLength;for(var N=0,H=v.length;N<H;N++){var j=v[N],et=j.unit,X=j.pts;if(F!==null)f[N-1].duration=Math.round((X-F)/l);else{if(r&&e.segmentCodec==="aac"&&(X=y),M=X,!(U>0))return;U+=m;try{P=new Uint8Array(U)}catch(lt){return void this.observer.emit(p.ERROR,p.ERROR,{type:K.MUX_ERROR,details:D.REMUX_ALLOC_ERROR,fatal:!1,error:lt,bytes:U,reason:"fail allocating audio mdat "+U})}c||(new DataView(P.buffer).setUint32(0,U),P.set(wt.types.mdat,4))}P.set(et,m);var ht=et.byteLength;m+=ht,f.push(os(!0,u,ht,0)),F=X}var rt=f.length;if(rt){var q=f[f.length-1];this.nextAudioPts=y=F+l*q.duration;var Et=c?new Uint8Array(0):wt.moof(e.sequenceNumber++,M/l,ot({},e,{samples:f}));e.samples=[];var nt=M/o,$=y/o,Y={data1:Et,data2:P,startPTS:nt,endPTS:$,startDTS:nt,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:rt};return this.isAudioContiguous=!0,Y}},s}();function Yt(s,a){var e;if(a===null)return s;for(e=a<s?-8589934592:8589934592;Math.abs(s-a)>4294967296;)s+=e;return s}function ls(s,a,e,t){var r=s.samples.length;if(r){for(var i=s.inputTimeScale,n=0;n<r;n++){var o=s.samples[n];o.pts=Yt(o.pts-e.baseTime*i/e.timescale,a*i)/i,o.dts=Yt(o.dts-t.baseTime*i/t.timescale,a*i)/i}var l=s.samples;return s.samples=[],{samples:l}}}function us(s,a,e){var t=s.samples.length;if(t){for(var r=s.inputTimeScale,i=0;i<t;i++){var n=s.samples[i];n.pts=Yt(n.pts-e.baseTime*r/e.timescale,a*r)/r}s.samples.sort(function(l,u){return l.pts-u.pts});var o=s.samples;return s.samples=[],{samples:o}}}var he,El=function(){function s(e,t,r,i){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=i}var a=s.prototype;return a.destroy=function(){},a.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},a.resetNextTimestamp=function(){this.lastEndTime=null},a.resetInitSegment=function(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(function(n,o){if(!n||!o)return n;var l=o.keyId;return l&&o.isCommonEncryption&&W(n,["moov","trak"]).forEach(function(u){var d=W(u,["mdia","minf","stbl","stsd"])[0].subarray(8),h=W(d,["enca"]),c=h.length>0;c||(h=W(d,["encv"])),h.forEach(function(f){W(c?f.subarray(28):f.subarray(78),["sinf"]).forEach(function(g){var v=Cn(g);if(v){var m=v.subarray(8,24);m.some(function(y){return y!==0})||(Z.log("[eme] Patching keyId in 'enc"+(c?"a":"v")+">sinf>>tenc' box: "+Jt.hexDump(m)+" -> "+Jt.hexDump(l)),v.set(l,8))}})})}),n}(e,i)),this.emitInitSegment=!0},a.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(e==null||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=Pn(e);i.audio&&(t=ds(i.audio,Ft)),i.video&&(r=ds(i.video,Ht));var n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:t+","+r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,supplemental:i.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},a.remux=function(e,t,r,i,n,o){var l,u,d=this.initPTS,h=this.lastEndTime,c={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};B(h)||(h=this.lastEndTime=n||0);var f=t.samples;if(f==null||!f.length)return c;var g={initPTS:void 0,timescale:1},v=this.initData;if((l=v)!=null&&l.length||(this.generateInitSegment(f),v=this.initData),(u=v)==null||!u.length)return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);var m=function(R,k){for(var _=0,C=0,x=0,w=W(R,["moof","traf"]),P=0;P<w.length;P++){var M=w[P],F=W(M,["tfhd"])[0],U=k[V(F,4)];if(U){var G=U.default,N=V(F,0)|(G==null?void 0:G.flags),H=G==null?void 0:G.duration;8&N&&(H=V(F,2&N?12:8));for(var j=U.timescale||9e4,et=W(M,["trun"]),X=0;X<et.length;X++)!(_=Eo(et[X]))&&H&&(_=H*V(et[X],4)),U.type===Ht?C+=_/j:U.type===Ft&&(x+=_/j)}}if(C===0&&x===0){for(var ht=1/0,rt=0,q=0,Et=W(R,["sidx"]),nt=0;nt<Et.length;nt++){var $=po(Et[nt]);if($!=null&&$.references){ht=Math.min(ht,$.earliestPresentationTime/$.timescale);var Y=$.references.reduce(function(lt,St){return lt+St.info.duration||0},0);q=(rt=Math.max(rt,Y+$.earliestPresentationTime/$.timescale))-ht}}if(q&&B(q))return q}return C||x}(f,v),y=function(R,k){return W(k,["moof","traf"]).reduce(function(_,C){var x=W(C,["tfdt"])[0],w=x[0],P=W(C,["tfhd"]).reduce(function(M,F){var U=V(F,4),G=R[U];if(G){var N=V(x,4);if(w===1){if(N===ur)return Z.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),M;N*=ur+1,N+=V(x,8)}var H=N/(G.timescale||9e4);if(B(H)&&(M===null||H<M))return H}return M},null);return P!==null&&B(P)&&(_===null||P<_)?P:_},null)}(v,f),E=y===null?n:y;!o&&d||!function(R,k,_,C){if(R===null)return!0;var x=Math.max(C,1),w=k-R.baseTime/R.timescale;return Math.abs(w-_)>x}(d,E,n,m)&&g.timescale===d.timescale||(g.initPTS=E-n,d&&d.timescale===1&&this.logger.warn("Adjusting initPTS @"+n+" from "+d.baseTime/d.timescale+" to "+g.initPTS),this.initPTS=d={baseTime:g.initPTS,timescale:1});var T=e?E-d.baseTime/d.timescale:h,S=T+m;(function(R,k,_){W(k,["moof","traf"]).forEach(function(C){W(C,["tfhd"]).forEach(function(x){var w=V(x,4),P=R[w];if(P){var M=P.timescale||9e4;W(C,["tfdt"]).forEach(function(F){var U=F[0],G=_*M;if(G){var N=V(F,4);if(U===0)N-=G,Jr(F,4,N=Math.max(N,0));else{N*=Math.pow(2,32),N+=V(F,8),N-=G,N=Math.max(N,0);var H=Math.floor(N/(ur+1)),j=Math.floor(N%(ur+1));Jr(F,4,H),Jr(F,8,j)}}})}})})})(v,f,d.baseTime/d.timescale),m>0?this.lastEndTime=S:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var I=!!v.audio,L=!!v.video,A="";I&&(A+="audio"),L&&(A+="video");var b={data1:f,startPTS:T,startDTS:T,endPTS:S,endDTS:S,type:A,hasAudio:I,hasVideo:L,nb:1,dropped:0};return c.audio=b.type==="audio"?b:void 0,c.video=b.type!=="audio"?b:void 0,c.initSegment=g,c.id3=ls(r,n,d,d),i.samples.length&&(c.text=us(i,n,d)),c},s}();function ds(s,a){var e=s==null?void 0:s.codec;return e&&e.length>4?e:a===Ft?e==="ec-3"||e==="ac-3"||e==="alac"?e:e==="fLaC"||e==="Opus"?gr(e,!1):(Z.warn('Unhandled audio codec "'+e+'" in mp4 MAP'),e||"mp4a"):(Z.warn('Unhandled video codec "'+e+'" in mp4 MAP'),e||"avc1")}try{he=self.performance.now.bind(self.performance)}catch{he=Date.now}var Or=[{demux:cl,remux:El},{demux:vl,remux:xr},{demux:ul,remux:xr},{demux:hl,remux:xr}];Or.splice(2,0,{demux:dl,remux:xr});var Mi=function(){function s(e,t,r,i,n,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=n,this.logger=o}var a=s.prototype;return a.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},a.push=function(e,t,r,i){var n=this,o=r.transmuxing;o.executeStart=he();var l=new Uint8Array(e),u=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=i||u,c=h.contiguous,f=h.discontinuity,g=h.trackSwitch,v=h.accurateTimeOffset,m=h.timeOffset,y=h.initSegmentChange,E=d.audioCodec,T=d.videoCodec,S=d.defaultInitPts,I=d.duration,L=d.initSegmentData,A=function(M,F){var U=null;return M.byteLength>0&&(F==null?void 0:F.key)!=null&&F.iv!==null&&F.method!=null&&(U=F),U}(l,t);if(A&&Me(A.method)){var b=this.getDecrypter(),R=di(A.method);if(!b.isSync())return this.asyncResult=!0,this.decryptionPromise=b.webCryptoDecrypt(l,A.key.buffer,A.iv.buffer,R).then(function(M){var F=n.push(M,null,r);return n.decryptionPromise=null,F}),this.decryptionPromise;var k=b.softwareDecrypt(l,A.key.buffer,A.iv.buffer,R);if(r.part>-1){var _=b.flush();k=_&&_.buffer}if(!k)return o.executeEnd=he(),Fi(r);l=new Uint8Array(k)}var C=this.needsProbing(f,g);if(C){var x=this.configureTransmuxer(l);if(x)return this.logger.warn("[transmuxer] "+x.message),this.observer.emit(p.ERROR,p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,fatal:!1,error:x,reason:x.message}),o.executeEnd=he(),Fi(r)}(f||g||y||C)&&this.resetInitSegment(L,E,T,I,t),(f||y||C)&&this.resetInitialTimestamp(S),c||this.resetContiguity();var w=this.transmux(l,A,m,v,r);this.asyncResult=Ie(w);var P=this.currentTransmuxState;return P.contiguous=!0,P.discontinuity=!1,P.trackSwitch=!1,o.executeEnd=he(),w},a.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=he();var i=this.decrypter,n=this.currentTransmuxState,o=this.decryptionPromise;if(o)return this.asyncResult=!0,o.then(function(){return t.flush(e)});var l=[],u=n.timeOffset;if(i){var d=i.flush();d&&l.push(this.push(d.buffer,null,e))}var h=this.demuxer,c=this.remuxer;if(!h||!c){r.executeEnd=he();var f=[Fi(e)];return this.asyncResult?Promise.resolve(f):f}var g=h.flush(u);return Ie(g)?(this.asyncResult=!0,g.then(function(v){return t.flushRemux(l,v,e),l})):(this.flushRemux(l,g,e),this.asyncResult?Promise.resolve(l):l)},a.flushRemux=function(e,t,r){var i=t.audioTrack,n=t.videoTrack,o=t.id3Track,l=t.textTrack,u=this.currentTransmuxState,d=u.accurateTimeOffset,h=u.timeOffset;this.logger.log("[transmuxer.ts]: Flushed "+this.id+" sn: "+r.sn+(r.part>-1?" part: "+r.part:"")+" of "+(this.id===J?"level":"track")+" "+r.level);var c=this.remuxer.remux(i,n,o,l,h,d,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=he()},a.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},a.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},a.resetInitSegment=function(e,t,r,i,n){var o=this.demuxer,l=this.remuxer;o&&l&&(o.resetInitSegment(e,t,r,i),l.resetInitSegment(e,t,r,n))},a.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},a.transmux=function(e,t,r,i,n){return t&&t.method==="SAMPLE-AES"?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n)},a.transmuxUnencrypted=function(e,t,r,i){var n=this.demuxer.demux(e,t,!1,!this.config.progressive),o=n.audioTrack,l=n.videoTrack,u=n.id3Track,d=n.textTrack;return{remuxResult:this.remuxer.remux(o,l,u,d,t,r,!1,this.id),chunkMeta:i}},a.transmuxSampleAes=function(e,t,r,i,n){var o=this;return this.demuxer.demuxSampleAes(e,t,r).then(function(l){return{remuxResult:o.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,r,i,!1,o.id),chunkMeta:n}})},a.configureTransmuxer=function(e){for(var t,r=this.config,i=this.observer,n=this.typeSupported,o=0,l=Or.length;o<l;o++){var u;if((u=Or[o].demux)!=null&&u.probe(e,this.logger)){t=Or[o];break}}if(!t)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,h=this.remuxer,c=t.remux,f=t.demux;h&&h instanceof c||(this.remuxer=new c(i,r,n,this.logger)),d&&d instanceof f||(this.demuxer=new f(i,r,n,this.logger),this.probe=f.probe)},a.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},a.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new oi(this.config)),e},s}(),Fi=function(s){return{remuxResult:{},chunkMeta:s}};function Ie(s){return"then"in s&&s.then instanceof Function}var Tl=function(s,a,e,t,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=a,this.initSegmentData=e,this.duration=t,this.defaultInitPts=r||null},Sl=function(s,a,e,t,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=a,this.accurateTimeOffset=e,this.trackSwitch=t,this.timeOffset=r,this.initSegmentChange=i},Ni=[];function Ui(s,a,e){if(!((t=a.remuxResult).audio||t.video||t.text||t.id3||t.initSegment))return!1;var t,r=[],i=a.remuxResult,n=i.audio,o=i.video;return n&&hs(r,n),o&&hs(r,o),s.postMessage({event:"transmuxComplete",data:a,instanceNo:e},r),!0}function hs(s,a){a.data1&&s.push(a.data1.buffer),a.data2&&s.push(a.data2.buffer)}function fs(s,a,e,t){a.reduce(function(r,i){return Ui(s,i,t)||r},!1)||s.postMessage({event:"transmuxComplete",data:a[0],instanceNo:t}),s.postMessage({event:"flush",data:e,instanceNo:t})}function Ue(s,a,e){self.postMessage({event:s,data:a,instanceNo:e})}ve!==void 0&&ve&&self.addEventListener("message",function(s){var a=s.data,e=a.instanceNo;if(e!==void 0){var t=Ni[e];if(a.cmd==="reset"&&(delete Ni[a.resetNo],t&&t.destroy(),a.cmd="init"),a.cmd==="init"){var r=JSON.parse(a.config),i=new lr;i.on(p.FRAG_DECRYPTED,Ue),i.on(p.ERROR,Ue);var n=Ln(r.debug,a.id);return function(d,h){var c=function(g){var v=function(m){Ue("workerLog",{logType:g,message:m},h)};d[g]=v};for(var f in d)c(f)}(n,e),Ni[e]=new Mi(i,a.typeSupported,r,"",a.id,n),void Ue("init",null,e)}if(t)switch(a.cmd){case"configure":t.configure(a.config);break;case"demux":var o=t.push(a.data,a.decryptdata,a.chunkMeta,a.state);Ie(o)?o.then(function(d){Ui(self,d,e)}).catch(function(d){Ue(p.ERROR,{instanceNo:e,type:K.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker push error"},e)}):Ui(self,o,e);break;case"flush":var l=a.chunkMeta,u=t.flush(l);Ie(u)?u.then(function(d){fs(self,d,l,e)}).catch(function(d){Ue(p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker flush error"},e)}):fs(self,u,l,e)}}});var ir="1.6.2",Be={},cs=0,gs=function(){function s(e,t,r,i){var n=this;this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=cs++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=function(c){var f=c.data,g=n.hls;if(g&&f!=null&&f.event&&f.instanceNo===n.instanceNo)switch(f.event){case"init":var v,m=(v=n.workerContext)==null?void 0:v.objectURL;m&&self.URL.revokeObjectURL(m);break;case"transmuxComplete":n.handleTransmuxComplete(f.data);break;case"flush":n.onFlush(f.data);break;case"workerLog":g.logger[f.data.logType]&&g.logger[f.data.logType](f.data.message);break;default:f.data=f.data||{},f.data.frag=n.frag,f.data.part=n.part,f.data.id=n.id,g.trigger(f.event,f.data)}},this.onWorkerError=function(c){if(n.hls){var f=new Error(c.message+"  ("+c.filename+":"+c.lineno+")");n.hls.config.enableWorker=!1,n.hls.logger.warn('Error in "'+n.id+'" Web Worker, fallback to inline'),n.hls.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})}};var o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var l=function(c,f){(f=f||{}).frag=n.frag||void 0,c===p.ERROR&&(f.parent=n.id,f.part=n.part,n.error=f.error),n.hls.trigger(c,f)};this.observer=new lr,this.observer.on(p.FRAG_DECRYPTED,l),this.observer.on(p.ERROR,l);var u=Un(o.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){var d=this.hls.logger;o.workerPath;try{o.workerPath?(d.log("loading Web Worker "+o.workerPath+' for "'+t+'"'),this.workerContext=function(c){var f=Be[c];if(f)return f.clientCount++,f;var g=new self.URL(c,self.location.href).href,v={worker:new self.Worker(g),scriptURL:g,clientCount:1};return Be[c]=v,v}(o.workerPath)):(d.log('injecting Web Worker for "'+t+'"'),this.workerContext=function(){var c=Be[ir];if(c)return c.clientCount++,c;var f=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+Ye.toString()+")(true);"],{type:"text/javascript"}),g=self.URL.createObjectURL(f),v={worker:new self.Worker(g),objectURL:g,clientCount:1};return Be[ir]=v,v}());var h=this.workerContext.worker;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:pt(o)})}catch(c){d.warn('Error setting up "'+t+'" Web Worker, fallback to inline',c),this.terminateWorker(),this.error=null,this.transmuxer=new Mi(this.observer,u,o,"",t,e.logger)}}else this.transmuxer=new Mi(this.observer,u,o,"",t,e.logger)}var a=s.prototype;return a.reset=function(){if(this.frag=null,this.part=null,this.workerContext){var e=this.instanceNo;this.instanceNo=cs++;var t=this.hls.config,r=Un(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:pt(t)})}},a.terminateWorker=function(){if(this.workerContext){var e=this.workerContext.worker;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(t){var r=Be[t||ir];if(r&&r.clientCount--==1){var i=r.worker,n=r.objectURL;delete Be[t||ir],n&&self.URL.revokeObjectURL(n),i.terminate()}}(this.hls.config.workerPath)}},a.destroy=function(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null},a.push=function(e,t,r,i,n,o,l,u,d,h){var c,f,g=this;d.transmuxing.start=self.performance.now();var v=this.instanceNo,m=this.transmuxer,y=o?o.start:n.start,E=n.decryptdata,T=this.frag,S=!(T&&n.cc===T.cc),I=!(T&&d.level===T.level),L=T?d.sn-T.sn:-1,A=this.part?d.part-this.part.index:-1,b=L===0&&d.id>1&&d.id===(T==null?void 0:T.stats.chunkCount),R=!I&&(L===1||L===0&&(A===1||b&&A<=0)),k=self.performance.now();(I||L||n.stats.parsing.start===0)&&(n.stats.parsing.start=k),!o||!A&&R||(o.stats.parsing.start=k);var _=!(T&&((c=n.initSegment)==null?void 0:c.url)===((f=T.initSegment)==null?void 0:f.url)),C=new Sl(S,R,u,I,y,_);if(!R||S||_){this.hls.logger.log("[transmuxer-interface]: Starting new transmux session for "+n.type+" sn: "+d.sn+(d.part>-1?" part: "+d.part:"")+" "+(this.id===J?"level":"track")+": "+d.level+" id: "+d.id+`
        discontinuity: `+S+`
        trackSwitch: `+I+`
        contiguous: `+R+`
        accurateTimeOffset: `+u+`
        timeOffset: `+y+`
        initSegmentChange: `+_);var x=new Tl(r,i,t,l,h);this.configureTransmuxer(x)}if(this.frag=n,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:v,cmd:"demux",data:e,decryptdata:E,chunkMeta:d,state:C},e instanceof ArrayBuffer?[e]:[]);else if(m){var w=m.push(e,E,d,C);Ie(w)?w.then(function(P){g.handleTransmuxComplete(P)}).catch(function(P){g.transmuxerError(P,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(w)}},a.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.instanceNo,i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:r,cmd:"flush",chunkMeta:e});else if(i){var n=i.flush(e);Ie(n)?n.then(function(o){t.handleFlushResult(o,e)}).catch(function(o){t.transmuxerError(o,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}},a.transmuxerError=function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))},a.handleFlushResult=function(e,t){var r=this;e.forEach(function(i){r.handleTransmuxComplete(i)}),this.onFlush(t)},a.configureTransmuxer=function(e){var t=this.instanceNo,r=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)},a.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},s}(),Ll=function(s){function a(t,r,i){var n;return(n=s.call(this,t,r,i,"audio-stream-controller",Mt)||this).mainAnchor=null,n.mainFragLoading=null,n.audioOnly=!1,n.bufferedTrack=null,n.switchingTrack=null,n.trackId=-1,n.waitingData=null,n.mainDetails=null,n.flushing=!1,n.bufferFlushed=!1,n.cachedTrackLoadedData=null,n.registerListeners(),n}ut(a,s);var e=a.prototype;return e.onHandlerDestroying=function(){this.unregisterListeners(),s.prototype.onHandlerDestroying.call(this),this.resetItem()},e.resetItem=function(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null},e.registerListeners=function(){s.prototype.registerListeners.call(this);var t=this.hls;t.on(p.LEVEL_LOADED,this.onLevelLoaded,this),t.on(p.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(p.BUFFER_RESET,this.onBufferReset,this),t.on(p.BUFFER_CREATED,this.onBufferCreated,this),t.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(p.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(p.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(p.FRAG_LOADING,this.onFragLoading,this),t.on(p.FRAG_BUFFERED,this.onFragBuffered,this)},e.unregisterListeners=function(){var t=this.hls;t&&(s.prototype.unregisterListeners.call(this),t.off(p.LEVEL_LOADED,this.onLevelLoaded,this),t.off(p.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(p.BUFFER_RESET,this.onBufferReset,this),t.off(p.BUFFER_CREATED,this.onBufferCreated,this),t.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(p.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(p.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(p.FRAG_LOADING,this.onFragLoading,this),t.off(p.FRAG_BUFFERED,this.onFragBuffered,this))},e.onInitPtsFound=function(t,r){var i=r.frag,n=r.id,o=r.initPTS,l=r.timescale;if(n===J){var u=i.cc,d=this.fragCurrent;if(this.initPTS[u]={baseTime:o,timescale:l},this.log("InitPTS for cc: "+u+" found from main: "+o+"/"+l),this.mainAnchor=i,this.state===O.WAITING_INIT_PTS){var h=this.waitingData;(!h&&!this.loadingParts||h&&h.frag.cc!==u)&&(this.nextLoadPosition=this.findSyncFrag(i).start),this.tick()}else!this.hls.hasEnoughToStart&&d&&d.cc!==u?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(i).start,d.abortRequests(),this.resetLoadingState()):this.state===O.IDLE&&this.tick()}},e.findSyncFrag=function(t){var r=this.getLevelDetails(),i=t.cc;return function(n,o,l){if(n&&n.startCC<=o&&n.endCC>=o){var u=l.start,d=l.end,h=n.fragments;if(!l.relurl){var c=n.fragmentHint;c&&(h=h.concat(c))}return ni(h,function(f){return f.cc<o||f.end<=u?1:f.cc>o||f.start>=d?-1:0})}return null}(r,i,t)||r&&Jn(r.fragments,i)||t},e.startLoad=function(t,r){if(!this.levels)return this.startPosition=t,void(this.state=O.STOPPED);var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),i>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),t=i,this.state=O.IDLE):this.state=O.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=r?-1:t,this.tick()},e.doTick=function(){switch(this.state){case O.IDLE:this.doTickIdle();break;case O.WAITING_TRACK:var t=this.levels,r=this.trackId,i=t==null?void 0:t[r],n=i==null?void 0:i.details;if(n&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(n))break;this.state=O.WAITING_INIT_PTS}break;case O.FRAG_LOADING_WAITING_RETRY:var o,l=performance.now(),u=this.retryDate;if(!u||l>=u||(o=this.media)!=null&&o.seeking){var d=this.levels,h=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((d==null?void 0:d[h])||null),this.state=O.IDLE}break;case O.WAITING_INIT_PTS:var c=this.waitingData;if(c){var f=c.frag,g=c.part,v=c.cache,m=c.complete,y=this.mainAnchor;if(this.initPTS[f.cc]!==void 0){this.waitingData=null,this.state=O.FRAG_LOADING;var E={frag:f,part:g,payload:v.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(E),m&&s.prototype._handleFragmentLoadComplete.call(this,E)}else y&&y.cc!==c.frag.cc&&(this.log("Waiting fragment cc ("+f.cc+") cancelled because video is at cc "+y.cc),this.nextLoadPosition=this.findSyncFrag(y).start,this.clearWaitingFragment())}else this.state=O.IDLE}this.onTickEnd()},e.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.state!==O.STOPPED&&(this.state=O.IDLE))},e.resetLoadingState=function(){this.clearWaitingFragment(),s.prototype.resetLoadingState.call(this)},e.onTickEnd=function(){var t=this.media;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)},e.doTickIdle=function(){var t,r=this.hls,i=this.levels,n=this.media,o=this.trackId,l=r.config;if(this.buffering&&(n||this.primaryPrefetch||!this.startFragRequested&&l.startFragPrefetch)&&i!=null&&i[o]){var u=i[o],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d))return this.state=O.WAITING_TRACK,void(this.startFragRequested=!1);var h=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&h&&(this.bufferFlushed=!1,this.afterBufferFlushed(h,Ft,Mt));var c=this.getFwdBufferInfo(h,Mt);if(c!==null){if(!this.switchingTrack&&this._streamEnded(c,d))return r.trigger(p.BUFFER_EOS,{type:"audio"}),void(this.state=O.ENDED);var f=c.len,g=r.maxBufferLength,v=d.fragments,m=v[0].start,y=this.getLoadPosition(),E=this.flushing?y:c.end;if(this.switchingTrack&&n){var T=y;d.PTSKnown&&T<m&&(c.end>m||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=m+.05)}if(!(f>=g&&!this.switchingTrack&&E<v[v.length-1].start)){var S=this.getNextFragment(E,d);if(S&&this.isLoopLoading(S,E)&&(S=this.getNextFragmentLoopLoading(S,d,c,J,g)),S){var I=((t=this.mainFragLoading)==null?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&I&&Dt(S)&&!S.endList&&(!d.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(I)===xe&&(this.mainFragLoading=I=null),I&&Dt(I))){if(S.start>I.end){var L=this.fragmentTracker.getFragAtPos(E,J);L&&L.end>I.end&&(I=L,this.mainFragLoading={frag:L,targetBufferTime:null})}if(S.start>I.end)return}this.loadFragment(S,u,E)}else this.bufferFlushed=!0}}}},e.onMediaDetaching=function(t,r){this.bufferFlushed=this.flushing=!1,s.prototype.onMediaDetaching.call(this,t,r)},e.onAudioTracksUpdated=function(t,r){var i=r.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(n){return new qe(n)})},e.onAudioTrackSwitching=function(t,r){var i=!!r.url;this.trackId=r.id;var n=this.fragCurrent;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),i?(this.switchingTrack=r,this.flushAudioIfNeeded(r),this.state!==O.STOPPED&&(this.setInterval(100),this.state=O.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=r,this.clearInterval())},e.onManifestLoading=function(){s.prototype.onManifestLoading.call(this),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1},e.onLevelLoaded=function(t,r){this.mainDetails=r.details;var i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(p.AUDIO_TRACK_LOADED,i))},e.onAudioTrackLoaded=function(t,r){var i,n=this.levels,o=r.details,l=r.id,u=r.groupId,d=r.track;if(n){var h=this.mainDetails;if(!h||o.endCC>h.endCC||h.expired)return this.cachedTrackLoadedData=r,void(this.state!==O.STOPPED&&(this.state=O.WAITING_TRACK));this.cachedTrackLoadedData=null,this.log("Audio track "+l+' "'+d.name+'" of "'+u+'" loaded ['+o.startSN+","+o.endSN+"]"+(o.lastPartSn?"[part-"+o.lastPartSn+"-"+o.lastPartIndex+"]":"")+",duration:"+o.totalduration);var c=n[l],f=0;if(o.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;var g;c.details&&(f=this.alignPlaylists(o,c.details,(g=this.levelLastLoaded)==null?void 0:g.details)),o.alignedSliding||(Ua(o,h),o.alignedSliding||Dr(o,h),f=o.fragmentStart)}c.details=o,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(h,f),this.hls.trigger(p.AUDIO_TRACK_UPDATED,{details:o,id:l,groupId:r.groupId}),this.state!==O.WAITING_TRACK||this.waitForCdnTuneIn(o)||(this.state=O.IDLE),this.tick()}else this.warn("Audio tracks reset while loading track "+l+' "'+d.name+'" of "'+u+'"')},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,n=t.part,o=t.payload,l=this.config,u=this.trackId,d=this.levels;if(d){var h=d[u];if(h){var c=h.details;if(!c)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);var f=l.defaultAudioCodec||h.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new gs(this.hls,Mt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var v=this.initPTS[i.cc],m=(r=i.initSegment)==null?void 0:r.data;if(v!==void 0){var y=n?n.index:-1,E=y!==-1,T=new li(i.level,i.sn,i.stats.chunkCount,o.byteLength,y,E);g.push(o,m,f,"",i,n,c.totalduration,!1,T,v)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+u),(this.waitingData=this.waitingData||{frag:i,part:n,cache:new Ga,complete:!1}).cache.push(new Uint8Array(o)),this.state!==O.STOPPED&&(this.state=O.WAITING_INIT_PTS)}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e._handleFragmentLoadComplete=function(t){this.waitingData?this.waitingData.complete=!0:s.prototype._handleFragmentLoadComplete.call(this,t)},e.onBufferReset=function(){this.mediaBuffer=null},e.onBufferCreated=function(t,r){this.bufferFlushed=this.flushing=!1;var i=r.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)},e.onFragLoading=function(t,r){!this.audioOnly&&r.frag.type===J&&Dt(r.frag)&&(this.mainFragLoading=r,this.state===O.IDLE&&this.tick())},e.onFragBuffered=function(t,r){var i=r.frag,n=r.part;if(i.type===Mt)if(this.fragContextChanged(i))this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if(Dt(i)){this.fragPrevious=i;var o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(p.AUDIO_TRACK_SWITCHED,at({},o)))}this.fragBufferedComplete(i,n),this.media&&this.tick()}else this.audioOnly||i.type!==J||i.elementaryStreams.video||i.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)},e.onError=function(t,r){var i;if(r.fatal)this.state=O.ERROR;else switch(r.details){case D.FRAG_GAP:case D.FRAG_PARSING_ERROR:case D.FRAG_DECRYPT_ERROR:case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Mt,r);break;case D.AUDIO_TRACK_LOAD_ERROR:case D.AUDIO_TRACK_LOAD_TIMEOUT:case D.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==O.WAITING_TRACK||((i=r.context)==null?void 0:i.type)!==zt||(this.state=O.IDLE);break;case D.BUFFER_ADD_CODEC_ERROR:case D.BUFFER_APPEND_ERROR:if(r.parent!=="audio")return;this.resetLoadingState();break;case D.BUFFER_FULL_ERROR:if(r.parent!=="audio")return;this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case D.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.onBufferFlushing=function(t,r){r.type!==Ht&&(this.flushing=!0)},e.onBufferFlushed=function(t,r){var i=r.type;if(i!==Ht){this.flushing=!1,this.bufferFlushed=!0,this.state===O.ENDED&&(this.state=O.IDLE);var n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,i,Mt),this.tick())}},e._handleTransmuxComplete=function(t){var r,i="audio",n=this.hls,o=t.remuxResult,l=t.chunkMeta,u=this.getCurrentContext(l);if(u){var d=u.frag,h=u.part,c=u.level,f=c.details,g=o.audio,v=o.text,m=o.id3,y=o.initSegment;if(!this.fragContextChanged(d)&&f){if(this.state=O.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){var E=d.initSegment||d;this._bufferInitSegment(c,y.tracks,E,l),n.trigger(p.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:y.tracks})}if(g){var T=g.startPTS,S=g.endPTS,I=g.startDTS,L=g.endDTS;h&&(h.elementaryStreams[Ft]={startPTS:T,endPTS:S,startDTS:I,endDTS:L}),d.setElementaryStreamInfo(Ft,T,S,I,L),this.bufferFragmentData(g,d,h,l)}if(m!=null&&(r=m.samples)!=null&&r.length){var A=ot({id:i,frag:d,details:f},m);n.trigger(p.FRAG_PARSING_METADATA,A)}if(v){var b=ot({id:i,frag:d,details:f},v);n.trigger(p.FRAG_PARSING_USERDATA,b)}}else this.fragmentTracker.removeFragment(d)}else this.resetWhenMissingContext(l)},e._bufferInitSegment=function(t,r,i,n){if(this.state===O.PARSING&&(r.video&&delete r.video,r.audiovideo&&delete r.audiovideo,r.audio)){var o=r.audio;o.id=Mt;var l=t.audioCodec;this.log("Init audio buffer, container:"+o.container+", codecs[level/parsed]=["+l+"/"+o.codec+"]"),l&&l.split(",").length===1&&(o.levelCodec=l),this.hls.trigger(p.BUFFER_CODECS,r);var u=o.initSegment;if(u!=null&&u.byteLength){var d={type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:u};this.hls.trigger(p.BUFFER_APPENDING,d)}this.tickImmediate()}},e.loadFragment=function(t,r,i){var n,o=this.fragmentTracker.getState(t);if(this.switchingTrack||o===Qe||o===we)if(Dt(t))if((n=r.details)!=null&&n.live&&!this.initPTS[t.cc]){this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=O.WAITING_INIT_PTS;var l=this.mainDetails;l&&l.fragmentStart!==r.details.fragmentStart&&Dr(r.details,l)}else s.prototype.loadFragment.call(this,t,r,i);else this._loadInitSegment(t,r);else this.clearTrackerIfNeeded(t)},e.flushAudioIfNeeded=function(t){if(this.media&&this.bufferedTrack){var r=this.bufferedTrack;Le({name:r.name,lang:r.lang,assocLang:r.assocLang,characteristics:r.characteristics,audioCodec:r.audioCodec,channels:r.channels},t,Ae)||(pr(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}},e.completeAudioSwitch=function(t){var r=this.hls;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,r.trigger(p.AUDIO_TRACK_SWITCHED,at({},t))},a}(Ai),Bi=function(s){function a(t,r){var i;return(i=s.call(this,r,t.logger)||this).hls=void 0,i.canLoad=!1,i.timer=-1,i.hls=t,i}ut(a,s);var e=a.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},e.startLoad=function(){this.canLoad=!0,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,r,i){var n=r==null?void 0:r.renditionReports;if(n){for(var o=-1,l=0;l<n.length;l++){var u=n[l],d=void 0;try{d=new self.URL(u.URI,r.url).href}catch(m){this.warn("Could not construct new URL for Rendition Report: "+m),d=u.URI||""}if(d===t){o=l;break}d===t.substring(0,d.length)&&(o=l)}if(o!==-1){var h=n[o],c=parseInt(h["LAST-MSN"])||(r==null?void 0:r.lastPartSn),f=parseInt(h["LAST-PART"])||(r==null?void 0:r.lastPartIndex);if(this.hls.config.lowLatencyMode){var g=Math.min(r.age-r.partTarget,r.targetduration);f>=0&&g>r.partTarget&&(f+=1)}var v=i&&Wn(i);return new jn(c,f>=0?f:void 0,v)}}},e.loadPlaylist=function(t){this.clearTimer()},e.loadingPlaylist=function(t,r){this.clearTimer()},e.shouldLoadPlaylist=function(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)},e.getUrlWithDirectives=function(t,r){if(r)try{return r.addDirectives(t)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}return t},e.playlistLoaded=function(t,r,i){var n=r.details,o=r.stats,l=self.performance.now(),u=o.loading.first?Math.max(0,l-o.loading.first):0;n.advancedDateTime=Date.now()-u;var d=this.hls.config.timelineOffset;if(d!==n.appliedTimelineOffset){var h=Math.max(d||0,0);n.appliedTimelineOffset=h,n.fragments.forEach(function(M){M.start=M.playlistOffset+h})}if(n.live||i!=null&&i.live){var c="levelInfo"in r?r.levelInfo:r.track;if(n.reloaded(i),i&&n.fragments.length>0){zo(i,n);var f=n.playlistParsingError;if(f){this.warn(f);var g=this.hls;if(!g.config.ignorePlaylistParsingErrors){var v,m=r.networkDetails;return void g.trigger(p.ERROR,{type:K.NETWORK_ERROR,details:D.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:f,reason:f.message,level:r.level||void 0,parent:(v=n.fragments[0])==null?void 0:v.type,networkDetails:m,stats:o})}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=o.loading.start);var y,E=this.hls.mainForwardBufferInfo,T=E?E.end-E.len:0,S=Ca(n,1e3*(n.edge-T));if(n.requestScheduled+S<l?n.requestScheduled=l:n.requestScheduled+=S,this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED")),!this.canLoad||!n.live)return;var I=void 0,L=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var A=this.hls.config.lowLatencyMode,b=n.lastPartSn,R=n.endSN,k=n.lastPartIndex,_=b===R;k!==-1?_?(I=R+1,L=A?0:k):(I=b,L=A?k+1:n.maxPartIndex):I=R+1;var C=n.age,x=C+n.ageHeader,w=Math.min(x-n.partTarget,1.5*n.targetduration);if(w>0){if(x>3*n.targetduration)this.log("Playlist last advanced "+C.toFixed(2)+"s ago. Omitting segment and part directives."),I=void 0,L=void 0;else if(i!=null&&i.tuneInGoal&&x-n.partTarget>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+w+" with playlist age: "+n.age),w=0;else{var P=Math.floor(w/n.targetduration);I+=P,L!==void 0&&(L+=Math.round(w%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+C.toFixed(2)+"s goal: "+w+" skip sn "+P+" to part "+L)}n.tuneInGoal=w}if(y=this.getDeliveryDirectives(n,r.deliveryDirectives,I,L),A||!_)return n.requestScheduled=l,void this.loadingPlaylist(c,y)}else(n.canBlockReload||n.canSkipUntil)&&(y=this.getDeliveryDirectives(n,r.deliveryDirectives,I,L));y&&I!==void 0&&n.canBlockReload&&(n.requestScheduled=o.loading.first+Math.max(S-2*u,S/2)),this.scheduleLoading(c,y,n)}else this.clearTimer()},e.scheduleLoading=function(t,r,i){var n=this,o=i||t.details;if(o){var l=self.performance.now(),u=o.requestScheduled;if(l>=u)this.loadingPlaylist(t,r);else{var d=u-l;this.log("reload live playlist "+(t.name||t.bitrate+"bps")+" in "+Math.round(d)+" ms"),this.clearTimer(),this.timer=self.setTimeout(function(){return n.loadingPlaylist(t,r)},d)}}else this.loadingPlaylist(t,r)},e.getDeliveryDirectives=function(t,r,i,n){var o=Wn(t);return r!=null&&r.skip&&t.deltaUpdateFailed&&(i=r.msn,n=r.part,o=Yn),new jn(i,n,o)},e.checkRetry=function(t){var r=this,i=t.details,n=yr(t),o=t.errorAction,l=o||{},u=l.action,d=l.retryCount,h=d===void 0?0:d,c=l.retryConfig,f=!!o&&!!c&&(u===Tr||!o.resolved&&u===le);if(f){var g;if(h>=c.maxNumRetry)return!1;if(n&&(g=t.context)!=null&&g.deliveryDirectives)this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var v=ai(c,h);this.clearTimer(),this.timer=self.setTimeout(function(){return r.loadPlaylist()},v),this.warn("Retrying playlist loading "+(h+1)+"/"+c.maxNumRetry+' after "'+i+'" in '+v+"ms")}t.levelRetry=!0,o.resolved=!0}return f},a}(oe);function vs(s,a){if(s.length!==a.length)return!1;for(var e=0;e<s.length;e++)if(!nr(s[e].attrs,a[e].attrs))return!1;return!0}function nr(s,a,e){var t=s["STABLE-RENDITION-ID"];return t&&!e?t===a["STABLE-RENDITION-ID"]:!(e||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(r){return s[r]!==a[r]})}function Gi(s,a){return a.label.toLowerCase()===s.name.toLowerCase()&&(!a.language||a.language.toLowerCase()===(s.lang||"").toLowerCase())}var Al=function(s){function a(t){var r;return(r=s.call(this,t,"audio-track-controller")||this).tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}ut(a,s);var e=a.prototype;return e.registerListeners=function(){var t=this.hls;t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.MANIFEST_PARSED,this.onManifestParsed,this),t.on(p.LEVEL_LOADING,this.onLevelLoading,this),t.on(p.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(p.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.MANIFEST_PARSED,this.onManifestParsed,this),t.off(p.LEVEL_LOADING,this.onLevelLoading,this),t.off(p.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(p.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(p.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,s.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.audioTracks||[]},e.onAudioTrackLoaded=function(t,r){var i=r.id,n=r.groupId,o=r.details,l=this.tracksInGroup[i];if(l&&l.groupId===n){var u=l.details;l.details=r.details,this.log("Audio track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+n+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,u)}else this.warn("Audio track with id:"+i+" and group:"+n+" not found in active group "+(l==null?void 0:l.groupId))},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r){var i=r.audioGroups||null,n=this.groupIds,o=this.currentTrack;if(!i||(n==null?void 0:n.length)!==(i==null?void 0:i.length)||i!=null&&i.some(function(y){return(n==null?void 0:n.indexOf(y))===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var l=this.tracks.filter(function(y){return!i||i.indexOf(y.groupId)!==-1});if(l.length)this.selectDefaultTrack&&!l.some(function(y){return y.default})&&(this.selectDefaultTrack=!1),l.forEach(function(y,E){y.id=E});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=l;var u=this.hls.config.audioPreference;if(!o&&u){var d=ee(u,l,Ae);if(d>-1)o=l[d];else{var h=ee(u,this.tracks);o=this.tracks[h]}}var c=this.findTrackId(o);c===-1&&o&&(c=this.findTrackId(null));var f={audioTracks:l};this.log("Updating audio tracks, "+l.length+" track(s) found in group(s): "+(i==null?void 0:i.join(","))),this.hls.trigger(p.AUDIO_TRACKS_UPDATED,f);var g=this.trackId;if(c!==-1&&g===-1)this.setAudioTrack(c);else if(l.length&&g===-1){var v,m=new Error("No audio track selected for current audio group-ID(s): "+((v=this.groupIds)==null?void 0:v.join(","))+" track count: "+l.length);this.warn(m.message),this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:m})}}}},e.onError=function(t,r){!r.fatal&&r.context&&(r.context.type!==zt||r.context.id!==this.trackId||this.groupIds&&this.groupIds.indexOf(r.context.groupId)===-1||this.checkRetry(r))},e.setAudioOption=function(t){var r=this.hls;if(r.config.audioPreference=t,t){var i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){var n=this.currentTrack;if(n&&Le(t,n,Ae))return n;var o=ee(t,this.tracksInGroup,Ae);if(o>-1){var l=this.tracksInGroup[o];return this.setAudioTrack(o),l}if(n){var u=r.loadLevel;u===-1&&(u=r.firstAutoLevel);var d=function(c,f,g,v,m){var y=f[v],E=f.reduce(function(A,b,R){var k=b.uri;return(A[k]||(A[k]=[])).push(R),A},{})[y.uri];E.length>1&&(v=Math.max.apply(Math,E));var T=y.videoRange,S=y.frameRate,I=y.codecSet.substring(0,4),L=Qn(f,v,function(A){if(A.videoRange!==T||A.frameRate!==S||A.codecSet.substring(0,4)!==I)return!1;var b=A.audioGroups,R=g.filter(function(k){return!b||b.indexOf(k.groupId)!==-1});return ee(c,R,m)>-1});return L>-1?L:Qn(f,v,function(A){var b=A.audioGroups,R=g.filter(function(k){return!b||b.indexOf(k.groupId)!==-1});return ee(c,R,m)>-1})}(t,r.levels,i,u,Ae);if(d===-1)return null;r.nextLoadLevel=d}if(t.channels||t.audioCodec){var h=ee(t,i);if(h>-1)return i[h]}}}return null},e.setAudioTrack=function(t){var r=this.tracksInGroup;if(t<0||t>=r.length)this.warn("Invalid audio track id: "+t);else{this.selectDefaultTrack=!1;var i=this.currentTrack,n=r[t],o=n.details&&!n.details.live;if(!(t===this.trackId&&n===i&&o||(this.log("Switching to audio-track "+t+' "'+n.name+'" lang:'+n.lang+" group:"+n.groupId+" channels:"+n.channels),this.trackId=t,this.currentTrack=n,this.hls.trigger(p.AUDIO_TRACK_SWITCHING,at({},n)),o))){var l=this.switchParams(n.url,i==null?void 0:i.details,n.details);this.loadPlaylist(l)}}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var n=r[i];if((!this.selectDefaultTrack||n.default)&&(!t||Le(t,n,Ae)))return i}if(t){for(var o=t.name,l=t.lang,u=t.assocLang,d=t.characteristics,h=t.audioCodec,c=t.channels,f=0;f<r.length;f++)if(Le({name:o,lang:l,assocLang:u,characteristics:d,audioCodec:h,channels:c},r[f],Ae))return f;for(var g=0;g<r.length;g++){var v=r[g];if(nr(t.attrs,v.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return g}for(var m=0;m<r.length;m++){var y=r[m];if(nr(t.attrs,y.attrs,["LANGUAGE"]))return m}}return-1},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.currentTrack;this.shouldLoadPlaylist(r)&&pr(r.url,this.hls)&&this.scheduleLoading(r,t)},e.loadingPlaylist=function(t,r){s.prototype.loadingPlaylist.call(this,t,r);var i=t.id,n=t.groupId,o=this.getUrlWithDirectives(t.url,r),l=t.details,u=l==null?void 0:l.age;this.log("Loading audio-track "+i+' "'+t.name+'" lang:'+t.lang+" group:"+n+((r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:"")+(u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):"")+" "+o),this.hls.trigger(p.AUDIO_TRACK_LOADING,{url:o,id:i,groupId:n,deliveryDirectives:r||null,track:t})},dt(a,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])}(Bi),Rl=function(){function s(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}var a=s.prototype;return a.destroy=function(){this.tracks=this.queues=null},a.append=function(e,t,r){if(this.queues!==null&&this.tracks!==null){var i=this.queues[t];i.push(e),i.length!==1||r||this.executeNext(t)}},a.appendBlocker=function(e){var t=this;return new Promise(function(r){var i={label:"async-blocker",execute:r,onStart:function(){},onComplete:function(){},onError:function(){}};t.append(i,e)})},a.prependBlocker=function(e){var t=this;return new Promise(function(r){if(t.queues){var i={label:"async-blocker-prepend",execute:r,onStart:function(){},onComplete:function(){},onError:function(){}};t.queues[e].unshift(i)}})},a.removeBlockers=function(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(function(e){var t,r=(t=e[0])==null?void 0:t.label;r!=="async-blocker"&&r!=="async-blocker-prepend"||(e[0].execute(),e.splice(0,1))})},a.unblockAudio=function(e){this.queues!==null&&this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")},a.executeNext=function(e){if(this.queues!==null&&this.tracks!==null){var t=this.queues[e];if(t.length){var r=t[0];try{r.execute()}catch(o){var i;if(r.onError(o),this.queues===null||this.tracks===null)return;var n=(i=this.tracks[e])==null?void 0:i.buffer;n!=null&&n.updating||this.shiftAndExecuteNext(e)}}}},a.shiftAndExecuteNext=function(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))},a.current=function(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null},a.toString=function(){var e=this.queues,t=this.tracks;return e===null||t===null?"<destroyed>":`
`+this.list("video")+`
`+this.list("audio")+`
`+this.list("audiovideo")+"}"},a.list=function(e){var t,r;return(t=this.queues)!=null&&t[e]||(r=this.tracks)!=null&&r[e]?e+": ("+this.listSbInfo(e)+") "+this.listOps(e):""},a.listSbInfo=function(e){var t,r=(t=this.tracks)==null?void 0:t[e],i=r==null?void 0:r.buffer;return i?"SourceBuffer"+(i.updating?" updating":"")+(r.ended?" ended":"")+(r.ending?" ending":""):"none"},a.listOps=function(e){var t;return((t=this.queues)==null?void 0:t[e].map(function(r){return r.label}).join(", "))||""},s}(),ms=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,ps="HlsJsTrackRemovedError",Il=function(s){function a(e){var t;return(t=s.call(this,e)||this).name=ps,t}return ut(a,s),a}(_e(Error)),kl=function(s){function a(t,r){var i,n;return(i=s.call(this,"buffer-controller",t.logger)||this).hls=void 0,i.fragmentTracker=void 0,i.details=null,i._objectUrl=null,i.operationQueue=null,i.bufferCodecEventsTotal=0,i.media=null,i.mediaSource=null,i.lastMpegAudioChunk=null,i.blockedAudioAppend=null,i.lastVideoAppendEnd=0,i.appendSource=void 0,i.transferData=void 0,i.overrides=void 0,i.appendErrors={audio:0,video:0,audiovideo:0},i.tracks={},i.sourceBuffers=[[null,null],[null,null]],i._onEndStreaming=function(o){var l;i.hls&&((l=i.mediaSource)==null?void 0:l.readyState)==="open"&&i.hls.pauseBuffering()},i._onStartStreaming=function(o){i.hls&&i.hls.resumeBuffering()},i._onMediaSourceOpen=function(o){var l=i,u=l.media,d=l.mediaSource;o&&i.log("Media source opened"),u&&d&&(d.removeEventListener("sourceopen",i._onMediaSourceOpen),u.removeEventListener("emptied",i._onMediaEmptied),i.updateDuration(),i.hls.trigger(p.MEDIA_ATTACHED,{media:u,mediaSource:d}),i.mediaSource!==null&&i.checkPendingTracks())},i._onMediaSourceClose=function(){i.log("Media source closed")},i._onMediaSourceEnded=function(){i.log("Media source ended")},i._onMediaEmptied=function(){var o=i,l=o.mediaSrc,u=o._objectUrl;l!==u&&i.error("Media element src was set while attaching MediaSource ("+u+" > "+l+")")},i.hls=t,i.fragmentTracker=r,i.appendSource=(n=Ee(t.config.preferManagedMediaSource),typeof self<"u"&&n===self.ManagedMediaSource),i.initTracks(),i.registerListeners(),i}ut(a,s);var e=a.prototype;return e.hasSourceTypes=function(){return Object.keys(this.tracks).length>0},e.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null},e.registerListeners=function(){var t=this.hls;t.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.MANIFEST_PARSED,this.onManifestParsed,this),t.on(p.BUFFER_RESET,this.onBufferReset,this),t.on(p.BUFFER_APPENDING,this.onBufferAppending,this),t.on(p.BUFFER_CODECS,this.onBufferCodecs,this),t.on(p.BUFFER_EOS,this.onBufferEos,this),t.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(p.FRAG_PARSED,this.onFragParsed,this),t.on(p.FRAG_CHANGED,this.onFragChanged,this),t.on(p.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.MANIFEST_PARSED,this.onManifestParsed,this),t.off(p.BUFFER_RESET,this.onBufferReset,this),t.off(p.BUFFER_APPENDING,this.onBufferAppending,this),t.off(p.BUFFER_CODECS,this.onBufferCodecs,this),t.off(p.BUFFER_EOS,this.onBufferEos,this),t.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(p.FRAG_PARSED,this.onFragParsed,this),t.off(p.FRAG_CHANGED,this.onFragChanged,this),t.off(p.ERROR,this.onError,this)},e.transferMedia=function(){var t=this,r=this.media,i=this.mediaSource;if(!r)return null;var n={};if(this.operationQueue){var o=this.isUpdating();o||this.operationQueue.removeBlockers();var l=this.isQueued();(o||l)&&this.warn("Transfering MediaSource with"+(l?" operations in queue":"")+(o?" updating SourceBuffer(s)":"")+" "+this.operationQueue),this.operationQueue.destroy()}var u=this.transferData;return!this.sourceBufferCount&&u&&u.mediaSource===i?ot(n,u.tracks):this.sourceBuffers.forEach(function(d){var h=d[0];h&&(n[h]=ot({},t.tracks[h]),t.removeBuffer(h)),d[0]=d[1]=null}),{media:r,mediaSource:i,tracks:n}},e.initTracks=function(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0},e.onManifestLoading=function(){this.bufferCodecEventsTotal=0,this.details=null},e.onManifestParsed=function(t,r){var i,n=2;(r.audio&&!r.video||!r.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(n+" bufferCodec event(s) expected."),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()},e.onMediaAttaching=function(t,r){var i=this.media=r.media,n=Ee(this.appendSource);if(this.transferData=this.overrides=void 0,i&&n){var o=!!r.mediaSource;(o||r.overrides)&&(this.transferData=r,this.overrides=r.overrides);var l=this.mediaSource=r.mediaSource||new n;if(this.assignMediaSource(l),o)this._objectUrl=i.src,this.attachTransferred();else{var u=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{i.removeAttribute("src");var d=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||d&&l instanceof d,ys(i),function(h,c){var f=self.document.createElement("source");f.type="video/mp4",f.src=c,h.appendChild(f)}(i,u),i.load()}catch{i.src=u}else i.src=u}i.addEventListener("emptied",this._onMediaEmptied)}},e.assignMediaSource=function(t){var r,i;this.log((((r=this.transferData)==null?void 0:r.mediaSource)===t?"transferred":"created")+" media source: "+((i=t.constructor)==null?void 0:i.name)),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))},e.attachTransferred=function(){var t=this,r=this.media,i=this.transferData;if(i&&r){var n=this.tracks,o=i.tracks,l=o?Object.keys(o):null,u=l?l.length:0,d=function(){t.media&&t.mediaSourceOpenOrEnded&&t._onMediaSourceOpen()};if(o&&l&&u){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log("attachTransferred: (bufferCodecEventsTotal "+this.bufferCodecEventsTotal+`)
required tracks: `+pt(n,function(g,v){return g==="initSegment"?void 0:v})+`;
transfer tracks: `+pt(o,function(g,v){return g==="initSegment"?void 0:v})+"}"),!An(o,n)){i.mediaSource=null,i.tracks=void 0;var h=r.currentTime,c=this.details,f=Math.max(h,(c==null?void 0:c.fragments[0].start)||0);return f-h>1?void this.log("attachTransferred: waiting for playback to reach new tracks start time "+h+" -> "+f):(this.warn('attachTransferred: resetting MediaSource for incompatible tracks ("'+Object.keys(o)+'"->"'+Object.keys(n)+'") start time: '+f+" currentTime: "+h),this.onMediaDetaching(p.MEDIA_DETACHING,{}),this.onMediaAttaching(p.MEDIA_ATTACHING,i),void(r.currentTime=f))}this.transferData=void 0,l.forEach(function(g){var v=g,m=o[v];if(m){var y=m.buffer;if(y){var E=t.fragmentTracker,T=m.id;if(E.hasFragments(T)||E.hasParts(T)){var S=tt.getBuffered(y);E.detectEvictedFragments(v,S,T,null,!0)}var I=Ki(v),L=[v,y];t.sourceBuffers[I]=L,y.updating&&t.operationQueue&&t.operationQueue.prependBlocker(v),t.trackSourceBuffer(v,m)}}}),d(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),d()}},e.onMediaDetaching=function(t,r){var i=this,n=!!r.transferMedia;this.transferData=this.overrides=void 0;var o=this.media,l=this.mediaSource,u=this._objectUrl;if(l){if(this.log("media source "+(n?"transferring":"detaching")),n)this.sourceBuffers.forEach(function(f){var g=f[0];g&&i.removeBuffer(g)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){var d=l.readyState==="open";try{for(var h=l.sourceBuffers,c=h.length;c--;)d&&h[c].abort(),l.removeSourceBuffer(h[c]);d&&l.endOfStream()}catch(f){this.warn("onMediaDetaching: "+f.message+" while calling endOfStream")}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}o&&(o.removeEventListener("emptied",this._onMediaEmptied),n||(u&&self.URL.revokeObjectURL(u),this.mediaSrc===u?(o.removeAttribute("src"),this.appendSource&&ys(o),o.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(p.MEDIA_DETACHED,r)},e.onBufferReset=function(){var t=this;this.sourceBuffers.forEach(function(r){var i=r[0];i&&t.resetBuffer(i)}),this.initTracks()},e.resetBuffer=function(t){var r,i=(r=this.tracks[t])==null?void 0:r.buffer;if(this.removeBuffer(t),i)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(o){this.warn("onBufferReset "+t,o)}delete this.tracks[t]},e.removeBuffer=function(t){this.removeBufferListeners(t),this.sourceBuffers[Ki(t)]=[null,null];var r=this.tracks[t];r&&(r.buffer=void 0)},e.resetQueue=function(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new Rl(this.tracks)},e.onBufferCodecs=function(t,r){var i=this,n=this.tracks,o=Object.keys(r);this.log('BUFFER_CODECS: "'+o+'" (current SB count '+this.sourceBufferCount+")");var l="audiovideo"in r&&(n.audio||n.video)||n.audiovideo&&("audio"in r||"video"in r),u=!l&&this.sourceBufferCount&&this.media&&o.some(function(d){return!n[d]});l||u?this.warn('Unsupported transition between "'+Object.keys(n)+'" and "'+o+'" SourceBuffers'):(o.forEach(function(d){var h,c,f,g=r[d],v=g.id,m=g.codec,y=g.levelCodec,E=g.container,T=g.metadata,S=g.supplemental,I=n[d],L=(h=i.transferData)==null||(c=h.tracks)==null?void 0:c[d],A=L!=null&&L.buffer?L:I,b=(A==null?void 0:A.pendingCodec)||(A==null?void 0:A.codec),R=A==null?void 0:A.levelCodec;I||(I=n[d]={buffer:void 0,listeners:[],codec:m,supplemental:S,container:E,levelCodec:y,metadata:T,id:v});var k=vr(b,R),_=k==null?void 0:k.replace(ms,"$1"),C=vr(m,y),x=(f=C)==null?void 0:f.replace(ms,"$1");C&&k&&_!==x&&(d.slice(0,5)==="audio"&&(C=gr(C,i.appendSource)),i.log("switching codec "+b+" to "+C),C!==(I.pendingCodec||I.codec)&&(I.pendingCodec=C),I.container=E,i.appendChangeType(d,E,C))}),(this.tracksReady||this.sourceBufferCount)&&(r.tracks=this.sourceBufferTracks),this.sourceBufferCount||this.mediaSourceOpenOrEnded&&this.checkPendingTracks())},e.appendChangeType=function(t,r,i){var n=this,o=r+";codecs="+i,l={label:"change-type="+o,execute:function(){var u=n.tracks[t];if(u){var d=u.buffer;d!=null&&d.changeType&&(n.log("changing "+t+" sourceBuffer type to "+o),d.changeType(o),u.codec=i,u.container=r)}n.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(u){n.warn("Failed to change "+t+" SourceBuffer type",u)}};this.append(l,t,this.isPending(this.tracks[t]))},e.blockAudio=function(t){var r,i=this,n=t.start,o=n+.05*t.duration;if(((r=this.fragmentTracker.getAppendedFrag(n,J))==null?void 0:r.gap)!==!0){var l={label:"block-audio",execute:function(){var u,d=i.tracks.video;(i.lastVideoAppendEnd>o||d!=null&&d.buffer&&tt.isBuffered(d.buffer,o)||((u=i.fragmentTracker.getAppendedFrag(o,J))==null?void 0:u.gap)===!0)&&(i.blockedAudioAppend=null,i.shiftAndExecuteNext("audio"))},onStart:function(){},onComplete:function(){},onError:function(u){i.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:l,frag:t},this.append(l,"audio",!0)}},e.unblockAudio=function(){var t=this.blockedAudioAppend,r=this.operationQueue;t&&r&&(this.blockedAudioAppend=null,r.unblockAudio(t.op))},e.onBufferAppending=function(t,r){var i=this,n=this.tracks,o=r.data,l=r.type,u=r.parent,d=r.frag,h=r.part,c=r.chunkMeta,f=c.buffering[l],g=d.sn,v=self.performance.now();f.start=v;var m=d.stats.buffering,y=h?h.stats.buffering:null;m.start===0&&(m.start=v),y&&y.start===0&&(y.start=v);var E=n.audio,T=!1;l==="audio"&&(E==null?void 0:E.container)==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var S=this.tracks.video,I=S==null?void 0:S.buffer;if(I&&g!=="initSegment"){var L=h||d,A=this.blockedAudioAppend;if(l!=="audio"||u==="main"||this.blockedAudioAppend){if(l==="video"){var b=L.end;if(A){var R=A.frag.start;(b>R||b<this.lastVideoAppendEnd||tt.isBuffered(I,R))&&this.unblockAudio()}this.lastVideoAppendEnd=b}}else{var k=L.start+.05*L.duration,_=I.buffered,C=this.currentOp("video");_.length||C?!C&&!tt.isBuffered(I,k)&&this.lastVideoAppendEnd<k&&this.blockAudio(L):this.blockAudio(L)}}var x=(h||d).start,w={label:"append-"+l,execute:function(){if(f.executeStart=self.performance.now(),T){var P=i.tracks[l];if(P){var M=P.buffer;if(M){var F=x-M.timestampOffset;Math.abs(F)>=.1&&(i.log("Updating audio SourceBuffer timestampOffset to "+x+" (delta: "+F+") sn: "+g+")"),M.timestampOffset=x)}}}i.appendExecutor(o,l)},onStart:function(){},onComplete:function(){var P=self.performance.now();f.executeEnd=f.end=P,m.first===0&&(m.first=P),y&&y.first===0&&(y.first=P);var M={};i.sourceBuffers.forEach(function(F){var U=F[0],G=F[1];U&&(M[U]=tt.getBuffered(G))}),i.appendErrors[l]=0,l==="audio"||l==="video"?i.appendErrors.audiovideo=0:(i.appendErrors.audio=0,i.appendErrors.video=0),i.hls.trigger(p.BUFFER_APPENDED,{type:l,frag:d,part:h,chunkMeta:c,parent:d.type,timeRanges:M})},onError:function(P){var M,F={type:K.MEDIA_ERROR,parent:d.type,details:D.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:d,part:h,chunkMeta:c,error:P,err:P,fatal:!1},U=(M=i.media)==null?void 0:M.error;if(P.code===DOMException.QUOTA_EXCEEDED_ERR)F.details=D.BUFFER_FULL_ERROR;else if(P.code===DOMException.INVALID_STATE_ERR&&i.mediaSourceOpenOrEnded&&!U)F.errorAction=ze(!0);else if(P.name===ps&&i.sourceBufferCount===0)F.errorAction=ze(!0);else{var G=++i.appendErrors[l];i.warn("Failed "+G+"/"+i.hls.config.appendErrorMaxRetry+' times to append segment in "'+l+'" sourceBuffer ('+(U||"no media error")+")"),(G>=i.hls.config.appendErrorMaxRetry||U)&&(F.fatal=!0)}i.hls.trigger(p.ERROR,F)}};this.append(w,l,this.isPending(this.tracks[l]))},e.getFlushOp=function(t,r,i){var n=this;return this.log('queuing "'+t+'" remove '+r+"-"+i),{label:"remove",execute:function(){n.removeExecutor(t,r,i)},onStart:function(){},onComplete:function(){n.hls.trigger(p.BUFFER_FLUSHED,{type:t})},onError:function(o){n.warn("Failed to remove "+r+"-"+i+' from "'+t+'" SourceBuffer',o)}}},e.onBufferFlushing=function(t,r){var i=this,n=r.type,o=r.startOffset,l=r.endOffset;n?this.append(this.getFlushOp(n,o,l),n):this.sourceBuffers.forEach(function(u){var d=u[0];d&&i.append(i.getFlushOp(d,o,l),d)})},e.onFragParsed=function(t,r){var i=this,n=r.frag,o=r.part,l=[],u=o?o.elementaryStreams:n.elementaryStreams;u[Qr]?l.push("audiovideo"):(u[Ft]&&l.push("audio"),u[Ht]&&l.push("video")),l.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var d=self.performance.now();n.stats.buffering.end=d,o&&(o.stats.buffering.end=d);var h=o?o.stats:n.stats;i.hls.trigger(p.FRAG_BUFFERED,{frag:n,part:o,stats:h,id:n.type})},l).catch(function(d){i.warn("Fragment buffered callback "+d),i.stepOperationQueue(i.sourceBufferTypes)})},e.onFragChanged=function(t,r){this.trimBuffers()},e.onBufferEos=function(t,r){var i,n=this;this.sourceBuffers.forEach(function(l){var u=l[0];if(u){var d=n.tracks[u];r.type&&r.type!==u||(d.ending=!0,d.ended||(d.ended=!0,n.log(u+" buffer reached EOS")))}});var o=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(function(l){var u,d=l[0];return d&&!((u=n.tracks[d])!=null&&u.ended)})&&(o?(this.log("Queueing EOS"),this.blockUntilOpen(function(){n.tracksEnded();var l=n.mediaSource;l&&l.readyState==="open"?(n.log("Calling mediaSource.endOfStream()"),l.endOfStream(),n.hls.trigger(p.BUFFERED_TO_END,void 0)):l&&n.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+l.readyState)})):(this.tracksEnded(),this.hls.trigger(p.BUFFERED_TO_END,void 0)))},e.tracksEnded=function(){var t=this;this.sourceBuffers.forEach(function(r){var i=r[0];if(i!==null){var n=t.tracks[i];n&&(n.ending=!1)}})},e.onLevelUpdated=function(t,r){var i=r.details;i.fragments.length&&(this.details=i,this.updateDuration())},e.updateDuration=function(){var t=this,r=this.getDurationAndRange();r&&this.blockUntilOpen(function(){return t.updateMediaSource(r)})},e.onError=function(t,r){if(r.details===D.BUFFER_APPEND_ERROR&&r.frag){var i,n=(i=r.errorAction)==null?void 0:i.nextAutoLevel;B(n)&&n!==r.frag.level&&this.resetAppendErrors()}},e.resetAppendErrors=function(){this.appendErrors={audio:0,video:0,audiovideo:0}},e.trimBuffers=function(){var t=this.hls,r=this.details,i=this.media;if(i&&r!==null&&this.sourceBufferCount){var n=t.config,o=i.currentTime,l=r.levelTargetDuration,u=r.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(B(u)&&u>=0){var d=Math.max(u,l),h=Math.floor(o/l)*l-d;this.flushBackBuffer(o,l,h)}if(B(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){var c=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),f=Math.max(c,l),g=Math.floor(o/l)*l+f;this.flushFrontBuffer(o,l,g)}}},e.flushBackBuffer=function(t,r,i){var n=this;this.sourceBuffers.forEach(function(o){var l=o[0],u=o[1];if(u){var d=tt.getBuffered(u);if(d.length>0&&i>d.start(0)){var h;n.hls.trigger(p.BACK_BUFFER_REACHED,{bufferEnd:i});var c=n.tracks[l];if((h=n.details)!=null&&h.live)n.hls.trigger(p.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(c!=null&&c.ended)return void n.log("Cannot flush "+l+" back buffer while SourceBuffer is in ended state");n.hls.trigger(p.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:l})}}})},e.flushFrontBuffer=function(t,r,i){var n=this;this.sourceBuffers.forEach(function(o){var l=o[0],u=o[1];if(u){var d=tt.getBuffered(u),h=d.length;if(h<2)return;var c=d.start(h-1),f=d.end(h-1);if(i>c||t>=c&&t<=f)return;n.hls.trigger(p.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:l})}})},e.getDurationAndRange=function(){var t,r=this.details,i=this.mediaSource;if(!r||!this.media||(i==null?void 0:i.readyState)!=="open")return null;var n=r.edge;if(r.live&&this.hls.config.liveDurationInfinity){if(r.fragments.length&&r.live&&i.setLiveSeekableRange){var o=Math.max(0,r.fragmentStart);return{duration:1/0,start:o,end:Math.max(o,n)}}return{duration:1/0}}var l=(t=this.overrides)==null?void 0:t.duration;if(l)return B(l)?{duration:l}:null;var u=this.media.duration;return n>(B(i.duration)?i.duration:0)&&n>u||!B(u)?{duration:n}:null},e.updateMediaSource=function(t){var r=t.duration,i=t.start,n=t.end,o=this.mediaSource;this.media&&o&&o.readyState==="open"&&(o.duration!==r&&(B(r)&&this.log("Updating MediaSource duration to "+r.toFixed(3)),o.duration=r),i!==void 0&&n!==void 0&&(this.log("MediaSource duration is set to "+o.duration+". Setting seekable range to "+i+"-"+n+"."),o.setLiveSeekableRange(i,n)))},e.checkPendingTracks=function(){var t=this.bufferCodecEventsTotal,r=this.pendingTrackCount,i=this.tracks;if(this.log("checkPendingTracks (pending: "+r+" codec events expected: "+t+") "+pt(i)),this.tracksReady){var n,o=(n=this.transferData)==null?void 0:n.tracks;o&&Object.keys(o).length?this.attachTransferred():this.createSourceBuffers()}},e.bufferCreated=function(){var t=this;if(this.sourceBufferCount){var r={};this.sourceBuffers.forEach(function(n){var o=n[0],l=n[1];if(o){var u=t.tracks[o];r[o]={buffer:l,container:u.container,codec:u.codec,supplemental:u.supplemental,levelCodec:u.levelCodec,id:u.id,metadata:u.metadata}}}),this.hls.trigger(p.BUFFER_CREATED,{tracks:r}),this.log("SourceBuffers created. Running queue: "+this.operationQueue),this.sourceBuffers.forEach(function(n){var o=n[0];t.executeNext(o)})}else{var i=new Error("could not create source buffer for media codec(s)");this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:i,reason:i.message})}},e.createSourceBuffers=function(){var t=this.tracks,r=this.sourceBuffers,i=this.mediaSource;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(var n in t){var o=n,l=t[o];if(this.isPending(l)){var u=this.getTrackCodec(l,o),d=l.container+";codecs="+u;l.codec=u,this.log("creating sourceBuffer("+d+")"+(this.currentOp(o)?" Queued":"")+" "+pt(l));try{var h=i.addSourceBuffer(d),c=Ki(o),f=[o,h];r[c]=f,l.buffer=h}catch(v){var g;return this.error("error while trying to add sourceBuffer: "+v.message),this.shiftAndExecuteNext(o),(g=this.operationQueue)==null||g.removeBlockers(),delete this.tracks[o],void this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:v,sourceBufferName:o,mimeType:d,parent:l.id})}this.trackSourceBuffer(o,l)}}this.bufferCreated()},e.getTrackCodec=function(t,r){var i=t.supplemental,n=t.codec;i&&(r==="video"||r==="audiovideo")&&ei(i,"video")&&(n=function(l,u){var d=[];if(l)for(var h=l.split(","),c=0;c<h.length;c++)Mn(h[c],"video")||d.push(h[c]);return u&&d.push(u),d.join(",")}(n,i));var o=vr(n,t.levelCodec);return o?r.slice(0,5)==="audio"?gr(o,this.appendSource):o:""},e.trackSourceBuffer=function(t,r){var i=this,n=r.buffer;if(n){var o=this.getTrackCodec(r,t);this.tracks[t]={buffer:n,codec:o,container:r.container,levelCodec:r.levelCodec,supplemental:r.supplemental,metadata:r.metadata,id:r.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",function(l,u){var d=u.removedRanges;d!=null&&d.length&&i.hls.trigger(p.BUFFER_FLUSHED,{type:l})})}},e.onSBUpdateStart=function(t){var r=this.currentOp(t);r&&r.onStart()},e.onSBUpdateEnd=function(t){var r;if(((r=this.mediaSource)==null?void 0:r.readyState)!=="closed"){var i=this.currentOp(t);i&&(i.onComplete(),this.shiftAndExecuteNext(t))}else this.resetBuffer(t)},e.onSBUpdateError=function(t,r){var i,n=new Error(t+" SourceBuffer error. MediaSource readyState: "+((i=this.mediaSource)==null?void 0:i.readyState));this.error(""+n,r),this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:n,fatal:!1});var o=this.currentOp(t);o&&o.onError(n)},e.removeExecutor=function(t,r,i){var n=this.media,o=this.mediaSource,l=this.tracks[t],u=l==null?void 0:l.buffer;if(!n||!o||!u)return this.warn("Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void this.shiftAndExecuteNext(t);var d=B(n.duration)?n.duration:1/0,h=B(o.duration)?o.duration:1/0,c=Math.max(0,r),f=Math.min(i,d,h);f>c&&(!l.ending||l.ended)?(l.ended=!1,this.log("Removing ["+c+","+f+"] from the "+t+" SourceBuffer"),u.remove(c,f)):this.shiftAndExecuteNext(t)},e.appendExecutor=function(t,r){var i=this.tracks[r],n=i==null?void 0:i.buffer;if(!n)throw new Il("Attempting to append to the "+r+" SourceBuffer, but it does not exist");i.ending=!1,i.ended=!1,n.appendBuffer(t)},e.blockUntilOpen=function(t){var r=this;if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(function(i){r.warn("SourceBuffer blocked callback "+i),r.stepOperationQueue(r.sourceBufferTypes)});else try{t()}catch(i){this.warn("Callback run without blocking "+this.operationQueue+" "+i)}},e.isUpdating=function(){return this.sourceBuffers.some(function(t){var r=t[0],i=t[1];return r&&i.updating})},e.isQueued=function(){var t=this;return this.sourceBuffers.some(function(r){var i=r[0];return i&&!!t.currentOp(i)})},e.isPending=function(t){return!!t&&!t.buffer},e.blockBuffers=function(t,r){var i=this;if(r===void 0&&(r=this.sourceBufferTypes),!r.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);var n=this.operationQueue,o=r.map(function(l){return i.appendBlocker(l)});return r.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(o).then(function(l){n===i.operationQueue&&(t(),i.stepOperationQueue(i.sourceBufferTypes))})},e.stepOperationQueue=function(t){var r=this;t.forEach(function(i){var n,o=(n=r.tracks[i])==null?void 0:n.buffer;o&&!o.updating&&r.shiftAndExecuteNext(i)})},e.append=function(t,r,i){this.operationQueue&&this.operationQueue.append(t,r,i)},e.appendBlocker=function(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)},e.currentOp=function(t){return this.operationQueue?this.operationQueue.current(t):null},e.executeNext=function(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)},e.shiftAndExecuteNext=function(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)},e.addBufferListener=function(t,r,i){var n=this.tracks[t];if(n){var o=n.buffer;if(o){var l=i.bind(this,t);n.listeners.push({event:r,listener:l}),o.addEventListener(r,l)}}},e.removeBufferListeners=function(t){var r=this.tracks[t];if(r){var i=r.buffer;i&&(r.listeners.forEach(function(n){i.removeEventListener(n.event,n.listener)}),r.listeners.length=0)}},dt(a,[{key:"mediaSourceOpenOrEnded",get:function(){var t,r=(t=this.mediaSource)==null?void 0:t.readyState;return r==="open"||r==="ended"}},{key:"sourceBufferTracks",get:function(){var t=this;return Object.keys(this.tracks).reduce(function(r,i){var n=t.tracks[i];return r[i]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},r},{})}},{key:"bufferedToEnd",get:function(){var t=this;return this.sourceBufferCount>0&&!this.sourceBuffers.some(function(r){var i,n,o=r[0];return o&&(!((i=t.tracks[o])!=null&&i.ended)||((n=t.tracks[o])==null?void 0:n.ending))})}},{key:"tracksReady",get:function(){var t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}},{key:"mediaSrc",get:function(){var t,r,i=((t=this.media)==null||(r=t.querySelector)==null?void 0:r.call(t,"source"))||this.media;return i==null?void 0:i.src}},{key:"pendingTrackCount",get:function(){var t=this;return Object.keys(this.tracks).reduce(function(r,i){return r+(t.isPending(t.tracks[i])?1:0)},0)}},{key:"sourceBufferCount",get:function(){return this.sourceBuffers.reduce(function(t,r){return t+(r[0]?1:0)},0)}},{key:"sourceBufferTypes",get:function(){return this.sourceBuffers.map(function(t){return t[0]}).filter(function(t){return!!t})}}])}(oe);function ys(s){var a=s.querySelectorAll("source");[].slice.call(a).forEach(function(e){s.removeChild(e)})}function Ki(s){return s==="audio"?1:0}var ar,bl=function(){function s(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var a=s.prototype;return a.setStreamController=function(e){this.streamController=e},a.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var e=this.hls;e.on(p.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.MANIFEST_PARSED,this.onManifestParsed,this),e.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(p.BUFFER_CODECS,this.onBufferCodecs,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var e=this.hls;e.off(p.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.MANIFEST_PARSED,this.onManifestParsed,this),e.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(p.BUFFER_CODECS,this.onBufferCodecs,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},a.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},a.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onLevelsUpdated=function(e,t){this.timer&&B(this.autoLevelCapping)&&this.detectPlayerSize()},a.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping(),this.media=null},a.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);var e=this.hls.levels;if(e.length){var t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log("Setting autoLevelCapping to "+r+": "+e[r].height+"p@"+e[r].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},a.getMaxLevel=function(e){var t=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter(function(n,o){return t.isLevelAllowed(n)&&o<=e});return this.clientRect=null,s.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},a.isLevelAllowed=function(e){return!this.restrictedLevels.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})},s.getMaxLevelByMediaSize=function(e,t,r){if(e==null||!e.length)return-1;for(var i,n,o=e.length-1,l=Math.max(t,r),u=0;u<e.length;u+=1){var d=e[u];if((d.width>=l||d.height>=l)&&(i=d,!(n=e[u+1])||i.width!==n.width||i.height!==n.height)){o=u;break}}return o},dt(s,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}}])}(),Nt={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Dl={HLS:"h"},sr={OBJECT:"CMCD-Object",REQUEST:"CMCD-Request",SESSION:"CMCD-Session",STATUS:"CMCD-Status"},_l=((ar={})[sr.OBJECT]=["br","d","ot","tb"],ar[sr.REQUEST]=["bl","dl","mtp","nor","nrr","su"],ar[sr.SESSION]=["cid","pr","sf","sid","st","v"],ar[sr.STATUS]=["bs","rtp"],ar),Hi=function s(a,e){Array.isArray(a)&&(a=a.map(function(t){return t instanceof s?t:new s(t)})),this.value=a,this.params=e},Pl="Dict";function Cl(s,a,e,t){return new Error("failed to "+s+' "'+(r=a,(Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r))+'" as ')+e,{cause:t});var r}function ie(s,a,e){return Cl("serialize",s,a,e)}var Es=function(s){this.description=s},Ts="Bare Item",wl="Boolean",xl="Byte Sequence";function Ol(s){if(ArrayBuffer.isView(s)===!1)throw ie(s,xl);return":"+(a=s,btoa(String.fromCharCode.apply(String,a))+":");var a}var Ml="Integer";function Ss(s){if(function(a){return a<-999999999999999||999999999999999<a}(s))throw ie(s,Ml);return s.toString()}var Fl="Decimal";function Nl(s){var a=qa(s,3);if(Math.floor(Math.abs(a)).toString().length>12)throw ie(s,Fl);var e=a.toString();return e.includes(".")?e:e+".0"}var Ul="String",Bl=/[\x00-\x1f\x7f]+/,Gl="Token";function Ls(s){var a,e=(a=s).description||a.toString().slice(7,-1);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ie(e,Gl);return e}function Vi(s){switch(typeof s){case"number":if(!B(s))throw ie(s,Ts);return Number.isInteger(s)?Ss(s):Nl(s);case"string":return function(a){if(Bl.test(a))throw ie(a,Ul);return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}(s);case"symbol":return Ls(s);case"boolean":return function(a){if(typeof a!="boolean")throw ie(a,wl);return a?"?1":"?0"}(s);case"object":if(s instanceof Date)return function(a){return"@"+Ss(a.getTime()/1e3)}(s);if(s instanceof Uint8Array)return Ol(s);if(s instanceof Es)return Ls(s);default:throw ie(s,Ts)}}var Kl="Key";function Yi(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw ie(s,Kl);return s}function Wi(s){return s==null?"":Object.entries(s).map(function(a){var e=a[0],t=a[1];return t===!0?";"+Yi(e):";"+Yi(e)+"="+Vi(t)}).join("")}function As(s){return s instanceof Hi?""+Vi(s.value)+Wi(s.params):Vi(s)}function Hl(s,a){if(a===void 0&&(a={whitespace:!0}),typeof s!="object")throw ie(s,Pl);var e=s instanceof Map?s.entries():Object.entries(s),t=a!=null&&a.whitespace?" ":"";return Array.from(e).map(function(r){var i=r[0],n=r[1];n instanceof Hi==0&&(n=new Hi(n));var o,l=Yi(i);return n.value===!0?l+=Wi(n.params):(l+="=",Array.isArray(n.value)?l+="("+(o=n).value.map(As).join(" ")+")"+Wi(o.params):l+=As(n)),l}).join(","+t)}var Mr=function(s){return Math.round(s)},Fr=function(s){return 100*Mr(s/100)},Vl={br:Mr,d:Mr,bl:Fr,dl:Fr,mtp:Fr,nor:function(s,a){return a!=null&&a.baseUrl&&(s=function(e,t){var r=new URL(e),i=new URL(t);if(r.origin!==i.origin)return e;for(var n=r.pathname.split("/").slice(1),o=i.pathname.split("/").slice(1,-1);n[0]===o[0];)n.shift(),o.shift();for(;o.length;)o.shift(),n.unshift("..");return n.join("/")}(s,a.baseUrl)),encodeURIComponent(s)},rtp:Fr,tb:Mr};function Yl(s,a){var e={};if(s==null||typeof s!="object")return e;var t=Object.keys(s).sort(),r=ot({},Vl,a==null?void 0:a.formatters),i=a==null?void 0:a.filter;return t.forEach(function(n){if(!(i!=null&&i(n))){var o=s[n],l=r[n];l&&(o=l(o,a)),n==="v"&&o===1||n=="pr"&&o===1||function(u){return typeof u=="number"?B(u):u!=null&&u!==""&&u!==!1}(o)&&(function(u){return u==="ot"||u==="sf"||u==="st"}(n)&&typeof o=="string"&&(o=new Es(o)),e[n]=o)}}),e}function Rs(s,a){return a===void 0&&(a={}),s?function(e,t){return Hl(e,t)}(Yl(s,a),ot({whitespace:!1},a)):""}function Wl(s,a,e){return ot(s,function(t,r){r===void 0&&(r={});var i={};if(!t)return i;var n=Object.entries(t),o=Object.entries(_l).concat(Object.entries((r==null?void 0:r.customHeaderMap)||{})),l=n.reduce(function(u,d){var h,c,f=d[0],g=d[1],v=((h=o.find(function(m){return m[1].includes(f)}))===null||h===void 0?void 0:h[0])||sr.REQUEST;return(c=u[v])!==null&&c!==void 0||(u[v]={}),u[v][f]=g,u},{});return Object.entries(l).reduce(function(u,d){var h=d[0],c=d[1];return u[h]=Rs(c,r),u},i)}(a,e))}var jl="CMCD",Is=/CMCD=[^&#]+/;function ql(s,a,e){var t=function(i,n){if(n===void 0&&(n={}),!i)return"";var o=Rs(i,n);return jl+"="+encodeURIComponent(o)}(a,e);if(!t)return s;if(Is.test(s))return s.replace(Is,t);var r=s.includes("?")?"&":"?";return""+s+r+t}var Xl=function(){function s(e){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(n){try{t.apply(n,{ot:Nt.MANIFEST,su:!t.initialized})}catch(o){t.hls.logger.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(n){try{var o=n.frag,l=n.part,u=t.hls.levels[o.level],d=t.getObjectType(o),h={d:1e3*(l||o).duration,ot:d};d!==Nt.VIDEO&&d!==Nt.AUDIO&&d!=Nt.MUXED||(h.br=u.bitrate/1e3,h.tb=t.getTopBandwidth(d)/1e3,h.bl=t.getBufferLength(d));var c=l?t.getNextPart(l):t.getNextFrag(o);c!=null&&c.url&&c.url!==o.url&&(h.nor=c.url),t.apply(n,h)}catch(f){t.hls.logger.warn("Could not generate segment CMCD data.",f)}},this.hls=e;var r=this.config=e.config,i=r.cmcd;i!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}var a=s.prototype;return a.registerListeners=function(){var e=this.hls;e.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.MEDIA_DETACHED,this.onMediaDetached,this),e.on(p.BUFFER_CREATED,this.onBufferCreated,this)},a.unregisterListeners=function(){var e=this.hls;e.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.MEDIA_DETACHED,this.onMediaDetached,this),e.off(p.BUFFER_CREATED,this.onBufferCreated,this)},a.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null},a.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},a.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},a.onBufferCreated=function(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer},a.createData=function(){var e;return{v:1,sf:Dl.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},a.apply=function(e,t){t===void 0&&(t={}),ot(t,this.createData());var r=t.ot===Nt.INIT||t.ot===Nt.VIDEO||t.ot===Nt.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);var i=this.includeKeys;i&&(t=Object.keys(t).reduce(function(o,l){return i.includes(l)&&(o[l]=t[l]),o},{}));var n={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Wl(e.headers,t,n)):e.url=ql(e.url,t,n)},a.getNextFrag=function(e){var t,r=(t=this.hls.levels[e.level])==null?void 0:t.details;if(r){var i=e.sn-r.startSN;return r.fragments[i+1]}},a.getNextPart=function(e){var t,r,i=e.index,n=e.fragment,o=(t=this.hls.levels[n.level])==null||(r=t.details)==null?void 0:r.partList;if(o)for(var l=n.sn,u=o.length-1;u>=0;u--){var d=o[u];if(d.index===i&&d.fragment.sn===l)return o[u+1]}},a.getObjectType=function(e){var t=e.type;return t==="subtitle"?Nt.TIMED_TEXT:e.sn==="initSegment"?Nt.INIT:t==="audio"?Nt.AUDIO:t==="main"?this.hls.audioTracks.length?Nt.VIDEO:Nt.MUXED:void 0},a.getTopBandwidth=function(e){var t,r=0,i=this.hls;if(e===Nt.AUDIO)t=i.audioTracks;else{var n=i.maxAutoLevel,o=n>-1?n+1:i.levels.length;t=i.levels.slice(0,o)}for(var l,u=so(t);!(l=u()).done;){var d=l.value;d.bitrate>r&&(r=d.bitrate)}return r>0?r:NaN},a.getBufferLength=function(e){var t=this.media,r=e===Nt.AUDIO?this.audioBuffer:this.videoBuffer;return r&&t?1e3*tt.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len:NaN},a.createPlaylistLoader=function(){var e=this.config.pLoader,t=this.applyPlaylistData,r=e||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var n=i.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(o,l,u){t(o),this.loader.load(o,l,u)},dt(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])}()},a.createFragmentLoader=function(){var e=this.config.fLoader,t=this.applyFragmentData,r=e||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var n=i.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(o,l,u){t(o),this.loader.load(o,l,u)},dt(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}])}()},s}(),zl=function(s){function a(t){var r;return(r=s.call(this,"content-steering",t.logger)||this).hls=void 0,r.loader=null,r.uri=null,r.pathwayId=".",r._pathwayPriority=null,r.timeToLoad=300,r.reloadTimer=-1,r.updated=0,r.started=!1,r.enabled=!0,r.levels=null,r.audioTracks=null,r.subtitleTracks=null,r.penalizedPathways={},r.hls=t,r.registerListeners(),r}ut(a,s);var e=a.prototype;return e.registerListeners=function(){var t=this.hls;t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(p.MANIFEST_PARSED,this.onManifestParsed,this),t.on(p.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(p.MANIFEST_PARSED,this.onManifestParsed,this),t.off(p.ERROR,this.onError,this))},e.pathways=function(){return(this.levels||[]).reduce(function(t,r){return t.indexOf(r.pathwayId)===-1&&t.push(r.pathwayId),t},[])},e.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}},e.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},e.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},e.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},e.removeLevel=function(t){var r=this.levels;r&&(this.levels=r.filter(function(i){return i!==t}))},e.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},e.onManifestLoaded=function(t,r){var i=r.contentSteering;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())},e.onManifestParsed=function(t,r){this.audioTracks=r.audioTracks,this.subtitleTracks=r.subtitleTracks},e.onError=function(t,r){var i=r.errorAction;if((i==null?void 0:i.action)===le&&i.flags===Sr){var n=this.levels,o=this._pathwayPriority,l=this.pathwayId;if(r.context){var u=r.context,d=u.groupId,h=u.pathwayId,c=u.type;d&&n?l=this.getPathwayForGroupId(d,c,l):h&&(l=h)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!o&&n&&(o=this.pathways()),o&&o.length>1&&(this.updatePathwayPriority(o),i.resolved=this.pathwayId!==l),i.resolved||this.warn("Could not resolve "+r.details+' ("'+r.error.message+'") with content-steering for Pathway: '+l+" levels: "+(n&&n.length)+" priorities: "+pt(o)+" penalized: "+pt(this.penalizedPathways))}},e.filterParsedLevels=function(t){this.levels=t;var r=this.getLevelsForPathway(this.pathwayId);if(r.length===0){var i=t[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+i+'"'),r=this.getLevelsForPathway(i),this.pathwayId=i}return r.length!==t.length&&this.log("Found "+r.length+"/"+t.length+' levels in Pathway "'+this.pathwayId+'"'),r},e.getLevelsForPathway=function(t){return this.levels===null?[]:this.levels.filter(function(r){return t===r.pathwayId})},e.updatePathwayPriority=function(t){var r;this._pathwayPriority=t;var i=this.penalizedPathways,n=performance.now();Object.keys(i).forEach(function(c){n-i[c]>3e5&&delete i[c]});for(var o=0;o<t.length;o++){var l=t[o];if(!(l in i)){if(l===this.pathwayId)return;var u=this.hls.nextLoadLevel,d=this.hls.levels[u];if((r=this.getLevelsForPathway(l)).length>0){this.log('Setting Pathway to "'+l+'"'),this.pathwayId=l,Ma(r),this.hls.trigger(p.LEVELS_UPDATED,{levels:r});var h=this.hls.levels[u];d&&h&&this.levels&&(h.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&h.bitrate!==d.bitrate&&this.log("Unstable Pathways change from bitrate "+d.bitrate+" to "+h.bitrate),this.hls.nextLoadLevel=u);break}}}},e.getPathwayForGroupId=function(t,r,i){for(var n=this.getLevelsForPathway(i).concat(this.levels||[]),o=0;o<n.length;o++)if(r===zt&&n[o].hasAudioGroup(t)||r===$t&&n[o].hasSubtitleGroup(t))return n[o].pathwayId;return i},e.clonePathways=function(t){var r=this,i=this.levels;if(i){var n={},o={};t.forEach(function(l){var u=l.ID,d=l["BASE-ID"],h=l["URI-REPLACEMENT"];if(!i.some(function(f){return f.pathwayId===u})){var c=r.getLevelsForPathway(d).map(function(f){var g=new Lt(f.attrs);g["PATHWAY-ID"]=u;var v=g.AUDIO&&g.AUDIO+"_clone_"+u,m=g.SUBTITLES&&g.SUBTITLES+"_clone_"+u;v&&(n[g.AUDIO]=v,g.AUDIO=v),m&&(o[g.SUBTITLES]=m,g.SUBTITLES=m);var y=bs(f.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),E=new qe({attrs:g,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:y,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(var T=1;T<f.audioGroups.length;T++)E.addGroupId("audio",f.audioGroups[T]+"_clone_"+u);if(f.subtitleGroups)for(var S=1;S<f.subtitleGroups.length;S++)E.addGroupId("text",f.subtitleGroups[S]+"_clone_"+u);return E});i.push.apply(i,c),ks(r.audioTracks,n,h,u),ks(r.subtitleTracks,o,h,u)}})}},e.loadSteeringManifest=function(t){var r,i=this,n=this.hls.config,o=n.loader;this.loader&&this.loader.destroy(),this.loader=new o(n);try{r=new self.URL(t)}catch{return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+t)}if(r.protocol!=="data:"){var l=0|(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate);r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+l)}var u={responseType:"json",url:r.href},d=n.steeringManifestLoadPolicy.default,h=d.errorRetry||d.timeoutRetry||{},c={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:h.maxNumRetry||0,retryDelay:h.retryDelayMs||0,maxRetryDelay:h.maxRetryDelayMs||0},f={onSuccess:function(g,v,m,y){i.log('Loaded steering manifest: "'+r+'"');var E=g.data;if((E==null?void 0:E.VERSION)===1){i.updated=performance.now(),i.timeToLoad=E.TTL;var T=E["RELOAD-URI"],S=E["PATHWAY-CLONES"],I=E["PATHWAY-PRIORITY"];if(T)try{i.uri=new self.URL(T,r).href}catch{return i.enabled=!1,void i.log("Failed to parse Steering Manifest RELOAD-URI: "+T)}i.scheduleRefresh(i.uri||m.url),S&&i.clonePathways(S);var L={steeringManifest:E,url:r.toString()};i.hls.trigger(p.STEERING_MANIFEST_LOADED,L),I&&i.updatePathwayPriority(I)}else i.log("Steering VERSION "+E.VERSION+" not supported!")},onError:function(g,v,m,y){if(i.log("Error loading steering manifest: "+g.code+" "+g.text+" ("+v.url+")"),i.stopLoad(),g.code===410)return i.enabled=!1,void i.log("Steering manifest "+v.url+" no longer available");var E=1e3*i.timeToLoad;if(g.code!==429)i.scheduleRefresh(i.uri||v.url,E);else{var T=i.loader;if(typeof(T==null?void 0:T.getResponseHeader)=="function"){var S=T.getResponseHeader("Retry-After");S&&(E=1e3*parseFloat(S))}i.log("Steering manifest "+v.url+" rate limited")}},onTimeout:function(g,v,m){i.log("Timeout loading steering manifest ("+v.url+")"),i.scheduleRefresh(i.uri||v.url)}};this.log("Requesting steering manifest: "+r),this.loader.load(u,c,f)},e.scheduleRefresh=function(t,r){var i=this;r===void 0&&(r=1e3*this.timeToLoad),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var n,o=(n=i.hls)==null?void 0:n.media;!o||o.ended?i.scheduleRefresh(t,1e3*i.timeToLoad):i.loadSteeringManifest(t)},r)},dt(a,[{key:"pathwayPriority",get:function(){return this._pathwayPriority},set:function(t){this.updatePathwayPriority(t)}}])}(oe);function ks(s,a,e,t){s&&Object.keys(a).forEach(function(r){var i=s.filter(function(n){return n.groupId===r}).map(function(n){var o=ot({},n);return o.details=void 0,o.attrs=new Lt(o.attrs),o.url=o.attrs.URI=bs(n.url,n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),o.groupId=o.attrs["GROUP-ID"]=a[r],o.attrs["PATHWAY-ID"]=t,o});s.push.apply(s,i)})}function bs(s,a,e,t){var r,i=t.HOST,n=t.PARAMS,o=t[e];a&&(r=o==null?void 0:o[a])&&(s=r);var l=new self.URL(s);return i&&!r&&(l.host=i),n&&Object.keys(n).sort().forEach(function(u){u&&l.searchParams.set(u,n[u])}),l.href}var Ds=function(s){function a(t){var r;return(r=s.call(this,"eme",t.logger)||this).hls=void 0,r.config=void 0,r.media=null,r.keyFormatPromise=null,r.keySystemAccessPromises={},r._requestLicenseFailureCount=0,r.mediaKeySessions=[],r.keyIdToKeySessionPromise={},r.setMediaKeysQueue=a.CDMCleanupPromise?[a.CDMCleanupPromise]:[],r.onMediaEncrypted=function(i){var n=i.initDataType,o=i.initData,l='"'+i.type+'" event: init data type: "'+n+'"';if(r.debug(l),o!==null){if(!r.keyFormatPromise){var u=Object.keys(r.keySystemAccessPromises);u.length||(u=kr(r.config));var d=u.map(pi).filter(function(h){return!!h});r.keyFormatPromise=r.getKeyFormatPromise(d)}r.keyFormatPromise.then(function(h){var c,f,g=vi(h);if(n==="sinf"){if(g!==st.FAIRPLAY)return void r.warn('Ignoring unexpected "'+i.type+'" event with init data type: "'+n+'" for selected key-system '+g);var v=kt(new Uint8Array(o));try{var m=Cn(hi(JSON.parse(v).sinf));if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");c=new Uint8Array(m.subarray(8,24)),f=st.FAIRPLAY}catch(x){return void r.warn(l+" Failed to parse sinf: "+x)}}else{if(g!==st.WIDEVINE&&g!==st.PLAYREADY)return void r.warn('Ignoring unexpected "'+i.type+'" event with init data type: "'+n+'" for selected key-system '+g);var y=function(x){var w=[];if(x instanceof ArrayBuffer)for(var P=x.byteLength,M=0;M+32<P;){var F=Lo(new DataView(x,M));w.push(F),M+=F.size}return w}(o),E=y.filter(function(x){return!!x.systemId&&mi(x.systemId)===g});E.length>1&&r.warn(l+" Using first of "+E.length+" pssh found for selected key-system "+g);var T=E[0];if(!T)return void(y.length===0||y.some(function(x){return!x.systemId})?r.warn(l+" contains incomplete or invalid pssh data"):r.log("ignoring "+l+" for "+y.map(function(x){return mi(x.systemId)}).join(",")+" pssh data in favor of playlist keys"));if(f=mi(T.systemId),T.version===0&&T.data)if(f===st.WIDEVINE){var S=T.data.length-22;c=new Uint8Array(T.data.subarray(S,S+16))}else f===st.PLAYREADY&&(c=pa(T.data))}if(f&&c){for(var I,L=Jt.hexDump(c),A=r,b=A.keyIdToKeySessionPromise,R=A.mediaKeySessions,k=b[L],_=function(){var x=R[C],w=x.decryptdata;if(!w.keyId)return 0;var P=Jt.hexDump(w.keyId);return L===P||w.uri.replace(/-/g,"").indexOf(L)!==-1?(k=b[P],w.pssh||(delete b[P],w.pssh=new Uint8Array(o),w.keyId=c,(k=b[L]=k.then(function(){return r.generateRequestWithPreferredKeySession(x,n,o,"encrypted-event-key-match")})).catch(function(M){return r.handleError(M)})),1):void 0},C=0;C<R.length&&((I=_())===0||I!==1);C++);if(!k){if(f!==g)return void r.log('Ignoring "'+i.type+'" event with '+f+" init data for selected key-system "+g);k=b[L]=r.getKeySystemSelectionPromise([f]).then(function(x){var w,P=x.keySystem,M=x.mediaKeys;r.throwIfDestroyed();var F=new yi("ISO-23001-7",L,(w=pi(P))!=null?w:"");return F.pssh=new Uint8Array(o),F.keyId=c,r.attemptSetMediaKeys(P,M).then(function(){r.throwIfDestroyed();var U=r.createMediaKeySessionContext({decryptdata:F,keySystem:P,mediaKeys:M});return r.generateRequestWithPreferredKeySession(U,n,o,"encrypted-event-no-match")})}),k.catch(function(x){return r.handleError(x)})}}})}},r.onWaitingForKey=function(i){r.log('"'+i.type+'" event')},r.hls=t,r.config=t.config,r.registerListeners(),r}ut(a,s);var e=a.prototype;return e.destroy=function(){var t=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(t);var r=this.config;r.requestMediaKeySystemAccessFunc=null,r.licenseXhrSetup=r.licenseResponseCallback=void 0,r.drmSystems=r.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null},e.registerListeners=function(){this.hls.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(p.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(p.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(p.MANIFEST_LOADED,this.onManifestLoaded,this)},e.unregisterListeners=function(){this.hls.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(p.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(p.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(p.MANIFEST_LOADED,this.onManifestLoaded,this)},e.getLicenseServerUrl=function(t){var r=this.config,i=r.drmSystems,n=r.widevineLicenseUrl,o=i[t];return o?o.licenseUrl:t===st.WIDEVINE&&n?n:void 0},e.getLicenseServerUrlOrThrow=function(t){var r=this.getLicenseServerUrl(t);if(r===void 0)throw new Error('no license server URL configured for key-system "'+t+'"');return r},e.getServerCertificateUrl=function(t){var r=this.config.drmSystems[t];if(r)return r.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+t+'"]')},e.attemptKeySystemAccess=function(t){var r=this,i=this.hls.levels,n=function(u,d,h){return!!u&&h.indexOf(u)===d},o=i.map(function(u){return u.audioCodec}).filter(n),l=i.map(function(u){return u.videoCodec}).filter(n);return o.length+l.length===0&&l.push("avc1.42e01e"),new Promise(function(u,d){var h=function(c){var f=c.shift();r.getMediaKeysPromise(f,o,l).then(function(g){return u({keySystem:f,mediaKeys:g})}).catch(function(g){c.length?h(c):d(g instanceof Wt?g:new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};h(t)})},e.requestMediaKeySystemAccess=function(t,r){var i=this.config.requestMediaKeySystemAccessFunc;if(typeof i!="function"){var n="Configured requestMediaKeySystemAccess is not a function "+i;return ma===null&&self.location.protocol==="http:"&&(n="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(n))}return i(t,r)},e.getMediaKeysPromise=function(t,r,i){var n=this,o=function(h,c,f,g){var v;switch(h){case st.FAIRPLAY:v=["cenc","sinf"];break;case st.WIDEVINE:case st.PLAYREADY:v=["cenc"];break;case st.CLEARKEY:v=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+h)}return function(m,y,E,T){return[{initDataTypes:m,persistentState:T.persistentState||"optional",distinctiveIdentifier:T.distinctiveIdentifier||"optional",sessionTypes:T.sessionTypes||[T.sessionType||"temporary"],audioCapabilities:y.map(function(S){return{contentType:"audio/mp4; codecs="+S,robustness:T.audioRobustness||"",encryptionScheme:T.audioEncryptionScheme||null}}),videoCapabilities:E.map(function(S){return{contentType:"video/mp4; codecs="+S,robustness:T.videoRobustness||"",encryptionScheme:T.videoEncryptionScheme||null}})}]}(v,c,f,g)}(t,r,i,this.config.drmSystemOptions),l=this.keySystemAccessPromises[t],u=l==null?void 0:l.keySystemAccess;if(!u){this.log('Requesting encrypted media "'+t+'" key-system access with config: '+pt(o)),u=this.requestMediaKeySystemAccess(t,o);var d=this.keySystemAccessPromises[t]={keySystemAccess:u};return u.catch(function(h){n.log('Failed to obtain access to key-system "'+t+'": '+h)}),u.then(function(h){n.log('Access for key-system "'+h.keySystem+'" obtained');var c=n.fetchServerCertificate(t);return n.log('Create media-keys for "'+t+'"'),d.mediaKeys=h.createMediaKeys().then(function(f){return n.log('Media-keys created for "'+t+'"'),c.then(function(g){return g?n.setMediaKeysServerCertificate(f,t,g):f})}),d.mediaKeys.catch(function(f){n.error('Failed to create media-keys for "'+t+'"}: '+f)}),d.mediaKeys})}return u.then(function(){return l.mediaKeys})},e.createMediaKeySessionContext=function(t){var r=t.decryptdata,i=t.keySystem,n=t.mediaKeys;this.log('Creating key-system session "'+i+'" keyId: '+Jt.hexDump(r.keyId||[]));var o=n.createSession(),l={decryptdata:r,keySystem:i,mediaKeys:n,mediaKeysSession:o,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l},e.renewKeySession=function(t){var r=t.decryptdata;if(r.pssh){var i=this.createMediaKeySessionContext(t),n=this.getKeyIdString(r);this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(i,"cenc",r.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)},e.getKeyIdString=function(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return Jt.hexDump(t.keyId)},e.updateKeySession=function(t,r){var i,n=t.mediaKeysSession;return this.log('Updating key-session "'+n.sessionId+'" for keyID '+Jt.hexDump(((i=t.decryptdata)==null?void 0:i.keyId)||[])+`
      } (data length: `+(r&&r.byteLength)+")"),n.update(r)},e.selectKeySystemFormat=function(t){var r=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+t.sn+" "+t.type+": "+t.level+") key formats "+r.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(r)),this.keyFormatPromise},e.getKeyFormatPromise=function(t){var r=this;return new Promise(function(i,n){var o=kr(r.config),l=t.map(vi).filter(function(u){return!!u&&o.indexOf(u)!==-1});return r.getKeySystemSelectionPromise(l).then(function(u){var d=u.keySystem,h=pi(d);h?i(h):n(new Error('Unable to find format for key-system "'+d+'"'))}).catch(n)})},e.loadKey=function(t){var r=this,i=t.keyInfo.decryptdata,n=this.getKeyIdString(i),o="(keyId: "+n+' format: "'+i.keyFormat+'" method: '+i.method+" uri: "+i.uri+")";this.log("Starting session for key "+o);var l=this.keyIdToKeySessionPromise[n];return l||(l=this.getKeySystemForKeyPromise(i).then(function(u){var d=u.keySystem,h=u.mediaKeys;return r.throwIfDestroyed(),r.log("Handle encrypted media sn: "+t.frag.sn+" "+t.frag.type+": "+t.frag.level+" using key "+o),r.attemptSetMediaKeys(d,h).then(function(){return r.throwIfDestroyed(),r.createMediaKeySessionContext({keySystem:d,mediaKeys:h,decryptdata:i})})}),(this.keyIdToKeySessionPromise[n]=l.then(function(u){var d=i.pssh?i.pssh.buffer:null;return r.generateRequestWithPreferredKeySession(u,"cenc",d,"playlist-key")})).catch(function(u){return r.handleError(u)})),l},e.throwIfDestroyed=function(t){if(!this.hls)throw new Error("invalid state")},e.handleError=function(t){this.hls&&(this.error(t.message),t instanceof Wt?this.hls.trigger(p.ERROR,t.data):this.hls.trigger(p.ERROR,{type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))},e.getKeySystemForKeyPromise=function(t){var r=this.getKeyIdString(t),i=this.keyIdToKeySessionPromise[r];if(!i){var n=vi(t.keyFormat),o=n?[n]:kr(this.config);return this.attemptKeySystemAccess(o)}return i},e.getKeySystemSelectionPromise=function(t){if(t.length||(t=kr(this.config)),t.length===0)throw new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+pt({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(t)},e.attemptSetMediaKeys=function(t,r){var i=this,n=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+t+'"');var o=Promise.all(n).then(function(){if(!i.media)throw new Error("Attempted to set mediaKeys without media element attached");return i.media.setMediaKeys(r)});return this.setMediaKeysQueue.push(o),o.then(function(){i.log('Media-keys set for "'+t+'"'),n.push(o),i.setMediaKeysQueue=i.setMediaKeysQueue.filter(function(l){return n.indexOf(l)===-1})})},e.generateRequestWithPreferredKeySession=function(t,r,i,n){var o,l,u=this,d=(o=this.config.drmSystems)==null||(l=o[t.keySystem])==null?void 0:l.generateRequest;if(d)try{var h=d.call(this.hls,r,i,t);if(!h)throw new Error("Invalid response from configured generateRequest filter");r=h.initDataType,i=h.initData?h.initData:null,t.decryptdata.pssh=i?new Uint8Array(i):null}catch(E){var c;if(this.warn(E.message),(c=this.hls)!=null&&c.config.debug)throw E}if(i===null)return this.log('Skipping key-session request for "'+n+'" (no initData)'),Promise.resolve(t);var f=this.getKeyIdString(t.decryptdata);this.log('Generating key-session request for "'+n+'": '+f+" (init data type: "+r+" length: "+(i?i.byteLength:null)+")");var g=new lr,v=t._onmessage=function(E){var T=t.mediaKeysSession;if(T){var S=E.messageType,I=E.message;u.log('"'+S+'" message event for session "'+T.sessionId+'" message size: '+I.byteLength),S==="license-request"||S==="license-renewal"?u.renewLicense(t,I).catch(function(L){g.eventNames().length?g.emit("error",L):u.handleError(L)}):S==="license-release"?t.keySystem===st.FAIRPLAY&&(u.updateKeySession(t,fi("acknowledged")),u.removeSession(t)):u.warn('unhandled media key message type "'+S+'"')}else g.emit("error",new Error("invalid state"))},m=t._onkeystatuseschange=function(E){if(t.mediaKeysSession){u.onKeyStatusChange(t);var T=t.keyStatus;g.emit("keyStatus",T),T==="expired"&&(u.warn(t.keySystem+" expired for key "+f),u.renewKeySession(t))}else g.emit("error",new Error("invalid state"))};t.mediaKeysSession.addEventListener("message",v),t.mediaKeysSession.addEventListener("keystatuseschange",m);var y=new Promise(function(E,T){g.on("error",T),g.on("keyStatus",function(S){S.startsWith("usable")?E():S==="output-restricted"?T(new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):S==="internal-error"?T(new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+S+'"')):S==="expired"?T(new Error("key expired while generating request")):u.warn('unhandled key status change "'+S+'"')})});return t.mediaKeysSession.generateRequest(r,i).then(function(){var E;u.log('Request generated for key-session "'+((E=t.mediaKeysSession)==null?void 0:E.sessionId)+'" keyId: '+f)}).catch(function(E){throw new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_NO_SESSION,error:E,fatal:!1},"Error generating key-session request: "+E)}).then(function(){return y}).catch(function(E){throw g.removeAllListeners(),u.removeSession(t),E}).then(function(){return g.removeAllListeners(),t})},e.onKeyStatusChange=function(t){var r=this;t.mediaKeysSession.keyStatuses.forEach(function(i,n){if(typeof n=="string"&&typeof i=="object"){var o=n;n=i,i=o}r.log('key status change "'+i+'" for keyStatuses keyId: '+Jt.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))+" session keyId: "+Jt.hexDump(new Uint8Array(t.decryptdata.keyId||[]))+" uri: "+t.decryptdata.uri),t.keyStatus=i})},e.fetchServerCertificate=function(t){var r=this.config,i=new r.loader(r),n=this.getServerCertificateUrl(t);return n?(this.log('Fetching server certificate for "'+t+'"'),new Promise(function(o,l){var u={responseType:"arraybuffer",url:n},d=r.certLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(f,g,v,m){o(f.data)},onError:function(f,g,v,m){l(new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:at({url:u.url,data:void 0},f)},'"'+t+'" certificate request failed ('+n+"). Status: "+f.code+" ("+f.text+")"))},onTimeout:function(f,g,v){l(new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:u.url,data:void 0}},'"'+t+'" certificate request timed out ('+n+")"))},onAbort:function(f,g,v){l(new Error("aborted"))}};i.load(u,h,c)})):Promise.resolve()},e.setMediaKeysServerCertificate=function(t,r,i){var n=this;return new Promise(function(o,l){t.setServerCertificate(i).then(function(u){n.log("setServerCertificate "+(u?"success":"not supported by CDM")+" ("+(i==null?void 0:i.byteLength)+') on "'+r+'"'),o(t)}).catch(function(u){l(new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:u,fatal:!0},u.message))})})},e.renewLicense=function(t,r){var i=this;return this.requestLicense(t,new Uint8Array(r)).then(function(n){return i.updateKeySession(t,new Uint8Array(n)).catch(function(o){throw new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:o,fatal:!0},o.message)})})},e.unpackPlayReadyKeyMessage=function(t,r){var i=String.fromCharCode.apply(null,new Uint16Array(r.buffer));if(!i.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),r;var n=new DOMParser().parseFromString(i,"application/xml"),o=n.querySelectorAll("HttpHeader");if(o.length>0)for(var l,u=0,d=o.length;u<d;u++){var h,c,f=(h=(l=o[u]).querySelector("name"))==null?void 0:h.textContent,g=(c=l.querySelector("value"))==null?void 0:c.textContent;f&&g&&t.setRequestHeader(f,g)}var v=n.querySelector("Challenge"),m=v==null?void 0:v.textContent;if(!m)throw new Error("Cannot find <Challenge> in key message");return fi(atob(m))},e.setupLicenseXHR=function(t,r,i,n){var o=this,l=this.config.licenseXhrSetup;return l?Promise.resolve().then(function(){if(!i.decryptdata)throw new Error("Key removed");return l.call(o.hls,t,r,i,n)}).catch(function(u){if(!i.decryptdata)throw u;return t.open("POST",r,!0),l.call(o.hls,t,r,i,n)}).then(function(u){return t.readyState||t.open("POST",r,!0),{xhr:t,licenseChallenge:u||n}}):(t.open("POST",r,!0),Promise.resolve({xhr:t,licenseChallenge:n}))},e.requestLicense=function(t,r){var i=this,n=this.config.keyLoadPolicy.default;return new Promise(function(o,l){var u=i.getLicenseServerUrlOrThrow(t.keySystem);i.log("Sending license request to URL: "+u);var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=function(){if(!i.hls||!t.mediaKeysSession)return l(new Error("invalid state"));if(d.readyState===4)if(d.status===200){i._requestLicenseFailureCount=0;var h=d.response;i.log("License received "+(h instanceof ArrayBuffer?h.byteLength:h));var c=i.config.licenseResponseCallback;if(c)try{h=c.call(i.hls,d,u,t)}catch(m){i.error(m)}o(h)}else{var f=n.errorRetry,g=f?f.maxNumRetry:0;if(i._requestLicenseFailureCount++,i._requestLicenseFailureCount>g||d.status>=400&&d.status<500)l(new Wt({type:K.KEY_SYSTEM_ERROR,details:D.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:d,response:{url:u,data:void 0,code:d.status,text:d.statusText}},"License Request XHR failed ("+u+"). Status: "+d.status+" ("+d.statusText+")"));else{var v=g-i._requestLicenseFailureCount+1;i.warn("Retrying license request, "+v+" attempts left"),i.requestLicense(t,r).then(o,l)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=d,i.setupLicenseXHR(d,u,t,r).then(function(h){var c=h.xhr,f=h.licenseChallenge;t.keySystem==st.PLAYREADY&&(f=i.unpackPlayReadyKeyMessage(c,f)),c.send(f)})})},e.onMediaAttached=function(t,r){if(this.config.emeEnabled){var i=r.media;this.media=i,i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}},e.onMediaDetached=function(){var t=this.media;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)},e._clear=function(t){var r,i=this,n=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},yi.clearKeyUriToKeyIdMap();var o=n.length;a.CDMCleanupPromise=Promise.all(n.map(function(l){return i.removeSession(l)}).concat(t==null||(r=t.setMediaKeys(null))==null?void 0:r.catch(function(l){var u;i.log("Could not clear media keys: "+l),(u=i.hls)==null||u.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error("Could not clear media keys: "+l)})}))).then(function(){o&&(i.log("finished closing key sessions and clearing media keys"),n.length=0)}).catch(function(l){var u;i.log("Could not close sessions and clear media keys: "+l),(u=i.hls)==null||u.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close sessions and clear media keys: "+l)})})},e.onManifestLoading=function(){this.keyFormatPromise=null},e.onManifestLoaded=function(t,r){var i=r.sessionKeys;if(i&&this.config.emeEnabled&&!this.keyFormatPromise){var n=i.reduce(function(o,l){return o.indexOf(l.keyFormat)===-1&&o.push(l.keyFormat),o},[]);this.log("Selecting key-system from session-keys "+n.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(n)}},e.removeSession=function(t){var r=this,i=t.mediaKeysSession,n=t.licenseXhr;if(i){this.log("Remove licenses and keys and close session "+i.sessionId),t._onmessage&&(i.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(i.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;var o=this.mediaKeySessions.indexOf(t);o>-1&&this.mediaKeySessions.splice(o,1);var l=function(u){var d;return u.sessionType==="persistent-license"||!((d=u.sessionTypes)==null||!d.some(function(h){return h==="persistent-license"}))}(this.config.drmSystemOptions)?new Promise(function(u,d){self.setTimeout(function(){return d(new Error("MediaKeySession.remove() timeout"))},8e3),i.remove().then(u)}):Promise.resolve();return l.catch(function(u){var d;r.log("Could not remove session: "+u),(d=r.hls)==null||d.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error("Could not remove session: "+u)})}).then(function(){return i.close()}).catch(function(u){var d;r.log("Could not close session: "+u),(d=r.hls)==null||d.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error("Could not close session: "+u)})})}},a}(oe);Ds.CDMCleanupPromise=void 0;var Wt=function(s){function a(e,t){var r;return(r=s.call(this,t)||this).data=void 0,e.error||(e.error=new Error(t)),r.data=e,e.err=e.error,r}return ut(a,s),a}(_e(Error)),Ql=function(){function s(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var a=s.prototype;return a.setStreamController=function(e){this.streamController=e},a.registerListeners=function(){this.hls.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(p.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListeners=function(){this.hls.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(p.MEDIA_DETACHING,this.onMediaDetaching,this)},a.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},a.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},a.onMediaDetaching=function(){this.media=null},a.checkFPS=function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var n=i-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*o/n,d=this.hls;if(d.trigger(p.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),u>0&&o>d.config.fpsDroppedMonitoringThreshold*l){var h=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h-=1,d.trigger(p.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},a.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},s}();function or(s){for(var a=5381,e=s.length;e;)a=33*a^s.charCodeAt(--e);return(a>>>0).toString()}var Ge=.025,Nr=function(s){return s[s.Point=0]="Point",s[s.Range=1]="Range",s}({});function $l(s,a,e){return s.identifier+"-"+(e+1)+"-"+or(a)}var Jl=function(){function s(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}var a=s.prototype;return a.setDateRange=function(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)},a.reset=function(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)},a.isAssetPastPlayoutLimit=function(e){if(e>=this.assetList.length)return!0;var t=this.playoutLimit;return!(e<=0||isNaN(t))&&this.assetList[e].startOffset>t},a.findAssetIndex=function(e){return this.assetList.indexOf(e)},a.toString=function(){return'["'+(e=this).identifier+'" '+(e.cue.pre?"<pre>":e.cue.post?"<post>":"")+e.timelineStart.toFixed(2)+"-"+e.resumeTime.toFixed(2)+"]";var e},dt(s,[{key:"identifier",get:function(){return this.dateRange.id}},{key:"startDate",get:function(){return this.dateRange.startDate}},{key:"startTime",get:function(){var e=this.dateRange.startTime;if(this.snapOptions.out){var t=this.dateRange.tagAnchor;if(t)return ji(e,t)}return e}},{key:"startOffset",get:function(){return this.cue.pre?0:this.startTime}},{key:"startIsAligned",get:function(){if(this.startTime===0||this.snapOptions.out)return!0;var e=this.dateRange.tagAnchor;if(e){var t=this.dateRange.startTime;return t-ji(t,e)<.1}return!1}},{key:"resumptionOffset",get:function(){var e=this.resumeOffset,t=B(e)?e:this.duration;return this.cumulativeDuration+t}},{key:"resumeTime",get:function(){var e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){var t=this.resumeAnchor;if(t)return ji(e,t)}return e}},{key:"appendInPlace",get:function(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Ge))},set:function(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}},{key:"timelineStart",get:function(){return this._timelineStart!==null?this._timelineStart:this.startTime},set:function(e){this._timelineStart=e}},{key:"duration",get:function(){var e,t=this.playoutLimit;return e=this._duration!==null?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e},set:function(e){this._duration=e}},{key:"cue",get:function(){return this.dateRange.cue}},{key:"timelineOccupancy",get:function(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Nr.Range:Nr.Point}},{key:"supplementsPrimary",get:function(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}},{key:"contentMayVary",get:function(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}},{key:"assetUrl",get:function(){return this.dateRange.attr["X-ASSET-URI"]}},{key:"assetListUrl",get:function(){return this.dateRange.attr["X-ASSET-LIST"]}},{key:"baseUrl",get:function(){return this.base.url}},{key:"assetListLoaded",get:function(){return this.assetList.length>0||this.assetListResponse!==null}}])}();function ji(s,a){return s-a.start<a.duration/2&&!(Math.abs(s-(a.start+a.duration))<Ge)?a.start:a.start+a.duration}function _s(s,a,e){var t=new self.URL(s,e);return t.protocol!=="data:"&&t.searchParams.set("_HLS_primary_id",a),t}function qi(s){var a=s.timelineStart,e=s.duration||0;return'["'+s.identifier+'" '+a.toFixed(2)+"-"+(a+e).toFixed(2)+"]"}var Zl=function(){function s(e,t,r,i){var n=this;this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=function(){var d=n.interstitial.playoutLimit,h=n.currentTime;n.startOffset+h>=d&&n.hls.trigger(p.PLAYOUT_LIMIT_REACHED,{})};var o=this.hls=new e(t);this.interstitial=r,this.assetItem=i;var l=i.uri;try{l=_s(l,o.sessionId).href}catch{}o.loadSource(l);var u=function(){n.hasDetails=!0};o.once(p.LEVEL_LOADED,u),o.once(p.AUDIO_TRACK_LOADED,u),o.once(p.SUBTITLE_TRACK_LOADED,u),o.on(p.MEDIA_ATTACHING,function(d,h){var c=h.media;n.removeMediaListeners(),n.mediaAttached=c,n.interstitial.playoutLimit&&c.addEventListener("timeupdate",n.checkPlayout)})}var a=s.prototype;return a.bufferedInPlaceToEnd=function(e){var t;if(!this.interstitial.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;var r=this.timelineOffset,i=tt.bufferInfo(e,r,0);return this.getAssetTime(i.end)>=this._bufferedEosTime-.02},a.getAssetTime=function(e){var t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)},a.removeMediaListeners=function(){var e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))},a.bufferSnapShot=function(){var e;this.mediaAttached&&(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)},a.destroy=function(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null},a.attachMedia=function(e){this.hls.attachMedia(e)},a.detachMedia=function(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()},a.resumeBuffering=function(){this.hls.resumeBuffering()},a.pauseBuffering=function(){this.hls.pauseBuffering()},a.transferMedia=function(){return this.bufferSnapShot(),this.hls.transferMedia()},a.on=function(e,t,r){this.hls.on(e,t)},a.once=function(e,t,r){this.hls.once(e,t)},a.off=function(e,t,r){this.hls.off(e,t)},a.toString=function(){var e,t;return"HlsAssetPlayer: "+qi(this.assetItem)+" "+((e=this.hls)==null?void 0:e.sessionId)+" "+((t=this.interstitial)!=null&&t.appendInPlace?"append-in-place":"")},dt(s,[{key:"destroyed",get:function(){var e;return!((e=this.hls)!=null&&e.userConfig)}},{key:"assetId",get:function(){return this.assetItem.identifier}},{key:"interstitialId",get:function(){return this.assetItem.parentIdentifier}},{key:"media",get:function(){var e;return((e=this.hls)==null?void 0:e.media)||null}},{key:"bufferedEnd",get:function(){var e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;var t=tt.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}},{key:"currentTime",get:function(){var e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}},{key:"duration",get:function(){var e=this.assetItem.duration;return e||0}},{key:"remaining",get:function(){var e=this.duration;return e?Math.max(0,e-this.currentTime):0}},{key:"startOffset",get:function(){return this.assetItem.startOffset}},{key:"timelineOffset",get:function(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0},set:function(e){var t=this.timelineOffset;if(e!==t){var r=e-t;if(Math.abs(r)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}}])}(),tu=function(s){function a(t,r){var i;return(i=s.call(this,"interstitials-sched",r)||this).onScheduleUpdate=void 0,i.eventMap={},i.events=null,i.items=null,i.durations={primary:0,playout:0,integrated:0},i.onScheduleUpdate=t,i}ut(a,s);var e=a.prototype;return e.destroy=function(){this.reset(),this.onScheduleUpdate=null},e.reset=function(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(function(t){return t.reset()}),this.events=this.items=null},e.resetErrorsInRange=function(t,r){return this.events?this.events.reduce(function(i,n){return t<=n.startOffset&&r>n.startOffset?(delete n.error,i+1):i},0):0},e.getEvent=function(t){return t&&this.eventMap[t]||null},e.hasEvent=function(t){return t in this.eventMap},e.findItemIndex=function(t,r){if(t.event)return this.findEventIndex(t.event.identifier);var i=-1;t.nextEvent?i=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(i=this.findEventIndex(t.previousEvent.identifier)+1);var n=this.items;if(n)for(n[i]||(r===void 0&&(r=t.start),i=this.findItemIndexAtTime(r));i>=0&&(o=n[i])!=null&&o.event;){var o;i--}return i},e.findItemIndexAtTime=function(t,r){var i=this.items;if(i)for(var n=0;n<i.length;n++){var o=i[n];if(r&&r!=="primary"&&(o=o[r]),t===o.start||t>o.start&&t<o.end)return n}return-1},e.findJumpRestrictedIndex=function(t,r){var i=this.items;if(i)for(var n=t;n<=r&&i[n];n++){var o=i[n].event;if(o!=null&&o.restrictions.jump&&!o.appendInPlace)return n}return-1},e.findEventIndex=function(t){var r=this.items;if(r)for(var i=r.length;i--;){var n;if(((n=r[i].event)==null?void 0:n.identifier)===t)return i}return-1},e.findAssetIndex=function(t,r){var i=t.assetList,n=i.length;if(n>1)for(var o=0;o<n;o++){var l=i[o];if(!l.error){var u=l.timelineStart;if(r===u||r>u&&r<u+(l.duration||0))return o}}return 0},e.parseInterstitialDateRanges=function(t,r){var i=this,n=t.main.details,o=n.dateRanges,l=this.events,u=this.parseDateRanges(o,{url:n.url},r),d=Object.keys(o),h=l?l.filter(function(c){return!d.includes(c.identifier)}):[];u.length&&u.sort(function(c,f){var g=c.cue.pre,v=c.cue.post,m=f.cue.pre,y=f.cue.post;if(g&&!m)return-1;if(m&&!g||v&&!y)return 1;if(y&&!v)return-1;if(!(g||m||v||y)){var E=c.startTime,T=f.startTime;if(E!==T)return E-T}return c.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=u,h.forEach(function(c){i.removeEvent(c)}),this.updateSchedule(t,h)},e.updateSchedule=function(t,r){r===void 0&&(r=[]);var i=this.events||[];if(i.length||r.length||this.length<2){var n=this.items,o=this.parseSchedule(i,t);(r.length||(n==null?void 0:n.length)!==o.length||o.some(function(l,u){return Math.abs(l.playout.start-n[u].playout.start)>.005||Math.abs(l.playout.end-n[u].playout.end)>.005}))&&(this.items=o,this.onScheduleUpdate(r,n))}},e.parseDateRanges=function(t,r,i){for(var n=[],o=Object.keys(t),l=0;l<o.length;l++){var u=o[l],d=t[u];if(d.isInterstitial){var h=this.eventMap[u];h?h.setDateRange(d):(h=new Jl(d,r),this.eventMap[u]=h,i===!1&&(h.appendInPlace=i)),n.push(h)}}return n},e.parseSchedule=function(t,r){var i=[],n=r.main.details,o=n.live?1/0:n.edge,l=0;if((t=t.filter(function(m){return!(m.error||m.cue.once&&m.hasPlayed)})).length){this.resolveOffsets(t,r);var u=0,d=0;if(t.forEach(function(m,y){var E=m.cue.pre,T=m.cue.post,S=t[y-1]||null,I=m.appendInPlace,L=T?o:m.startOffset,A=m.duration,b=m.timelineOccupancy===Nr.Range?A:0,R=m.resumptionOffset,k=(S==null?void 0:S.startTime)===L,_=L+m.cumulativeDuration,C=I?_+A:L+R;if(E||!T&&L<=0){var x=d;d+=b,m.timelineStart=_;var w=l;l+=A,i.push({event:m,start:_,end:C,playout:{start:w,end:l},integrated:{start:x,end:d}})}else{if(!(L<=o))return;if(!k){var P=L-u;if(P>.033){var M=u,F=d;d+=P;var U=l;l+=P;var G={previousEvent:t[y-1]||null,nextEvent:m,start:M,end:M+P,playout:{start:U,end:l},integrated:{start:F,end:d}};i.push(G)}else P>0&&S&&(S.cumulativeDuration+=P,i[i.length-1].end=L)}T&&(C=_),m.timelineStart=_;var N=d;d+=b;var H=l;l+=A,i.push({event:m,start:_,end:C,playout:{start:H,end:l},integrated:{start:N,end:d}})}var j=m.resumeTime;u=T||j>o?o:j}),u<o){var h,c=u,f=d,g=o-u;d+=g;var v=l;l+=g,i.push({previousEvent:((h=i[i.length-1])==null?void 0:h.event)||null,nextEvent:null,start:u,end:c+g,playout:{start:v,end:l},integrated:{start:f,end:d}})}this.setDurations(o,l,d)}else i.push({previousEvent:null,nextEvent:null,start:0,end:o,playout:{start:0,end:o},integrated:{start:0,end:o}}),this.setDurations(o,o,o);return i},e.setDurations=function(t,r,i){this.durations={primary:t,playout:r,integrated:i}},e.resolveOffsets=function(t,r){var i=this,n=r.main.details,o=n.live?1/0:n.edge,l=0,u=-1;t.forEach(function(d,h){var c=d.cue.pre,f=d.cue.post,g=c?0:f?o:d.startTime;i.updateAssetDurations(d),u===g?d.cumulativeDuration=l:(l=0,u=g),!f&&d.snapOptions.in&&(d.resumeAnchor=Re(null,n.fragments,d.startOffset+d.resumptionOffset,0,0)||void 0),d.appendInPlace&&!d.appendInPlaceStarted&&(i.primaryCanResumeInPlaceAt(d,r)||(d.appendInPlace=!1)),!d.appendInPlace&&h+1<t.length&&t[h+1].startTime-t[h].resumeTime<.033&&(t[h+1].appendInPlace=!1,t[h+1].appendInPlace&&i.warn("Could not change append strategy for abutting event "+d));var v=B(d.resumeOffset)?d.resumeOffset:d.duration;l+=v})},e.primaryCanResumeInPlaceAt=function(t,r){var i=this,n=t.resumeTime,o=t.startTime+t.resumptionOffset;return Math.abs(n-o)>Ge?(this.log('"'+t.identifier+'" resumption '+n+" not aligned with estimated timeline end "+o),!1):r?!Object.keys(r).some(function(l){var u=r[l].details,d=u.edge;if(n>=d)return i.log('"'+t.identifier+'" resumption '+n+" past "+l+" playlist end "+d),!1;var h=Re(null,u.fragments,n);if(!h)return i.log('"'+t.identifier+'" resumption '+n+" does not align with any fragments in "+l+" playlist ("+u.fragStart+"-"+u.fragmentEnd+")"),!0;var c=l==="audio"?.175:0;return!(Math.abs(h.start-n)<Ge+c||Math.abs(h.end-n)<Ge+c||(i.log('"'+t.identifier+'" resumption '+n+" not aligned with "+l+" fragment bounds ("+h.start+"-"+h.end+" sn: "+h.sn+" cc: "+h.cc+")"),0))}):(this.log('"'+t.identifier+'" resumption '+n+" can not be aligned with media (none selected)"),!1)},e.updateAssetDurations=function(t){if(t.assetListLoaded){var r=t.timelineStart,i=0,n=!1,o=!1;t.assetList.forEach(function(l,u){var d=r+i;l.startOffset=i,l.timelineStart=d,n||(n=l.duration===null),o||(o=!!l.error);var h=l.error?0:l.duration||0;i+=h}),t.duration=n&&!o?Math.max(i,t.duration):i}},e.removeEvent=function(t){t.reset(),delete this.eventMap[t.identifier]},dt(a,[{key:"duration",get:function(){var t=this.items;return t?t[t.length-1].end:0}},{key:"length",get:function(){return this.items?this.items.length:0}},{key:"assetIdAtEnd",get:function(){var t,r,i=(t=this.items)==null||(r=t[this.length-1])==null?void 0:r.event;if(i){var n=i.assetList,o=n[n.length-1];if(o)return o.identifier}return null}}])}(oe);function Se(s){return"["+(s.event?'"'+s.event.identifier+'"':"primary")+": "+s.start.toFixed(2)+"-"+s.end.toFixed(2)+"]"}var eu=function(){function s(e){this.hls=void 0,this.hls=e}var a=s.prototype;return a.destroy=function(){this.hls=null},a.loadAssetList=function(e,t){var r,i=this,n=e.assetListUrl;try{r=_s(n,this.hls.sessionId,e.baseUrl)}catch(g){var o=this.assignAssetListError(e,D.ASSET_LIST_LOAD_ERROR,g,n);return void this.hls.trigger(p.ERROR,o)}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);var l=this.hls.config,u=new l.loader(l),d={responseType:"json",url:r.href},h=l.interstitialAssetListLoadPolicy.default,c={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:function(g,v,m,y){var E=g.data,T=E==null?void 0:E.ASSETS;if(Array.isArray(T))e.assetListResponse=E,i.hls.trigger(p.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:y});else{var S=i.assignAssetListError(e,D.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,v,y);i.hls.trigger(p.ERROR,S)}},onError:function(g,v,m,y){var E=i.assignAssetListError(e,D.ASSET_LIST_LOAD_ERROR,new Error("Error loading X-ASSET-LIST: HTTP status "+g.code+" "+g.text+" ("+v.url+")"),v.url,y,m);i.hls.trigger(p.ERROR,E)},onTimeout:function(g,v,m){var y=i.assignAssetListError(e,D.ASSET_LIST_LOAD_TIMEOUT,new Error("Timeout loading X-ASSET-LIST ("+v.url+")"),v.url,g,m);i.hls.trigger(p.ERROR,y)}};return u.load(d,c,f),this.hls.trigger(p.ASSET_LIST_LOADING,{event:e}),u},a.assignAssetListError=function(e,t,r,i,n,o){return e.error=r,{type:K.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:r,networkDetails:o,stats:n}},s}();function fe(s,a,e){ne(s,a,e),s.addEventListener(a,e)}function ne(s,a,e){s.removeEventListener(a,e)}function Ps(s){s==null||s.play().catch(function(){})}var ru=function(s){function a(t,r){var i;return(i=s.call(this,"interstitials",t.logger)||this).HlsPlayerClass=void 0,i.hls=void 0,i.assetListLoader=void 0,i.mediaSelection=null,i.altSelection=null,i.media=null,i.detachedData=null,i.requiredTracks=null,i.manager=null,i.playerQueue=[],i.bufferedPos=-1,i.timelinePos=-1,i.schedule=void 0,i.playingItem=null,i.bufferingItem=null,i.waitingItem=null,i.endedItem=null,i.playingAsset=null,i.endedAsset=null,i.bufferingAsset=null,i.shouldPlay=!1,i.onPlay=function(){i.shouldPlay=!0},i.onPause=function(){i.shouldPlay=!1},i.onSeeking=function(){var n=i.currentTime;if(n!==void 0&&!i.playbackDisabled){var o=n-i.timelinePos;if(!(Math.abs(o)<1/7056e5)){var l=o<=-.01;i.timelinePos=n,i.bufferedPos=n;var u=i.playingItem;if(u)if(l&&i.schedule.resetErrorsInRange(n,n-o)&&i.updateSchedule(),i.checkBuffer(),l&&n<u.start||n>=u.end){var d,h=i.schedule.findItemIndexAtTime(i.timelinePos);if(!i.isInterstitial(u)&&(d=i.media)!=null&&d.paused&&(i.shouldPlay=!1),!l){var c=i.findItemIndex(u);if(h>c){var f=i.schedule.findJumpRestrictedIndex(c+1,h);if(f>c)return void i.setSchedulePosition(f)}}i.setSchedulePosition(h)}else{var g=i.playingAsset;if(g){var v=g.timelineStart,m=g.duration||0;(l&&n<v||n>=v+m)&&i.setScheduleToAssetAtTime(n,g)}else if(i.playingLastItem&&i.isInterstitial(u)){var y=u.event.assetList[0];y&&(i.endedItem=i.playingItem,i.playingItem=null,i.setScheduleToAssetAtTime(n,y))}}else i.checkBuffer()}}},i.onTimeupdate=function(){var n=i.currentTime;if(n!==void 0&&!i.playbackDisabled&&n>i.timelinePos){i.timelinePos=n,n>i.bufferedPos&&i.checkBuffer();var o=i.playingItem;if(o&&!i.playingLastItem){if(n>=o.end){i.timelinePos=o.end;var l=i.findItemIndex(o);i.setSchedulePosition(l+1)}var u=i.playingAsset;u&&n>=u.timelineStart+(u.duration||0)&&i.setScheduleToAssetAtTime(n,u)}}},i.onScheduleUpdate=function(n,o){var l=i.schedule,u=i.playingItem,d=l.events||[],h=l.items||[],c=l.durations,f=n.map(function(E){return E.identifier}),g=!(!d.length&&!f.length);if(g&&i.log("INTERSTITIALS_UPDATED ("+d.length+"): "+d+`
Schedule: `+h.map(function(E){return Se(E)})),f.length&&i.log("Removed events "+f),i.playerQueue.forEach(function(E){if(E.interstitial.appendInPlace){var T=E.assetItem.timelineStart,S=E.timelineOffset-T;if(S)try{E.timelineOffset=T}catch(I){Math.abs(S)>Ge&&i.warn(I+' ("'+E.assetId+'" '+E.timelineOffset+"->"+T+")")}}}),u){var v=i.updateItem(u,i.timelinePos);i.itemsMatch(u,v)&&(i.playingItem=v,i.waitingItem=i.endedItem=null)}else i.waitingItem=i.updateItem(i.waitingItem),i.endedItem=i.updateItem(i.endedItem);var m=i.bufferingItem;if(m){var y=i.updateItem(m,i.bufferedPos);i.itemsMatch(m,y)?i.bufferingItem=y:m.event&&(i.bufferingItem=i.playingItem,i.clearInterstitial(m.event,null))}if(n.forEach(function(E){E.assetList.forEach(function(T){i.clearAssetPlayer(T.identifier,null)})}),g||o){if(i.hls.trigger(p.INTERSTITIALS_UPDATED,{events:d.slice(0),schedule:h.slice(0),durations:c,removedIds:f}),i.isInterstitial(u)&&f.includes(u.event.identifier))return i.warn('Interstitial "'+u.event.identifier+'" removed while playing'),void i.primaryFallback(u.event);i.checkBuffer()}},i.hls=t,i.HlsPlayerClass=r,i.assetListLoader=new eu(t),i.schedule=new tu(i.onScheduleUpdate,t.logger),i.registerListeners(),i}ut(a,s);var e=a.prototype;return e.registerListeners=function(){var t=this.hls;t.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(p.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(p.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(p.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(p.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(p.BUFFER_APPENDED,this.onBufferAppended,this),t.on(p.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(p.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(p.MEDIA_ENDED,this.onMediaEnded,this),t.on(p.ERROR,this.onError,this),t.on(p.DESTROYING,this.onDestroying,this)},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(p.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(p.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(p.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(p.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(p.BUFFER_CODECS,this.onBufferCodecs,this),t.off(p.BUFFER_APPENDED,this.onBufferAppended,this),t.off(p.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(p.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(p.MEDIA_ENDED,this.onMediaEnded,this),t.off(p.ERROR,this.onError,this),t.off(p.DESTROYING,this.onDestroying,this))},e.startLoad=function(){this.resumeBuffering()},e.stopLoad=function(){this.pauseBuffering()},e.resumeBuffering=function(){var t;(t=this.getBufferingPlayer())==null||t.resumeBuffering()},e.pauseBuffering=function(){var t;(t=this.getBufferingPlayer())==null||t.pauseBuffering()},e.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null},e.onDestroying=function(){var t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)},e.removeMediaListeners=function(t){ne(t,"play",this.onPlay),ne(t,"pause",this.onPause),ne(t,"seeking",this.onSeeking),ne(t,"timeupdate",this.onTimeupdate)},e.onMediaAttaching=function(t,r){var i=this.media=r.media;fe(i,"seeking",this.onSeeking),fe(i,"timeupdate",this.onTimeupdate),fe(i,"play",this.onPlay),fe(i,"pause",this.onPause)},e.onMediaAttached=function(t,r){var i=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!n){this.clearScheduleState();var o=this.findItemIndex(i);this.setSchedulePosition(o)}},e.clearScheduleState=function(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null},e.onMediaDetaching=function(t,r){var i=!!r.transferMedia,n=this.media;if(this.media=null,!i&&(n&&this.removeMediaListeners(n),this.detachedData)){var o=this.getBufferingPlayer();o&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,o.detachMedia()),this.shouldPlay=!1}},e.isInterstitial=function(t){return!(t==null||!t.event)},e.retreiveMediaSource=function(t,r){var i=this.getAssetPlayer(t);i&&this.transferMediaFromPlayer(i,r)},e.transferMediaFromPlayer=function(t,r){var i=t.interstitial.appendInPlace,n=t.media;if(i&&n===this.primaryMedia){if(this.bufferingAsset=null,(!r||this.isInterstitial(r)&&!r.event.appendInPlace)&&r&&n)return void(this.detachedData={media:n});var o=t.transferMedia();this.log("transfer MediaSource from "+t+" "+pt(o)),this.detachedData=o}else r&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))},e.transferMediaTo=function(t,r){var i,n,o=this;if(t.media!==r){var l,u=null,d=this.hls,h=t!==d,c=h&&t.interstitial.appendInPlace,f=(i=this.detachedData)==null?void 0:i.mediaSource;if(d.media)c&&(u=d.transferMedia(),this.detachedData=u),l="Primary";else if(f){var g=this.getBufferingPlayer();g?(u=g.transferMedia(),l=""+g):l="detached MediaSource"}else l="detached media";if(!u){if(f)u=this.detachedData,this.log("using detachedData: MediaSource "+pt(u));else if(!this.detachedData||d.media===r){var v=this.playerQueue;v.length>1&&v.forEach(function(T){if(h&&T.interstitial.appendInPlace!==c){var S=T.interstitial;o.clearInterstitial(T.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&o.warn("Could not change append strategy for queued assets "+S)}}),this.hls.detachMedia(),this.detachedData={media:r}}}var m=u&&"mediaSource"in u&&((n=u.mediaSource)==null?void 0:n.readyState)!=="closed",y=m&&u?u:r;if(this.log((m?"transfering MediaSource":"attaching media")+" to "+(h?t:"Primary")+" from "+l),y===u){var E=h&&t.assetId===this.schedule.assetIdAtEnd;y.overrides={duration:this.schedule.duration,endOfStream:!h||E,cueRemoval:!h}}t.attachMedia(y)}},e.onInterstitialCueEnter=function(){this.onTimeupdate()},e.checkStart=function(){var t=this.schedule,r=t.events;if(r&&!this.playbackDisabled&&this.media){this.bufferedPos===-1&&(this.bufferedPos=0);var i=this.timelinePos,n=this.effectivePlayingItem;if(i===-1){var o=this.hls.startPosition;if(this.timelinePos=o,r.length&&r[0].cue.pre){var l=t.findEventIndex(r[0].identifier);this.setSchedulePosition(l)}else if(o>=0||!this.primaryLive){var u=this.timelinePos=o>0?o:0,d=t.findItemIndexAtTime(u);this.setSchedulePosition(d)}}else if(n&&!this.playingItem){var h=t.findItemIndex(n);this.setSchedulePosition(h)}}},e.advanceAfterAssetEnded=function(t,r,i){var n=i+1;if(t.isAssetPastPlayoutLimit(n)||t.assetList[n].error){var o=this.schedule.items;if(o){var l=r+1;if(l>=o.length)return void this.setSchedulePosition(-1);var u=t.resumeTime;this.timelinePos<u&&(this.timelinePos=u,this.checkBuffer()),this.setSchedulePosition(l)}}else this.setSchedulePosition(r,n)},e.setScheduleToAssetAtTime=function(t,r){var i=this.schedule,n=r.parentIdentifier,o=i.getEvent(n);if(o){var l=i.findEventIndex(n),u=i.findAssetIndex(o,t);this.setSchedulePosition(l,u)}},e.setSchedulePosition=function(t,r){var i=this.schedule.items;if(i&&!this.playbackDisabled){this.log("setSchedulePosition "+t+", "+r);var n=t>=0?i[t]:null,o=this.playingItem,l=this.playingLastItem;if(this.isInterstitial(o)){var u,d=o.event,h=this.playingAsset,c=h==null?void 0:h.identifier,f=c?this.getAssetPlayer(c):null;if(f&&c&&(!this.eventItemsMatch(o,n)||r!==void 0&&c!==((u=d.assetList)==null?void 0:u[r].identifier))){var g,v=d.findAssetIndex(h);this.log("INTERSTITIAL_ASSET_ENDED "+(v+1)+"/"+d.assetList.length+" "+qi(h)),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(p.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:v,event:d,schedule:i.slice(0),scheduleIndex:t,player:f}),this.retreiveMediaSource(c,n),!f.media||(g=this.detachedData)!=null&&g.mediaSource||f.detachMedia()}if(!this.eventItemsMatch(o,n)&&(this.endedItem=o,this.playingItem=null,this.log("INTERSTITIAL_ENDED "+d+" "+Se(o)),d.hasPlayed=!0,this.hls.trigger(p.INTERSTITIAL_ENDED,{event:d,schedule:i.slice(0),scheduleIndex:t}),d.cue.once)){this.updateSchedule();var m=this.schedule.items;if(n&&m){var y=this.schedule.findItemIndex(n);this.advanceSchedule(y,m,r,o,l)}return}}this.advanceSchedule(t,i,r,o,l)}},e.advanceSchedule=function(t,r,i,n,o){var l=this,u=t>=0?r[t]:null,d=this.primaryMedia,h=this.playerQueue;if(h.length&&h.forEach(function(T){var S=T.interstitial,I=l.schedule.findEventIndex(S.identifier);(I<t||I>t+1)&&l.clearInterstitial(S,u)}),this.isInterstitial(u)){this.timelinePos=Math.min(Math.max(this.timelinePos,u.start),u.end);var c=u.event;i===void 0&&(i=this.schedule.findAssetIndex(c,this.timelinePos));var f=this.waitingItem;this.assetsBuffered(u,d)||this.setBufferingItem(u);var g=this.preloadAssets(c,i);if(this.eventItemsMatch(u,f||n)||(this.waitingItem=u,this.log("INTERSTITIAL_STARTED "+Se(u)+" "+(c.appendInPlace?"append in place":"")),this.hls.trigger(p.INTERSTITIAL_STARTED,{event:c,schedule:r.slice(0),scheduleIndex:t})),!c.assetListLoaded)return void this.log("Waiting for ASSET-LIST to complete loading "+c);if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!d)return void this.log("Waiting for attachMedia to start Interstitial "+c);this.waitingItem=this.endedItem=null,this.playingItem=u;var v=c.assetList[i];if(!v){var m=r[t+1],y=this.media;return m&&y&&!this.isInterstitial(m)&&y.currentTime<m.start&&(y.currentTime=this.timelinePos=m.start),void this.advanceAfterAssetEnded(c,t,i||0)}if(g||(g=this.getAssetPlayer(v.identifier)),g===null||g.destroyed){var E=c.assetList.length;this.warn("asset "+(i+1)+"/"+E+" player destroyed "+c),g=this.createAssetPlayer(c,v,i)}if(!this.eventItemsMatch(u,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(g,i,r,t,d),this.shouldPlay&&Ps(g.media)}else u!==null?(this.resumePrimary(u,t,n),this.shouldPlay&&Ps(this.hls.media)):o&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))},e.resumePrimary=function(t,r,i){var n;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log("resuming "+Se(t)),(n=this.detachedData)==null||!n.mediaSource){var o=this.timelinePos;(o<t.start||o>=t.end)&&(o=this.getPrimaryResumption(t,r),this.timelinePos=o),this.attachPrimary(o,t)}if(i){var l=this.schedule.items;l&&(this.log("resumed "+Se(t)),this.hls.trigger(p.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:r}),this.checkBuffer())}},e.getPrimaryResumption=function(t,r){var i=t.start;if(this.primaryLive){var n=this.primaryDetails;if(r===0)return this.hls.startPosition;if(n&&(i<n.fragmentStart||i>n.edge))return this.hls.liveSyncPosition||-1}return i},e.isAssetBuffered=function(t){var r=this.getAssetPlayer(t.identifier);return r!=null&&r.hls?r.hls.bufferedToEnd:tt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)},e.attachPrimary=function(t,r,i){r?this.setBufferingItem(r):this.bufferingItem=this.playingItem,this.bufferingAsset=null;var n=this.primaryMedia;if(n){var o=this.hls;o.media?this.checkBuffer():(this.transferMediaTo(o,n),i&&this.startLoadingPrimaryAt(t,i)),i||(this.timelinePos=t,this.startLoadingPrimaryAt(t,i))}},e.startLoadingPrimaryAt=function(t,r){var i,n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((i=n.mainForwardBufferInfo)==null?void 0:i.start)||n.media.currentTime)-t)>.5?n.startLoad(t,r):n.bufferingEnabled||n.resumeBuffering()},e.onManifestLoading=function(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(p.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(p.BUFFER_CODECS,this.onBufferCodecs,this)},e.onLevelUpdated=function(t,r){if(r.level!==-1){var i=this.hls.levels[r.level],n=at(at({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}},e.onAudioTrackUpdated=function(t,r){var i=this.hls.audioTracks[r.id],n=this.mediaSelection;if(n){var o=at(at({},n),{},{audio:i});this.mediaSelection=o}else this.altSelection=at(at({},this.altSelection),{},{audio:i})},e.onSubtitleTrackUpdated=function(t,r){var i=this.hls.subtitleTracks[r.id],n=this.mediaSelection;if(n){var o=at(at({},n),{},{subtitles:i});this.mediaSelection=o}else this.altSelection=at(at({},this.altSelection),{},{subtitles:i})},e.onAudioTrackSwitching=function(t,r){var i=zn(r);this.playerQueue.forEach(function(n){return n.hls.setAudioOption(r)||n.hls.setAudioOption(i)})},e.onSubtitleTrackSwitch=function(t,r){var i=zn(r);this.playerQueue.forEach(function(n){return n.hls.setSubtitleOption(r)||r.id!==-1&&n.hls.setSubtitleOption(i)})},e.onBufferCodecs=function(t,r){var i=r.tracks;i&&(this.requiredTracks=i)},e.onBufferAppended=function(t,r){this.checkBuffer()},e.onBufferFlushed=function(t,r){var i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){var n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}},e.onBufferedToEnd=function(t){var r=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&r){for(var i=0;i<r.length;i++){var n=r[i];if(n.cue.post){var o,l=this.schedule.findEventIndex(n.identifier),u=(o=this.schedule.items)==null?void 0:o[l];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}},e.onMediaEnded=function(t){var r=this.playingItem;if(!this.playingLastItem&&r){var i=this.findItemIndex(r);this.setSchedulePosition(i+1)}else this.shouldPlay=!1},e.updateItem=function(t,r){var i=this.schedule.items;return t&&i&&i[this.findItemIndex(t,r)]||null},e.itemsMatch=function(t,r){return!!r&&(t===r||t.event&&r.event&&this.eventItemsMatch(t,r)||!t.event&&!r.event&&this.findItemIndex(t)===this.findItemIndex(r))},e.eventItemsMatch=function(t,r){var i;return!!r&&(t===r||t.event.identifier===((i=r.event)==null?void 0:i.identifier))},e.findItemIndex=function(t,r){return t?this.schedule.findItemIndex(t,r):-1},e.updateSchedule=function(){var t=this.mediaSelection;t&&this.schedule.updateSchedule(t,[])},e.checkBuffer=function(t){var r=this.schedule.items;if(r){var i=tt.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=i.len<1),this.updateBufferedPos(i.end,r,t)}},e.updateBufferedPos=function(t,r,i){var n=this.schedule,o=this.bufferingItem;if(!(this.bufferedPos>t))if(r.length===1&&this.itemsMatch(r[0],o))this.bufferedPos=t;else{var l=this.playingItem,u=this.findItemIndex(l),d=n.findItemIndexAtTime(t);if(this.bufferedPos<t){var h,c,f=this.findItemIndex(o),g=Math.min(f+1,r.length-1),v=r[g];if((d===-1&&o&&t>=o.end||(h=v.event)!=null&&h.appendInPlace&&t+.01>=v.start)&&(d=g),g-u>1&&(o==null||(c=o.event)==null?void 0:c.appendInPlace)===!1)return;if(this.bufferedPos=t,d>f&&d>u)this.bufferedToItem(v);else{var m=this.primaryDetails;this.primaryLive&&m&&t>m.edge-m.targetduration&&v.start<m.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else i&&l&&!this.itemsMatch(l,o)&&(d===u?this.bufferedToItem(l):d===u+1&&this.bufferedToItem(r[d]))}},e.assetsBuffered=function(t,r){var i=this;return t.event.assetList.length!==0&&!t.event.assetList.some(function(n){var o=i.getAssetPlayer(n.identifier);return!(o!=null&&o.bufferedInPlaceToEnd(r))})},e.setBufferingItem=function(t){var r=this,i=this.bufferingItem,n=this.schedule;if(this.itemsMatch(t,i))this.bufferingItem!==t&&(this.bufferingItem=t);else{var o=n.items,l=n.events;if(!o||!l)return i;var u=this.isInterstitial(t),d=this.getBufferingPlayer();if(this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos)),!this.playbackDisabled){var h=d?d.remaining:i?i.end-this.timelinePos:0;this.log("buffered to boundary "+Se(t)+(i?" ("+h.toFixed(2)+" remaining)":"")),u?t.event.assetList.forEach(function(c){var f=r.getAssetPlayer(c.identifier);f&&f.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(function(c){return c.pauseBuffering()}))}this.hls.trigger(p.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:o.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}return i},e.bufferedToItem=function(t,r){r===void 0&&(r=0);var i=this.setBufferingItem(t);if(!this.playbackDisabled){if(this.isInterstitial(t))this.bufferedToEvent(t,r);else if(i!==null){this.bufferingAsset=null;var n=this.detachedData;n&&n.mediaSource?this.attachPrimary(t.start,t,!0):this.preloadPrimary(t)}}},e.preloadPrimary=function(t){var r=this.findItemIndex(t),i=this.getPrimaryResumption(t,r);this.startLoadingPrimaryAt(i)},e.bufferedToEvent=function(t,r){var i=t.event,n=i.assetList.length===0&&!i.assetListLoader,o=i.cue.once;if(n||!o){var l=this.preloadAssets(i,r);if(l!=null&&l.interstitial.appendInPlace){var u=i.assetList[r],d=this.primaryMedia;u&&d&&this.bufferAssetPlayer(l,d)}}},e.preloadAssets=function(t,r){var i=t.assetUrl,n=t.assetList.length,o=n===0&&!t.assetListLoader,l=t.cue.once;if(o){var u,d=t.timelineStart;if(t.appendInPlace){var h,c=this.playingItem;this.isInterstitial(c)||(c==null||(h=c.nextEvent)==null?void 0:h.identifier)!==t.identifier||this.flushFrontBuffer(d+.25)}var f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition)===-1&&(f=this.hls.liveSyncPosition||0),f&&!t.cue.pre&&!t.cue.post){var g=f-d;g>0&&(u=Math.round(1e3*g)/1e3)}if(this.log("Load interstitial asset "+(r+1)+"/"+(i?1:n)+" "+t+(u?" live-start: "+f+" start-offset: "+u:"")),i)return this.createAsset(t,0,0,d,t.duration,i);var v=this.assetListLoader.loadAssetList(t,u);v&&(t.assetListLoader=v)}else if(!l&&n){for(var m=r;m<n;m++){var y=t.assetList[m],E=this.getAssetPlayerQueueIndex(y.identifier);E!==-1&&!this.playerQueue[E].destroyed||y.error||this.createAssetPlayer(t,y,m)}return this.getAssetPlayer(t.assetList[r].identifier)}return null},e.flushFrontBuffer=function(t){var r=this,i=this.requiredTracks;i&&(this.log("Removing front buffer starting at "+t),Object.keys(i).forEach(function(n){r.hls.trigger(p.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:n})}))},e.getAssetPlayerQueueIndex=function(t){for(var r=this.playerQueue,i=0;i<r.length;i++)if(t===r[i].assetId)return i;return-1},e.getAssetPlayer=function(t){var r=this.getAssetPlayerQueueIndex(t);return this.playerQueue[r]||null},e.getBufferingPlayer=function(){var t=this.playerQueue,r=this.primaryMedia;if(r){for(var i=0;i<t.length;i++)if(t[i].media===r)return t[i]}return null},e.createAsset=function(t,r,i,n,o,l){var u={parentIdentifier:t.identifier,identifier:$l(t,l,r),duration:o,startOffset:i,timelineStart:n,uri:l};return this.createAssetPlayer(t,u,r)},e.createAssetPlayer=function(t,r,i){var n=this;this.log("create HLSAssetPlayer for "+qi(r));var o=this.hls,l=o.userConfig,u=l.videoPreference,d=o.loadLevelObj||o.levels[o.currentLevel];(u||d)&&(u=ot({},u),d.videoCodec&&(u.videoCodec=d.videoCodec),d.videoRange&&(u.allowedVideoRanges=[d.videoRange]));var h=o.audioTracks[o.audioTrack],c=o.subtitleTracks[o.subtitleTrack],f=0;if(this.primaryLive||t.appendInPlace){var g=this.timelinePos-r.timelineStart;if(g>1){var v=r.duration;v&&g<v&&(f=g)}}var m=r.identifier,y=at(at({},l),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:o.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:o.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:u,audioPreference:h||l.audioPreference,subtitlePreference:c||l.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,r.timelineStart&&(y.timelineOffset=r.timelineStart));var E=y.cmcd;E!=null&&E.sessionId&&E.contentId&&(y.cmcd=ot({},E,{contentId:or(r.uri)})),this.getAssetPlayer(m)&&this.warn("Duplicate date range identifier "+t+" and asset "+m);var T=new Zl(this.HlsPlayerClass,y,t,r);this.playerQueue.push(T),t.assetList[i]=r;var S=function(b){if(b.live){var R=new Error("Interstitials MUST be VOD assets "+t),k={fatal:!0,type:K.OTHER_ERROR,details:D.INTERSTITIAL_ASSET_ITEM_ERROR,error:R};n.handleAssetItemError(k,t,n.schedule.findEventIndex(t.identifier),i,R.message)}else{var _=b.edge-b.fragmentStart,C=r.duration;(C===null||_>C)&&(n.log('Interstitial asset "'+m+'" duration change '+C+" > "+_),r.duration=_,n.updateSchedule())}};T.on(p.LEVEL_UPDATED,function(b,R){var k=R.details;return S(k)}),T.on(p.LEVEL_PTS_UPDATED,function(b,R){var k=R.details;return S(k)});var I=function(b,R){var k=n.getAssetPlayer(m);if(k&&R.tracks){k.off(p.BUFFER_CODECS,I),k.tracks=R.tracks;var _=n.primaryMedia;n.bufferingAsset===k.assetItem&&_&&!k.media&&n.bufferAssetPlayer(k,_)}};T.on(p.BUFFER_CODECS,I);var L=function(){var b,R=n.getAssetPlayer(m);if(n.log("buffered to end of asset "+R),R){var k=n.schedule.findEventIndex(t.identifier),_=t.findAssetIndex(r),C=_+1,x=(b=n.schedule.items)==null?void 0:b[k];if(n.isInterstitial(x))if(_===-1||t.isAssetPastPlayoutLimit(C)||t.assetList[C].error){var w,P=(w=n.schedule.items)==null?void 0:w[k+1];P&&n.bufferedToItem(P)}else n.bufferedToItem(x,C)}};T.on(p.BUFFERED_TO_END,L);var A=function(b){return function(){if(n.getAssetPlayer(m)){n.shouldPlay=!0;var R=n.schedule.findEventIndex(t.identifier);n.advanceAfterAssetEnded(t,R,b)}}};return T.once(p.MEDIA_ENDED,A(i)),T.once(p.PLAYOUT_LIMIT_REACHED,A(1/0)),T.on(p.ERROR,function(b,R){var k=n.getAssetPlayer(m);if(R.details!==D.BUFFER_STALLED_ERROR)n.handleAssetItemError(R,t,n.schedule.findEventIndex(t.identifier),i,"Asset player error "+R.error+" "+t);else if(k!=null&&k.media){var _=k.currentTime,C=k.duration-_;_&&t.appendInPlace&&C/k.media.playbackRate<.5?(n.log("Advancing buffer past end of asset "+m+" "+t+" at "+k.media.currentTime),L()):(n.warn("Stalled at "+_+" of "+(_+C)+" in asset "+m+" "+t),n.onTimeupdate(),n.checkBuffer(!0))}}),T.on(p.DESTROYING,function(){if(n.getAssetPlayer(m)){var b=new Error("Asset player destroyed unexpectedly "+m),R={fatal:!0,type:K.OTHER_ERROR,details:D.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};n.handleAssetItemError(R,t,n.schedule.findEventIndex(t.identifier),i,b.message)}}),this.hls.trigger(p.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:r,assetListIndex:i,event:t,player:T}),T},e.clearInterstitial=function(t,r){var i=this;t.assetList.forEach(function(n){i.clearAssetPlayer(n.identifier,r)}),t.reset()},e.clearAssetPlayer=function(t,r){var i=this.getAssetPlayerQueueIndex(t);if(i!==-1){this.log('clearAssetPlayer "'+t+'" toSegment: '+(r&&Se(r)));var n=this.playerQueue[i];this.transferMediaFromPlayer(n,r),this.playerQueue.splice(i,1),n.destroy()}},e.emptyPlayerQueue=function(){for(var t;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]},e.startAssetPlayer=function(t,r,i,n,o){var l=t.interstitial,u=t.assetItem,d=t.assetId,h=l.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=u,c&&c.identifier===d||(c&&(this.clearAssetPlayer(c.identifier,i[n]),delete c.error),this.log("INTERSTITIAL_ASSET_STARTED "+(r+1)+"/"+h+" "+t),this.hls.trigger(p.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:r,event:l,schedule:i.slice(0),scheduleIndex:n,player:t})),this.bufferAssetPlayer(t,o)},e.bufferAssetPlayer=function(t,r){var i,n,o=t.interstitial,l=t.assetItem,u=t.assetId,d=this.schedule.findEventIndex(o.identifier),h=(i=this.schedule.items)==null?void 0:i[d];if(h){this.setBufferingItem(h),this.bufferingAsset=l;var c=this.getBufferingPlayer();if(c!==t){var f=o.appendInPlace;if(!f||(c==null?void 0:c.interstitial.appendInPlace)!==!1){var g=(c==null?void 0:c.tracks)||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(f&&l!==this.playingAsset){if(!t.tracks)return;if(g&&!An(g,t.tracks)){var v=new Error('Asset "'+u+`" SourceBuffer tracks ('`+Object.keys(t.tracks)+"') are not compatible with primary content tracks ('"+Object.keys(g)+"')"),m={fatal:!0,type:K.OTHER_ERROR,details:D.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},y=o.findAssetIndex(l);return void this.handleAssetItemError(m,o,d,y,v.message)}}this.transferMediaTo(t,r)}}}},e.handleAssetItemError=function(t,r,i,n,o){if(t.details!==D.BUFFER_STALLED_ERROR){var l=r.assetList[n]||null,u=null;if(l){var d=this.getAssetPlayerQueueIndex(l.identifier);u=this.playerQueue[d]||null}var h=this.schedule.items,c=ot({},t,{fatal:!1,errorAction:ze(!0),asset:l,assetListIndex:n,event:r,schedule:h,scheduleIndex:i,player:u});if(this.warn("Asset item error: "+t.error),this.hls.trigger(p.INTERSTITIAL_ASSET_ERROR,c),t.fatal){var f=new Error(o);l&&(this.playingAsset!==l&&this.clearAssetPlayer(l.identifier,null),l.error=f),r.assetList.some(function(g){return!g.error})?r.appendInPlace&&(r.error=f):r.error=f,this.primaryFallback(r)}}},e.primaryFallback=function(t){var r=t.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log('Fallback to primary from event "'+t.identifier+'" start: '+r+" pos: "+this.timelinePos+" playing: "+(i?Se(i):"<none>")+" error: "+t.error),t.appendInPlace&&(this.attachPrimary(r,null),this.flushFrontBuffer(r));var n=this.timelinePos;n===-1&&(n=this.hls.startPosition);var o=this.updateItem(i,n);if(this.itemsMatch(i,o))this.clearInterstitial(t,null);else{var l=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(l)}}else this.checkStart()},e.onAssetListLoaded=function(t,r){var i,n=this,o=r.event,l=o.identifier,u=r.assetListResponse.ASSETS;if(this.schedule.hasEvent(l)){var d=o.timelineStart,h=o.duration,c=0;u.forEach(function(L,A){var b=parseFloat(L.DURATION);n.createAsset(o,A,c,d+c,b,L.URI),c+=b}),o.duration=c,this.log("Loaded asset-list with duration: "+c+" (was: "+h+") "+o);var f=this.waitingItem,g=(f==null?void 0:f.event.identifier)===l;this.updateSchedule();var v=(i=this.bufferingItem)==null?void 0:i.event;if(g){var m,y=this.schedule.findEventIndex(l),E=(m=this.schedule.items)==null?void 0:m[y];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y)return o.error=new Error("Interstitial no longer within playback range "+this.timelinePos+" "+o),void this.primaryFallback(o);this.setBufferingItem(E)}this.setSchedulePosition(y)}else if((v==null?void 0:v.identifier)===l&&v.appendInPlace){var T=o.assetList[0],S=this.getAssetPlayer(T.identifier),I=this.primaryMedia;T&&S&&I&&this.bufferAssetPlayer(S,I)}}},e.onError=function(t,r){switch(r.details){case D.ASSET_LIST_PARSING_ERROR:case D.ASSET_LIST_LOAD_ERROR:case D.ASSET_LIST_LOAD_TIMEOUT:var i=r.interstitial;i&&this.primaryFallback(i);break;case D.BUFFER_STALLED_ERROR:this.onTimeupdate(),this.checkBuffer(!0)}},dt(a,[{key:"interstitialsManager",get:function(){if(!this.manager){if(!this.hls)return null;var t=this,r=function(){return t.bufferingItem||t.waitingItem},i=function(c){return c&&t.getAssetPlayer(c.identifier)},n=function(c,f,g,v,m){if(c){var y=c[f].start,E=c.event;if(E){if(f==="playout"||E.timelineOccupancy!==Nr.Point){var T=i(g);(T==null?void 0:T.interstitial)===E&&(y+=T.assetItem.startOffset+T[m])}}else y+=(v==="bufferedPos"?o():t[v])-c.start;return y}return 0},o=function(){var c=t.bufferedPos;return c===Number.MAX_VALUE?l("primary"):Math.max(c,0)},l=function(c){var f;return(f=t.primaryDetails)!=null&&f.live?t.primaryDetails.edge:t.schedule.durations[c]},u=function(c,f){var g,v,m=t.effectivePlayingItem;if(m==null||(g=m.event)==null||!g.restrictions.skip){t.log("seek to "+c+' "'+f+'"');var y=t.effectivePlayingItem,E=t.schedule.findItemIndexAtTime(c,f),T=(v=t.schedule.items)==null?void 0:v[E],S=t.getBufferingPlayer(),I=S==null?void 0:S.interstitial,L=I==null?void 0:I.appendInPlace,A=y&&t.itemsMatch(y,T);if(y&&(L||A)){var b=i(t.playingAsset),R=(b==null?void 0:b.media)||t.primaryMedia;if(R){var k=f==="primary"?R.currentTime:n(y,f,t.playingAsset,"timelinePos","currentTime"),_=c-k,C=(L?k:R.currentTime)+_;if(C>=0&&(!b||L||C<=b.duration))return void(R.currentTime=C)}}if(T){var x=c;if(f!=="primary"){var w=c-T[f].start;x=T.start+w}var P=!t.isInterstitial(T);if(t.isInterstitial(y)&&!y.event.appendInPlace||!P&&!T.event.appendInPlace){if(y){var M=t.findItemIndex(y);if(E>M){var F=t.schedule.findJumpRestrictedIndex(M+1,E);if(F>M)return void t.setSchedulePosition(F)}var U=0;if(P)t.timelinePos=x,t.checkBuffer();else{var G,N=T==null||(G=T.event)==null?void 0:G.assetList;if(N)for(var H=c-(T[f]||T).start,j=N.length;j--;){var et=N[j];if(et.duration&&H>=et.startOffset&&H<et.startOffset+et.duration){U=j;break}}}t.setSchedulePosition(E,U)}}else{var X=t.media||(L?S==null?void 0:S.media:null);X&&(X.currentTime=x)}}}},d=function(){var c=t.effectivePlayingItem;if(t.isInterstitial(c))return c;var f=r();return t.isInterstitial(f)?f:null},h={get currentTime(){var c=d(),f=t.effectivePlayingItem;return f&&f===c?n(f,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(c){var f=d(),g=t.effectivePlayingItem;g&&g===f&&u(c+g.playout.start,"playout")},get duration(){var c=d();return c?c.playout.end-c.playout.start:0},get assetPlayers(){var c,f=(c=d())==null?void 0:c.event.assetList;return f?f.map(function(g){return t.getAssetPlayer(g.identifier)}):[]},get playingIndex(){var c,f=(c=d())==null?void 0:c.event;return f&&t.effectivePlayingAsset?f.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return d()}};this.manager={get events(){var c,f;return((c=t.schedule)==null||(f=c.events)==null?void 0:f.slice(0))||[]},get schedule(){var c,f;return((c=t.schedule)==null||(f=c.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return d()?h:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return r()},get bufferingIndex(){var c=r();return t.findItemIndex(c)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){var c=t.effectivePlayingItem;return t.findItemIndex(c)},primary:{get bufferedEnd(){return o()},get currentTime(){var c=t.timelinePos;return c>0?c:0},set currentTime(c){u(c,"primary")},get duration(){return l("primary")},get seekableStart(){var c;return((c=t.primaryDetails)==null?void 0:c.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(r(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(c){u(c,"integrated")},get duration(){return l("integrated")},get seekableStart(){var c;return function(f,g){if(f!==0&&g!=="primary"&&t.schedule.length){var v,m=t.schedule.findItemIndexAtTime(f),y=(v=t.schedule.items)==null?void 0:v[m];if(y)return f+(y[g].start-y.start)}return f}(((c=t.primaryDetails)==null?void 0:c.fragmentStart)||0,"integrated")}},skip:function(){var c=t.effectivePlayingItem,f=c==null?void 0:c.event;if(f&&!f.restrictions.skip){var g=t.findItemIndex(c);if(f.appendInPlace){var v=c.playout.start+c.event.duration;u(v+.001,"playout")}else t.advanceAfterAssetEnded(f,g,1/0)}}}}return this.manager}},{key:"effectivePlayingItem",get:function(){return this.waitingItem||this.playingItem||this.endedItem}},{key:"effectivePlayingAsset",get:function(){return this.playingAsset||this.endedAsset}},{key:"playingLastItem",get:function(){var t,r=this.playingItem,i=(t=this.schedule)==null?void 0:t.items;return!!(this.playbackStarted&&r&&i)&&this.findItemIndex(r)===i.length-1}},{key:"playbackStarted",get:function(){return this.effectivePlayingItem!==null}},{key:"currentTime",get:function(){var t,r,i;if(this.mediaSelection!==null){var n=this.waitingItem||this.playingItem;if(!this.isInterstitial(n)||n.event.appendInPlace){var o=this.media;!o&&(t=this.bufferingItem)!=null&&(r=t.event)!=null&&r.appendInPlace&&(o=this.primaryMedia);var l=(i=o)==null?void 0:i.currentTime;if(l!==void 0&&B(l))return l}}}},{key:"primaryMedia",get:function(){var t;return this.media||((t=this.detachedData)==null?void 0:t.media)||null}},{key:"playbackDisabled",get:function(){return this.hls.config.enableInterstitialPlayback===!1}},{key:"primaryDetails",get:function(){var t,r;return(t=this.mediaSelection)==null||(r=t.main)==null?void 0:r.details}},{key:"primaryLive",get:function(){var t;return!((t=this.primaryDetails)==null||!t.live)}}])}(oe),iu=function(s){function a(t,r,i){var n;return(n=s.call(this,t,r,i,"subtitle-stream-controller",Qt)||this).currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n.registerListeners(),n}ut(a,s);var e=a.prototype;return e.onHandlerDestroying=function(){this.unregisterListeners(),s.prototype.onHandlerDestroying.call(this),this.mainDetails=null},e.registerListeners=function(){s.prototype.registerListeners.call(this);var t=this.hls;t.on(p.LEVEL_LOADED,this.onLevelLoaded,this),t.on(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(p.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this)},e.unregisterListeners=function(){s.prototype.unregisterListeners.call(this);var t=this.hls;t.off(p.LEVEL_LOADED,this.onLevelLoaded,this),t.off(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(p.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(p.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this)},e.startLoad=function(t,r){this.stopLoad(),this.state=O.IDLE,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=r?-1:t,this.tick()},e.onManifestLoading=function(){s.prototype.onManifestLoading.call(this),this.mainDetails=null},e.onMediaDetaching=function(t,r){this.tracksBuffered=[],s.prototype.onMediaDetaching.call(this,t,r)},e.onLevelLoaded=function(t,r){this.mainDetails=r.details},e.onSubtitleFragProcessed=function(t,r){var i=r.frag,n=r.success;if(Dt(i)&&(this.fragPrevious=i),this.state=O.IDLE,n){var o=this.tracksBuffered[this.currentTrackId];if(o){for(var l,u=i.start,d=0;d<o.length;d++)if(u>=o[d].start&&u<=o[d].end){l=o[d];break}var h=i.start+i.duration;l?l.end=h:(l={start:u,end:h},o.push(l)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}}},e.onBufferFlushing=function(t,r){var i=r.startOffset,n=r.endOffset;if(i===0&&n!==Number.POSITIVE_INFINITY){var o=n-1;if(o<=0)return;r.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach(function(l){for(var u=0;u<l.length;)if(l[u].end<=o)l.shift();else{if(!(l[u].start<o))break;l[u].start=o,u++}}),this.fragmentTracker.removeFragmentsInRange(i,o,Qt)}},e.onError=function(t,r){var i=r.frag;(i==null?void 0:i.type)===Qt&&(r.details===D.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==O.STOPPED&&(this.state=O.IDLE))},e.onSubtitleTracksUpdated=function(t,r){var i=this,n=r.subtitleTracks;this.levels&&vs(this.levels,n)?this.levels=n.map(function(o){return new qe(o)}):(this.tracksBuffered=[],this.levels=n.map(function(o){var l=new qe(o);return i.tracksBuffered[l.id]=[],l}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Qt),this.fragPrevious=null,this.mediaBuffer=null)},e.onSubtitleTrackSwitch=function(t,r){var i;if(this.currentTrackId=r.id,(i=this.levels)!=null&&i.length&&this.currentTrackId!==-1){var n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==O.STOPPED&&this.setInterval(500)}else this.clearInterval()},e.onSubtitleTrackLoaded=function(t,r){var i,n=this.currentTrackId,o=this.levels,l=r.details,u=r.id;if(o){var d=o[u];if(!(u>=o.length)&&d){if(this.log("Subtitle track "+u+" loaded ["+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+",duration:"+l.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges,l.live||(i=d.details)!=null&&i.live){var h=this.mainDetails;if(l.deltaUpdateFailed||!h)return;var c,f=h.fragments[0];d.details?this.alignPlaylists(l,d.details,(c=this.levelLastLoaded)==null?void 0:c.details)===0&&f&&Li(l,f.start):l.hasProgramDateTime&&h.hasProgramDateTime?(Dr(l,h),l.fragmentStart):f&&Li(l,f.start)}d.details=l,this.levelLastLoaded=d,u===n&&(this.hls.trigger(p.SUBTITLE_TRACK_UPDATED,{details:l,id:u,groupId:r.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===O.IDLE&&(Re(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}}else this.warn("Subtitle tracks were reset while loading level "+u)},e._handleFragmentLoadComplete=function(t){var r=this,i=t.frag,n=t.payload,o=i.decryptdata,l=this.hls;if(!this.fragContextChanged(i)&&n&&n.byteLength>0&&o!=null&&o.key&&o.iv&&Me(o.method)){var u=performance.now();this.decrypter.decrypt(new Uint8Array(n),o.key.buffer,o.iv.buffer,di(o.method)).catch(function(d){throw l.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:i}),d}).then(function(d){var h=performance.now();l.trigger(p.FRAG_DECRYPTED,{frag:i,payload:d,stats:{tstart:u,tdecrypt:h}})}).catch(function(d){r.warn(d.name+": "+d.message),r.state=O.IDLE})}},e.doTick=function(){if(this.media){if(this.state===O.IDLE){var t=this.currentTrackId,r=this.levels,i=r==null?void 0:r[t];if(!i||!r.length||!i.details||this.waitForLive(i))return;var n=this.config,o=this.getLoadPosition(),l=tt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o,n.maxBufferHole),u=l.end,d=l.len,h=i.details;if(d>this.hls.maxBufferLength+h.levelTargetDuration)return;var c=h.fragments,f=c.length,g=h.edge,v=null,m=this.fragPrevious;if(u<g){var y=n.maxFragLookUpTolerance,E=u>g-y?0:y;!(v=Re(m,c,Math.max(c[0].start,u),E))&&m&&m.start<c[0].start&&(v=c[0])}else v=c[f-1];if(!(v=this.filterReplacedPrimary(v,i.details)))return;var T=c[v.sn-h.startSN-1];if(T&&T.cc===v.cc&&this.fragmentTracker.getState(T)===Qe&&(v=T),this.fragmentTracker.getState(v)===Qe){var S=this.mapToInitFragWhenRequired(v);S&&this.loadFragment(S,i,u)}}}else this.state=O.IDLE},e.loadFragment=function(t,r,i){Dt(t)?s.prototype.loadFragment.call(this,t,r,i):this._loadInitSegment(t,r)},dt(a,[{key:"mediaBufferTimeRanges",get:function(){return new nu(this.tracksBuffered[this.currentTrackId]||[])}}])}(Ai),nu=function(s){this.buffered=void 0;var a=function(e,t,r){if((t>>>=0)>r-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+t+") is greater than the maximum bound ("+r+")");return s[t][e]};this.buffered={get length(){return s.length},end:function(e){return a("end",e,s.length)},start:function(e){return a("start",e,s.length)}}};function Cs(s,a){var e;try{e=new Event("addtrack")}catch{(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=s,a.dispatchEvent(e)}function ws(s,a){var e=s.mode;if(e==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(a.id))try{if(s.addCue(a),!s.cues.getCueById(a.id))throw new Error("addCue is failed for: "+a)}catch(r){Z.debug("[texttrack-utils]: "+r);try{var t=new self.TextTrackCue(a.startTime,a.endTime,a.text);t.id=a.id,s.addCue(t)}catch(i){Z.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+i)}}e==="disabled"&&(s.mode=e)}function Ke(s,a){var e=s.mode;if(e==="disabled"&&(s.mode="hidden"),s.cues)for(var t=s.cues.length;t--;)a&&s.cues[t].removeEventListener("enter",a),s.removeCue(s.cues[t]);e==="disabled"&&(s.mode=e)}function Xi(s,a,e,t){var r=s.mode;if(r==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var i=function(o,l,u){var d=[],h=function(v,m){if(m<=v[0].startTime)return 0;var y=v.length-1;if(m>v[y].endTime)return-1;for(var E,T=0,S=y;T<=S;)if(m<v[E=Math.floor((S+T)/2)].startTime)S=E-1;else{if(!(m>v[E].startTime&&T<y))return E;T=E+1}return v[T].startTime-m<m-v[S].startTime?T:S}(o,l);if(h>-1)for(var c=h,f=o.length;c<f;c++){var g=o[c];if(g.startTime>=l&&g.endTime<=u)d.push(g);else if(g.startTime>u)return d}return d}(s.cues,a,e),n=0;n<i.length;n++)t&&!t(i[n])||s.removeCue(i[n]);r==="disabled"&&(s.mode=r)}function Ur(s){for(var a=[],e=0;e<s.length;e++){var t=s[e];t.kind!=="subtitles"&&t.kind!=="captions"||!t.label||a.push(s[e])}return a}var au=function(s){function a(t){var r;return(r=s.call(this,t,"subtitle-track-controller")||this).media=null,r.tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.onTextTracksChanged=function(){if(r.useTextTrackPolling||self.clearInterval(r.subtitlePollingInterval),r.media&&r.hls.config.renderTextTracksNatively){for(var i=null,n=Ur(r.media.textTracks),o=0;o<n.length;o++)if(n[o].mode==="hidden")i=n[o];else if(n[o].mode==="showing"){i=n[o];break}var l=r.findTrackForTextTrack(i);r.subtitleTrack!==l&&r.setSubtitleTrack(l)}},r.registerListeners(),r}ut(a,s);var e=a.prototype;return e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,s.prototype.destroy.call(this)},e.registerListeners=function(){var t=this.hls;t.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.MANIFEST_PARSED,this.onManifestParsed,this),t.on(p.LEVEL_LOADING,this.onLevelLoading,this),t.on(p.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(p.ERROR,this.onError,this)},e.unregisterListeners=function(){var t=this.hls;t.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.MANIFEST_PARSED,this.onManifestParsed,this),t.off(p.LEVEL_LOADING,this.onLevelLoading,this),t.off(p.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(p.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(p.ERROR,this.onError,this)},e.onMediaAttached=function(t,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},e.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)},e.onMediaDetaching=function(t,r){var i=this.media;if(i){var n=!!r.transferMedia;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n||Ur(i.textTracks).forEach(function(o){Ke(o)})}},e.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},e.onManifestParsed=function(t,r){this.tracks=r.subtitleTracks},e.onSubtitleTrackLoaded=function(t,r){var i=r.id,n=r.groupId,o=r.details,l=this.tracksInGroup[i];if(l&&l.groupId===n){var u=l.details;l.details=r.details,this.log("Subtitle track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+n+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,u)}else this.warn("Subtitle track with id:"+i+" and group:"+n+" not found in active group "+(l==null?void 0:l.groupId))},e.onLevelLoading=function(t,r){this.switchLevel(r.level)},e.onLevelSwitching=function(t,r){this.switchLevel(r.level)},e.switchLevel=function(t){var r=this.hls.levels[t];if(r){var i=r.subtitleGroups||null,n=this.groupIds,o=this.currentTrack;if(!i||(n==null?void 0:n.length)!==(i==null?void 0:i.length)||i!=null&&i.some(function(g){return(n==null?void 0:n.indexOf(g))===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var l=this.tracks.filter(function(g){return!i||i.indexOf(g.groupId)!==-1});if(l.length)this.selectDefaultTrack&&!l.some(function(g){return g.default})&&(this.selectDefaultTrack=!1),l.forEach(function(g,v){g.id=v});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=l;var u=this.hls.config.subtitlePreference;if(!o&&u){this.selectDefaultTrack=!1;var d=ee(u,l);if(d>-1)o=l[d];else{var h=ee(u,this.tracks);o=this.tracks[h]}}var c=this.findTrackId(o);c===-1&&o&&(c=this.findTrackId(null));var f={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+(i==null?void 0:i.join(","))+'" group-id'),this.hls.trigger(p.SUBTITLE_TRACKS_UPDATED,f),c!==-1&&this.trackId===-1&&this.setSubtitleTrack(c)}}},e.findTrackId=function(t){for(var r=this.tracksInGroup,i=this.selectDefaultTrack,n=0;n<r.length;n++){var o=r[n];if((!i||o.default)&&(i||t)&&(!t||Le(o,t)))return n}if(t){for(var l=0;l<r.length;l++){var u=r[l];if(nr(t.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(var d=0;d<r.length;d++){var h=r[d];if(nr(t.attrs,h.attrs,["LANGUAGE"]))return d}}return-1},e.findTrackForTextTrack=function(t){if(t){for(var r=this.tracksInGroup,i=0;i<r.length;i++)if(Gi(r[i],t))return i}return-1},e.onError=function(t,r){!r.fatal&&r.context&&(r.context.type!==$t||r.context.id!==this.trackId||this.groupIds&&this.groupIds.indexOf(r.context.groupId)===-1||this.checkRetry(r))},e.setSubtitleOption=function(t){if(this.hls.config.subtitlePreference=t,t){if(t.id===-1)return this.setSubtitleTrack(-1),null;var r=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,r.length){var i=this.currentTrack;if(i&&Le(t,i))return i;var n=ee(t,this.tracksInGroup);if(n>-1){var o=this.tracksInGroup[n];return this.setSubtitleTrack(n),o}if(i)return null;var l=ee(t,r);if(l>-1)return r[l]}}return null},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)},e.loadingPlaylist=function(t,r){s.prototype.loadingPlaylist.call(this,t,r);var i=t.id,n=t.groupId,o=this.getUrlWithDirectives(t.url,r),l=t.details,u=l==null?void 0:l.age;this.log("Loading subtitle "+i+' "'+t.name+'" lang:'+t.lang+" group:"+n+((r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:"")+(u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):"")+" "+o),this.hls.trigger(p.SUBTITLE_TRACK_LOADING,{url:o,id:i,groupId:n,deliveryDirectives:r||null,track:t})},e.toggleTrackModes=function(){var t=this.media;if(t){var r,i=Ur(t.textTracks),n=this.currentTrack;if(n&&((r=i.filter(function(l){return Gi(n,l)})[0])||this.warn('Unable to find subtitle TextTrack with name "'+n.name+'" and language "'+n.lang+'"')),[].slice.call(i).forEach(function(l){l.mode!=="disabled"&&l!==r&&(l.mode="disabled")}),r){var o=this.subtitleDisplay?"showing":"hidden";r.mode!==o&&(r.mode=o)}}},e.setSubtitleTrack=function(t){var r=this.tracksInGroup;if(this.media)if(t<-1||t>=r.length||!B(t))this.warn("Invalid subtitle track id: "+t);else{this.selectDefaultTrack=!1;var i=this.currentTrack,n=r[t]||null;if(this.trackId=t,this.currentTrack=n,this.toggleTrackModes(),n){var o=!!n.details&&!n.details.live;if(t!==this.trackId||n!==i||!o){this.log("Switching to subtitle-track "+t+(n?' "'+n.name+'" lang:'+n.lang+" group:"+n.groupId:""));var l=n.id,u=n.groupId,d=u===void 0?"":u,h=n.name,c=n.type,f=n.url;this.hls.trigger(p.SUBTITLE_TRACK_SWITCH,{id:l,groupId:d,name:h,type:c,url:f});var g=this.switchParams(n.url,i==null?void 0:i.details,n.details);this.loadPlaylist(g)}}else this.hls.trigger(p.SUBTITLE_TRACK_SWITCH,{id:t})}else this.queuedDefaultTrack=t},dt(a,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}}])}(Bi),su={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},xs=function(s){return String.fromCharCode(su[s]||s)},ke=15,ce=100,ou={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},lu={17:2,18:4,21:6,22:8,23:10,19:13,20:15},uu={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},du={25:2,26:4,29:6,30:8,31:10,27:13,28:15},hu=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],fu=function(){function s(){this.time=null,this.verboseLevel=0}return s.prototype.log=function(a,e){if(this.verboseLevel>=a){var t=typeof e=="function"?e():e;Z.log(this.time+" ["+a+"] "+t)}},s}(),be=function(s){for(var a=[],e=0;e<s.length;e++)a.push(s[e].toString(16));return a},Os=function(){function s(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var a=s.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},a.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},s}(),cu=function(){function s(){this.uchar=" ",this.penState=new Os}var a=s.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},a.setPenState=function(e){this.penState.copy(e)},a.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},a.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},s}(),gu=function(){function s(e){this.chars=[],this.pos=0,this.currPenState=new Os,this.cueStartTime=null,this.logger=void 0;for(var t=0;t<ce;t++)this.chars.push(new cu);this.logger=e}var a=s.prototype;return a.equals=function(e){for(var t=0;t<ce;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0},a.copy=function(e){for(var t=0;t<ce;t++)this.chars[t].copy(e.chars[t])},a.isEmpty=function(){for(var e=!0,t=0;t<ce;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},a.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ce&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ce)},a.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(e){var t=this;e>=144&&this.backSpace();var r=xs(e);this.pos>=ce?this.logger.log(0,function(){return"Cannot insert "+e.toString(16)+" ("+r+") at position "+t.pos+". Skipping it!"}):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},a.clearFromPos=function(e){var t;for(t=e;t<ce;t++)this.chars[t].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var e=[],t=!0,r=0;r<ce;r++){var i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")},a.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},s}(),zi=function(){function s(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var t=0;t<ke;t++)this.rows.push(new gu(e));this.logger=e}var a=s.prototype;return a.reset=function(){for(var e=0;e<ke;e++)this.rows[e].clear();this.currRow=14},a.equals=function(e){for(var t=!0,r=0;r<ke;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},a.copy=function(e){for(var t=0;t<ke;t++)this.rows[t].copy(e.rows[t])},a.isEmpty=function(){for(var e=!0,t=0;t<ke;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},a.backSpace=function(){this.rows[this.currRow].backSpace()},a.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},a.insertChar=function(e){this.rows[this.currRow].insertChar(e)},a.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},a.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},a.setCursor=function(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},a.setPAC=function(e){this.logger.log(2,function(){return"pacData = "+pt(e)});var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<ke;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var o=n.rows[i].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(var u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(n.rows[i+u])}}this.currRow=t;var d=this.rows[this.currRow];if(e.indent!==null){var h=e.indent,c=Math.max(h-1,0);d.setCursor(e.indent),e.color=d.chars[c].penState.foreground}var f={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(f)},a.setBkgData=function(e){this.logger.log(2,function(){return"bkgData = "+pt(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},a.setRollUpRows=function(e){this.nrRollUpRows=e},a.rollUp=function(){var e=this;if(this.nrRollUpRows!==null){this.logger.log(1,function(){return e.getDisplayText()});var t=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(t,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},a.getDisplayText=function(e){e=e||!1;for(var t=[],r="",i=-1,n=0;n<ke;n++){var o=this.rows[n].getTextString();o&&(i=n+1,e?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join(`
`)),r},a.getTextAndFormat=function(){return this.rows},s}(),Ms=function(){function s(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new zi(r),this.nonDisplayedMemory=new zi(r),this.lastOutputScreen=new zi(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var a=s.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(e){this.outputFilter=e},a.setPAC=function(e){this.writeScreen.setPAC(e)},a.setBkgData=function(e){this.writeScreen.setBkgData(e)},a.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(2,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},a.insertChars=function(e){for(var t=this,r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+t.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(1,function(){return"DISPLAYED: "+t.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},a.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){var e=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},a.ccTO=function(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},a.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+pt(t)),this.writeScreen.setPen(t)},a.outputDataUpdate=function(e){e===void 0&&(e=!1);var t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},s}(),Fs=function(){function s(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;var i=this.logger=new fu;this.channels=[null,new Ms(e,t,i),new Ms(e+1,r,i)]}var a=s.prototype;return a.getHandler=function(e){return this.channels[e].getHandler()},a.setHandler=function(e,t){this.channels[e].setHandler(t)},a.addData=function(e,t){var r=this;this.logger.time=e;for(var i=function(o){var l=127&t[o],u=127&t[o+1],d=!1,h=null;if(l===0&&u===0)return 0;r.logger.log(3,function(){return"["+be([t[o],t[o+1]])+"] -> ("+be([l,u])+")"});var c=r.cmdHistory;if(l>=16&&l<=31){if(function(g,v,m){return m.a===g&&m.b===v}(l,u,c))return Br(null,null,c),r.logger.log(3,function(){return"Repeated command ("+be([l,u])+") is dropped"}),0;Br(l,u,r.cmdHistory),(d=r.parseCmd(l,u))||(d=r.parseMidrow(l,u)),d||(d=r.parsePAC(l,u)),d||(d=r.parseBackgroundAttributes(l,u))}else Br(null,null,c);if(!d&&(h=r.parseChars(l,u))){var f=r.currentChannel;f&&f>0?r.channels[f].insertChars(h):r.logger.log(2,"No channel found yet. TEXT-MODE?")}d||h||r.logger.log(2,function(){return"Couldn't parse cleaned data "+be([l,u])+" orig: "+be([t[o],t[o+1]])})},n=0;n<t.length;n+=2)i(n)},a.parseCmd=function(e,t){if(!((e===20||e===28||e===21||e===29)&&t>=32&&t<=47||(e===23||e===31)&&t>=33&&t<=35))return!1;var r=e===20||e===21||e===23?1:2,i=this.channels[r];return e===20||e===21||e===28||e===29?t===32?i.ccRCL():t===33?i.ccBS():t===34?i.ccAOF():t===35?i.ccAON():t===36?i.ccDER():t===37?i.ccRU(2):t===38?i.ccRU(3):t===39?i.ccRU(4):t===40?i.ccFON():t===41?i.ccRDC():t===42?i.ccTR():t===43?i.ccRTD():t===44?i.ccEDM():t===45?i.ccCR():t===46?i.ccENM():t===47&&i.ccEOC():i.ccTO(t-32),this.currentChannel=r,!0},a.parseMidrow=function(e,t){var r=0;if((e===17||e===25)&&t>=32&&t<=47){if((r=e===17?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(t),this.logger.log(3,function(){return"MIDROW ("+be([e,t])+")"}),!0)}return!1},a.parsePAC=function(e,t){var r;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(e===16||e===24)&&t>=64&&t<=95))return!1;var i=e<=23?1:2;r=t>=64&&t<=95?i===1?ou[e]:uu[e]:i===1?lu[e]:du[e];var n=this.channels[i];return!!n&&(n.setPAC(this.interpretPAC(r,t)),this.currentChannel=i,!0)},a.interpretPAC=function(e,t){var r,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=(1&r)==1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},a.parseChars=function(e,t){var r,i,n=null,o=null;return e>=25?(r=2,o=e-8):(r=1,o=e),o>=17&&o<=19?(i=o===17?t+80:o===18?t+112:t+144,this.logger.log(2,function(){return"Special char '"+xs(i)+"' in channel "+r}),n=[i]):e>=32&&e<=127&&(n=t===0?[e]:[e,t]),n&&this.logger.log(3,function(){return"Char codes =  "+be(n).join(",")}),n},a.parseBackgroundAttributes=function(e,t){var r;if(!((e===16||e===24)&&t>=32&&t<=47||(e===23||e===31)&&t>=45&&t<=47))return!1;var i={};e===16||e===24?(r=Math.floor((t-32)/2),i.background=hu[r],t%2==1&&(i.background=i.background+"_semi")):t===45?i.background="transparent":(i.foreground="black",t===47&&(i.underline=!0));var n=e<=23?1:2;return this.channels[n].setBkgData(i),!0},a.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}Br(null,null,this.cmdHistory)},a.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var r=this.channels[t];r&&r.cueSplitAtTime(e)}},s}();function Br(s,a,e){e.a=s,e.b=a}var Qi=function(){if(Ar!=null&&Ar.VTTCue)return self.VTTCue;var s=["","lr","rl"],a=["start","middle","end","left","right"];function e(n,o){if(typeof o!="string"||!Array.isArray(n))return!1;var l=o.toLowerCase();return!!~n.indexOf(l)&&l}function t(n){return e(a,n)}function r(n){for(var o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];for(var d=1;d<arguments.length;d++){var h=arguments[d];for(var c in h)n[c]=h[c]}return n}function i(n,o,l){var u=this,d={enumerable:!0};u.hasBeenReset=!1;var h="",c=!1,f=n,g=o,v=l,m=null,y="",E=!0,T="auto",S="start",I=50,L="middle",A=50,b="middle";Object.defineProperty(u,"id",r({},d,{get:function(){return h},set:function(R){h=""+R}})),Object.defineProperty(u,"pauseOnExit",r({},d,{get:function(){return c},set:function(R){c=!!R}})),Object.defineProperty(u,"startTime",r({},d,{get:function(){return f},set:function(R){if(typeof R!="number")throw new TypeError("Start time must be set to a number.");f=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",r({},d,{get:function(){return g},set:function(R){if(typeof R!="number")throw new TypeError("End time must be set to a number.");g=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",r({},d,{get:function(){return v},set:function(R){v=""+R,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",r({},d,{get:function(){return m},set:function(R){m=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",r({},d,{get:function(){return y},set:function(R){var k=function(_){return e(s,_)}(R);if(k===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",r({},d,{get:function(){return E},set:function(R){E=!!R,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",r({},d,{get:function(){return T},set:function(R){if(typeof R!="number"&&R!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",r({},d,{get:function(){return S},set:function(R){var k=t(R);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");S=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",r({},d,{get:function(){return I},set:function(R){if(R<0||R>100)throw new Error("Position must be between 0 and 100.");I=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",r({},d,{get:function(){return L},set:function(R){var k=t(R);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");L=k,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",r({},d,{get:function(){return A},set:function(R){if(R<0||R>100)throw new Error("Size must be between 0 and 100.");A=R,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",r({},d,{get:function(){return b},set:function(R){var k=t(R);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");b=k,this.hasBeenReset=!0}})),u.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}(),vu=function(){function s(){}return s.prototype.decode=function(a,e){if(!a)return"";if(typeof a!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))},s}();function Ns(s){function a(t,r,i,n){return 3600*(0|t)+60*(0|r)+(0|i)+parseFloat(n||0)}var e=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?a(e[2],e[3],0,e[4]):a(e[1],e[2],e[3],e[4]):null}var mu=function(){function s(){this.values=Object.create(null)}var a=s.prototype;return a.set=function(e,t){this.get(e)||t===""||(this.values[e]=t)},a.get=function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},a.has=function(e){return e in this.values},a.alt=function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},a.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},a.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1},s}();function Us(s,a,e,t){var r=t?s.split(t):[s];for(var i in r)if(typeof r[i]=="string"){var n=r[i].split(e);n.length===2&&a(n[0],n[1])}}var $i=new Qi(0,0,""),Gr=$i.align==="middle"?"middle":"center";function pu(s,a,e){var t=s;function r(){var n=Ns(s);if(n===null)throw new Error("Malformed timestamp: "+t);return s=s.replace(/^[^\sa-zA-Z-]+/,""),n}function i(){s=s.replace(/^\s+/,"")}if(i(),a.startTime=r(),i(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);s=s.slice(3),i(),a.endTime=r(),i(),function(n,o){var l=new mu;Us(n,function(h,c){var f;switch(h){case"region":for(var g=e.length-1;g>=0;g--)if(e[g].id===c){l.set(h,e[g].region);break}break;case"vertical":l.alt(h,c,["rl","lr"]);break;case"line":f=c.split(","),l.integer(h,f[0]),l.percent(h,f[0])&&l.set("snapToLines",!1),l.alt(h,f[0],["auto"]),f.length===2&&l.alt("lineAlign",f[1],["start",Gr,"end"]);break;case"position":f=c.split(","),l.percent(h,f[0]),f.length===2&&l.alt("positionAlign",f[1],["start",Gr,"end","line-left","line-right","auto"]);break;case"size":l.percent(h,c);break;case"align":l.alt(h,c,["start",Gr,"end","left","right"])}},/:/,/\s/),o.region=l.get("region",null),o.vertical=l.get("vertical","");var u=l.get("line","auto");u==="auto"&&$i.line===-1&&(u=-1),o.line=u,o.lineAlign=l.get("lineAlign","start"),o.snapToLines=l.get("snapToLines",!0),o.size=l.get("size",100),o.align=l.get("align",Gr);var d=l.get("position","auto");d==="auto"&&$i.position===50&&(d=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=d}(s,a)}function Bs(s){return s.replace(/<br(?: \/)?>/gi,`
`)}var yu=function(){function s(){this.state="INITIAL",this.buffer="",this.decoder=new vu,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var a=s.prototype;return a.parse=function(e){var t=this;function r(){var u=t.buffer,d=0;for(u=Bs(u);d<u.length&&u[d]!=="\r"&&u[d]!==`
`;)++d;var h=u.slice(0,d);return u[d]==="\r"&&++d,u[d]===`
`&&++d,t.buffer=u.slice(d),h}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var n=(i=r()).match(/^()?WEBVTT([ \t].*)?$/);if(n==null||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:i=r(),t.state){case"HEADER":/:/.test(i)?Us(i,function(u,d){},/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new Qi(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{pu(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var l=i.indexOf("-->")!==-1;if(!i||l&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},a.flush=function(){var e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this},s}(),Eu=/\r\n|\n\r|\n|\r/g,Ji=function(s,a,e){return e===void 0&&(e=0),s.slice(e,e+a.length)===a};function Zi(s,a,e){return or(s.toString())+or(a.toString())+or(e)}function Tu(s,a,e,t,r,i,n){var o,l,u,d=new yu,h=Gt(new Uint8Array(s)).trim().replace(Eu,`
`).split(`
`),c=[],f=a?(o=a.baseTime,(l=a.timescale)===void 0&&(l=1),xi(o,ss,1/l)):0,g="00:00.000",v=0,m=0,y=!0;d.oncue=function(E){var T=e[t],S=e.ccOffset,I=(v-f)/9e4;if(T!=null&&T.new&&(m!==void 0?S=e.ccOffset=T.start:function(R,k,_){var C=R[k],x=R[C.prevCC];if(!x||!x.new&&C.new)return R.ccOffset=R.presentationOffset=C.start,void(C.new=!1);for(;(w=x)!=null&&w.new;){var w;R.ccOffset+=C.start-x.start,C.new=!1,x=R[(C=x).prevCC]}R.presentationOffset=_}(e,t,I)),I){if(!a)return void(u=new Error("Missing initPTS for VTT MPEGTS"));S=I-e.presentationOffset}var L=E.endTime-E.startTime,A=Yt(9e4*(E.startTime+S-m),9e4*r)/9e4;E.startTime=Math.max(A,0),E.endTime=Math.max(A+L,0);var b=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(b)),E.id||(E.id=Zi(E.startTime,E.endTime,b)),E.endTime>0&&c.push(E)},d.onparsingerror=function(E){u=E},d.onflush=function(){u?n(u):i(c)},h.forEach(function(E){if(y){if(Ji(E,"X-TIMESTAMP-MAP=")){y=!1,E.slice(16).split(",").forEach(function(T){Ji(T,"LOCAL:")?g=T.slice(6):Ji(T,"MPEGTS:")&&(v=parseInt(T.slice(7)))});try{m=function(T){var S=parseInt(T.slice(-3)),I=parseInt(T.slice(-6,-4)),L=parseInt(T.slice(-9,-7)),A=T.length>9?parseInt(T.substring(0,T.indexOf(":"))):0;if(!(B(S)&&B(I)&&B(L)&&B(A)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+T);return S+=1e3*I,(S+=6e4*L)+36e5*A}(g)/1e3}catch(T){u=T}return}E===""&&(y=!1)}d.parse(E+`
`)}),d.flush()}var tn="stpp.ttml.im1t",Gs=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ks=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Su={left:"start",center:"center",right:"end",start:"start",end:"end"};function Hs(s,a,e,t){var r=W(new Uint8Array(s),["mdat"]);if(r.length!==0){var i,n,o,l,u=r.map(function(h){return Gt(h)}),d=(i=a.baseTime,n=1,(o=a.timescale)===void 0&&(o=1),l===void 0&&(l=!1),xi(i,n,1/o,l));try{u.forEach(function(h){return e(function(c,f){var g=new DOMParser().parseFromString(c,"text/xml"),v=g.getElementsByTagName("tt")[0];if(!v)throw new Error("Invalid ttml");var m={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},y=Object.keys(m).reduce(function(L,A){return L[A]=v.getAttribute("ttp:"+A)||m[A],L},{}),E=v.getAttribute("xml:space")!=="preserve",T=Vs(en(v,"styling","style")),S=Vs(en(v,"layout","region")),I=en(v,"body","[begin]");return[].map.call(I,function(L){var A=Ys(L,E);if(!A||!L.hasAttribute("begin"))return null;var b=nn(L.getAttribute("begin"),y),R=nn(L.getAttribute("dur"),y),k=nn(L.getAttribute("end"),y);if(b===null)throw Ws(L);if(k===null){if(R===null)throw Ws(L);k=b+R}var _=new Qi(b-f,k-f,A);_.id=Zi(_.startTime,_.endTime,_.text);var C=function(P,M,F){var U="http://www.w3.org/ns/ttml#styling",G=null,N=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],H=P!=null&&P.hasAttribute("style")?P.getAttribute("style"):null;return H&&F.hasOwnProperty(H)&&(G=F[H]),N.reduce(function(j,et){var X=rn(M,U,et)||rn(P,U,et)||rn(G,U,et);return X&&(j[et]=X),j},{})}(S[L.getAttribute("region")],T[L.getAttribute("style")],T),x=C.textAlign;if(x){var w=Su[x];w&&(_.lineAlign=w),_.align=x}return ot(_,C),_}).filter(function(L){return L!==null})}(h,d))})}catch(h){t(h)}}else t(new Error("Could not parse IMSC1 mdat"))}function en(s,a,e){var t=s.getElementsByTagName(a)[0];return t?[].slice.call(t.querySelectorAll(e)):[]}function Vs(s){return s.reduce(function(a,e){var t=e.getAttribute("xml:id");return t&&(a[t]=e),a},{})}function Ys(s,a){return[].slice.call(s.childNodes).reduce(function(e,t,r){var i;return t.nodeName==="br"&&r?e+`
`:(i=t.childNodes)!=null&&i.length?Ys(t,a):a?e+t.textContent.trim().replace(/\s+/g," "):e+t.textContent},"")}function rn(s,a,e){return s&&s.hasAttributeNS(a,e)?s.getAttributeNS(a,e):null}function Ws(s){return new Error("Could not parse ttml timestamp "+s)}function nn(s,a){if(!s)return null;var e=Ns(s);return e===null&&(Gs.test(s)?e=function(t,r){var i=Gs.exec(t),n=(0|i[4])+(0|i[5])/r.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+n/r.frameRate}(s,a):Ks.test(s)&&(e=function(t,r){var i=Ks.exec(t),n=Number(i[1]);switch(i[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/r.frameRate;case"t":return n/r.tickRate}return n}(s,a))),e}var Kr=function(){function s(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var a=s.prototype;return a.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},a.newCue=function(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},a.reset=function(){this.cueRanges=[],this.startTime=null},s}(),Lu=function(){function s(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(p.FRAG_LOADING,this.onFragLoading,this),e.on(p.FRAG_LOADED,this.onFragLoaded,this),e.on(p.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(p.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(p.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(p.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=s.prototype;return a.destroy=function(){var e=this.hls;e.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(p.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(p.FRAG_LOADING,this.onFragLoading,this),e.off(p.FRAG_LOADED,this.onFragLoaded,this),e.off(p.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(p.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(p.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(p.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0},a.initCea608Parsers=function(){var e=new Kr(this,"textTrack1"),t=new Kr(this,"textTrack2"),r=new Kr(this,"textTrack3"),i=new Kr(this,"textTrack4");this.cea608Parser1=new Fs(1,e,t),this.cea608Parser2=new Fs(3,r,i)},a.addCues=function(e,t,r,i,n){for(var o,l,u,d,h=!1,c=n.length;c--;){var f=n[c],g=(o=f[0],l=f[1],u=t,d=r,Math.min(l,d)-Math.max(o,u));if(g>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],r),h=!0,g/(r-t)>.5))return}if(h||n.push([t,r]),this.config.renderTextTracksNatively){var v=this.captionsTracks[e];this.Cues.newCue(v,t,r,i)}else{var m=this.Cues.newCue(null,t,r,i);this.hls.trigger(p.CUES_PARSED,{type:"captions",cues:m,track:e})}},a.onInitPtsFound=function(e,t){var r=this,i=t.frag,n=t.id,o=t.initPTS,l=t.timescale,u=this.unparsedVttFrags;n===J&&(this.initPTS[i.cc]={baseTime:o,timescale:l}),u.length&&(this.unparsedVttFrags=[],u.forEach(function(d){r.onFragLoaded(p.FRAG_LOADED,d)}))},a.getExistingTrack=function(e,t){var r=this.media;if(r)for(var i=0;i<r.textTracks.length;i++){var n=r.textTracks[i];if(qs(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null},a.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},a.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,r=this.captionsTracks,i=this.media,n=t[e],o=n.label,l=n.languageCode,u=this.getExistingTrack(o,l);if(u)r[e]=u,Ke(r[e]),Cs(r[e],i);else{var d=this.createTextTrack("captions",o,l);d&&(d[e]=!0,r[e]=d)}}},a.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(p.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},a.createTextTrack=function(e,t,r){var i=this.media;if(i)return i.addTextTrack(e,t,r)},a.onMediaAttaching=function(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()},a.onMediaDetaching=function(e,t){var r=!!t.transferMedia;if(this.media=null,!r){var i=this.captionsTracks;Object.keys(i).forEach(function(n){Ke(i[n]),delete i[n]}),this.nonNativeCaptionsTracks={}}},a.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)Ke(t[r])}},a.onSubtitleTracksUpdated=function(e,t){var r=this,i=t.subtitleTracks||[],n=i.some(function(h){return h.textCodec===tn});if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(vs(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var o=this.media,l=o?Ur(o.textTracks):null;if(this.tracks.forEach(function(h,c){var f;if(l){for(var g=null,v=0;v<l.length;v++)if(l[v]&&qs(l[v],h)){g=l[v],l[v]=null;break}g&&(f=g)}if(f)Ke(f);else{var m=js(h);(f=r.createTextTrack(m,h.name,h.lang))&&(f.mode="disabled")}f&&r.textTracks.push(f)}),l!=null&&l.length){var u=l.filter(function(h){return h!==null}).map(function(h){return h.label});u.length&&this.hls.logger.warn("Media element contains unused subtitle tracks: "+u.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var d=this.tracks.map(function(h){return{label:h.name,kind:h.type.toLowerCase(),default:h.default,subtitleTrack:h}});this.hls.trigger(p.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:d})}}},a.onManifestLoaded=function(e,t){var r=this;this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(function(i){var n=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(n){var o="textTrack"+n[1],l=r.captionsProperties[o];l&&(l.label=i.name,i.lang&&(l.languageCode=i.lang),l.media=i)}})},a.closedCaptionsForLevel=function(e){var t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]},a.onFragLoading=function(e,t){if(this.enabled&&t.frag.type===J){var r,i,n=this.cea608Parser1,o=this.cea608Parser2,l=this.lastSn,u=t.frag,d=u.cc,h=u.sn,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;n&&o&&(h!==l+1||h===l&&c!==this.lastPartIndex+1||d!==this.lastCc)&&(n.reset(),o.reset()),this.lastCc=d,this.lastSn=h,this.lastPartIndex=c}},a.onFragLoaded=function(e,t){var r=t.frag,i=t.payload;if(r.type===Qt)if(i.byteLength){var n=r.decryptdata,o="stats"in t;if(n==null||!n.encrypted||o){var l=this.tracks[r.level],u=this.vttCCs;u[r.cc]||(u[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),l&&l.textCodec===tn?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(e,t){var r=this,i=this.hls;Hs(t,this.initPTS[e.cc],function(n){r._appendCues(n,e.level),i.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(n){i.logger.log("Failed to parse IMSC1: "+n),i.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})},a._parseVTTs=function(e){var t,r=this,i=e.frag,n=e.payload,o=this.initPTS,l=this.unparsedVttFrags,u=o.length-1;if(o[i.cc]||u!==-1){var d=this.hls;Tu((t=i.initSegment)!=null&&t.data?Vt(i.initSegment.data,new Uint8Array(n)).buffer:n,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,function(h){r._appendCues(h,i.level),d.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(h){var c=h.message==="Missing initPTS for VTT MPEGTS";c?l.push(e):r._fallbackToIMSC1(i,n),d.logger.log("Failed to parse VTT cue: "+h),c&&u>i.cc||d.trigger(p.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:h})})}else l.push(e)},a._fallbackToIMSC1=function(e,t){var r=this,i=this.tracks[e.level];i.textCodec||Hs(t,this.initPTS[e.cc],function(){i.textCodec=tn,r._parseIMSC1(e,t)},function(){i.textCodec="wvtt"})},a._appendCues=function(e,t){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(function(l){return ws(i,l)})}else{var n=this.tracks[t];if(!n)return;var o=n.default?"default":"subtitles"+t;r.trigger(p.CUES_PARSED,{type:"subtitles",cues:e,track:o})}},a.onFragDecrypted=function(e,t){t.frag.type===Qt&&this.onFragLoaded(p.FRAG_LOADED,t)},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(e,t){if(this.enabled&&this.config.enableCEA708Captions){var r=t.frag,i=t.samples;if(r.type!==J||this.closedCaptionsForLevel(r)!=="NONE")for(var n=0;n<i.length;n++){var o=i[n].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();var l=this.extractCea608Data(o);this.cea608Parser1.addData(i[n].pts,l[0]),this.cea608Parser2.addData(i[n].pts,l[1])}}}},a.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,n=t.endOffsetSubtitles,o=t.type,l=this.media;if(l&&!(l.currentTime<i)){if(!o||o==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(h){return Xi(u[h],r,i)})}if(this.config.renderTextTracksNatively&&r===0&&n!==void 0){var d=this.textTracks;Object.keys(d).forEach(function(h){return Xi(d[h],r,n)})}}},a.extractCea608Data=function(e){for(var t=[[],[]],r=31&e[0],i=2,n=0;n<r;n++){var o=e[i++],l=127&e[i++],u=127&e[i++];if((l!==0||u!==0)&&(4&o)!=0){var d=3&o;d!==0&&d!==1||(t[d].push(l),t[d].push(u))}}return t},s}();function js(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function qs(s,a){return!!s&&s.kind===js(a)&&Gi(a,s)}var Au=/\s/,Ru={newCue:function(s,a,e,t){for(var r,i,n,o,l,u=[],d=self.VTTCue||self.TextTrackCue,h=0;h<t.rows.length;h++)if(n=!0,o=0,l="",!(r=t.rows[h]).isEmpty()){for(var c,f=0;f<r.chars.length;f++)Au.test(r.chars[f].uchar)&&n?o++:(l+=r.chars[f].uchar,n=!1);r.cueStartTime=a,a===e&&(e+=1e-4),o>=16?o--:o++;var g=Bs(l.trim()),v=Zi(a,e,g);s!=null&&(c=s.cues)!=null&&c.getCueById(v)||((i=new d(a,e,g)).id=v,i.line=h+1,i.align="left",i.position=10+Math.min(80,10*Math.floor(8*o/32)),u.push(i))}return s&&u.length&&(u.sort(function(m,y){return m.line==="auto"||y.line==="auto"?0:m.line>8&&y.line>8?y.line-m.line:m.line-y.line}),u.forEach(function(m){return ws(s,m)})),u}},Iu=/(\d+)-(\d+)\/(\d+)/,Xs=function(){function s(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||ku,this.controller=new self.AbortController,this.stats=new zr}var a=s.prototype;return a.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},a.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},a.load=function(e,t,r){var i=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var o=function(f,g){var v={method:"GET",mode:"cors",credentials:"same-origin",signal:g,headers:new self.Headers(ot({},f.headers))};return f.rangeEnd&&v.headers.set("Range","bytes="+f.rangeStart+"-"+String(f.rangeEnd-1)),v}(e,this.controller.signal),l=e.responseType==="arraybuffer",u=l?"byteLength":"length",d=t.loadPolicy,h=d.maxTimeToFirstByteMs,c=d.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=h&&B(h)?h:c,this.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(n,e,i.response))},t.timeout),(Ie(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(function(f){var g;i.response=i.loader=f;var v=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=c,i.requestTimeout=self.setTimeout(function(){i.callbacks&&(i.abortInternal(),i.callbacks.onTimeout(n,e,i.response))},c-(v-n.loading.start)),!f.ok){var m=f.status,y=f.statusText;throw new bu(y||"fetch, bad network response",m,f)}n.loading.first=v,n.total=function(T){var S=T.get("Content-Range");if(S){var I=function(A){var b=Iu.exec(A);if(b)return parseInt(b[2])-parseInt(b[1])+1}(S);if(B(I))return I}var L=T.get("Content-Length");if(L)return parseInt(L)}(f.headers)||n.total;var E=(g=i.callbacks)==null?void 0:g.onProgress;return E&&B(t.highWaterMark)?i.loadProgressively(f,n,e,t.highWaterMark,E):l?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(function(f){var g,v,m=i.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(i.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);var y=f[u];y&&(n.loaded=n.total=y);var E={url:m.url,data:f,code:m.status},T=(g=i.callbacks)==null?void 0:g.onProgress;T&&!B(t.highWaterMark)&&T(n,e,f,m),(v=i.callbacks)==null||v.onSuccess(E,n,e,m)}).catch(function(f){var g;if(self.clearTimeout(i.requestTimeout),!n.aborted){var v=f&&f.code||0,m=f?f.message:null;(g=i.callbacks)==null||g.onError({code:v,text:m},e,f?f.details:null,n)}})},a.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},a.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},a.loadProgressively=function(e,t,r,i,n){i===void 0&&(i=0);var o=new Ga,l=e.body.getReader(),u=function(){return l.read().then(function(d){if(d.done)return o.dataLength&&n(t,r,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));var h=d.value,c=h.length;return t.loaded+=c,c<i||o.dataLength?(o.push(h),o.dataLength>=i&&n(t,r,o.flush().buffer,e)):n(t,r,h.buffer,e),u()}).catch(function(){return Promise.reject()})};return u()},s}();function ku(s,a){return new self.Request(s.url,a)}var bu=function(s){function a(e,t,r){var i;return(i=s.call(this,e)||this).code=void 0,i.details=void 0,i.code=t,i.details=r,i}return ut(a,s),a}(_e(Error)),Du=/^age:\s*[\d.]+\s*$/im,zs=function(){function s(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new zr,this.retryDelay=0}var a=s.prototype;return a.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},a.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},a.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()},a.loadInternal=function(){var e=this,t=this.config,r=this.context;if(t&&r){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;var o=this.xhrSetup;o?Promise.resolve().then(function(){if(e.loader===i&&!e.stats.aborted)return o(i,r.url)}).catch(function(l){if(e.loader===i&&!e.stats.aborted)return i.open("GET",r.url,!0),o(i,r.url)}).then(function(){e.loader!==i||e.stats.aborted||e.openAndSendXhr(i,r,t)}).catch(function(l){var u;(u=e.callbacks)==null||u.onError({code:i.status,text:l.message},r,i,n)}):this.openAndSendXhr(i,r,t)}},a.openAndSendXhr=function(e,t,r){e.readyState||e.open("GET",t.url,!0);var i=t.headers,n=r.loadPolicy,o=n.maxTimeToFirstByteMs,l=n.maxLoadTimeMs;if(i)for(var u in i)e.setRequestHeader(u,i[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=o&&B(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()},a.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,n=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var o=t.status,l=t.responseType==="text"?t.responseText:null;if(o>=200&&o<300){var u=l??t.response;if(u!=null){var d,h;r.loading.end=Math.max(self.performance.now(),r.loading.first);var c=t.responseType==="arraybuffer"?u.byteLength:u.length;r.loaded=r.total=c,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first);var f=(d=this.callbacks)==null?void 0:d.onProgress;f&&f(r,e,u,t);var g={url:t.responseURL,data:u,code:o};return void((h=this.callbacks)==null||h.onSuccess(g,r,e,t))}}var v,m=n.loadPolicy.errorRetry;Er(m,r.retry,!1,{url:e.url,data:void 0,code:o})?this.retry(m):(Z.error(o+" while loading "+e.url),(v=this.callbacks)==null||v.onError({code:o,text:t.statusText},e,t,r))}}},a.loadtimeout=function(){if(this.config){var e=this.config.loadPolicy.timeoutRetry;if(Er(e,this.stats.retry,!0))this.retry(e);else{var t;Z.warn("timeout while loading "+((t=this.context)==null?void 0:t.url));var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}},a.retry=function(e){var t=this.context,r=this.stats;this.retryDelay=ai(e,r.retry),r.retry++,Z.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+(t==null?void 0:t.url)+", retrying "+r.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},a.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},a.getCacheAge=function(){var e=null;if(this.loader&&Du.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},a.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},s}(),_u=at(at({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:zs,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Do,bufferController:kl,capLevelController:bl,errorController:Co,fpsController:Ql,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ma,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Ru,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:iu,subtitleTrackController:au,timelineController:Lu,audioStreamController:Ll,audioTrackController:Al,emeController:Ds,cmcdController:Xl,contentSteeringController:zl,interstitialsController:ru});function an(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(an):Object.keys(s).reduce(function(a,e){return a[e]=an(s[e]),a},{}):s}function Pu(s,a){var e=s.loader;e!==Xs&&e!==zs?(a.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(s.loader=Xs,s.progressive=!0,s.enableSoftwareAES=!0,a.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Cu=function(s){function a(t,r){var i;return(i=s.call(this,"gap-controller",t.logger)||this).hls=null,i.fragmentTracker=null,i.media=null,i.mediaSource=void 0,i.nudgeRetry=0,i.stallReported=!1,i.stalled=null,i.moved=!1,i.seeking=!1,i.buffered={},i.lastCurrentTime=0,i.ended=0,i.waiting=0,i.onMediaPlaying=function(){i.ended=0,i.waiting=0},i.onMediaWaiting=function(){var n;(n=i.media)!=null&&n.seeking||(i.waiting=self.performance.now(),i.tick())},i.onMediaEnded=function(){var n;i.hls&&(i.ended=((n=i.media)==null?void 0:n.currentTime)||1,i.hls.trigger(p.MEDIA_ENDED,{stalled:!1}))},i.hls=t,i.fragmentTracker=r,i.registerListeners(),i}ut(a,s);var e=a.prototype;return e.registerListeners=function(){var t=this.hls;t&&(t.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(p.BUFFER_APPENDED,this.onBufferAppended,this))},e.unregisterListeners=function(){var t=this.hls;t&&(t.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(p.BUFFER_APPENDED,this.onBufferAppended,this))},e.destroy=function(){s.prototype.destroy.call(this),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0},e.onMediaAttached=function(t,r){this.setInterval(100),this.mediaSource=r.mediaSource;var i=this.media=r.media;fe(i,"playing",this.onMediaPlaying),fe(i,"waiting",this.onMediaWaiting),fe(i,"ended",this.onMediaEnded)},e.onMediaDetaching=function(t,r){this.clearInterval();var i=this.media;i&&(ne(i,"playing",this.onMediaPlaying),ne(i,"waiting",this.onMediaWaiting),ne(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0},e.onBufferAppended=function(t,r){this.buffered=r.timeRanges},e.tick=function(){var t;if((t=this.media)!=null&&t.readyState&&this.hasBuffered){var r=this.media.currentTime;this.poll(r,this.lastCurrentTime),this.lastCurrentTime=r}},e.poll=function(t,r){var i,n,o=(i=this.hls)==null?void 0:i.config;if(o){var l=this.media,u=this.stalled;if(l){var d=l.seeking,h=this.seeking&&!d,c=!this.seeking&&d,f=l.paused&&!d||l.ended||l.playbackRate===0;if(this.seeking=d,t!==r)return r&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,o.nudgeOnVideoHole&&!f&&t>r&&this.nudgeOnVideoHole(t,r)),void(this.waiting===0&&this.stallResolved(t));if(c||h)h&&this.stallResolved(t);else{if(f)return this.nudgeRetry=0,this.stallResolved(t),void(!this.ended&&l.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(p.MEDIA_ENDED,{stalled:!1})));if(tt.getBuffered(l).length){var g=tt.bufferInfo(l,t,0),v=g.nextStart||0,m=this.fragmentTracker;if(d&&m&&this.hls){var y=Qs(this.hls.inFlightFragments,t),E=g.len>2,T=!v||y||v-t>2&&!m.getPartialFragment(t);if(E||T)return;this.moved=!1}var S=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&m){if(!(g.len>0||v))return;var I=Math.max(v,g.start||0)-t,L=S!=null&&S.live?2*S.targetduration:2,A=m.getPartialFragment(t);if(I>0&&(I<=L||A))return void(l.paused||this._trySkipBufferHole(A))}var b=o.detectStallWithCurrentTimeMs,R=self.performance.now(),k=this.waiting;if(u!==null){var _=R-u;if(!d&&(_>=b||k)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&(S==null||!S.live)&&Math.abs(t-((S==null?void 0:S.edge)||0))<1)return this.ended?void 0:(this.ended=t||1,void this.hls.trigger(p.MEDIA_ENDED,{stalled:!0}));if(this._reportStall(g),!this.media||!this.hls)return}var x=tt.bufferInfo(l,t,o.maxBufferHole);this._tryFixBufferStall(x,_)}else this.stalled=k>0&&R-k<b?k:R}else this.nudgeRetry=0}}}},e.stallResolved=function(t){var r=this.stalled;if(r&&this.hls&&(this.stalled=null,this.stallReported)){var i=self.performance.now()-r;this.log("playback not stuck anymore @"+t+", after "+Math.round(i)+"ms"),this.stallReported=!1,this.waiting=0,this.hls.trigger(p.STALL_RESOLVED,{})}},e.nudgeOnVideoHole=function(t,r){var i,n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&n&&n.length>1&&t>n.end(0)){var o=tt.bufferedInfo(tt.timeRangesToArray(this.buffered.audio),t,0);if(o.len>1&&r>=o.start){var l=tt.timeRangesToArray(n),u=tt.bufferedInfo(l,r,0).bufferedIndex;if(u>-1&&u<l.length-1){var d=tt.bufferedInfo(l,t,0).bufferedIndex,h=l[u].end,c=l[u+1].start;if((d===-1||d>u)&&c-h<1&&t-h<2){var f=new Error("nudging playhead to flush pipeline after video hole. currentTime: "+t+" hole: "+h+" -> "+c+" buffered index: "+d);this.warn(f.message),this.media.currentTime+=1e-6;var g=this.fragmentTracker.getPartialFragment(t)||void 0,v=tt.bufferInfo(this.media,t,0);this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:g,buffer:v.len,bufferInfo:v})}}}}},e._tryFixBufferStall=function(t,r){var i,n,o=this.fragmentTracker,l=this.media,u=(i=this.hls)==null?void 0:i.config;if(l&&o&&u){var d=l.currentTime,h=(n=this.hls)==null?void 0:n.latestLevelDetails,c=o.getPartialFragment(d);if((c||h!=null&&h.live&&d<h.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;var f=t.buffered;(f&&f.length>1&&t.len>u.maxBufferHole||t.nextStart&&t.nextStart-d<u.maxBufferHole)&&(r>1e3*u.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}},e._reportStall=function(t){var r=this.hls,i=this.media,n=this.stallReported,o=this.stalled;if(!n&&o!==null&&i&&r){this.stallReported=!0;var l=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+pt(t)+")");this.warn(l.message),r.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:t.len,bufferInfo:t,stalled:{start:o}})}},e._trySkipBufferHole=function(t){var r,i=this.fragmentTracker,n=this.media,o=(r=this.hls)==null?void 0:r.config;if(!n||!i||!o)return 0;var l=n.currentTime,u=tt.bufferInfo(n,l,0),d=l<u.start?u.start:u.nextStart;if(d&&this.hls){var h=u.len<=o.maxBufferHole,c=u.len>0&&u.len<1&&n.readyState<3,f=d-l;if(f>0&&(h||c)){if(f>o.maxBufferHole){var g=!1;if(l===0){var v=i.getAppendedFrag(0,J);v&&d<v.end&&(g=!0)}if(!g){var m=t||i.getAppendedFrag(l,J);if(m){var y;if((y=this.hls.loadLevelObj)==null||!y.details||Qs(this.hls.inFlightFragments,d))return 0;for(var E=!1,T=m.end;T<d;){var S=i.getPartialFragment(T);if(!S){E=!0;break}T+=S.duration}if(E)return 0}}}var I=Math.max(d+.05,l+.1);if(this.warn("skipping hole, adjusting currentTime from "+l+" to "+I),this.moved=!0,n.currentTime=I,t==null||!t.gap){var L=new Error("fragment loaded with buffer holes, seeking from "+l+" to "+I);this.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:L,reason:L.message,frag:t||void 0,buffer:u.len,bufferInfo:u})}return I}}return 0},e._tryNudgeBuffer=function(t){var r=this.hls,i=this.media,n=this.nudgeRetry,o=r==null?void 0:r.config;if(!i||!o)return 0;var l=i.currentTime;if(this.nudgeRetry++,n<o.nudgeMaxRetry){var u=l+(n+1)*o.nudgeOffset,d=new Error("Nudging 'currentTime' from "+l+" to "+u);this.warn(d.message),i.currentTime=u,r.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:t.len,bufferInfo:t})}else{var h=new Error("Playhead still not moving while enough data buffered @"+l+" after "+o.nudgeMaxRetry+" nudges");this.error(h.message),r.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.BUFFER_STALLED_ERROR,error:h,fatal:!0,buffer:t.len,bufferInfo:t})}},dt(a,[{key:"hasBuffered",get:function(){return Object.keys(this.buffered).length>0}}])}(la);function Qs(s,a){var e=$s(s.main);if(e&&e.start<=a)return e;var t=$s(s.audio);return t&&t.start<=a?t:null}function $s(s){if(!s)return null;switch(s.state){case O.IDLE:case O.STOPPED:case O.ENDED:case O.ERROR:return null}return s.frag}function sn(){if(typeof self<"u")return self.VTTCue||self.TextTrackCue}function Js(s,a,e,t,r){var i=new s(a,e,"");try{i.value=t,r&&(i.type=r)}catch{i=new s(a,e,pt(r?at({type:r},t):t))}return i}var Hr=function(){var s=sn();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}(),wu=function(){function s(e){var t=this;this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=function(){t.hls&&t.hls.trigger(p.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}var a=s.prototype;return a.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null},a._registerListeners=function(){var e=this.hls;e.on(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(p.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(p.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},a._unregisterListeners=function(){var e=this.hls;e.off(p.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(p.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(p.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)},a.onMediaAttaching=function(e,t){var r;this.media=t.media,((r=t.overrides)==null?void 0:r.cueRemoval)===!1&&(this.removeCues=!1)},a.onMediaAttached=function(){var e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)},a.onMediaDetaching=function(e,t){this.media=null,t.transferMedia||(this.id3Track&&(this.removeCues&&Ke(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})},a.onManifestLoading=function(){this.dateRangeCuesAppended={}},a.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},a.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if(r.kind==="metadata"&&r.label==="id3")return Cs(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},a.onFragParsingMetadata=function(e,t){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,n=r.enableID3MetadataCues;if(i||n){var o=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var l=sn();if(l)for(var u=0;u<o.length;u++){var d=o[u].type;if((d!==Kt.emsg||i)&&n){var h=Xa(o[u].data);if(h){var c=o[u].pts,f=c+o[u].duration;f>Hr&&(f=Hr),f-c<=0&&(f=c+.25);for(var g=0;g<h.length;g++){var v=h[g];if(!za(v)){this.updateId3CueEnds(c,d);var m=Js(l,c,f,v,d);m&&this.id3Track.addCue(m)}}}}}}}},a.updateId3CueEnds=function(e,t){var r,i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(var n=i.length;n--;){var o=i[n];o.type===t&&o.startTime<e&&o.endTime===Hr&&(o.endTime=e)}},a.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,n=t.type,o=this.id3Track,l=this.hls;if(l){var u=l.config,d=u.enableEmsgMetadataCues,h=u.enableID3MetadataCues;o&&(d||h)&&Xi(o,r,i,n==="audio"?function(c){return c.type===Kt.audioId3&&h}:n==="video"?function(c){return c.type===Kt.emsg&&d}:function(c){return c.type===Kt.audioId3&&h||c.type===Kt.emsg&&d})}},a.onLevelUpdated=function(e,t){var r=t.details;this.updateDateRangeCues(r,!0)},a.onLevelPtsUpdated=function(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)},a.updateDateRangeCues=function(e,t){var r=this;if(this.media&&e.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var i,n=this.id3Track,o=e.dateRanges,l=Object.keys(o),u=this.dateRangeCuesAppended;if(n&&t)if((i=n.cues)!=null&&i.length)for(var d=Object.keys(u).filter(function(y){return!l.includes(y)}),h=function(){var y=d[c],E=u[y].cues;delete u[y],Object.keys(E).forEach(function(T){try{var S=E[T];S.removeEventListener("enter",r.onEventCueEnter),n.removeCue(S)}catch{}})},c=d.length;c--;)h();else u=this.dateRangeCuesAppended={};var f=e.fragments[e.fragments.length-1];if(l.length!==0&&B(f==null?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=sn(),v=function(){var y=l[m],E=o[y],T=E.startTime,S=u[y],I=(S==null?void 0:S.cues)||{},L=(S==null?void 0:S.durationKnown)||!1,A=Hr,b=E.duration;if(E.endDate&&b!==null)A=T+b,L=!0;else if(E.endOnNext&&!L){var R=l.reduce(function(U,G){if(G!==E.id){var N=o[G];if(N.class===E.class&&N.startDate>E.startDate&&(!U||E.startDate<U.startDate))return N}return U},null);R&&(A=R.startTime,L=!0)}for(var k,_,C=Object.keys(E.attr),x=0;x<C.length;x++){var w=C[x];if((_=w)!=="ID"&&_!=="CLASS"&&_!=="CUE"&&_!=="START-DATE"&&_!=="DURATION"&&_!=="END-DATE"&&_!=="END-ON-NEXT"){var P=I[w];if(P)L&&!S.durationKnown?P.endTime=A:Math.abs(P.startTime-T)>.01&&(P.startTime=T,P.endTime=A);else if(g){var M=E.attr[w];Bo(w)&&(k=M,M=Uint8Array.from(k.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);var F=Js(g,T,A,{key:w,data:M},Kt.dateRange);F&&(F.id=y,r.id3Track.addCue(F),I[w]=F,r.hls.config.interstitialsController&&(w!=="X-ASSET-LIST"&&w!=="X-ASSET-URL"||F.addEventListener("enter",r.onEventCueEnter)))}}}u[y]={cues:I,dateRange:E,durationKnown:L}},m=0;m<l.length;m++)v()}}},s}(),xu=function(){function s(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=function(){var r=t.media,i=t.levelDetails;if(r&&i){t.currentTime=r.currentTime;var n=t.computeLatency();if(n!==null){t._latency=n;var o=t.config,l=o.lowLatencyMode,u=o.maxLiveSyncPlaybackRate;if(l&&u!==1&&i.live){var d=t.targetLatency;if(d!==null){var h=n-d;if(h<Math.min(t.maxLatency,d+i.targetduration)&&h>.05&&t.forwardBufferLength>1){var c=Math.min(2,Math.max(1,u)),f=Math.round(2/(1+Math.exp(-.75*h-t.edgeStalled))*20)/20,g=Math.min(c,Math.max(1,f));t.changeMediaPlaybackRate(r,g)}else r.playbackRate!==1&&r.playbackRate!==0&&t.changeMediaPlaybackRate(r,1)}}}}},this.hls=e,this.config=e.config,this.registerListeners()}var a=s.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null},a.registerListeners=function(){var e=this.hls;e&&(e.on(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(p.ERROR,this.onError,this))},a.unregisterListeners=function(){var e=this.hls;e&&(e.off(p.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(p.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(p.ERROR,this.onError,this))},a.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)},a.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)},a.onManifestLoading=function(){this._latency=null,this.stallCount=0},a.onLevelUpdated=function(e,t){var r=t.details;r.advanced&&this.onTimeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)},a.onError=function(e,t){var r;t.details===D.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(r=this.levelDetails)!=null&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))},a.changeMediaPlaybackRate=function(e,t){var r,i;e.playbackRate!==t&&((r=this.hls)==null||r.logger.debug("[latency-controller]: latency="+this.latency.toFixed(3)+", targetLatency="+((i=this.targetLatency)==null?void 0:i.toFixed(3))+", forwardBufferLength="+this.forwardBufferLength.toFixed(3)+": adjusting playback rate from "+e.playbackRate+" to "+t),e.playbackRate=t)},a.estimateLiveEdge=function(){var e=this.levelDetails;return e===null?null:e.edge+e.age},a.computeLatency=function(){var e=this.estimateLiveEdge();return e===null?null:e-this.currentTime},dt(s,[{key:"levelDetails",get:function(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}},{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;var t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(e===null||this.hls===null)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,n=this.config,o=n.liveSyncDuration,l=n.liveSyncDurationCount,u=n.lowLatencyMode,d=this.hls.userConfig,h=u&&r||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=o!==void 0?o:l*i);var c=i;return h+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)},set:function(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;var r=this.levelDetails;if(r===null)return null;var i=r.edge,n=e-t-this.edgeStalled,o=i-r.totalduration,l=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,n),l)}},{key:"drift",get:function(){var e=this.levelDetails;return e===null?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(e===null)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}}])}(),Ou=function(s){function a(t,r){var i;return(i=s.call(this,t,"level-controller")||this)._levels=[],i._firstLevel=-1,i._maxAutoLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}ut(a,s);var e=a.prototype;return e._registerListeners=function(){var t=this.hls;t.on(p.MANIFEST_LOADING,this.onManifestLoading,this),t.on(p.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(p.LEVEL_LOADED,this.onLevelLoaded,this),t.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(p.FRAG_BUFFERED,this.onFragBuffered,this),t.on(p.ERROR,this.onError,this)},e._unregisterListeners=function(){var t=this.hls;t.off(p.MANIFEST_LOADING,this.onManifestLoading,this),t.off(p.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(p.LEVEL_LOADED,this.onLevelLoaded,this),t.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(p.FRAG_BUFFERED,this.onFragBuffered,this),t.off(p.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s.prototype.destroy.call(this)},e.stopLoad=function(){this._levels.forEach(function(t){t.loadError=0,t.fragmentError=0}),s.prototype.stopLoad.call(this)},e.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},e.onManifestLoading=function(t,r){this.resetLevels()},e.onManifestLoaded=function(t,r){var i=this,n=this.hls.config.preferManagedMediaSource,o=[],l={},u={},d=!1,h=!1,c=!1;r.levels.forEach(function(f){var g,v=f.attrs,m=f.audioCodec,y=f.videoCodec;m&&(f.audioCodec=m=gr(m,n)||void 0),((g=y)==null?void 0:g.indexOf("avc1"))===0&&(y=f.videoCodec=function(U){for(var G=U.split(","),N=0;N<G.length;N++){var H=G[N].split(".");if(H.length>2){var j=H.shift()+".";j+=parseInt(H.shift()).toString(16),j+=("000"+parseInt(H.shift()).toString(16)).slice(-4),G[N]=j}}return G.join(",")}(y));var E=f.width,T=f.height,S=f.unknownCodecs,I=S?S.length:0;if(S)for(var L=I;L--;){var A=S[L];i.isAudioSupported(A)?(f.audioCodec=m=m?m+","+A:A,I--,Ce.audio[m.substring(0,4)]=2):i.isVideoSupported(A)&&(f.videoCodec=y=y?y+","+A:A,I--,Ce.video[y.substring(0,4)]=2)}if(d||(d=!(!E||!T)),h||(h=!!y),c||(c=!!m),I||m&&!i.isAudioSupported(m)||y&&!i.isVideoSupported(y))i.log('Some or all CODECS not supported "'+v.CODECS+'"');else{var b=v.CODECS,R=v["FRAME-RATE"],k=v["HDCP-LEVEL"],_=v["PATHWAY-ID"],C=v.RESOLUTION,x=v["VIDEO-RANGE"],w=(_||".")+"-"+f.bitrate+"-"+C+"-"+R+"-"+b+"-"+x+"-"+k;if(l[w])if(l[w].uri===f.url||f.attrs["PATHWAY-ID"])l[w].addGroupId("audio",v.AUDIO),l[w].addGroupId("text",v.SUBTITLES);else{var P=u[w]+=1;f.attrs["PATHWAY-ID"]=new Array(P+1).join(".");var M=i.createLevel(f);l[w]=M,o.push(M)}else{var F=i.createLevel(f);l[w]=F,u[w]=1,o.push(F)}}}),this.filterAndSortMediaOptions(o,r,d,h,c)},e.createLevel=function(t){var r=new qe(t),i=t.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){var n=new Error('SUPPLEMENTAL-CODECS not supported "'+i.videoCodec+'"');this.log(n.message),r.supportedResult=Kn(n,[])}return r},e.isAudioSupported=function(t){return ei(t,"audio",this.hls.config.preferManagedMediaSource)},e.isVideoSupported=function(t){return ei(t,"video",this.hls.config.preferManagedMediaSource)},e.filterAndSortMediaOptions=function(t,r,i,n,o){var l=this,u=[],d=[],h=t;if((i||n)&&o&&(h=h.filter(function(b){var R,k=b.videoCodec,_=b.videoRange,C=b.width,x=b.height;return(!!k||!(!C||!x))&&!!(R=_)&&mr.indexOf(R)>-1})),h.length!==0){r.audioTracks&&Zs(u=r.audioTracks.filter(function(b){return!b.audioCodec||l.isAudioSupported(b.audioCodec)})),r.subtitles&&Zs(d=r.subtitles);var c=h.slice(0);h.sort(function(b,R){if(b.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(b.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&b.height!==R.height)return b.height-R.height;if(b.frameRate!==R.frameRate)return b.frameRate-R.frameRate;if(b.videoRange!==R.videoRange)return mr.indexOf(b.videoRange)-mr.indexOf(R.videoRange);if(b.videoCodec!==R.videoCodec){var k=Nn(b.videoCodec),_=Nn(R.videoCodec);if(k!==_)return _-k}if(b.uri===R.uri&&b.codecSet!==R.codecSet){var C=cr(b.codecSet),x=cr(R.codecSet);if(C!==x)return x-C}return b.averageBitrate!==R.averageBitrate?b.averageBitrate-R.averageBitrate:0});var f=c[0];if(this.steering&&(h=this.steering.filterParsedLevels(h)).length!==c.length){for(var g=0;g<c.length;g++)if(c[g].pathwayId===h[0].pathwayId){f=c[g];break}}this._levels=h;for(var v=0;v<h.length;v++)if(h[v]===f){var m;this._firstLevel=v;var y=f.bitrate,E=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+y),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){var T=Math.min(y,this.hls.config.abrEwmaDefaultEstimateMax);T>E&&E===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}var S=o&&!n,I=this.hls.config,L=!(!I.audioStreamController||!I.audioTrackController),A={levels:h,audioTracks:u,subtitleTracks:d,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:o,video:n,altAudio:L&&!S&&u.some(function(b){return!!b.url})};this.hls.trigger(p.MANIFEST_PARSED,A)}else Promise.resolve().then(function(){if(l.hls){var b="no level with compatible codecs found in manifest",R=b;r.levels.length&&(R="one or more CODECS in variant not supported: "+pt(r.levels.map(function(_){return _.attrs.CODECS}).filter(function(_,C,x){return x.indexOf(_)===C})),l.warn(R),b+=" ("+R+")");var k=new Error(b);l.hls.trigger(p.ERROR,{type:K.MEDIA_ERROR,details:D.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:k,reason:R})}})},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===se&&r.context.level===this.level&&this.checkRetry(r)},e.onFragBuffered=function(t,r){var i=r.frag;if(i!==void 0&&i.type===J){var n=i.elementaryStreams;if(!Object.keys(n).some(function(l){return!!n[l]}))return;var o=this._levels[i.level];o!=null&&o.loadError&&(this.log("Resetting level error count of "+o.loadError+" on frag buffered"),o.loadError=0)}},e.onLevelLoaded=function(t,r){var i,n,o=r.level,l=r.details,u=r.levelInfo;if(!u)return this.warn("Invalid level index "+o),void((n=r.deliveryDirectives)!=null&&n.skip&&(l.deltaUpdateFailed=!0));if(u===this.currentLevel||r.withoutMultiVariant){u.fragmentError===0&&(u.loadError=0);var d=u.details;d===r.details&&d.advanced&&(d=void 0),this.playlistLoaded(o,r,d)}else(i=r.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)},e.loadingPlaylist=function(t,r){s.prototype.loadingPlaylist.call(this,t,r);var i=this.getUrlWithDirectives(t.uri,r),n=this.currentLevelIndex,o=t.attrs["PATHWAY-ID"],l=t.details,u=l==null?void 0:l.age;this.log("Loading level index "+n+((r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:"")+(o?" Pathway "+o:"")+(u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):"")+" "+i),this.hls.trigger(p.LEVEL_LOADING,{url:i,level:n,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:r||null})},e.removeLevel=function(t){var r,i=this;if(this._levels.length!==1){var n=this._levels.filter(function(l,u){return u!==t||(i.steering&&i.steering.removeLevel(l),l===i.currentLevel&&(i.currentLevel=null,i.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(function(d){return d.level=-1})),!1)});Ma(n),this._levels=n,this.currentLevelIndex>-1&&(r=this.currentLevel)!=null&&r.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);var o=n.length-1;this._firstLevel=Math.min(this._firstLevel,o),this._startLevel&&(this._startLevel=Math.min(this._startLevel,o)),this.hls.trigger(p.LEVELS_UPDATED,{levels:n})}},e.onLevelsUpdated=function(t,r){var i=r.levels;this._levels=i},e.checkMaxAutoUpdated=function(){var t=this.hls,r=t.autoLevelCapping,i=t.maxAutoLevel,n=t.maxHdcpLevel;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(p.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:r,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))},dt(a,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"loadLevelObj",get:function(){return this.currentLevel}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var r=this._levels;if(r.length!==0){if(t<0||t>=r.length){var i=new Error("invalid level idx"),n=t<0;if(this.hls.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.LEVEL_SWITCH_ERROR,level:t,fatal:n,error:i,reason:i.message}),n)return;t=Math.min(t,r.length-1)}var o=this.currentLevelIndex,l=this.currentLevel,u=l?l.attrs["PATHWAY-ID"]:void 0,d=r[t],h=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=d,o!==t||!l||u!==h){this.log("Switching to level "+t+" ("+(d.height?d.height+"p ":"")+(d.videoRange?d.videoRange+" ":"")+(d.codecSet?d.codecSet+" ":"")+"@"+d.bitrate+")"+(h?" with Pathway "+h:"")+" from level "+o+(u?" with Pathway "+u:""));var c={level:t,attrs:d.attrs,details:d.details,bitrate:d.bitrate,averageBitrate:d.averageBitrate,maxBitrate:d.maxBitrate,realBitrate:d.realBitrate,width:d.width,height:d.height,codecSet:d.codecSet,audioCodec:d.audioCodec,videoCodec:d.videoCodec,audioGroups:d.audioGroups,subtitleGroups:d.subtitleGroups,loaded:d.loaded,loadError:d.loadError,fragmentError:d.fragmentError,name:d.name,id:d.id,uri:d.uri,url:d.url,urlId:0,audioGroupIds:d.audioGroupIds,textGroupIds:d.textGroupIds};this.hls.trigger(p.LEVEL_SWITCHING,c);var f=d.details;if(!f||f.live){var g=this.switchParams(d.uri,l==null?void 0:l.details,f);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this.hls.firstAutoLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"pathways",get:function(){return this.steering?this.steering.pathways():[]}},{key:"pathwayPriority",get:function(){return this.steering?this.steering.pathwayPriority:null},set:function(t){if(this.steering){var r=this.steering.pathways(),i=t.filter(function(n){return r.indexOf(n)!==-1});if(t.length<1)return void this.warn("pathwayPriority "+t+" should contain at least one pathway from list: "+r);this.steering.pathwayPriority=i}}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}])}(Bi);function Zs(s){var a={};s.forEach(function(e){var t=e.groupId||"";e.id=a[t]=a[t]||0,a[t]++})}function to(){return self.SourceBuffer||self.WebKitSourceBuffer}function eo(){if(!Ee())return!1;var s=to();return!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function"}var Mu=function(s){function a(t,r,i){var n;return(n=s.call(this,t,r,i,"stream-controller",J)||this).audioCodecSwap=!1,n.level=-1,n._forceStartLoad=!1,n._hasEnoughToStart=!1,n.altAudio=0,n.audioOnly=!1,n.fragPlaying=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n.onMediaPlaying=function(){n.tick()},n.onMediaSeeked=function(){var o=n.media,l=o?o.currentTime:null;if(l!==null&&B(l)&&(n.log("Media seeked to "+l.toFixed(3)),n.getBufferedFrag(l))){var u=n.getFwdBufferInfoAtPos(o,l,J,0);u!==null&&u.len!==0?n.tick():n.warn("Main forward buffer length at "+l+' on "seeked" event '+(u?u.len:"empty")+")")}},n.registerListeners(),n}ut(a,s);var e=a.prototype;return e.registerListeners=function(){s.prototype.registerListeners.call(this);var t=this.hls;t.on(p.MANIFEST_PARSED,this.onManifestParsed,this),t.on(p.LEVEL_LOADING,this.onLevelLoading,this),t.on(p.LEVEL_LOADED,this.onLevelLoaded,this),t.on(p.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(p.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(p.BUFFER_CREATED,this.onBufferCreated,this),t.on(p.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(p.FRAG_BUFFERED,this.onFragBuffered,this)},e.unregisterListeners=function(){s.prototype.unregisterListeners.call(this);var t=this.hls;t.off(p.MANIFEST_PARSED,this.onManifestParsed,this),t.off(p.LEVEL_LOADED,this.onLevelLoaded,this),t.off(p.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(p.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(p.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(p.BUFFER_CREATED,this.onBufferCreated,this),t.off(p.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(p.FRAG_BUFFERED,this.onFragBuffered,this)},e.onHandlerDestroying=function(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),s.prototype.onHandlerDestroying.call(this)},e.startLoad=function(t,r){if(this.levels){var i=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var o=n.startLevel;o===-1&&(n.config.testBandwidth&&this.levels.length>1?(o=0,this.bitrateTest=!0):o=n.firstAutoLevel),n.nextLoadLevel=o,this.level=n.loadLevel,this._hasEnoughToStart=!!r}i>0&&t===-1&&!r&&(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),t=i),this.state=O.IDLE,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=r?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=O.STOPPED},e.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},e.doTick=function(){switch(this.state){case O.WAITING_LEVEL:var t=this.levels,r=this.level,i=t==null?void 0:t[r],n=i==null?void 0:i.details;if(n&&(!n.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(n))break;this.state=O.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=O.IDLE;break}break;case O.FRAG_LOADING_WAITING_RETRY:var o,l=self.performance.now(),u=this.retryDate;if(!u||l>=u||(o=this.media)!=null&&o.seeking){var d=this.levels,h=this.level,c=d==null?void 0:d[h];this.resetStartWhenNotLoaded(c||null),this.state=O.IDLE}}this.state===O.IDLE&&this.doTickIdle(),this.onTickEnd()},e.onTickEnd=function(){var t;s.prototype.onTickEnd.call(this),(t=this.media)!=null&&t.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()},e.doTickIdle=function(){var t=this.hls,r=this.levelLastLoaded,i=this.levels,n=this.media;if(r!==null&&(n||this.primaryPrefetch||!this.startFragRequested&&t.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)){var o=this.buffering?t.nextLoadLevel:t.loadLevel;if(i!=null&&i[o]){var l=i[o],u=this.getMainFwdBufferInfo();if(u!==null){var d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){var h={};return this.altAudio===2&&(h.type="video"),this.hls.trigger(p.BUFFER_EOS,h),void(this.state=O.ENDED)}if(this.buffering){t.loadLevel!==o&&t.manualLevel===-1&&this.log("Adapting to level "+o+" from level "+this.level),this.level=t.nextLoadLevel=o;var c=l.details;if(!c||this.state===O.WAITING_LEVEL||this.waitForLive(l))return this.level=o,this.state=O.WAITING_LEVEL,void(this.startFragRequested=!1);var f=u.len,g=this.getMaxBufferLength(l.maxBitrate);if(!(f>=g)){this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);var v=this.backtrackFragment?this.backtrackFragment.start:u.end,m=this.getNextFragment(v,c);if(this.couldBacktrack&&!this.fragPrevious&&m&&Dt(m)&&this.fragmentTracker.getState(m)!==xe){var y,E=((y=this.backtrackFragment)!=null?y:m).sn-c.startSN,T=c.fragments[E-1];T&&m.cc===T.cc&&(m=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,v)){if(!m.gap){var S=this.audioOnly&&!this.altAudio?Ft:Ht,I=(S===Ht?this.videoBuffer:this.mediaBuffer)||this.media;I&&this.afterBufferFlushed(I,S,J)}m=this.getNextFragmentLoopLoading(m,c,u,J,g)}m&&(!m.initSegment||m.initSegment.data||this.bitrateTest||(m=m.initSegment),this.loadFragment(m,l,v))}}}}}},e.loadFragment=function(t,r,i){var n=this.fragmentTracker.getState(t);n===Qe||n===we?Dt(t)?this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,r)):s.prototype.loadFragment.call(this,t,r,i):this._loadInitSegment(t,r):this.clearTrackerIfNeeded(t)},e.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,J)},e.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},e.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.nextLevelSwitch=function(){var t=this.levels,r=this.media;if(r!=null&&r.readyState){var i,n=this.getAppendedFrag(r.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);var o=this.getLevelDetails();if(o!=null&&o.live){var l=this.getMainFwdBufferInfo();if(!l||l.len<2*o.targetduration)return}if(!r.paused&&t){var u=t[this.hls.nextLoadLevel],d=this.fragLastKbps;i=d&&this.fragCurrent?this.fragCurrent.duration*u.maxBitrate/(1e3*d)+1:0}else i=0;var h=this.getBufferedFrag(r.currentTime+i);if(h){var c=this.followingBufferedFrag(h);if(c){this.abortCurrentFrag();var f=c.maxStartPTS?c.maxStartPTS:c.start,g=c.duration,v=Math.max(h.end,f+Math.min(Math.max(g-this.config.maxFragLookUpTolerance,g*(this.couldBacktrack?.5:.125)),g*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(v,Number.POSITIVE_INFINITY)}}}},e.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case O.KEY_LOADING:case O.FRAG_LOADING:case O.FRAG_LOADING_WAITING_RETRY:case O.PARSING:case O.PARSED:this.state=O.IDLE}this.nextLoadPosition=this.getLoadPosition()},e.flushMainBuffer=function(t,r){s.prototype.flushMainBuffer.call(this,t,r,this.altAudio===2?"video":null)},e.onMediaAttached=function(t,r){s.prototype.onMediaAttached.call(this,t,r);var i=r.media;fe(i,"playing",this.onMediaPlaying),fe(i,"seeked",this.onMediaSeeked)},e.onMediaDetaching=function(t,r){var i=this.media;i&&(ne(i,"playing",this.onMediaPlaying),ne(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,s.prototype.onMediaDetaching.call(this,t,r),r.transferMedia||(this._hasEnoughToStart=!1)},e.onManifestLoading=function(){s.prototype.onManifestLoading.call(this),this.log("Trigger BUFFER_RESET"),this.hls.trigger(p.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1},e.onManifestParsed=function(t,r){var i,n,o=!1,l=!1;r.levels.forEach(function(u){var d=u.audioCodec;d&&(o=o||d.indexOf("mp4a.40.2")!==-1,l=l||d.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=o&&l&&typeof((n=to())==null||(i=n.prototype)==null?void 0:i.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},e.onLevelLoading=function(t,r){if(this.levels&&this.state===O.IDLE){var i=r.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=O.WAITING_LEVEL)}},e.onLevelLoaded=function(t,r){var i,n=this.levels,o=this.startFragRequested,l=r.level,u=r.details,d=u.totalduration;if(n){this.log("Level "+l+" loaded ["+u.startSN+","+u.endSN+"]"+(u.lastPartSn?"[part-"+u.lastPartSn+"-"+u.lastPartIndex+"]":"")+", cc ["+u.startCC+", "+u.endCC+"] duration:"+d);var h=r.levelInfo,c=this.fragCurrent;!c||this.state!==O.FRAG_LOADING&&this.state!==O.FRAG_LOADING_WAITING_RETRY||c.level!==r.level&&c.loader&&this.abortCurrentFrag();var f=0;if(u.live||(i=h.details)!=null&&i.live){var g;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;f=this.alignPlaylists(u,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(h.details=u,this.levelLastLoaded=h,o||this.setStartPosition(u,f),this.hls.trigger(p.LEVEL_UPDATED,{details:u,level:l}),this.state===O.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=O.IDLE}o&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}else this.warn("Levels were reset while loading level "+l)},e.synchronizeToLiveEdge=function(t){var r=this.config,i=this.media;if(i){var n=this.hls.liveSyncPosition,o=this.getLoadPosition(),l=t.fragmentStart,u=t.edge,d=o>=l-r.maxFragLookUpTolerance&&o<=u;if(n!==null&&i.duration>n&&(o<n||!d)){var h=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*t.targetduration;(!d&&i.readyState<4||o<u-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),i.readyState&&(this.warn("Playback: "+o.toFixed(3)+" is located too far from the end of live sliding playlist: "+u+", reset currentTime to : "+n.toFixed(3)),i.currentTime=n))}}},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,n=t.part,o=t.payload,l=this.levels;if(l){var u=l[i.level];if(u){var d=u.details;if(!d)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var h=u.videoCodec,c=d.PTSKnown||!d.live,f=(r=i.initSegment)==null?void 0:r.data,g=this._getAudioCodec(u),v=this.transmuxer=this.transmuxer||new gs(this.hls,J,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=n?n.index:-1,y=m!==-1,E=new li(i.level,i.sn,i.stats.chunkCount,o.byteLength,m,y),T=this.initPTS[i.cc];v.push(o,f,g,h,i,n,d.totalduration,c,E,T)}else this.warn("Level "+i.level+" not found on progress")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e.onAudioTrackSwitching=function(t,r){var i=this,n=this.hls,o=this.altAudio===2;if(pr(r.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(o)return this.fragmentTracker.removeAllFragments(),n.once(p.BUFFER_FLUSHED,function(){var u;(u=i.hls)==null||u.trigger(p.AUDIO_TRACK_SWITCHED,r)}),void n.trigger(p.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});n.trigger(p.AUDIO_TRACK_SWITCHED,r)}},e.onAudioTrackSwitched=function(t,r){var i=pr(r.url,this.hls);if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i?2:0,this.tick()},e.onBufferCreated=function(t,r){var i,n,o=r.tracks,l=!1;for(var u in o){var d=o[u];if(d.id==="main"){if(n=u,i=d,u==="video"){var h=o[u];h&&(this.videoBuffer=h.buffer)}}else l=!0}l&&i?(this.log("Alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},e.onFragBuffered=function(t,r){var i=r.frag,n=r.part,o=i.type===J;if(o){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===O.PARSED&&(this.state=O.IDLE));var l=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),Dt(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}var u=this.media;u&&(!this._hasEnoughToStart&&tt.getBuffered(u).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),o&&this.tick())},e.onError=function(t,r){var i;if(r.fatal)this.state=O.ERROR;else switch(r.details){case D.FRAG_GAP:case D.FRAG_PARSING_ERROR:case D.FRAG_DECRYPT_ERROR:case D.FRAG_LOAD_ERROR:case D.FRAG_LOAD_TIMEOUT:case D.KEY_LOAD_ERROR:case D.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(J,r);break;case D.LEVEL_LOAD_ERROR:case D.LEVEL_LOAD_TIMEOUT:case D.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==O.WAITING_LEVEL||((i=r.context)==null?void 0:i.type)!==se||(this.state=O.IDLE);break;case D.BUFFER_ADD_CODEC_ERROR:case D.BUFFER_APPEND_ERROR:if(r.parent!=="main")return;this.resetLoadingState();break;case D.BUFFER_FULL_ERROR:if(r.parent!=="main")return;this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case D.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.onFragLoadEmergencyAborted=function(){this.state=O.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()},e.onBufferFlushed=function(t,r){var i=r.type;if(i!==Ft||!this.altAudio){var n=(i===Ht?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,i,J),this.tick())}},e.onLevelsUpdated=function(t,r){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=r.levels},e.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.seekToStartPos=function(){var t=this.media;if(t){var r=t.currentTime,i=this.startPosition;if(i>=0&&r<i){if(t.seeking)return void this.log("could not seek to "+i+", already seeking at "+r);var n=this.timelineOffset;n&&i&&(i+=n);var o=this.getLevelDetails(),l=tt.getBuffered(t),u=l.length?l.start(0):0,d=u-i,h=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);d>0&&(d<h||this.loadingParts&&d<2*((o==null?void 0:o.partTarget)||0))&&(this.log("adjusting start position by "+d+" to match buffer start"),i+=d,this.startPosition=i),r<i&&(this.log("seek to target start position "+i+" from current time "+r+" buffer start "+u),t.currentTime=i)}}},e._getAudioCodec=function(t){var r=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r=r.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),r},e._loadBitrateTestFrag=function(t,r){var i=this;t.bitrateTest=!0,this._doFragLoad(t,r).then(function(n){var o=i.hls,l=n==null?void 0:n.frag;if(l&&!i.fragContextChanged(l)){r.fragmentError=0,i.state=O.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var u=l.stats;u.parsing.start=u.parsing.end=u.buffering.start=u.buffering.end=self.performance.now(),o.trigger(p.FRAG_LOADED,n),l.bitrateTest=!1}})},e._handleTransmuxComplete=function(t){var r,i=this.playlistType,n=this.hls,o=t.remuxResult,l=t.chunkMeta,u=this.getCurrentContext(l);if(u){var d=u.frag,h=u.part,c=u.level,f=o.video,g=o.text,v=o.id3,m=o.initSegment,y=c.details,E=this.altAudio?void 0:o.audio;if(this.fragContextChanged(d))this.fragmentTracker.removeFragment(d);else{if(this.state=O.PARSING,m){if(m!=null&&m.tracks){var T=d.initSegment||d;this._bufferInitSegment(c,m.tracks,T,l),n.trigger(p.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:m.tracks})}var S=m.initPTS,I=m.timescale;B(S)&&(this.initPTS[d.cc]={baseTime:S,timescale:I},n.trigger(p.INIT_PTS_FOUND,{frag:d,id:i,initPTS:S,timescale:I}))}if(f&&y){E&&f.type==="audiovideo"&&this.logMuxedErr(d);var L=y.fragments[d.sn-1-y.startSN],A=d.sn===y.startSN,b=!L||d.cc>L.cc;if(o.independent!==!1){var R=f.startPTS,k=f.endPTS,_=f.startDTS,C=f.endDTS;if(h)h.elementaryStreams[f.type]={startPTS:R,endPTS:k,startDTS:_,endDTS:C};else if(f.firstKeyFrame&&f.independent&&l.id===1&&!b&&(this.couldBacktrack=!0),f.dropped&&f.independent){var x=this.getMainFwdBufferInfo(),w=(x?x.end:this.getLoadPosition())+this.config.maxBufferHole,P=f.firstKeyFramePTS?f.firstKeyFramePTS:R;if(!A&&w<P-this.config.maxBufferHole&&!b)return void this.backtrack(d);b&&(d.gap=!0),d.setElementaryStreamInfo(f.type,d.start,k,d.start,C,!0)}else A&&R-(y.appliedTimelineOffset||0)>2&&(d.gap=!0);d.setElementaryStreamInfo(f.type,R,k,_,C),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(f,d,h,l,A||b)}else{if(!A&&!b)return void this.backtrack(d);d.gap=!0}}if(E){var M=E.startPTS,F=E.endPTS,U=E.startDTS,G=E.endDTS;h&&(h.elementaryStreams[Ft]={startPTS:M,endPTS:F,startDTS:U,endDTS:G}),d.setElementaryStreamInfo(Ft,M,F,U,G),this.bufferFragmentData(E,d,h,l)}if(y&&v!=null&&(r=v.samples)!=null&&r.length){var N={id:i,frag:d,details:y,samples:v.samples};n.trigger(p.FRAG_PARSING_METADATA,N)}if(y&&g){var H={id:i,frag:d,details:y,samples:g.samples};n.trigger(p.FRAG_PARSING_USERDATA,H)}}}else this.resetWhenMissingContext(l)},e.logMuxedErr=function(t){this.warn((Dt(t)?"Media":"Init")+" segment with muxed audiovideo where only video expected: "+t.url)},e._bufferInitSegment=function(t,r,i,n){var o=this;if(this.state===O.PARSING){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&(delete r.audio,r.audiovideo&&this.logMuxedErr(i));var l=r.audio,u=r.video,d=r.audiovideo;if(l){var h=vr(l.codec,t.audioCodec);h==="mp4a"&&(h="mp4a.40.5");var c=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h=h.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5");var f=l.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&c.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log("Android: force audio codec to "+h)),t.audioCodec&&t.audioCodec!==h&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+h+'"'),l.levelCodec=h,l.id=J,this.log("Init audio buffer, container:"+l.container+", codecs[selected/level/parsed]=["+(h||"")+"/"+(t.audioCodec||"")+"/"+l.codec+"]"),delete r.audiovideo}if(u){u.levelCodec=t.videoCodec,u.id=J;var g=u.codec;if((g==null?void 0:g.length)===4)switch(g){case"hvc1":case"hev1":u.codec="hvc1.1.6.L120.90";break;case"av01":u.codec="av01.0.04M.08";break;case"avc1":u.codec="avc1.42e01e"}this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+g+"]"+(u.codec!==g?" parsed-corrected="+u.codec:"")+(u.supplemental?" supplemental="+u.supplemental:"")),delete r.audiovideo}d&&(this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+t.codecs+"/"+d.codec+"]"),delete r.video,delete r.audio);var v=Object.keys(r);if(v.length){if(this.hls.trigger(p.BUFFER_CODECS,r),!this.hls)return;v.forEach(function(m){var y=r[m].initSegment;y!=null&&y.byteLength&&o.hls.trigger(p.BUFFER_APPENDING,{type:m,data:y,frag:i,part:null,chunkMeta:n,parent:i.type})})}this.tickImmediate()}},e.getMainFwdBufferInfo=function(){var t=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,J)},e.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=O.IDLE},e.checkFragmentChanged=function(){var t=this.media,r=null;if(t&&t.readyState>1&&t.seeking===!1){var i=t.currentTime;if(tt.isBuffered(t,i)?r=this.getAppendedFrag(i):tt.isBuffered(t,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){this.backtrackFragment=null;var n=this.fragPlaying,o=r.level;n&&r.sn===n.sn&&n.level===o||(this.fragPlaying=r,this.hls.trigger(p.FRAG_CHANGED,{frag:r}),n&&n.level===o||this.hls.trigger(p.LEVEL_SWITCHED,{level:o}))}}},dt(a,[{key:"hasEnoughToStart",get:function(){return this._hasEnoughToStart}},{key:"maxBufferLength",get:function(){var t=this.levels,r=this.level,i=t==null?void 0:t[r];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t;if(this.fragPlaying)return this.fragPlaying;var r=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;return B(r)?this.getAppendedFrag(r):null}},{key:"currentProgramDateTime",get:function(){var t,r=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;if(B(r)){var i=this.getLevelDetails(),n=this.currentFrag||(i?Re(null,i.fragments,r):null);if(n){var o=n.programDateTime;if(o!==null){var l=o+1e3*(r-n.start);return new Date(l)}}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])}(Ai),Fu=function(){function s(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var a=s.prototype;return a.abort=function(e){for(var t in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[t].loader;if(r){var i;if(e&&e!==((i=r.context)==null?void 0:i.frag.type))return;r.abort()}}},a.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},a.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},a.createKeyLoadError=function(e,t,r,i,n){return t===void 0&&(t=D.KEY_LOAD_ERROR),new ue({type:K.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:i})},a.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,n=e.cc,o=function(){var u=t[l];if(n<=u.cc&&(i==="initSegment"||u.sn==="initSegment"||i<u.sn))return r.emeController.selectKeySystemFormat(u).then(function(d){u.setKeyFormat(d)}),1},l=0;l<t.length&&!o();l++);},a.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(function(r){return t.loadInternal(e,r)}):this.loadInternal(e)},a.loadInternal=function(e,t){var r,i;t&&e.setKeyFormat(t);var n=e.decryptdata;if(!n){var o=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,D.KEY_LOAD_ERROR,o))}var l=n.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,D.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+l+'"')));var u,d=this.keyUriToKeyInfo[l];if((r=d)!=null&&r.decryptdata.key)return n.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if((i=d)!=null&&i.keyLoadPromise)switch((u=d.mediaKeySessionContext)==null?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return d.keyLoadPromise.then(function(h){return n.key=h.keyInfo.decryptdata.key,{frag:e,keyInfo:d}})}switch(d=this.keyUriToKeyInfo[l]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,D.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+n.method+'"')))}},a.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(function(n){return e.mediaKeySessionContext=n,r})).catch(function(n){throw e.keyLoadPromise=null,n})}return Promise.resolve(r)},a.loadKeyHTTP=function(e,t){var r=this,i=this.config,n=new i.loader(i);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise(function(o,l){var u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=i.keyLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},c={onSuccess:function(f,g,v,m){var y=v.frag,E=v.keyInfo,T=v.url;if(!y.decryptdata||E!==r.keyUriToKeyInfo[T])return l(r.createKeyLoadError(y,D.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));E.decryptdata.key=y.decryptdata.key=new Uint8Array(f.data),y.keyLoader=null,E.loader=null,o({frag:y,keyInfo:E})},onError:function(f,g,v,m){r.resetLoader(g),l(r.createKeyLoadError(t,D.KEY_LOAD_ERROR,new Error("HTTP Error "+f.code+" loading key "+f.text),v,at({url:u.url,data:void 0},f)))},onTimeout:function(f,g,v){r.resetLoader(g),l(r.createKeyLoadError(t,D.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),v))},onAbort:function(f,g,v){r.resetLoader(g),l(r.createKeyLoadError(t,D.INTERNAL_ABORTED,new Error("key loading aborted"),v))}};n.load(u,h,c)})},a.resetLoader=function(e){var t=e.frag,r=e.keyInfo,i=e.url,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],n&&n.destroy()},s}();function ro(s){switch(s.type){case zt:return Mt;case $t:return Qt;default:return J}}function on(s,a){var e=s.url;return e!==void 0&&e.indexOf("data:")!==0||(e=a.url),e}var Nu=function(){function s(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}var a=s.prototype;return a.startLoad=function(e){},a.stopLoad=function(){this.destroyInternalLoaders()},a.registerListeners=function(){var e=this.hls;e.on(p.MANIFEST_LOADING,this.onManifestLoading,this),e.on(p.LEVEL_LOADING,this.onLevelLoading,this),e.on(p.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(p.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(p.LEVELS_UPDATED,this.onLevelsUpdated,this)},a.unregisterListeners=function(){var e=this.hls;e.off(p.MANIFEST_LOADING,this.onManifestLoading,this),e.off(p.LEVEL_LOADING,this.onLevelLoading,this),e.off(p.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(p.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(p.LEVELS_UPDATED,this.onLevelsUpdated,this)},a.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return this.loaders[e.type]=n,n},a.getInternalLoader=function(e){return this.loaders[e.type]},a.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},a.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},a.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},a.onManifestLoading=function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:pe,url:r,deliveryDirectives:null,levelOrTrack:null})},a.onLevelLoading=function(e,t){var r=t.id,i=t.level,n=t.pathwayId,o=t.url,l=t.deliveryDirectives,u=t.levelInfo;this.load({id:r,level:i,pathwayId:n,responseType:"text",type:se,url:o,deliveryDirectives:l,levelOrTrack:u})},a.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,o=t.deliveryDirectives,l=t.track;this.load({id:r,groupId:i,level:null,responseType:"text",type:zt,url:n,deliveryDirectives:o,levelOrTrack:l})},a.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,o=t.deliveryDirectives,l=t.track;this.load({id:r,groupId:i,level:null,responseType:"text",type:$t,url:n,deliveryDirectives:o,levelOrTrack:l})},a.onLevelsUpdated=function(e,t){var r=this.loaders[se];if(r){var i=r.context;i&&!t.levels.some(function(n){return n===i.levelOrTrack})&&(r.abort(),delete this.loaders[se])}},a.load=function(e){var t,r,i,n=this,o=this.hls.config,l=this.getInternalLoader(e);if(l){var u=this.hls.logger,d=l.context;if(d&&d.levelOrTrack===e.levelOrTrack&&(d.url===e.url||d.deliveryDirectives&&!e.deliveryDirectives))return void(d.url===e.url?u.log("[playlist-loader]: ignore "+e.url+" ongoing request"):u.log("[playlist-loader]: ignore "+e.url+" in favor of "+d.url));u.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}if(r=e.type===pe?o.manifestLoadPolicy.default:ot({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),l=this.createInternalLoader(e),B((t=e.deliveryDirectives)==null?void 0:t.part)&&(e.type===se&&e.level!==null?i=this.hls.levels[e.level].details:e.type===zt&&e.id!==null?i=this.hls.audioTracks[e.id].details:e.type===$t&&e.id!==null&&(i=this.hls.subtitleTracks[e.id].details),i)){var h=i.partTarget,c=i.targetduration;if(h&&c){var f=1e3*Math.max(3*h,.8*c);r=ot({},r,{maxTimeToFirstByteMs:Math.min(f,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,r.maxTimeToFirstByteMs)})}}var g=r.errorRetry||r.timeoutRetry||{},v={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:g.maxNumRetry||0,retryDelay:g.retryDelayMs||0,maxRetryDelay:g.maxRetryDelayMs||0},m={onSuccess:function(y,E,T,S){var I=n.getInternalLoader(T);n.resetInternalLoader(T.type);var L=y.data;L.indexOf("#EXTM3U")===0?(E.parsing.start=performance.now(),Je.isMediaPlaylist(L)||T.type!==pe?n.handleTrackOrLevelPlaylist(y,E,T,S||null,I):n.handleMasterPlaylist(y,E,T,S)):n.handleManifestParsingError(y,T,new Error("no EXTM3U delimiter"),S||null,E)},onError:function(y,E,T,S){n.handleNetworkError(E,T,!1,y,S)},onTimeout:function(y,E,T){n.handleNetworkError(E,T,!0,void 0,y)}};l.load(e,v,m)},a.checkAutostartLoad=function(){if(this.hls){var e=this.hls,t=e.config,r=t.autoStartLoad,i=t.startPosition,n=e.forceStartLoad;(r||n)&&(this.hls.logger.log((r?"auto":"force")+" startLoad with configured startPosition "+i),this.hls.startLoad(i))}},a.handleMasterPlaylist=function(e,t,r,i){var n=this.hls,o=e.data,l=on(e,r),u=Je.parseMasterPlaylist(o,l);if(u.playlistParsingError)this.handleManifestParsingError(e,r,u.playlistParsingError,i,t);else{var d=u.contentSteering,h=u.levels,c=u.sessionData,f=u.sessionKeys,g=u.startTimeOffset,v=u.variableList;this.variableList=v;var m=Je.parseMasterPlaylistMedia(o,l,u),y=m.AUDIO,E=y===void 0?[]:y,T=m.SUBTITLES,S=m["CLOSED-CAPTIONS"];E.length&&(E.some(function(I){return!I.url})||!h[0].audioCodec||h[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Lt({}),bitrate:0,url:""}))),n.trigger(p.MANIFEST_LOADED,{levels:h,audioTracks:E,subtitles:T,captions:S,contentSteering:d,url:l,stats:t,networkDetails:i,sessionData:c,sessionKeys:f,startTimeOffset:g,variableList:v})}},a.handleTrackOrLevelPlaylist=function(e,t,r,i,n){var o=this.hls,l=r.id,u=r.level,d=r.type,h=on(e,r),c=B(u)?u:B(l)?l:0,f=ro(r),g=Je.parseLevelPlaylist(e.data,h,c,f,0,this.variableList);if(d===pe){var v={attrs:new Lt({}),bitrate:0,details:g,name:"",url:h};g.requestScheduled=t.loading.start+Ca(g,0),o.trigger(p.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=g,this.handlePlaylistLoaded(g,e,t,r,i,n)},a.handleManifestParsingError=function(e,t,r,i,n){this.hls.trigger(p.ERROR,{type:K.NETWORK_ERROR,details:D.MANIFEST_PARSING_ERROR,fatal:t.type===pe,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:n})},a.handleNetworkError=function(e,t,r,i,n){r===void 0&&(r=!1);var o="A network "+(r?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+e.type;e.type===se?o+=": "+e.level+" id: "+e.id:e.type!==zt&&e.type!==$t||(o+=" id: "+e.id+' group-id: "'+e.groupId+'"');var l=new Error(o);this.hls.logger.warn("[playlist-loader]: "+o);var u=D.UNKNOWN,d=!1,h=this.getInternalLoader(e);switch(e.type){case pe:u=r?D.MANIFEST_LOAD_TIMEOUT:D.MANIFEST_LOAD_ERROR,d=!0;break;case se:u=r?D.LEVEL_LOAD_TIMEOUT:D.LEVEL_LOAD_ERROR,d=!1;break;case zt:u=r?D.AUDIO_TRACK_LOAD_TIMEOUT:D.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case $t:u=r?D.SUBTITLE_TRACK_LOAD_TIMEOUT:D.SUBTITLE_LOAD_ERROR,d=!1}h&&this.resetInternalLoader(e.type);var c={type:K.NETWORK_ERROR,details:u,fatal:d,url:e.url,loader:h,context:e,error:l,networkDetails:t,stats:n};if(i){var f=(t==null?void 0:t.url)||e.url;c.response=at({url:f,data:void 0},i)}this.hls.trigger(p.ERROR,c)},a.handlePlaylistLoaded=function(e,t,r,i,n,o){var l=this.hls,u=i.type,d=i.level,h=i.id,c=i.groupId,f=i.deliveryDirectives,g=on(t,i),v=ro(i),m=typeof i.level=="number"&&v===J?d:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var y=e.playlistParsingError;if(y){if(this.hls.logger.warn(y),!l.config.ignorePlaylistParsingErrors)return void l.trigger(p.ERROR,{type:K.NETWORK_ERROR,details:D.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:y,reason:y.message,response:t,context:i,level:m,parent:v,networkDetails:n,stats:r});e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),o.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),u){case pe:case se:l.trigger(p.LEVEL_LOADED,{details:e,levelInfo:i.levelOrTrack||l.levels[0],level:m||0,id:h||0,stats:r,networkDetails:n,deliveryDirectives:f,withoutMultiVariant:u===pe});break;case zt:l.trigger(p.AUDIO_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:r,networkDetails:n,deliveryDirectives:f});break;case $t:l.trigger(p.SUBTITLE_TRACK_LOADED,{details:e,track:i.levelOrTrack,id:h||0,groupId:c||"",stats:r,networkDetails:n,deliveryDirectives:f})}}else{var E=e.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(p.ERROR,{type:K.NETWORK_ERROR,details:D.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:t,context:i,level:m,parent:v,networkDetails:n,stats:r})}},s}(),io=function(){function s(e){e===void 0&&(e={}),this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new lr,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;var t=this.logger=Ln(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=function(P,M,F){if((M.liveSyncDurationCount||M.liveMaxLatencyDurationCount)&&(M.liveSyncDuration||M.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(M.liveMaxLatencyDurationCount!==void 0&&(M.liveSyncDurationCount===void 0||M.liveMaxLatencyDurationCount<=M.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(M.liveMaxLatencyDuration!==void 0&&(M.liveSyncDuration===void 0||M.liveMaxLatencyDuration<=M.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var U=an(P),G=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(N){var H=(N==="level"?"playlist":N)+"LoadPolicy",j=M[H]===void 0,et=[];G.forEach(function(X){var ht=N+"Loading"+X,rt=M[ht];if(rt!==void 0&&j){et.push(ht);var q=U[H].default;switch(M[H]={default:q},X){case"TimeOut":q.maxLoadTimeMs=rt,q.maxTimeToFirstByteMs=rt;break;case"MaxRetry":q.errorRetry.maxNumRetry=rt,q.timeoutRetry.maxNumRetry=rt;break;case"RetryDelay":q.errorRetry.retryDelayMs=rt,q.timeoutRetry.retryDelayMs=rt;break;case"MaxRetryTimeout":q.errorRetry.maxRetryDelayMs=rt,q.timeoutRetry.maxRetryDelayMs=rt}}}),et.length&&F.warn('hls.js config: "'+et.join('", "')+'" setting(s) are deprecated, use "'+H+'": '+pt(M[H]))}),at(at({},U),M)}(s.DefaultConfig,e,t);this.userConfig=e,r.progressive&&Pu(r,t);var i=r.abrController,n=r.bufferController,o=r.capLevelController,l=r.errorController,u=r.fpsController,d=new l(this),h=this.abrController=new i(this),c=new wo(this),f=r.interstitialsController,g=f?this.interstitialsController=new f(this,s):null,v=this.bufferController=new n(this,c),m=this.capLevelController=new o(this),y=new u(this),E=new Nu(this),T=r.contentSteeringController,S=T?new T(this):null,I=this.levelController=new Ou(this,S),L=new wu(this),A=new Fu(this.config),b=this.streamController=new Mu(this,c,A),R=this.gapController=new Cu(this,c);m.setStreamController(b),y.setStreamController(b);var k=[E,I,b];g&&k.splice(1,0,g),S&&k.splice(1,0,S),this.networkControllers=k;var _=[h,v,R,m,y,L,c];this.audioTrackController=this.createController(r.audioTrackController,k);var C=r.audioStreamController;C&&k.push(this.audioStreamController=new C(this,c,A)),this.subtitleTrackController=this.createController(r.subtitleTrackController,k);var x=r.subtitleStreamController;x&&k.push(this.subtititleStreamController=new x(this,c,A)),this.createController(r.timelineController,_),A.emeController=this.emeController=this.createController(r.emeController,_),this.cmcdController=this.createController(r.cmcdController,_),this.latencyController=this.createController(xu,_),this.coreComponents=_,k.push(d);var w=d.onErrorOut;typeof w=="function"&&this.on(p.ERROR,w,d),this.on(p.MANIFEST_LOADED,E.onManifestLoaded,E)}s.isMSESupported=function(){return eo()},s.isSupported=function(){return function(){if(!eo())return!1;var e=Ee();return typeof(e==null?void 0:e.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(t){return e.isTypeSupported(je(t,"video"))})||["mp4a.40.2","fLaC"].some(function(t){return e.isTypeSupported(je(t,"audio"))}))}()},s.getMediaSource=function(){return Ee()};var a=s.prototype;return a.createController=function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null},a.on=function(e,t,r){r===void 0&&(r=this),this._emitter.on(e,t,r)},a.once=function(e,t,r){r===void 0&&(r=this),this._emitter.once(e,t,r)},a.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},a.off=function(e,t,r,i){r===void 0&&(r=this),this._emitter.off(e,t,r,i)},a.listeners=function(e){return this._emitter.listeners(e)},a.emit=function(e,t,r){return this._emitter.emit(e,t,r)},a.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;var r=e===p.ERROR;this.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.INTERNAL_EXCEPTION,fatal:r,event:e,error:i}),this.triggeringException=!1}}return!1},a.listenerCount=function(e){return this._emitter.listenerCount(e)},a.destroy=function(){this.logger.log("destroy"),this.trigger(p.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},a.attachMedia=function(e){if(!e||"media"in e&&!e.media){var t=new Error("attachMedia failed: invalid argument ("+e+")");this.trigger(p.ERROR,{type:K.OTHER_ERROR,details:D.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}else{this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());var r="media"in e,i=r?e.media:e,n=r?e:{media:i};this._media=i,this.trigger(p.MEDIA_ATTACHING,n)}},a.detachMedia=function(){this.logger.log("detachMedia"),this.trigger(p.MEDIA_DETACHING,{}),this._media=null},a.transferMedia=function(){this._media=null;var e=this.bufferController.transferMedia();return this.trigger(p.MEDIA_DETACHING,{transferMedia:e}),e},a.loadSource=function(e){this.stopLoad();var t=this.media,r=this._url,i=this._url=jr.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log("loadSource:"+i),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(p.MANIFEST_LOADING,{url:e})},a.startLoad=function(e,t){e===void 0&&(e=-1),this.logger.log("startLoad("+e+(t?", <skip seek to start>":"")+")"),this.started=!0,this.resumeBuffering();for(var r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),this.started&&this.networkControllers);r++);},a.stopLoad=function(){this.logger.log("stopLoad"),this.started=!1;for(var e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);},a.resumeBuffering=function(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(function(e){e.resumeBuffering&&e.resumeBuffering()}))},a.pauseBuffering=function(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(function(e){e.pauseBuffering&&e.pauseBuffering()}))},a.swapAudioCodec=function(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){this.logger.log("recoverMediaError");var e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))},a.removeLevel=function(e){this.levelController.removeLevel(e)},a.setAudioOption=function(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null},a.setSubtitleOption=function(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null},a.getMediaDecodingInfo=function(e,t){return t===void 0&&(t=this.allAudioTracks),Vn(e,Xn(t),navigator.mediaCapabilities)},dt(s,[{key:"url",get:function(){return this._url}},{key:"hasEnoughToStart",get:function(){return this.streamController.hasEnoughToStart}},{key:"startPosition",get:function(){return this.streamController.startPositionValue}},{key:"loadingEnabled",get:function(){return this.started}},{key:"bufferingEnabled",get:function(){return this.streamController.bufferingEnabled}},{key:"inFlightFragments",get:function(){var e,t=((e={})[J]=this.streamController.inFlightFrag,e);return this.audioStreamController&&(t[Mt]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[Qt]=this.subtititleStreamController.inFlightFrag),t}},{key:"sessionId",get:function(){var e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch{try{var t=URL.createObjectURL(new Blob),r=t.toString();return URL.revokeObjectURL(t),r.slice(r.lastIndexOf("/")+1)}catch{var i=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){var u=(i+16*Math.random())%16|0;return i=Math.floor(i/16),(l=="x"?u:3&u|8).toString(16)})}}}()),e}},{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"latestLevelDetails",get:function(){return this.streamController.getLevelDetails()||null}},{key:"loadLevelObj",get:function(){return this.levelController.loadLevelObj}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){this.logger.log("set currentLevel:"+e),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){this.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){this.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){this.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){var e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e},set:function(e){this.logger.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(this.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN},set:function(e){this.abrController.resetEstimator(e)}},{key:"abrEwmaDefaultEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.defaultEstimate:NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){(function(t){return ii.indexOf(t)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=r===-1&&t!=null&&t.length?t.length-1:r,i)for(var n=e;n--;){var o=t[n].attrs["HDCP-LEVEL"];if(o&&o<=i)return n}return e}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(e){this.abrController.nextAutoLevel=e}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"maxBufferLength",get:function(){return this.streamController.maxBufferLength}},{key:"allAudioTracks",get:function(){var e=this.audioTrackController;return e?e.allAudioTracks:[]}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"allSubtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency},set:function(e){this.latencyController.targetLatency=e}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}},{key:"pathways",get:function(){return this.levelController.pathways}},{key:"pathwayPriority",get:function(){return this.levelController.pathwayPriority},set:function(e){this.levelController.pathwayPriority=e}},{key:"bufferedToEnd",get:function(){var e;return!((e=this.bufferController)==null||!e.bufferedToEnd)}},{key:"interstitialsManager",get:function(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}}],[{key:"version",get:function(){return ir}},{key:"Events",get:function(){return p}},{key:"MetadataSchema",get:function(){return Kt}},{key:"ErrorTypes",get:function(){return K}},{key:"ErrorDetails",get:function(){return D}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:_u},set:function(e){s.defaultConfig=e}}])}();return io.defaultConfig=void 0,io},Ve.exports=me()})(!1)}(fn)),fn.exports}var ao=Gu();const Ku=Uu(ao),Vu=Bu({__proto__:null,default:Ku},[ao]);export{Vu as h};
