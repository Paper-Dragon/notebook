import{aq as t,ar as n,aw as s,av as i}from"./app-zh13eAqJ.js";const a={};function r(c,e){return i(),n("div",null,e[0]||(e[0]=[s(`<h1 id="kubernetes-service-account如何生成token" tabindex="-1"><a class="header-anchor" href="#kubernetes-service-account如何生成token"><span>Kubernetes Service Account如何生成Token</span></a></h1><p>果然两天不看就跟不上了，我的集群版本是 1.25.3，今天需要用 token 来做些事情，创建 serviceAccount 的时候发现没有生成 secret，查了一下发现从 1.24 开始就不会自动生成 secret 了，<a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.24.md#urgent-upgrade-notes" target="_blank" rel="noopener noreferrer">chanagelog 在这里.</a></p><p>内容如下 LegacyServiceAccountTokenNoAutoGeneration 功能门是测试版，默认启用。启用后，不再为每个 ServiceAccount 自动生成包含服务帐户令牌的 Secret API 对象。使用 <a href="https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/authentication-resources/token-request-v1/" target="_blank" rel="noopener noreferrer">TokenRequest API</a> 获取服务帐户令牌，或者如果需要未过期的令牌，请按照<a href="https://kubernetes.io/docs/concepts/configuration/secret/#service-account-token-secrets" target="_blank" rel="noopener noreferrer">本指南</a>为令牌控制器创建一个 Secret API 对象以填充服务帐户令牌</p><p>pr: https://github.com/kubernetes/kubernetes/pull/108309</p><p>在上面提到的两种方式要怎么用呢</p><h2 id="方式-1" tabindex="-1"><a class="header-anchor" href="#方式-1"><span>方式 1</span></a></h2><p>使用 <code>TokenRequest API</code> 来生成 token，获取方式如下</p><ul><li>使用 client-go 或者其他 api 调用工具来获取某个 serviceaccount 的 token</li><li>创建 yaml，使用 kubectl apply -f</li><li>使用 <code>kubectl create token -n xxx &lt;serviceaccount-name&gt;</code> 来获取一个临时的 token, 默认 1 小时</li></ul><h2 id="方式-2" tabindex="-1"><a class="header-anchor" href="#方式-2"><span>方式 2</span></a></h2><p>创建 secret token，创建后从 secret 的 token 字段拿就可以了</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Secret</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">secret-sa-sample</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  annotations</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    kubernetes.io/service-account.name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;sa-name&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 这里填写serviceAccountName</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kubernetes.io/service-account-token</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11)]))}const l=t(a,[["render",r],["__file","Kubernetes Service Account如何生成Token.html.vue"]]),p=JSON.parse('{"path":"/note-book/Kubernetes/Kubernetes%20Service%20Account%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90Token.html","title":"Kubernetes Service Account如何生成Token","lang":"zh-CN","frontmatter":{"description":"Kubernetes Service Account如何生成Token 果然两天不看就跟不上了，我的集群版本是 1.25.3，今天需要用 token 来做些事情，创建 serviceAccount 的时候发现没有生成 secret，查了一下发现从 1.24 开始就不会自动生成 secret 了，chanagelog 在这里. 内容如下 LegacySe...","head":[["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/Kubernetes/Kubernetes%20Service%20Account%E5%A6%82%E4%BD%95%E7%94%9F%E6%88%90Token.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"Kubernetes Service Account如何生成Token"}],["meta",{"property":"og:description","content":"Kubernetes Service Account如何生成Token 果然两天不看就跟不上了，我的集群版本是 1.25.3，今天需要用 token 来做些事情，创建 serviceAccount 的时候发现没有生成 secret，查了一下发现从 1.24 开始就不会自动生成 secret 了，chanagelog 在这里. 内容如下 LegacySe..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-08-13T15:08:38.000Z"}],["meta",{"property":"article:modified_time","content":"2023-08-13T15:08:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Kubernetes Service Account如何生成Token\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-08-13T15:08:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"PaperDragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"]]},"git":{"createdTime":1691939318000,"updatedTime":1691939318000,"contributors":[{"name":"PaperDragon","username":"PaperDragon","email":"2678885646@qq.com","commits":1,"url":"https://github.com/PaperDragon"}]},"readingTime":{"minutes":1.07,"words":321},"filePathRelative":"note-book/Kubernetes/Kubernetes Service Account如何生成Token.md","localizedDate":"2023年8月13日","excerpt":"\\n<p>果然两天不看就跟不上了，我的集群版本是 1.25.3，今天需要用 token 来做些事情，创建 serviceAccount 的时候发现没有生成 secret，查了一下发现从 1.24 开始就不会自动生成 secret 了，<a href=\\"https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.24.md#urgent-upgrade-notes\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">chanagelog 在这里.</a></p>\\n<p>内容如下 LegacyServiceAccountTokenNoAutoGeneration 功能门是测试版，默认启用。启用后，不再为每个 ServiceAccount 自动生成包含服务帐户令牌的 Secret API 对象。使用 <a href=\\"https://kubernetes.io/zh-cn/docs/reference/kubernetes-api/authentication-resources/token-request-v1/\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">TokenRequest API</a> 获取服务帐户令牌，或者如果需要未过期的令牌，请按照<a href=\\"https://kubernetes.io/docs/concepts/configuration/secret/#service-account-token-secrets\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">本指南</a>为令牌控制器创建一个 Secret API 对象以填充服务帐户令牌</p>","autoDesc":true}');export{l as comp,p as data};
