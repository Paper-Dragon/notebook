import{ah as a,ai as i,ar as e,am as n}from"./app-DylxrlAN.js";const l="/assets/156b7412eefd0609-DXARnvRG.jpg",t={};function h(r,s){return n(),i("div",null,s[0]||(s[0]=[e(`<h1 id="docker一键部署clash服务与管理面板" tabindex="-1"><a class="header-anchor" href="#docker一键部署clash服务与管理面板"><span>Docker一键部署Clash服务与管理面板</span></a></h1><blockquote><p>部分资料来自： https://blog.laoyutang.cn/linux/clash.html</p></blockquote><p>官方Clash部署需要采用两个镜像分别启动服务和面板，博主使用官方Server镜像和官方管理面板前端代码，重新修改打包构建，使用一个镜像可以直接启动服务和管理面板，简单轻量。</p><blockquote><p>Clash和它的面板已经很久不更新了，建议使用Meta内核和MetaCube面板，随我来这个文档部署：</p><p><a href="https://www.geekery.cn/note-book/VirtualPrivateNetwork/%E7%8B%AD%E4%B9%89VirtualPrivateNetwork/Docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Meta%E5%92%8CMetacubexD%E9%9D%A2%E6%9D%BF.html" target="_blank" rel="noopener noreferrer">Docker一键部署Meta和MetacubexD面板</a></p></blockquote><h2 id="镜像地址" tabindex="-1"><a class="header-anchor" href="#镜像地址"><span>镜像地址</span></a></h2><p><a href="https://hub.docker.com/r/laoyutang/clash-and-dashboard" target="_blank" rel="noopener noreferrer">laoyutang/clash-and-dashboard</a></p><h2 id="修改后源码地址" tabindex="-1"><a class="header-anchor" href="#修改后源码地址"><span>修改后源码地址</span></a></h2><p><a href="https://github.com/LaoYutang/clash-and-dashboard" target="_blank" rel="noopener noreferrer">Github:clash-and-dashboard</a> 可以查看源码，自行打包</p><h2 id="修改内容" tabindex="-1"><a class="header-anchor" href="#修改内容"><span>修改内容</span></a></h2><ul><li>修改前端接口baseurl，不再通过用户配置，使用页面相对路径<code>/api</code>。</li><li>去除Clash服务接口配置框。</li><li>Docker镜像增加Nginx和前端打包文件。</li><li>Nginx反代Clash管理接口，实现管理页面无需配置直接管理容器内Clash服务。</li></ul><h2 id="启动容器" tabindex="-1"><a class="header-anchor" href="#启动容器"><span>启动容器</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>docker run -d \\</span></span>
<span class="line"><span>  --name clash \\</span></span>
<span class="line"><span>  --restart=always \\</span></span>
<span class="line"><span>  --log-opt max-size=1m \\</span></span>
<span class="line"><span>  --name clash-and-dashboard \\</span></span>
<span class="line"><span>  -v /data/clash/clash.yaml:/root/.config/clash/config.yaml \\</span></span>
<span class="line"><span>  -p 7888:8080 -p 7890:7890 \\</span></span>
<span class="line"><span>  laoyutang/clash-and-dashboard:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>-v /data/clash/clash.yaml:/root/.config/clash/config.yaml 提供clash的yaml文件，文件如何获取请读者自行解决</li><li>-p 7888:8080 管理<strong>页面端口</strong></li><li>-p 7890:7890 http<strong>代理端口</strong> socks端口使用7891</li><li>laoyutang/clash-and-dashboard:latest 博主修改后的镜像</li></ul><p>访问Ip:7888管理页面即可，注意非本机使用，请勾选<strong>允许局域网连接</strong><img src="`+l+`" alt="管理版面预览"></p><h2 id="自动更新yaml文件" tabindex="-1"><a class="header-anchor" href="#自动更新yaml文件"><span>自动更新yaml文件</span></a></h2><h3 id="配置定期更新" tabindex="-1"><a class="header-anchor" href="#配置定期更新"><span>配置定期更新</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">crontab</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -e</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>添加如下内容：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加以下的内容</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每隔 8 小时备份配置文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">0</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/8</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/.config/clash/config.yaml</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/.config/clash/config.yaml.bak</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每隔 8 小时延迟 5 分钟支更新配置文件</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">5</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/8</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://xxxxxxx</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/root/.config/clash/config.yaml</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每隔 8 小时延迟 6 分钟修改配置文件 allow-lan: false 修改为true</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">6</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/8</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/allow-lan: false/allow-lan: true/&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/.config/clash/config.yaml</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每隔 8 小时延迟 7 分钟修改配置文件 external-controller:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">7</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/8</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/external-controller: 127.0.0.1:9090/external-controller: 0.0.0.0:9090/&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/.config/clash/config.yaml</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每隔 8 小时延迟 8 分钟修改配置文件 external-ui: dashboard 注释掉，即不使用内置的dashboard，有的机场提供的配置文件没有这个配置，就不需要添加这行</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">8</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/8</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/external-ui: dashboard/#external-ui: dashboard/&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/.config/clash/config.yaml</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每隔 8 小时延迟 10 分钟重启 clash</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/8</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> clash-and-dashboard</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启 cron 服务</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cron.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,21)]))}const k=a(t,[["render",h]]),o=JSON.parse('{"path":"/note-book/VirtualPrivateNetwork/%E7%8B%AD%E4%B9%89VirtualPrivateNetwork/Docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Clash%E6%9C%8D%E5%8A%A1%E4%B8%8E%E7%AE%A1%E7%90%86%E9%9D%A2%E6%9D%BF.html","title":"Docker一键部署Clash服务与管理面板","lang":"zh-CN","frontmatter":{"description":"Docker一键部署Clash服务与管理面板 部分资料来自： https://blog.laoyutang.cn/linux/clash.html 官方Clash部署需要采用两个镜像分别启动服务和面板，博主使用官方Server镜像和官方管理面板前端代码，重新修改打包构建，使用一个镜像可以直接启动服务和管理面板，简单轻量。 Clash和它的面板已经很久不...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker一键部署Clash服务与管理面板\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-09-22T13:07:52.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Paper-Dragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"],["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/VirtualPrivateNetwork/%E7%8B%AD%E4%B9%89VirtualPrivateNetwork/Docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Clash%E6%9C%8D%E5%8A%A1%E4%B8%8E%E7%AE%A1%E7%90%86%E9%9D%A2%E6%9D%BF.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"Docker一键部署Clash服务与管理面板"}],["meta",{"property":"og:description","content":"Docker一键部署Clash服务与管理面板 部分资料来自： https://blog.laoyutang.cn/linux/clash.html 官方Clash部署需要采用两个镜像分别启动服务和面板，博主使用官方Server镜像和官方管理面板前端代码，重新修改打包构建，使用一个镜像可以直接启动服务和管理面板，简单轻量。 Clash和它的面板已经很久不..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-22T13:07:52.000Z"}],["meta",{"property":"article:modified_time","content":"2024-09-22T13:07:52.000Z"}]]},"git":{"createdTime":1699694698000,"updatedTime":1727010472000,"contributors":[{"name":"Paper-Dragon","username":"Paper-Dragon","email":"2678885646@qq.com","commits":3,"url":"https://github.com/Paper-Dragon"},{"name":"PaperDragon-SH","username":"PaperDragon-SH","email":"2678885646@qq.com","commits":2,"url":"https://github.com/PaperDragon-SH"}],"changelog":[{"hash":"0835233cfc8ff71f1dcb3829070fc5ac80780bfc","time":1727010472000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"fixed markdown"},{"hash":"cc36944f2fe9bb845ecb128af8ad73eadb0eb965","time":1727009179000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"Docker一键部署Meta和MetacubexD面板"},{"hash":"4e450477161662b8fd627f7fa3cb4b7847dd5072","time":1713842159000,"email":"2678885646@qq.com","author":"PaperDragon-SH","message":"Docker一键部署Clash服务与管理面板 更新”定时更新“ 功能"},{"hash":"444cc620e507ab19e4bdea14567836aa80169356","time":1710837804000,"email":"2678885646@qq.com","author":"PaperDragon-SH","message":"侠义vpn规范化标题"},{"hash":"8fb53a7200d313607ed11daaaa8fcb4c221b3d3f","time":1699694698000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"Docker一键部署Clash服务与管理面板"}]},"readingTime":{"minutes":2.16,"words":649},"filePathRelative":"note-book/VirtualPrivateNetwork/狭义VirtualPrivateNetwork/Docker一键部署Clash服务与管理面板.md","excerpt":"\\n<blockquote>\\n<p>部分资料来自： https://blog.laoyutang.cn/linux/clash.html</p>\\n</blockquote>\\n<p>官方Clash部署需要采用两个镜像分别启动服务和面板，博主使用官方Server镜像和官方管理面板前端代码，重新修改打包构建，使用一个镜像可以直接启动服务和管理面板，简单轻量。</p>\\n<blockquote>\\n<p>Clash和它的面板已经很久不更新了，建议使用Meta内核和MetaCube面板，随我来这个文档部署：</p>\\n<p><a href=\\"https://www.geekery.cn/note-book/VirtualPrivateNetwork/%E7%8B%AD%E4%B9%89VirtualPrivateNetwork/Docker%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2Meta%E5%92%8CMetacubexD%E9%9D%A2%E6%9D%BF.html\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Docker一键部署Meta和MetacubexD面板</a></p>\\n</blockquote>","autoDesc":true}');export{k as comp,o as data};
