import{a as i,c as s,g as a,o as n}from"./app-CfZ1rw5k.js";const t="/assets/150304171156551-BsGA7Nz-.png",r="/assets/150304171156552-Cqpf4Nz3.png",d="/assets/150304171156553-TPiz5SJm.png",o="/assets/150304171156554-Bu5Xl8wu.png",c="/assets/150304171156555-B_vmlTbi.png",l="/assets/150304171156556-CegC_Tyh.png",p={};function u(m,e){return n(),s("div",null,[...e[0]||(e[0]=[a(`<h1 id="备份linux系统" tabindex="-1"><a class="header-anchor" href="#备份linux系统"><span>备份Linux系统</span></a></h1><p>在前面的一些文章中，我反复提到经常会把Linux系统搞崩溃，所以备份系统就是一件不容忽视的事情。由于Linux系统本身的优越性，系统的备份和还原还是比较容易的。主要表现在以下方面：</p><ul><li>Linux系统所有的数据都以文件的形式存在，所以备份就是直接拷贝文件；硬盘分区也被当成文件，所以可以直接克隆硬盘数据。</li><li>Linux系统自带很多实用工具，比如tar、dd、rsync等，备份还原系统不需要购买或下载第三方软件。</li><li>Linux系统在运行时其硬盘上的文件可以直接被覆盖，所以还原系统的时候不需要另外的引导盘。（当然，系统完全挂掉到无法启动这种情况还是需要另外的引导盘的。）</li></ul><p>备份Linux系统的策略有很多，比如使用dd命令直接克隆硬盘分区：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>sudo dd if=/dev/sda1 of=/dev/sdb1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或者，使用tar将硬盘上的文件打包：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>cd /</span></span>
<span class="line"><span>sudo tar cvpzf backup.tgz --exclude=/proc --exclude=/mnt --exclude=/sys --exclude=/backup.tgz /</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>还原系统的命令是：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>sudo dd if=/dev/sdb1 of=/dev/sda1</span></span>
<span class="line"><span>或</span></span>
<span class="line"><span>tar xvpfz backup.tgz -C /</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是我最终选择的是rsync命令。rsync是一个非常优秀的文件同步工具，从它的名字可以看出，它支持远程同步。当然，在备份我的桌面系统时，只需要用到它的本地同步功能就行了。之所以选择rsync，是因为它具有如下优点：</p><ul><li>在备份还原过程中，可以保存文件原有的时间、权限、软硬链接等信息；</li><li>首次备份时，需要复制所有文件，但是再次备份或还原系统时，只需要复制修改过的文件。</li></ul><p>关于rsync的使用方法，其主要参考文档是<code>man rsync</code>，另外，rsync也可以作为守护进程运行用来建立文件备份服务器，可以参考文档<code>man rsyncd.conf</code>。</p><h2 id="桌面系统备份实战" tabindex="-1"><a class="header-anchor" href="#桌面系统备份实战"><span>桌面系统备份实战</span></a></h2><p>对于我的桌面系统，我选择的备份策略是使用rsync命令将硬盘上的所有文件(当然要排除/proc和/sys目录下的内容）复制到U盘上。首先使用<code>df -lh</code>命令查看一下我电脑的系统占多大空间，如下图： <img src="`+t+'" alt="img"></p><p>从上图可以看出，根目录所在的分区占用了14G，而/boot目录所在的分区才占用100多M。其实Linux系统本来不用这么臃肿，只是因为我安装了太多的软件包，比如一整套的texlive啊什么的，才占用了这么多的空间。不过这都不是事儿，反正现在U盘也便宜，所以找个32G的USB 3.0的U盘来备份我这个系统，肯定是很轻松愉快的。</p><p>新U盘插到电脑上会被自动识别，使用不带参数的<code>mount</code>命令可以查看U盘的设备文件和挂载路径，使用<code>fdisk</code>命令了解U盘的大小和分区情况。如下图： <img src="'+r+'" alt="img"></p><p>整个U盘分成一个区我没什么意见，不过我不喜欢它的vfat文件系统，万一碰到超过4G的巨型文件怎么办？so，先<code>umount</code>它，然后使用<code>mkfs.ext3</code>为它重新建立一个文件系统，如下图： <img src="'+d+'" alt="img"></p><p>再把U盘<code>mount</code>起来，挂载的路径为<code>/media/youxia/usb</code>。如下图： <img src="'+o+'" alt="img"></p><p>然后，可以开始备份了，我备份的命令是：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>sudo rsync -Pa / /media/youxia/usb/backup_20141216 --exclude=/media/* --exclude=/sys/* --exclude=/proc/* --exclude=/mnt/* --exclude=/tmp/*</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如下图： <img src="'+c+'" alt="img"></p><p>下图是备份完成后的效果，可以看到整个备份过程花了59分多钟，U盘被占用15G，如下图： <img src="'+l+'" alt="img"></p><p>如果哪天系统再崩溃了的话，只需要使用<code>sudo rsync -Pa /media/youxia/usb/backup_20141216 /</code>即可恢复系统。</p>',23)])])}const g=i(p,[["render",u]]),b=JSON.parse('{"path":"/note-book/OperaSystems/%E5%A4%87%E4%BB%BDLinux%E7%B3%BB%E7%BB%9F.html","title":"备份Linux系统","lang":"zh-CN","frontmatter":{"description":"备份Linux系统 在前面的一些文章中，我反复提到经常会把Linux系统搞崩溃，所以备份系统就是一件不容忽视的事情。由于Linux系统本身的优越性，系统的备份和还原还是比较容易的。主要表现在以下方面： Linux系统所有的数据都以文件的形式存在，所以备份就是直接拷贝文件；硬盘分区也被当成文件，所以可以直接克隆硬盘数据。 Linux系统自带很多实用工具，...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"备份Linux系统\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-08-13T15:08:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Paper-Dragon\\",\\"url\\":\\"https://github.com/Paper-Dragon\\",\\"email\\":\\"2678885646@qq.com\\"}]}"],["meta",{"property":"og:url","content":"https://www.geekery.cn/note-book/OperaSystems/%E5%A4%87%E4%BB%BDLinux%E7%B3%BB%E7%BB%9F.html"}],["meta",{"property":"og:site_name","content":"运维开发绿皮书"}],["meta",{"property":"og:title","content":"备份Linux系统"}],["meta",{"property":"og:description","content":"备份Linux系统 在前面的一些文章中，我反复提到经常会把Linux系统搞崩溃，所以备份系统就是一件不容忽视的事情。由于Linux系统本身的优越性，系统的备份和还原还是比较容易的。主要表现在以下方面： Linux系统所有的数据都以文件的形式存在，所以备份就是直接拷贝文件；硬盘分区也被当成文件，所以可以直接克隆硬盘数据。 Linux系统自带很多实用工具，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-08-13T15:08:38.000Z"}],["meta",{"property":"article:modified_time","content":"2023-08-13T15:08:38.000Z"}]]},"git":{"createdTime":1691939318000,"updatedTime":1691939318000,"contributors":[{"name":"Paper-Dragon","username":"Paper-Dragon","email":"2678885646@qq.com","commits":1,"url":"https://github.com/Paper-Dragon"}],"changelog":[{"hash":"392a519398b2e846f316619fbe831e100164de7c","time":1691939318000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"Create The Worid!"}]},"readingTime":{"minutes":3.38,"words":1014},"filePathRelative":"note-book/OperaSystems/备份Linux系统.md","excerpt":"\\n<p>在前面的一些文章中，我反复提到经常会把Linux系统搞崩溃，所以备份系统就是一件不容忽视的事情。由于Linux系统本身的优越性，系统的备份和还原还是比较容易的。主要表现在以下方面：</p>\\n<ul>\\n<li>Linux系统所有的数据都以文件的形式存在，所以备份就是直接拷贝文件；硬盘分区也被当成文件，所以可以直接克隆硬盘数据。</li>\\n<li>Linux系统自带很多实用工具，比如tar、dd、rsync等，备份还原系统不需要购买或下载第三方软件。</li>\\n<li>Linux系统在运行时其硬盘上的文件可以直接被覆盖，所以还原系统的时候不需要另外的引导盘。（当然，系统完全挂掉到无法启动这种情况还是需要另外的引导盘的。）</li>\\n</ul>","autoDesc":true}');export{g as comp,b as data};
