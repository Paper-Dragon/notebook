import{a as i,c as a,g as n,o as l}from"./app-CfCcbveN.js";const h="/assets/image-20240723001740440-B6CTEGTv.png",e="/assets/image-20240723001943818-C9ig3t3L.png",k="/assets/image-20240722224550408-yQby4Dpq.png",t="/assets/image-20240723005003786-XX3yLOlp.png",p="/assets/image-20240723005359414-BbGQDzvD.png",d="/assets/image-20240723005519930-MrDUrFPg.png",r="/assets/image-20240723005703806-OVS2qZDO.png",c="/assets/image-20240723005804850-rMlU0NOP.png",g="/assets/image-20240723005841433-Cd5bv2Bl.png",F="/assets/image-20240723005938492-BdDH8wKh.png",y="/assets/image-20240723005950596-Dnu_yVO-.png",A="/assets/image-20240723010901654-7zouBJQq.png",o="/assets/image-20240723011558478-Dd_G6nv4.png",u={};function b(m,s){return l(),a("div",null,[...s[0]||(s[0]=[n('<h1 id="docker的pull和push接口调用流程" tabindex="-1"><a class="header-anchor" href="#docker的pull和push接口调用流程"><span>Docker的Pull和Push接口调用流程</span></a></h1><p>找了很多的资料，没有人写过Docker接口逆向的教程。国家封锁了海外的Dockerhub镜像站，而且禁止国内的各大高校和企业镜像官方仓库。这下技术人员犯了难，所需要的镜像都没有了，趁手的工具都没有了，怎么去搞技术，于是乎开始有民间制作的Dockerhub镜像加速地址。这些加速地址优良参差不齐，有的速度极慢、有的要趁机收费发一笔横财、有的被滥用（白嫖过度）甚至过不了几天就要跑路。我配置在docker damon进程里的镜像加速地址换了又换，自己的实验地址这样操作是没问题的，可是业务容器不能容忍重启daemon进程，会导致整个namespace重置，业务中断，这就让人犯了难，于是乎我就根据大佬的教程搭建了一个镜像站，加速是实现了，速度也还能够满足，利用全球网络流量占比20%的CloudFlare Worker每天100,000次的免费请求进行无成本构建，满足了需求，并打通了Dockerhub的高速流量隧道。</p><p>可是我并不满足这些仅仅支持下载加速的地址，Dockerhub的免费无限存储空间呢？Docker私有账户存储的镜像怎么办？我想要一个支持登录和上传的镜像地址，于是我又找了网上几乎所有的教程，他们的实现方式要么成本较高，实现方法需要自己的服务器来做，难以承受巨额的流量费；要么用的是Github Action来做，等待Action去下载然后打包，你在本地导入，这丧失了很多优点，不具备实时性、无法与Linux里面安装的Docker客户端进行交互。于是我做了同时支持账户登录，账户私有镜像加速，推送到官方Dockerhub的镜像站，同时无成本实现。这篇文章用来记录逆向过程、账户推送镜像的原理和过程，顺带讲一点点DockerHub镜像站的架构、原理。</p><h2 id="伪造证书认证中心的安装" tabindex="-1"><a class="header-anchor" href="#伪造证书认证中心的安装"><span>伪造证书认证中心的安装</span></a></h2><p>因为Docker强制使用tls加密，无法解析到数据包里面的内容，则无法进行数据的逆向查看。这里利用伪造证书认证中心（CA）的方式让他使用指定的证书认证机构进行数据加密，而这个认证中心是假的，我具有这个认证中心的数据解码方法，这个tls无法解密的问题就解决了。</p><h3 id="启动burpsuite并导出ca" tabindex="-1"><a class="header-anchor" href="#启动burpsuite并导出ca"><span>启动BurpSuite并导出CA</span></a></h3><p>打开设置</p><p><img src="'+h+'" alt="image-20240723001740440"></p><p>导出证书</p><p><img src="'+e+`" alt="image-20240723001943818"></p><p>导出的文件名我设置的是</p><ul><li>burpsuite-cacert.der</li><li>burpsuite-cakey.der</li></ul><h3 id="ca证书解析为系统可识别的格式" tabindex="-1"><a class="header-anchor" href="#ca证书解析为系统可识别的格式"><span>CA证书解析为系统可识别的格式</span></a></h3><p>仅需要安装CA证书即可，不需要安装ca密钥！！！</p><h4 id="证书解析和安装进操作系统" tabindex="-1"><a class="header-anchor" href="#证书解析和安装进操作系统"><span>证书解析和安装进操作系统</span></a></h4><p>详细过程和另一种不适用dpkg-reconfigure的方法</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> x509</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -inform</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> der</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> burpsuite-cacert.der</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> burpsuite-ca.crt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/ca-certificates/extra</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> burpsuite-ca.crt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/share/ca-certificates/extra/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dpkg-reconfigure</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ca-certificates</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这里勾选你的证书并下一步，直到完成就结束了</p><p><img src="`+k+`" alt="image-20240722224550408"></p><h2 id="docker-cs架构抓包的困难性和解决方法" tabindex="-1"><a class="header-anchor" href="#docker-cs架构抓包的困难性和解决方法"><span>Docker CS架构抓包的困难性和解决方法</span></a></h2><p>我想了各种办去做docker本身的流量拦截定向到burp正向代理里解析，我尝试了常用的proxychain4去单程序拦截可是不奏效，甚至我都要扒出tun网卡来拦截了，恰好找到了Docker Daemon进程写进配置文件的方式，数据果然出来的，Docker Dameon进程跟Dockerhub交互的流量全部被抓取出来（经过后续的查看，这个东西没有代理Dockerfile编译成镜像过程当时产生的流量，请知悉）。</p><h3 id="proxychain4的尝试-失败" tabindex="-1"><a class="header-anchor" href="#proxychain4的尝试-失败"><span>proxychain4的尝试（失败）</span></a></h3><p>在配置文件里设置代理</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">┌──(root㉿localhost</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)-[~]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">└─#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/proxychains4.conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tail</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   154</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #         * raw: The traffic is simply forwarded to the proxy without modification.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   155</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #        ( auth types supported: &quot;basic&quot;-http  &quot;user/pass&quot;-socks )</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   156</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   157</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  [ProxyList]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   158</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # add proxy here ...</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   159</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # meanwile</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   160</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # defaults set to &quot;tor&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   161</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #socks4         127.0.0.1 9050</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   162</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  http</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">   163</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试，结果失败，burp里没获取到任何流量</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">┌──(root㉿localhost</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)-[~]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">└─#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proxychains</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> login</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hub.icert.top</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="daemon进程直接对接正向代理" tabindex="-1"><a class="header-anchor" href="#daemon进程直接对接正向代理"><span>Daemon进程直接对接正向代理</span></a></h3><p>（失败）在daemon配置文件里配置，这种设置方法我认为是一种正确的设置方法，但是不知道为什么会报错。于是乎我换了一种方式，</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  &quot;proxies&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    &quot;http-proxy&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;http://proxy.example.com:3128&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    &quot;https-proxy&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;https://proxy.example.com:3129&quot;,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    &quot;no-proxy&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;*.test.example.com,.example.org,127.0.0.0/8&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接在systemd service里设置，注意看第17、18行是我新加的。这样设置之后即可抓取daemon流量。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">┌──(root㉿localhost</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)-[~]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">└─#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># /usr/lib/systemd/system/docker.service</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Description</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Docker</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Application</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Engine</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Documentation</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">https://docs.docker.com</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">After</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">network-online.target</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> docker.socket</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> firewalld.service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> containerd.service</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Wants</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">network-online.target</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> containerd.service</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Requires</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">docker.socket</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">notify</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># the default is not to use systemd for cgroups because the delegate issues still</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># exists and systemd currently does not support the cgroup feature set required</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># for containers run by docker</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">EnvironmentFile</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">-/etc/default/docker</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Environment</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;HTTP_PROXY=http://127.0.0.1:8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Environment</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;HTTPS_PROXY=http://127.0.0.1:8080&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/usr/sbin/dockerd</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> -H</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fd://</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --containerd=/run/containerd/containerd.sock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $DOCKER_OPTS</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ExecReload</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/bin/kill</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HUP</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $MAINPID</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LimitNOFILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1048576</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LimitNPROC</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">infinity</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LimitCORE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">infinity</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Uncomment TasksMax if your systemd version supports it.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Only systemd 226 and above support this version.</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">TasksMax</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">infinity</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">TimeoutStartSec</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># set delegate yes so that systemd does not reset the cgroups of docker containers</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Delegate</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">yes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># kill only the docker process, not all processes in the cgroup</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">KillMode</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">process</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># restart the docker process if it exits prematurely</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Restart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">on-failure</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">StartLimitBurst</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">3</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">StartLimitInterval</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">60s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">WantedBy</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="利用burpsuite进行记录和解析流量" tabindex="-1"><a class="header-anchor" href="#利用burpsuite进行记录和解析流量"><span>利用BurpSuite进行记录和解析流量</span></a></h2><h4 id="初始设置" tabindex="-1"><a class="header-anchor" href="#初始设置"><span>初始设置</span></a></h4><p>关闭这个选项，不然出一个请求停一下抓取。实话说这个工具挺难用的，java编写的程序，4G内存占用先不说，在分析具备blob数据的时候经常性卡顿，南勇的一逼，不知道是否是我没买企业版的原因哈哈哈。</p><p><img src="`+t+'" alt="image-20240723005003786"></p><p><img src="'+p+'" alt="image-20240723005359414"></p><h4 id="login流量过程" tabindex="-1"><a class="header-anchor" href="#login流量过程"><span>Login流量过程</span></a></h4><p>第一个直接登录流量包，先试探是否为无密码登录，返回401代码未授权，并且通过location触发跳转登录链接</p><p><img src="'+d+'" alt="image-20240723005519930"></p><p>客户端携带用户名密码加密的base64字符串去请求接口，返回一个具有期限的token</p><p><img src="'+r+'" alt="image-20240723005703806"></p><p><img src="'+c+'" alt="image-20240723005804850"></p><p><img src="'+g+'" alt="image-20240723005841433"></p><p>再次请求镜像站，这次会携带token进行球球，返回200状态码，则登录成功</p><p><img src="'+F+'" alt="image-20240723005938492"></p><p><img src="'+y+`" alt="image-20240723005950596"></p><h4 id="push流量过程" tabindex="-1"><a class="header-anchor" href="#push流量过程"><span>Push流量过程</span></a></h4><p>编译一个新的镜像进行测试</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">┌──(root㉿kali</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)-[~/ifconfig.icu]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">└─#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hub.icert.top/jockerdragon/test:0.0.0.3</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --no-cache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Sending</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> build</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> context</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> daemon</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  58.26MB</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> FROM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python:3.12.3-alpine3.18</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">c692e99e7633</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 2/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LABEL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> org.opencontainers.image.authors=&quot;&lt;PaperDragon&amp;&amp;2678885646@qq.com&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 076a28b7242f</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> intermediate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 076a28b7242f</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">b2254bf15177</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WORKDIR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /app</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 910ae15bcdeb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> intermediate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 910ae15bcdeb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">7024f52ed628</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 4/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> COPY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> .</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /app</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ed5b51167133</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 5/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> entrypoint.sh</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 62cd697e5508</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> intermediate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 62cd697e5508</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ee501f4c9f13</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 6/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --no-cache-dir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requirements.txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">rm</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requirements.txt</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3def86822d95</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Collecting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastapi==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.111.1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (from </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requirements.txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (line </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Downloading</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastapi-0.111.1-py3-none-any.whl.metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (26 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Collecting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uvicorn==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.30.1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (from </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requirements.txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (line </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Downloading</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uvicorn-0.30.1-py3-none-any.whl.metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (6.3 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Collecting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> geoip2==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4.8.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (from </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requirements.txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (line </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  Downloading</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> geoip2-4.8.0-py2.py3-none-any.whl.metadata</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (18 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Collecting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jinja2==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3.1.4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (from </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requirements.txt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (line </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ................................</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Downloading</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mdurl-0.1.2-py3-none-any.whl</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (10.0 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">kB</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Installing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> collected</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> packages:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> websockets,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uvloop,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> urllib3,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> typing-extensions,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sniffio,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shellingham,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pyyaml,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python-multipart,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python-dotenv,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pygments,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> multidict,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mdurl,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> maxminddb,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MarkupSafe,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> idna,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httptools,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> h11,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> frozenlist,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dnspython,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> click,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> charset-normalizer,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> certifi,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> attrs,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> annotated-types,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yarl,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uvicorn,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requests,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pydantic-core,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> markdown-it-py,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jinja2,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httpcore,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> email_validator,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> anyio,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aiosignal,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> watchfiles,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> starlette,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rich,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pydantic,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httpx,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aiohttp,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> typer,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> geoip2,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastapi-cli,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastapi</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Successfully</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> installed</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MarkupSafe-2.1.5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aiohttp-3.9.5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> aiosignal-1.3.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> annotated-types-0.7.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> anyio-4.4.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> attrs-23.2.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> certifi-2024.7.4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> charset-normalizer-3.3.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> click-8.1.7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dnspython-2.6.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> email_validator-2.2.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastapi-0.111.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> fastapi-cli-0.0.4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> frozenlist-1.4.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> geoip2-4.8.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> h11-0.14.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httpcore-1.0.5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httptools-0.6.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> httpx-0.27.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> idna-3.7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> jinja2-3.1.4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> markdown-it-py-3.0.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> maxminddb-2.6.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mdurl-0.1.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> multidict-6.0.5</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pydantic-2.8.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pydantic-core-2.20.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pygments-2.18.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python-dotenv-1.0.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python-multipart-0.0.9</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pyyaml-6.0.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> requests-2.32.3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rich-13.7.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shellingham-1.5.4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sniffio-1.3.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> starlette-0.37.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> typer-0.12.3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> typing-extensions-4.12.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> urllib3-2.2.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uvicorn-0.30.1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> uvloop-0.19.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> watchfiles-0.22.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> websockets-12.0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yarl-1.9.4</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WARNING:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> as</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;root&#39;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> can</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> result</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> broken</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> permissions</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> conflicting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> behaviour</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> system</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> package</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> manager.</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> It</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> recommended</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> virtual</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> environment</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> instead:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://pip.pypa.io/warnings/venv</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[notice] A new release of pip is available: 24.0 -&gt; 24.1.2                                                                                                                                                                                 </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[notice] To update, run: pip install --upgrade pip                                                                                                                                                                                         </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> intermediate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3def86822d95</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                                                                                                                                                                               </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">8802aa36cd80</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 7/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> EXPOSE</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 8000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3f08ba09c39b</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> intermediate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3f08ba09c39b</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">d9bc475e34ed</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Step</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8/8</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CMD</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/app/entrypoint.sh&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Running</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3f53a33715a9</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Removing</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> intermediate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> container</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 3f53a33715a9</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ---</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">459bcc4789fe</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Successfully</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> built</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 459bcc4789fe</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Successfully</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tagged</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hub.icert.top/jockerdragon/test:0.0.0.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置单线程上传方便测试</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">┌──(root㉿kali</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)-[~/ifconfig.icu]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">└─#</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/docker/daemon.json</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                          </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      &quot;max-concurrent-downloads&quot;:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1,</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      &quot;max-concurrent-uploads&quot;:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">     4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>推送测试</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hub.icert.top/jockerdragon/test:0.0.0.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>第1、2请求会发起登录，并获取一个临时的登录密钥</p><p><img src="`+A+`" alt="image-20240723010901654"></p><p>认证完了会携带token，进行upload请求，返回一个blob uuid和上传地址。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">POST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /v2/jockerdragon/test/blobs/uploads/</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HTTP/2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Host:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hub.icert.top</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">User-Agent:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker/20.10.25+dfsg1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> go/go1.22.3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git-commit/5df983c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel/6.8.11-amd64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> os/linux</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> arch/amd64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> UpstreamClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Client/20.10.25+dfsg1</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">linux</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Content-Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Authorization:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Bearer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsIng1YyI6WyJNSUlFRmpDQ0F2NmdBd0lCQWdJVVZOajJRbU1JWnUzeGl0NUJ1RTlvRWdoVU5KUXdEUVlKS29aSWh2Y05BUUVMQlFBd2dZWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SSXdFQVlEVlFRSEV3bFFZV3h2SUVGc2RHOHhGVEFUQmdOVkJBb1RERVJ2WTJ0bGNpd2dTVzVqTGpFVU1CSUdBMVVFQ3hNTFJXNW5hVzVsWlhKcGJtY3hJVEFmQmdOVkJBTVRHRVJ2WTJ0bGNpd2dTVzVqTGlCRmJtY2dVbTl2ZENCRFFUQWVGdzB5TkRBeE1UWXdOak0yTURCYUZ3MHlOVEF4TVRVd05qTTJNREJhTUlHRk1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFU01CQUdBMVVFQnhNSlVHRnNieUJCYkhSdk1SVXdFd1lEVlFRS0V3eEViMk5yWlhJc0lFbHVZeTR4RkRBU0JnTlZCQXNUQzBWdVoybHVaV1Z5YVc1bk1TQXdIZ1lEVlFRREV4ZEViMk5yWlhJc0lFbHVZeTRnUlc1bklFcFhWQ0JEUVRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTWI4eHR6ZDQ1UWdYekV0bWMxUEJsdWNGUnlzSUF4UUJCN3lSNjdJemdMd05IS24rbUdKTzV5alh6amtLZm5zWm1JRURnZFlraEpBbGNYYTdQa1BFaCtqcTRGNWNaaWtkTmFUQmM3alNkTFJzTVlVa3dwWTl4WUVqYitCYnVGUWVxa0R2RXNqbFJJTzRQK0FsRlhNMDhMYlpIZ3hFWUdkbFk3WFlhT1BLMmE1aUd2eVFRb09GVmZjZDd2ekhaREVBMHZqVmU1M0xLdjVMYmh6TzcxZHRxS0RwNEhnVWR5N1pENDFNN3I1bTd5eE1LeFNpQmJHZTFvem5Wamh1ck5GNHdGSml5bVU4YkhTV2tVTXVLQ3JTbEd4d1NCZFVZNDRyaEh2UW5zYmgzUFF2TUZTWTQ4REdoNFhUUldjSzFWUVlSTnA2ZWFXUVg1RUpJSXVJbjJQOVBzQ0F3RUFBYU43TUhrd0RnWURWUjBQQVFIL0JBUURBZ0dtTUJNR0ExVWRKUVFNTUFvR0NDc0dBUVVGQndNQk1CSUdBMVVkRXdFQi93UUlNQVlCQWY4Q0FRQXdIUVlEVlIwT0JCWUVGSnVRYXZTZHVScm5kRXhLTTAwV2Z2czh5T0RaTUI4R0ExVWRJd1FZTUJhQUZGSGVwRE9ZQ0Y5Qnc5dXNsY0RVUW5CalU3MS9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUNDWW0xUVorUUZ1RVhkSWpiNkg4bXNyVFBRSlNnR0JpWDFXSC9QRnpqZlJGeHc3dTdDazBRb0FXZVNqV3JWQWtlVlZQN3J2REpwZ0ZoeUljdzNzMXRPVjN0OGp3cXJTUmc2R285dUd2OG9IWUlLTm9YaDErUFVDTG44b0JwYUJsOUxzSWtsL2FHMG9lY0hrcDVLYmtBNjN6eTFxSUVXNFAzWVJLSk9hSGoxYWFiOXJLc3lRSHF6SUl4TnlDRVVINTMwU1B4RUNMbE53YWVKTDVmNXIxUW5wSi9GM3Q5Vk8xZ0Y2RFpiNitPczdTV29ocGhWZlRCOERkL1VjSk1VOGp2YlF3MWRVREkwelNEdXo2aHNJbGdITk0yak04M0lOS1VqNjNaRDMwRG15ejQvczFFdGgyQmlKK2RHdnFpQkRzaWhaR0tyQnJzUzhWVkRBd3hDeDVRMyJdfQ.eyJhY2Nlc3MiOlt7ImFjdGlvbnMiOlsicHVsbCIsInB1c2giXSwibmFtZSI6ImpvY2tlcmRyYWdvbi90ZXN0IiwicGFyYW1ldGVycyI6eyJwdWxsX2xpbWl0IjoiMjAwIiwicHVsbF9saW1pdF9pbnRlcnZhbCI6IjIxNjAwIn0sInR5cGUiOiJyZXBvc2l0b3J5In1dLCJhdWQiOiJyZWdpc3RyeS5kb2NrZXIuaW8iLCJleHAiOjE3MjE2NjgzMDIsImh0dHBzOi8vYXV0aC5kb2NrZXIuaW8iOnsicGxhbl9uYW1lIjoiZnJlZSIsInVzZXJuYW1lIjoiam9ja2VyZHJhZ29uIn0sImlhdCI6MTcyMTY2ODAwMiwiaXNzIjoiYXV0aC5kb2NrZXIuaW8iLCJqdGkiOiJkY2tyX2p0aV8tSWs4cFdyUk5rVllmeFJsRXA0WmI0NnFCTjg9IiwibmJmIjoxNzIxNjY3NzAyLCJzdWIiOiI5MDE5NDY1YS1jZTgwLTRmOTAtOWM4NS03NjI2NjVjM2VhM2QifQ.GXCo-bhNjbAUopm-8PikvNeciwADB6LL7VZhMRuHNhAet2O1-1ZsRnQAbkBdrX6tOs39BLkefer1Ps_HwYjwLi3PCx6y6y3j20P-OckeXC59whGfihH51jkJq7WSBBrXkU4k5TNceGnCQxtR1p2z1LkXewfS0Jnwxz2P1TmUV2EUKlxLwZwSTSg-NlH3AqW6OclcmV_sA95NgmRp4BnKrkQOTiUdz2xTjA7vELA2q3VptYdcORZAyI1NIMdwBfMCw-gPiz-PQnBt93AoPCoHkcjuzZVTfxrCrg480m7BiWnOHTdgKhH0UasLdhKg5ys0fw95_nIKgTI4iIzlQ-teIg</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Accept-Encoding:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gzip,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deflate,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Connection:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> close</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HTTP/2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 202</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Accepted</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Date:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mon,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jul</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2024</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 17:06:43</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GMT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Content-Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Location:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://hub.icert.top/v2/jockerdragon/test/blobs/uploads/8429c964-3a56-46e5-9512-f5c9559f2179?_state=nkCV87II1yHCU_48NVc21qHc7HPq7oEf1DIKZmuCwTp7Ik5hbWUiOiJqb2NrZXJkcmFnb24vdGVzdCIsIlVVSUQiOiI4NDI5Yzk2NC0zYTU2LTQ2ZTUtOTUxMi1mNWM5NTU5ZjIxNzkiLCJPZmZzZXQiOjAsIlN0YXJ0ZWRBdCI6IjIwMjQtMDctMjJUMTc6MDY6NDMuNTY1ODcxNTU3WiJ9</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Host:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry-1.docker.io</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Range:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0-0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cf-Ray:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8a7505dccb0f77b7-LHR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cf-Cache-Status:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DYNAMIC</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Strict-Transport-Security:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> max-age=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">31536000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Distribution-Api-Version:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry/2.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Upload-Uuid:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8429c964-3a56-46e5-9512-f5c9559f2179</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Report-To:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {&quot;endpoints&quot;:[{&quot;url&quot;:&quot;https:\\/\\/a.nel.cloudflare.com\\/report\\/v4?s=B7%2FiBGoGkgqffejfiHuBu%2FuyJrGmNRAg6XAZ5NTj5sO%2FuQEZlwuSePqq3kYh0A34WG5PRO22S%2Bni0JiIagWLEOx5XG%2FsmIBuYYptQd0scR9HU4B7sCHvngDcSrVftzOo9A%3D%3D&quot;}],&quot;group&quot;:&quot;cf-nel&quot;,&quot;max_age&quot;:604800}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nel:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {&quot;success_fraction&quot;:0,&quot;report_to&quot;:&quot;cf-nel&quot;,&quot;max_age&quot;:604800}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Vary:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Accept-Encoding</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Server:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudflare</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Alt-Svc:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> h3=&quot;:443&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ma</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">86400</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>客户端发起PATCH请求，这时body里会携带全部的这层镜像的压缩包，太大了会分段传输，range表示传递了多少段,上传完毕会200代码，若没有则继续通过location进行传递下一段，直到完全传完。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">PATCH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /v2/jockerdragon/test/blobs/uploads/f7b19f97-233b-4d29-93dd-721b20e6d6f8?_state=ifxCfGeZFk6-9Ww1vmIz20QeKa5mafNkGZHm6SPQKYJ7Ik5hbWUiOiJqb2NrZXJkcmFnb24vdGVzdCIsIlVVSUQiOiJmN2IxOWY5Ny0yMzNiLTRkMjktOTNkZC03MjFiMjBlNmQ2ZjgiLCJPZmZzZXQiOjAsIlN0YXJ0ZWRBdCI6IjIwMjQtMDctMjJUMTc6MDc6MjAuNjQyMzIzNDhaIn0%3D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HTTP/2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Host:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hub.icert.top</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">User-Agent:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker/20.10.25+dfsg1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> go/go1.22.3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git-commit/5df983c</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel/6.8.11-amd64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> os/linux</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> arch/amd64</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> UpstreamClient</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Client/20.10.25+dfsg1</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">linux</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Authorization:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Bearer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsIng1YyI6WyJNSUlFRmpDQ0F2NmdBd0lCQWdJVVZOajJRbU1JWnUzeGl0NUJ1RTlvRWdoVU5KUXdEUVlKS29aSWh2Y05BUUVMQlFBd2dZWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SSXdFQVlEVlFRSEV3bFFZV3h2SUVGc2RHOHhGVEFUQmdOVkJBb1RERVJ2WTJ0bGNpd2dTVzVqTGpFVU1CSUdBMVVFQ3hNTFJXNW5hVzVsWlhKcGJtY3hJVEFmQmdOVkJBTVRHRVJ2WTJ0bGNpd2dTVzVqTGlCRmJtY2dVbTl2ZENCRFFUQWVGdzB5TkRBeE1UWXdOak0yTURCYUZ3MHlOVEF4TVRVd05qTTJNREJhTUlHRk1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFU01CQUdBMVVFQnhNSlVHRnNieUJCYkhSdk1SVXdFd1lEVlFRS0V3eEViMk5yWlhJc0lFbHVZeTR4RkRBU0JnTlZCQXNUQzBWdVoybHVaV1Z5YVc1bk1TQXdIZ1lEVlFRREV4ZEViMk5yWlhJc0lFbHVZeTRnUlc1bklFcFhWQ0JEUVRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTWI4eHR6ZDQ1UWdYekV0bWMxUEJsdWNGUnlzSUF4UUJCN3lSNjdJemdMd05IS24rbUdKTzV5alh6amtLZm5zWm1JRURnZFlraEpBbGNYYTdQa1BFaCtqcTRGNWNaaWtkTmFUQmM3alNkTFJzTVlVa3dwWTl4WUVqYitCYnVGUWVxa0R2RXNqbFJJTzRQK0FsRlhNMDhMYlpIZ3hFWUdkbFk3WFlhT1BLMmE1aUd2eVFRb09GVmZjZDd2ekhaREVBMHZqVmU1M0xLdjVMYmh6TzcxZHRxS0RwNEhnVWR5N1pENDFNN3I1bTd5eE1LeFNpQmJHZTFvem5Wamh1ck5GNHdGSml5bVU4YkhTV2tVTXVLQ3JTbEd4d1NCZFVZNDRyaEh2UW5zYmgzUFF2TUZTWTQ4REdoNFhUUldjSzFWUVlSTnA2ZWFXUVg1RUpJSXVJbjJQOVBzQ0F3RUFBYU43TUhrd0RnWURWUjBQQVFIL0JBUURBZ0dtTUJNR0ExVWRKUVFNTUFvR0NDc0dBUVVGQndNQk1CSUdBMVVkRXdFQi93UUlNQVlCQWY4Q0FRQXdIUVlEVlIwT0JCWUVGSnVRYXZTZHVScm5kRXhLTTAwV2Z2czh5T0RaTUI4R0ExVWRJd1FZTUJhQUZGSGVwRE9ZQ0Y5Qnc5dXNsY0RVUW5CalU3MS9NQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUNDWW0xUVorUUZ1RVhkSWpiNkg4bXNyVFBRSlNnR0JpWDFXSC9QRnpqZlJGeHc3dTdDazBRb0FXZVNqV3JWQWtlVlZQN3J2REpwZ0ZoeUljdzNzMXRPVjN0OGp3cXJTUmc2R285dUd2OG9IWUlLTm9YaDErUFVDTG44b0JwYUJsOUxzSWtsL2FHMG9lY0hrcDVLYmtBNjN6eTFxSUVXNFAzWVJLSk9hSGoxYWFiOXJLc3lRSHF6SUl4TnlDRVVINTMwU1B4RUNMbE53YWVKTDVmNXIxUW5wSi9GM3Q5Vk8xZ0Y2RFpiNitPczdTV29ocGhWZlRCOERkL1VjSk1VOGp2YlF3MWRVREkwelNEdXo2aHNJbGdITk0yak04M0lOS1VqNjNaRDMwRG15ejQvczFFdGgyQmlKK2RHdnFpQkRzaWhaR0tyQnJzUzhWVkRBd3hDeDVRMyJdfQ.eyJhY2Nlc3MiOlt7ImFjdGlvbnMiOlsicHVsbCIsInB1c2giXSwibmFtZSI6ImpvY2tlcmRyYWdvbi90ZXN0IiwicGFyYW1ldGVycyI6eyJwdWxsX2xpbWl0IjoiMjAwIiwicHVsbF9saW1pdF9pbnRlcnZhbCI6IjIxNjAwIn0sInR5cGUiOiJyZXBvc2l0b3J5In1dLCJhdWQiOiJyZWdpc3RyeS5kb2NrZXIuaW8iLCJleHAiOjE3MjE2NjgzMDIsImh0dHBzOi8vYXV0aC5kb2NrZXIuaW8iOnsicGxhbl9uYW1lIjoiZnJlZSIsInVzZXJuYW1lIjoiam9ja2VyZHJhZ29uIn0sImlhdCI6MTcyMTY2ODAwMiwiaXNzIjoiYXV0aC5kb2NrZXIuaW8iLCJqdGkiOiJkY2tyX2p0aV8tSWs4cFdyUk5rVllmeFJsRXA0WmI0NnFCTjg9IiwibmJmIjoxNzIxNjY3NzAyLCJzdWIiOiI5MDE5NDY1YS1jZTgwLTRmOTAtOWM4NS03NjI2NjVjM2VhM2QifQ.GXCo-bhNjbAUopm-8PikvNeciwADB6LL7VZhMRuHNhAet2O1-1ZsRnQAbkBdrX6tOs39BLkefer1Ps_HwYjwLi3PCx6y6y3j20P-OckeXC59whGfihH51jkJq7WSBBrXkU4k5TNceGnCQxtR1p2z1LkXewfS0Jnwxz2P1TmUV2EUKlxLwZwSTSg-NlH3AqW6OclcmV_sA95NgmRp4BnKrkQOTiUdz2xTjA7vELA2q3VptYdcORZAyI1NIMdwBfMCw-gPiz-PQnBt93AoPCoHkcjuzZVTfxrCrg480m7BiWnOHTdgKhH0UasLdhKg5ys0fw95_nIKgTI4iIzlQ-teIg</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Accept-Encoding:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> gzip,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> deflate,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> br</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Connection:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> close</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Content-Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HTTP/2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 202</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Accepted</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Date:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Mon,</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 22</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jul</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2024</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 17:07:21</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> GMT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Content-Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Location:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://hub.icert.top/v2/jockerdragon/test/blobs/uploads/f7b19f97-233b-4d29-93dd-721b20e6d6f8?_state=eIbb6aiCKJ4yvBm73PQwwMK9oPGXr1l3F66xUAE6ZPd7Ik5hbWUiOiJqb2NrZXJkcmFnb24vdGVzdCIsIlVVSUQiOiJmN2IxOWY5Ny0yMzNiLTRkMjktOTNkZC03MjFiMjBlNmQ2ZjgiLCJPZmZzZXQiOjAsIlN0YXJ0ZWRBdCI6IjIwMjQtMDctMjJUMTc6MDc6MjBaIn0%3D</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Host:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry-1.docker.io</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Range:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0-0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cf-Ray:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 8a7506c888f877b7-LHR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Cf-Cache-Status:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> DYNAMIC</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Strict-Transport-Security:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> max-age=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">31536000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Distribution-Api-Version:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> registry/2.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Upload-Uuid:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> f7b19f97-233b-4d29-93dd-721b20e6d6f8</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Report-To:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {&quot;endpoints&quot;:[{&quot;url&quot;:&quot;https:\\/\\/a.nel.cloudflare.com\\/report\\/v4?s=lMuAl0UgmHfUdIxLJEOM5CeeqKvoGrWyjIUWWjfyUfWZaO65Z9ss1qo%2Bypcr7bbpG0b1tK8bXvJFZjkMXDUal9y56PPaoBA%2BqIQ9H2%2Fn3QHRKaA0HVM5Bdoq4LpWZUc6Gg%3D%3D&quot;}],&quot;group&quot;:&quot;cf-nel&quot;,&quot;max_age&quot;:604800}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Nel:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> {&quot;success_fraction&quot;:0,&quot;report_to&quot;:&quot;cf-nel&quot;,&quot;max_age&quot;:604800}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Vary:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Accept-Encoding</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Server:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cloudflare</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Alt-Svc:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> h3=&quot;:443&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ma</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">86400</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="解析登录和推送过程并在云端重写" tabindex="-1"><a class="header-anchor" href="#解析登录和推送过程并在云端重写"><span>解析登录和推送过程并在云端重写</span></a></h2><p>。。。传递上边过程中提到的body和head里面的数据。改写location里的跳转为自己的地址。。。。。</p><h2 id="dockerhub架构解析" tabindex="-1"><a class="header-anchor" href="#dockerhub架构解析"><span>DockerHub架构解析</span></a></h2><h3 id="认证过程" tabindex="-1"><a class="header-anchor" href="#认证过程"><span>认证过程</span></a></h3><p><img src="`+o+`" alt="image-20240723011558478"></p><ol><li>尝试与仓库开始推送/拉取操作。</li><li>如果仓库需要授权，它将返回一个401未授权的HTTP响应，并附带如何进行认证的信息。</li><li>仓库客户端向授权服务请求一个Bearer令牌。</li><li>授权服务返回一个不透明的Bearer令牌，代表客户端已获授权的访问权限。</li><li>客户端使用在请求的Authorization头中嵌入的Bearer令牌重试原始请求。</li><li>仓库通过验证Bearer令牌及其内嵌的有效声明集来授权客户端，并像往常一样开始推送/拉取会话。</li></ol><h3 id="push过程" tabindex="-1"><a class="header-anchor" href="#push过程"><span>Push过程</span></a></h3><blockquote><p><a href="https://distribution.github.io/distribution/spec/api/" target="_blank" rel="noopener noreferrer">API文档</a></p></blockquote><h4 id="api-版本确认" tabindex="-1"><a class="header-anchor" href="#api-版本确认"><span>Api 版本确认</span></a></h4><p>registry 服务器会通过/v2/接口根据返回的状态码来提供api的版本信息，请求格式如下</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /v2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果返回200 OK 则表明registry实现了V2接口，并且客户端可以安全的去使用其他所有的v2接口 如果返回401 Unauthorized, 则表示客户端需要根据WWW-Authenticate header 重新请求接口。根据访问控制设置，用户即使这里通过验证，在访问不同的资源的时候可能仍需身份验证 如果返回404 NOT FOUND ,则客户端应认为registry未实现v2接口</p><h4 id="校验layer是否存在" tabindex="-1"><a class="header-anchor" href="#校验layer是否存在"><span>校验layer是否存在</span></a></h4><p>可以通过一个HEAD 请求来校验一个layer是否存在。 请求格式如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HEAD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /v2/[name]/blobs/[digest]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果返回的状态码为200 OK ,则表示指定的layer已存在，若已存在则client 则跳过该layer的上传。由于HEAD 请求根据HTTP规范没有body,因此HEADER中带了以下信息</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">200</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Content-Length:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [length </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> blob]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Content-Digest:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [digest]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看上边burp的抓包结果</p><h4 id="发送post请求" tabindex="-1"><a class="header-anchor" href="#发送post请求"><span>发送post请求</span></a></h4><p>该请求的参数是镜像命名空间，layer将在该命名空间被链接。该请求的格式是：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">POST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">  /v2/[name]/blobs/uploads/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果返回202 Accepted 则表明请求成功，其HEADER携带了以下信息：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">202</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Accepted</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Location:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /v2/[name]/blobs/uploads/[uuid]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Range:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> bytes=0-[offset]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Content-Length:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Docker-Upload-UUID:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [uuid]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中Location 返回下一步镜像上传的地址,其API格式为/v2/[name]/blobs/uploads/[uuid] 如果本地客户端想和远程registry的上传状态相关联，可以使用Docker-Upload-UUID中的值。这个id可以作为上一次 location header 的key 来实现可恢复上传。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">POST</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /v2/hello-world/blobs/uploads/</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HTTP/1.1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Host:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> hub.vic.com</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">User-Agent:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> docker/17.12.0-ce</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> go/go1.9.2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git-commit/c97c6d6</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kernel/3.10.0-693.el7.x86</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,84)])])}const C=i(u,[["render",b]]),B=JSON.parse('{"path":"/note-book/Security/Docker%E7%9A%84Pull%E5%92%8CPush%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B.html","title":"Docker的Pull和Push接口调用流程","lang":"zh-CN","frontmatter":{"feed":false,"seo":false,"head":[]},"git":{"createdTime":1721668959000,"updatedTime":1735538930000,"contributors":[{"name":"Paper-Dragon","username":"Paper-Dragon","email":"2678885646@qq.com","commits":2,"url":"https://github.com/Paper-Dragon"},{"name":"PaperDragon-SH","username":"PaperDragon-SH","email":"2678885646@qq.com","commits":3,"url":"https://github.com/PaperDragon-SH"}],"changelog":[{"hash":"081468780aa520400d26727b845a6846742a29b1","time":1735538930000,"email":"2678885646@qq.com","author":"PaperDragon-SH","message":"fixed domain hub.icert.top"},{"hash":"c28e56d609a913f28105c711dc7540aae5922a55","time":1726163060000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"markdown format"},{"hash":"93a0a2be76570df3d9a0dda66f092c147b0dc320","time":1721887008000,"email":"2678885646@qq.com","author":"PaperDragon-SH","message":"fixed bug"},{"hash":"e515f3f80c9be5624fb5520273566b29ae24643e","time":1721876650000,"email":"2678885646@qq.com","author":"PaperDragon-SH","message":"renamed:    \\"src/note-book/Security/Docker\\\\347\\\\232\\\\204Push\\\\347\\\\232\\\\204\\\\346\\\\216\\\\245\\\\345\\\\217\\\\243\\\\350\\\\277\\\\207\\\\347\\\\250\\\\213\\\\351\\\\200\\\\206\\\\345\\\\220\\\\221.md\\" -> \\"src/note-book/Security/Docker\\\\347\\\\232\\\\204Pull\\\\345\\\\222\\\\214Push\\\\346\\\\216\\\\245\\\\345\\\\217\\\\243\\\\350\\\\260\\\\203\\\\347\\\\224\\\\250\\\\346\\\\265\\\\201\\\\347\\\\250\\\\213.md\\""},{"hash":"518db44614aab17f96556140e15518b6cac451ff","time":1721668959000,"email":"2678885646@qq.com","author":"Paper-Dragon","message":"Docker的Push的接口过程逆向"}]},"readingTime":{"minutes":10.93,"words":3280},"filePathRelative":"note-book/Security/Docker的Pull和Push接口调用流程.md"}');export{C as comp,B as data};
