import{g as Hl}from"./commonjsHelpers-CqkleIqs.js";function Vl(_e,_r){for(var xe=0;xe<_r.length;xe++){const ee=_r[xe];if(typeof ee!="string"&&!Array.isArray(ee)){for(const re in ee)if(re!=="default"&&!(re in _e)){const me=Object.getOwnPropertyDescriptor(ee,re);me&&Object.defineProperty(_e,re,me.get?me:{enumerable:!0,get:()=>ee[re]})}}}return Object.freeze(Object.defineProperty(_e,Symbol.toStringTag,{value:"Module"}))}var Wi={exports:{}},us;function Yl(){return us||(us=1,function(_e,_r){(function xe(ee){var re;re=function(){function me(s,n){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(s);n&&(e=e.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),t.push.apply(t,e)}return t}function yt(s){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?me(Object(t),!0).forEach(function(e){var r,i,a;r=s,i=e,a=t[e],(i=ji(i))in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):me(Object(t)).forEach(function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(t,e))})}return s}function ji(s){var n=function(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var i=r.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}(s,"string");return typeof n=="symbol"?n:String(n)}function qi(s,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(s,ji(e.key),e)}}function ct(s,n,t){return n&&qi(s.prototype,n),t&&qi(s,t),Object.defineProperty(s,"prototype",{writable:!1}),s}function gt(){return gt=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(s[e]=t[e])}return s},gt.apply(this,arguments)}function Lt(s,n){s.prototype=Object.create(n.prototype),s.prototype.constructor=s,Pe(s,n)}function xr(s){return xr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},xr(s)}function Pe(s,n){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pe(s,n)}function Pr(s,n,t){return Pr=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}()?Reflect.construct.bind():function(e,r,i){var a=[null];a.push.apply(a,r);var o=new(Function.bind.apply(e,a));return i&&Pe(o,i.prototype),o},Pr.apply(null,arguments)}function Fe(s){var n=typeof Map=="function"?new Map:void 0;return Fe=function(t){if(t===null||!function(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(n!==void 0){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return Pr(t,arguments,xr(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Pe(e,t)},Fe(s)}function Xi(s,n){(n==null||n>s.length)&&(n=s.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=s[t];return e}function ds(s,n){var t=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(t)return(t=t.call(s)).next.bind(t);if(Array.isArray(s)||(t=function(r,i){if(r){if(typeof r=="string")return Xi(r,i);var a=Object.prototype.toString.call(r).slice(8,-1);return a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set"?Array.from(r):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Xi(r,i):void 0}}(s))||n){t&&(s=t);var e=0;return function(){return e>=s.length?{done:!0}:{done:!1,value:s[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fs(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var zi={exports:{}};(function(s,n){var t,e,r,i,a;t=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,e=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(o,l,h){if(h=h||{},o=o.trim(),!(l=l.trim())){if(!h.alwaysNormalize)return o;var u=a.parseURL(o);if(!u)throw new Error("Error trying to parse base URL.");return u.path=a.normalizePath(u.path),a.buildURLFromParts(u)}var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return h.alwaysNormalize?(d.path=a.normalizePath(d.path),a.buildURLFromParts(d)):l;var f=a.parseURL(o);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var c=e.exec(f.path);f.netLoc=c[1],f.path=c[2]}f.netLoc&&!f.path&&(f.path="/");var v={scheme:f.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(v.netLoc=f.netLoc,d.path[0]!=="/"))if(d.path){var g=f.path,p=g.substring(0,g.lastIndexOf("/")+1)+d.path;v.path=a.normalizePath(p)}else v.path=f.path,d.params||(v.params=f.params,d.query||(v.query=f.query));return v.path===null&&(v.path=h.alwaysNormalize?a.normalizePath(d.path):d.path),a.buildURLFromParts(v)},parseURL:function(o){var l=t.exec(o);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(r,"");o.length!==(o=o.replace(i,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}},s.exports=a})(zi);var Fr=zi.exports,N=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},cs=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=gs},gs=Number.MAX_SAFE_INTEGER||9007199254740991,y=function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",s}({}),K=function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s}({}),I=function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.UNKNOWN="unknown",s}({}),ae=function(){},Mr={trace:ae,debug:ae,log:ae,warn:ae,info:ae,error:ae},Me=Mr;function vs(s){for(var n=arguments.length,t=new Array(n>1?n-1:0),e=1;e<n;e++)t[e-1]=arguments[e];t.forEach(function(r){Me[r]=s[r]?s[r].bind(s):function(i){var a=self.console[i];return a?a.bind(self.console,"["+i+"] >"):ae}(r)})}function Qi(s,n){if(typeof console=="object"&&s===!0||typeof s=="object"){vs(s,"debug","log","info","warn","error");try{Me.log('Debug logs enabled for "'+n+'" in hls.js version 1.5.20')}catch{Me=Mr}}else Me=Mr}var b=Me,ms=/^(\d+)x(\d+)$/,Ji=/(.+?)=(".*?"|.*?)(?:,|$)/g,dt=function(){function s(t){typeof t=="string"&&(t=s.parseAttrList(t)),gt(this,t)}var n=s.prototype;return n.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},n.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},n.decimalFloatingPoint=function(t){return parseFloat(this[t])},n.optionalFloat=function(t,e){var r=this[t];return r?parseFloat(r):e},n.enumeratedString=function(t){return this[t]},n.bool=function(t){return this[t]==="YES"},n.decimalResolution=function(t){var e=ms.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},s.parseAttrList=function(t){var e,r={};for(Ji.lastIndex=0;(e=Ji.exec(t))!==null;){var i=e[2];i.indexOf('"')===0&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1].trim()]=i}return r},ct(s,[{key:"clientAttrs",get:function(){return Object.keys(this).filter(function(t){return t.substring(0,2)==="X-"})}}]),s}();function ps(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"}var $i=function(){function s(n,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){var e=t.attr;for(var r in e)if(Object.prototype.hasOwnProperty.call(n,r)&&n[r]!==e[r]){b.warn('DATERANGE tag attribute: "'+r+'" does not match for tags with ID: "'+n.ID+'"'),this._badValueForSameId=r;break}n=gt(new dt({}),e,n)}if(this.attr=n,this._startDate=new Date(n["START-DATE"]),"END-DATE"in this.attr){var i=new Date(this.attr["END-DATE"]);N(i.getTime())&&(this._endDate=i)}}return ct(s,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var n=this.duration;return n!==null?new Date(this._startDate.getTime()+1e3*n):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var n=this.attr.decimalFloatingPoint("DURATION");if(N(n))return n}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&N(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),s}(),Qe=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},wt="audio",Pt="video",Or="audiovideo",Zi=function(){function s(n){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((t={})[wt]=null,t[Pt]=null,t[Or]=null,t),this.baseurl=n}return s.prototype.setByteRange=function(n,t){var e,r=n.split("@",2);e=r.length===1?(t==null?void 0:t.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[e,parseInt(r[0])+e]},ct(s,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Fr.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(n){this._url=n}}]),s}(),Nr=function(s){function n(e,r){var i;return(i=s.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new Qe,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.urlId=0,i.type=e,i}Lt(n,s);var t=n.prototype;return t.setKeyFormat=function(e){if(this.levelkeys){var r=this.levelkeys[e];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}},t.abortRequests=function(){var e,r;(e=this.loader)==null||e.abort(),(r=this.keyLoader)==null||r.abort()},t.setElementaryStreamInfo=function(e,r,i,a,o,l){l===void 0&&(l=!1);var h=this.elementaryStreams,u=h[e];u?(u.startPTS=Math.min(u.startPTS,r),u.endPTS=Math.max(u.endPTS,i),u.startDTS=Math.min(u.startDTS,a),u.endDTS=Math.max(u.endDTS,o)):h[e]={startPTS:r,endPTS:i,startDTS:a,endDTS:o,partial:l}},t.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[wt]=null,e[Pt]=null,e[Or]=null},ct(n,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!N(this.programDateTime))return null;var e=N(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}}]),n}(Zi),ys=function(s){function n(t,e,r,i,a){var o;(o=s.call(this,r)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new Qe,o.duration=t.decimalFloatingPoint("DURATION"),o.gap=t.bool("GAP"),o.independent=t.bool("INDEPENDENT"),o.relurl=t.enumeratedString("URI"),o.fragment=e,o.index=i;var l=t.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,a),a&&(o.fragOffset=a.fragOffset+a.duration),o}return Lt(n,s),ct(n,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),n}(Zi),Es=function(){function s(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=n}return s.prototype.reloaded=function(n){if(!n)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-n.lastPartSn,e=this.lastPartIndex-n.lastPartIndex;this.updated=this.endSN!==n.endSN||!!e||!!t||!this.live,this.advanced=this.endSN>n.endSN||t>0||t===0&&e>0,this.updated||this.advanced?this.misses=Math.floor(.6*n.misses):this.misses=n.misses+1,this.availabilityDelay=n.availabilityDelay},ct(s,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&N(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var n=this.driftEndTime-this.driftStartTime;return n>0?1e3*(this.driftEnd-this.driftStart)/n:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var n;return(n=this.fragments)!=null&&n.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var n;return(n=this.partList)!=null&&n.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),s}();function Ur(s){return Uint8Array.from(atob(s),function(n){return n.charCodeAt(0)})}function Ts(s){var n,t,e=s.split(":"),r=null;if(e[0]==="data"&&e.length===2){var i=e[1].split(";"),a=i[i.length-1].split(",");if(a.length===2){var o=a[0]==="base64",l=a[1];o?(i.splice(-1,1),r=Ur(l)):(n=Br(l).subarray(0,16),(t=new Uint8Array(16)).set(n,16-n.length),r=t)}}return r}function Br(s){return Uint8Array.from(unescape(encodeURIComponent(s)),function(n){return n.charCodeAt(0)})}var pe=typeof self<"u"?self:void 0,Z={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Gr="org.w3.clearkey",Kr="com.apple.streamingkeydelivery",Je="com.microsoft.playready",$e="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Hr(s){switch(s){case Kr:return Z.FAIRPLAY;case Je:return Z.PLAYREADY;case $e:return Z.WIDEVINE;case Gr:return Z.CLEARKEY}}var Ss="1077efecc0b24d02ace33c1e52e2fb4b",Ls="e2719d58a985b3c9781ab030af78d30e",As="9a04f07998404286ab92e65be0885f95",Rs="edef8ba979d64acea3c827dcd51d21ed";function Vr(s){return s===Rs?Z.WIDEVINE:s===As?Z.PLAYREADY:s===Ss||s===Ls?Z.CLEARKEY:void 0}function Yr(s){switch(s){case Z.FAIRPLAY:return Kr;case Z.PLAYREADY:return Je;case Z.WIDEVINE:return $e;case Z.CLEARKEY:return Gr}}function Ze(s){var n=s.drmSystems,t=s.widevineLicenseUrl,e=n?[Z.FAIRPLAY,Z.WIDEVINE,Z.PLAYREADY,Z.CLEARKEY].filter(function(r){return!!n[r]}):[];return!e[Z.WIDEVINE]&&t&&e.push(Z.WIDEVINE),e}var tn,en=pe!=null&&(tn=pe.navigator)!=null&&tn.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function rn(s){var n=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2),t=String.fromCharCode.apply(null,Array.from(n)),e=t.substring(t.indexOf("<"),t.length),r=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("KID")[0];if(r){var i=r.childNodes[0]?r.childNodes[0].nodeValue:r.getAttribute("VALUE");if(i){var a=Ur(i).subarray(0,16);return function(o){var l=function(h,u,d){var f=h[u];h[u]=h[d],h[d]=f};l(o,0,3),l(o,1,2),l(o,4,5),l(o,6,7)}(a),a}}return null}function se(s,n,t){return Uint8Array.prototype.slice?s.slice(n,t):new Uint8Array(Array.prototype.slice.call(s,n,t))}var Wr,jr=function(s,n){return n+10<=s.length&&s[n]===73&&s[n+1]===68&&s[n+2]===51&&s[n+3]<255&&s[n+4]<255&&s[n+6]<128&&s[n+7]<128&&s[n+8]<128&&s[n+9]<128},nn=function(s,n){return n+10<=s.length&&s[n]===51&&s[n+1]===68&&s[n+2]===73&&s[n+3]<255&&s[n+4]<255&&s[n+6]<128&&s[n+7]<128&&s[n+8]<128&&s[n+9]<128},Oe=function(s,n){for(var t=n,e=0;jr(s,n);)e+=10,e+=tr(s,n+6),nn(s,n+10)&&(e+=10),n+=e;if(e>0)return s.subarray(t,t+e)},tr=function(s,n){var t=0;return t=(127&s[n])<<21,t|=(127&s[n+1])<<14,t|=(127&s[n+2])<<7,t|=127&s[n+3]},bs=function(s,n){return jr(s,n)&&tr(s,n+6)+10<=s.length-n},qr=function(s){for(var n=sn(s),t=0;t<n.length;t++){var e=n[t];if(an(e))return _s(e)}},an=function(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"},ks=function(s){var n=String.fromCharCode(s[0],s[1],s[2],s[3]),t=tr(s,4);return{type:n,size:t,data:s.subarray(10,10+t)}},sn=function(s){for(var n=0,t=[];jr(s,n);){for(var e=tr(s,n+6),r=(n+=10)+e;n+8<r;){var i=ks(s.subarray(n)),a=Ds(i);a&&t.push(a),n+=i.size+10}nn(s,n)&&(n+=10)}return t},Ds=function(s){return s.type==="PRIV"?ws(s):s.type[0]==="W"?Cs(s):Is(s)},ws=function(s){if(!(s.size<2)){var n=Gt(s.data,!0),t=new Uint8Array(s.data.subarray(n.length+1));return{key:s.type,info:n,data:t.buffer}}},Is=function(s){if(!(s.size<2)){if(s.type==="TXXX"){var n=1,t=Gt(s.data.subarray(n),!0);n+=t.length+1;var e=Gt(s.data.subarray(n));return{key:s.type,info:t,data:e}}var r=Gt(s.data.subarray(1));return{key:s.type,data:r}}},Cs=function(s){if(s.type==="WXXX"){if(s.size<2)return;var n=1,t=Gt(s.data.subarray(n),!0);n+=t.length+1;var e=Gt(s.data.subarray(n));return{key:s.type,info:t,data:e}}var r=Gt(s.data);return{key:s.type,data:r}},_s=function(s){if(s.data.byteLength===8){var n=new Uint8Array(s.data),t=1&n[3],e=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return e/=45,t&&(e+=4772185884e-2),Math.round(e)}},Gt=function(s,n){n===void 0&&(n=!1);var t=xs();if(t){var e=t.decode(s);if(n){var r=e.indexOf("\0");return r!==-1?e.substring(0,r):e}return e.replace(/\0/g,"")}for(var i,a,o,l=s.length,h="",u=0;u<l;){if((i=s[u++])===0&&n)return h;if(i!==0&&i!==3)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h+=String.fromCharCode(i);break;case 12:case 13:a=s[u++],h+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=s[u++],o=s[u++],h+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&o)<<0)}}return h};function xs(){if(!navigator.userAgent.includes("PlayStation 4"))return Wr||self.TextDecoder===void 0||(Wr=new self.TextDecoder("utf-8")),Wr}var Kt={hexDump:function(s){for(var n="",t=0;t<s.length;t++){var e=s[t].toString(16);e.length<2&&(e="0"+e),n+=e}return n}},er=Math.pow(2,32)-1,Ps=[].push,on={video:1,audio:2,id3:3,text:4};function mt(s){return String.fromCharCode.apply(null,s)}function ln(s,n){var t=s[n]<<8|s[n+1];return t<0?65536+t:t}function H(s,n){var t=hn(s,n);return t<0?4294967296+t:t}function un(s,n){var t=H(s,n);return t*=Math.pow(2,32),t+=H(s,n+4)}function hn(s,n){return s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3]}function Xr(s,n,t){s[n]=t>>24,s[n+1]=t>>16&255,s[n+2]=t>>8&255,s[n+3]=255&t}function q(s,n){var t=[];if(!n.length)return t;for(var e=s.byteLength,r=0;r<e;){var i=H(s,r),a=i>1?r+i:e;if(mt(s.subarray(r+4,r+8))===n[0])if(n.length===1)t.push(s.subarray(r+8,a));else{var o=q(s.subarray(r+8,a),n.slice(1));o.length&&Ps.apply(t,o)}r=a}return t}function Fs(s){var n=[],t=s[0],e=8,r=H(s,e);e+=4;var i=0,a=0;t===0?(i=H(s,e),a=H(s,e+4),e+=8):(i=un(s,e),a=un(s,e+8),e+=16),e+=2;var o=s.length+a,l=ln(s,e);e+=2;for(var h=0;h<l;h++){var u=e,d=H(s,u);u+=4;var f=2147483647&d;if((2147483648&d)>>>31==1)return b.warn("SIDX has hierarchical references (not supported)"),null;var c=H(s,u);u+=4,n.push({referenceSize:f,subsegmentDuration:c,info:{duration:c/r,start:o,end:o+f-1}}),o+=f,e=u+=4}return{earliestPresentationTime:i,timescale:r,version:t,referencesCount:l,references:n}}function dn(s){for(var n=[],t=q(s,["moov","trak"]),e=0;e<t.length;e++){var r=t[e],i=q(r,["tkhd"])[0];if(i){var a=i[0],o=H(i,a===0?12:20),l=q(r,["mdia","mdhd"])[0];if(l){var h=H(l,(a=l[0])===0?12:20),u=q(r,["mdia","hdlr"])[0];if(u){var d=mt(u.subarray(8,12)),f={soun:wt,vide:Pt}[d];if(f){var c=Ms(q(r,["mdia","minf","stbl","stsd"])[0]);n[o]={timescale:h,type:f},n[f]=yt({timescale:h,id:o},c)}}}}}return q(s,["moov","mvex","trex"]).forEach(function(v){var g=H(v,4),p=n[g];p&&(p.default={duration:H(v,12),flags:H(v,20)})}),n}function Ms(s){var n=s.subarray(8),t=n.subarray(86),e=mt(n.subarray(4,8)),r=e,i=e==="enca"||e==="encv";if(i){var a=q(n,[e])[0];q(a.subarray(e==="enca"?28:78),["sinf"]).forEach(function(Y){var z=q(Y,["schm"])[0];if(z){var j=mt(z.subarray(4,8));if(j==="cbcs"||j==="cenc"){var it=q(Y,["frma"])[0];it&&(r=mt(it))}}})}switch(r){case"avc1":case"avc2":case"avc3":case"avc4":var o=q(t,["avcC"])[0];r+="."+rr(o[1])+rr(o[2])+rr(o[3]);break;case"mp4a":var l=q(n,[e])[0],h=q(l.subarray(28),["esds"])[0];if(h&&h.length>12){var u=4;if(h[u++]!==3)break;u=zr(h,u),u+=2;var d=h[u++];if(128&d&&(u+=2),64&d&&(u+=h[u++]),h[u++]!==4)break;u=zr(h,u);var f=h[u++];if(f!==64||(r+="."+rr(f),u+=12,h[u++]!==5))break;u=zr(h,u);var c=h[u++],v=(248&c)>>3;v===31&&(v+=1+((7&c)<<3)+((224&h[u])>>5)),r+="."+v}break;case"hvc1":case"hev1":var g=q(t,["hvcC"])[0],p=g[1],m=["","A","B","C"][p>>6],E=31&p,T=H(g,2),S=(32&p)>>5?"H":"L",R=g[12],A=g.subarray(6,12);r+="."+m+E,r+="."+T.toString(16).toUpperCase(),r+="."+S+R;for(var L="",w=A.length;w--;){var k=A[w];(k||L)&&(L="."+k.toString(16).toUpperCase()+L)}r+=L;break;case"dvh1":case"dvhe":var C=q(t,["dvcC"])[0],D=C[2]>>1&127,_=C[2]<<5&32|C[3]>>3&31;r+="."+Ht(D)+"."+Ht(_);break;case"vp09":var x=q(t,["vpcC"])[0],P=x[4],M=x[5],U=x[6]>>4&15;r+="."+Ht(P)+"."+Ht(M)+"."+Ht(U);break;case"av01":var F=q(t,["av1C"])[0],O=F[1]>>>5,B=31&F[1],G=F[2]>>>7?"H":"M",V=(64&F[2])>>6,Q=(32&F[2])>>5,ot=O===2&&V?Q?12:10:V?10:8,et=(16&F[2])>>4,ft=(8&F[2])>>3,st=(4&F[2])>>2,rt=3&F[2];r+="."+O+"."+Ht(B)+G+"."+Ht(ot)+"."+et+"."+ft+st+rt+"."+Ht(1)+"."+Ht(1)+"."+Ht(1)+".0"}return{codec:r,encrypted:i}}function zr(s,n){for(var t=n+5;128&s[n++]&&n<t;);return n}function rr(s){return("0"+s.toString(16).toUpperCase()).slice(-2)}function Ht(s){return(s<10?"0":"")+s}function fn(s){var n=q(s,["schm"])[0];if(n){var t=mt(n.subarray(4,8));if(t==="cbcs"||t==="cenc")return q(s,["schi","tenc"])[0]}return null}function Os(s){var n=H(s,0),t=8;1&n&&(t+=4),4&n&&(t+=4);for(var e=0,r=H(s,4),i=0;i<r;i++)256&n&&(e+=H(s,t),t+=4),512&n&&(t+=4),1024&n&&(t+=4),2048&n&&(t+=4);return e}function Ft(s,n){var t=new Uint8Array(s.length+n.length);return t.set(s),t.set(n,s.length),t}function cn(s,n){var t=[],e=n.samples,r=n.timescale,i=n.id,a=!1;return q(e,["moof"]).map(function(o){var l=o.byteOffset-8;q(o,["traf"]).map(function(h){var u=q(h,["tfdt"]).map(function(d){var f=d[0],c=H(d,4);return f===1&&(c*=Math.pow(2,32),c+=H(d,8)),c/r})[0];return u!==void 0&&(s=u),q(h,["tfhd"]).map(function(d){var f=H(d,4),c=16777215&H(d,0),v=0,g=(16&c)!=0,p=0,m=(32&c)!=0,E=8;f===i&&(1&c&&(E+=8),2&c&&(E+=4),8&c&&(v=H(d,E),E+=4),g&&(p=H(d,E),E+=4),m&&(E+=4),n.type==="video"&&(a=function(T){if(!T)return!1;var S=T.indexOf("."),R=S<0?T:T.substring(0,S);return R==="hvc1"||R==="hev1"||R==="dvh1"||R==="dvhe"}(n.codec)),q(h,["trun"]).map(function(T){var S=T[0],R=16777215&H(T,0),A=(1&R)!=0,L=0,w=(4&R)!=0,k=(256&R)!=0,C=0,D=(512&R)!=0,_=0,x=(1024&R)!=0,P=(2048&R)!=0,M=0,U=H(T,4),F=8;A&&(L=H(T,F),F+=4),w&&(F+=4);for(var O=L+l,B=0;B<U;B++){if(k?(C=H(T,F),F+=4):C=v,D?(_=H(T,F),F+=4):_=p,x&&(F+=4),P&&(M=S===0?H(T,F):hn(T,F),F+=4),n.type===Pt)for(var G=0;G<_;){var V=H(e,O);Ns(a,e[O+=4])&&gn(e.subarray(O,O+V),a?2:1,s+M/r,t),O+=V,G+=V+4}s+=C/r}}))})})}),t}function Ns(s,n){if(s){var t=n>>1&63;return t===39||t===40}return(31&n)==6}function gn(s,n,t,e){var r=vn(s),i=0;i+=n;for(var a=0,o=0,l=0;i<r.length;){a=0;do{if(i>=r.length)break;a+=l=r[i++]}while(l===255);o=0;do{if(i>=r.length)break;o+=l=r[i++]}while(l===255);var h=r.length-i,u=i;if(o<h)i+=o;else if(o>h){b.error("Malformed SEI payload. "+o+" is too small, only "+h+" bytes left to parse.");break}if(a===4){if(r[u++]===181){var d=ln(r,u);if(u+=2,d===49){var f=H(r,u);if(u+=4,f===1195456820){var c=r[u++];if(c===3){var v=r[u++],g=64&v,p=g?2+3*(31&v):0,m=new Uint8Array(p);if(g){m[0]=v;for(var E=1;E<p;E++)m[E]=r[u++]}e.push({type:c,payloadType:a,pts:t,bytes:m})}}}}}else if(a===5&&o>16){for(var T=[],S=0;S<16;S++){var R=r[u++].toString(16);T.push(R.length==1?"0"+R:R),S!==3&&S!==5&&S!==7&&S!==9||T.push("-")}for(var A=o-16,L=new Uint8Array(A),w=0;w<A;w++)L[w]=r[u++];e.push({payloadType:a,pts:t,uuid:T.join(""),userData:Gt(L),userDataBytes:L})}}}function vn(s){for(var n=s.byteLength,t=[],e=1;e<n-2;)s[e]===0&&s[e+1]===0&&s[e+2]===3?(t.push(e+2),e+=2):e++;if(t.length===0)return s;var r=n-t.length,i=new Uint8Array(r),a=0;for(e=0;e<r;a++,e++)a===t[0]&&(a++,t.shift()),i[e]=s[a];return i}function Us(s,n,t){if(s.byteLength!==16)throw new RangeError("Invalid system id");var e,r,i;e=0,r=new Uint8Array,e>0?(i=new Uint8Array(4),n.length>0&&new DataView(i.buffer).setUint32(0,n.length,!1)):i=new Uint8Array;var a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),function(o){for(var l=arguments.length,h=new Array(l>1?l-1:0),u=1;u<l;u++)h[u-1]=arguments[u];for(var d=h.length,f=8,c=d;c--;)f+=h[c].byteLength;var v=new Uint8Array(f);for(v[0]=f>>24&255,v[1]=f>>16&255,v[2]=f>>8&255,v[3]=255&f,v.set(o,4),c=0,f=8;c<d;c++)v.set(h[c],f),f+=h[c].byteLength;return v}([112,115,115,104],new Uint8Array([e,0,0,0]),s,i,r,a,t||new Uint8Array)}function Bs(s){var n=s.getUint32(0),t=s.byteOffset,e=s.byteLength;if(e<n)return{offset:t,size:e};if(s.getUint32(4)!==1886614376)return{offset:t,size:n};var r=s.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:n};var i=s.buffer,a=Kt.hexDump(new Uint8Array(i,t+12,16)),o=s.getUint32(28),l=null,h=null;if(r===0){if(n-32<o||o<22)return{offset:t,size:n};h=new Uint8Array(i,t+32,o)}else if(r===1){if(!o||e<t+32+16*o+16)return{offset:t,size:n};l=[];for(var u=0;u<o;u++)l.push(new Uint8Array(i,t+32+16*u,16))}return{version:r,systemId:a,kids:l,data:h,offset:t,size:n}}var ir={},Qr=function(){function s(t,e,r,i,a){i===void 0&&(i=[1]),a===void 0&&(a=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=r,this.keyFormatVersions=i,this.iv=a,this.encrypted=!!t&&t!=="NONE",this.isCommonEncryption=this.encrypted&&t!=="AES-128"}s.clearKeyUriToKeyIdMap=function(){ir={}};var n=s.prototype;return n.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Kr:case $e:case Je:case Gr:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},n.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof t!="number"&&(this.method!=="AES-128"||this.iv||b.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var e=function(u){for(var d=new Uint8Array(16),f=12;f<16;f++)d[f]=u>>8*(15-f)&255;return d}(t);return new s(this.method,this.uri,"identity",this.keyFormatVersions,e)}var r=Ts(this.uri);if(r)switch(this.keyFormat){case $e:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case Je:var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Us(i,null,r),this.keyId=rn(r);break;default:var a=r.subarray(0,16);if(a.length!==16){var o=new Uint8Array(16);o.set(a,16-a.length),a=o}this.keyId=a}if(!this.keyId||this.keyId.byteLength!==16){var l=ir[this.uri];if(!l){var h=Object.keys(ir).length%Number.MAX_SAFE_INTEGER;l=new Uint8Array(16),new DataView(l.buffer,12,4).setUint32(0,h),ir[this.uri]=l}this.keyId=l}return this},s}(),mn=/\{\$([a-zA-Z0-9-_]+)\}/g;function pn(s){return mn.test(s)}function It(s,n,t){if(s.variableList!==null||s.hasVariableRefs)for(var e=t.length;e--;){var r=t[e],i=n[r];i&&(n[r]=Jr(s,i))}}function Jr(s,n){if(s.variableList!==null||s.hasVariableRefs){var t=s.variableList;return n.replace(mn,function(e){var r=e.substring(2,e.length-1),i=t==null?void 0:t[r];return i===void 0?(s.playlistParsingError||(s.playlistParsingError=new Error('Missing preceding EXT-X-DEFINE tag for Variable Reference: "'+r+'"')),e):i})}return n}function yn(s,n,t){var e,r,i=s.variableList;if(i||(s.variableList=i={}),"QUERYPARAM"in n){e=n.QUERYPARAM;try{var a=new self.URL(t).searchParams;if(!a.has(e))throw new Error('"'+e+'" does not match any query parameter in URI: "'+t+'"');r=a.get(e)}catch(o){s.playlistParsingError||(s.playlistParsingError=new Error("EXT-X-DEFINE QUERYPARAM: "+o.message))}}else e=n.NAME,r=n.VALUE;e in i?s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE duplicate Variable Name declarations: "'+e+'"')):i[e]=r||""}function Gs(s,n,t){var e=n.IMPORT;if(t&&e in t){var r=s.variableList;r||(s.variableList=r={}),r[e]=t[e]}else s.playlistParsingError||(s.playlistParsingError=new Error('EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'+e+'"'))}function oe(s){if(s===void 0&&(s=!0),typeof self<"u")return(s||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}var nr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function $r(s,n,t){return t===void 0&&(t=!0),!s.split(",").some(function(e){return!En(e,n,t)})}function En(s,n,t){var e;t===void 0&&(t=!0);var r=oe(t);return(e=r==null?void 0:r.isTypeSupported(Ne(s,n)))!=null&&e}function Ne(s,n){return n+'/mp4;codecs="'+s+'"'}function Tn(s){if(s){var n=s.substring(0,4);return nr.video[n]}return 2}function ar(s){return s.split(",").reduce(function(n,t){var e=nr.video[t];return e?(2*e+n)/(n?3:2):(nr.audio[t]+n)/(n?2:1)},0)}var Zr={},Ks=/flac|opus/i;function sr(s,n){return n===void 0&&(n=!0),s.replace(Ks,function(t){return function(e,r){if(r===void 0&&(r=!0),Zr[e])return Zr[e];for(var i={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e],a=0;a<i.length;a++)if(En(i[a],"audio",r))return Zr[e]=i[a],i[a];return e}(t.toLowerCase(),n)})}function Sn(s,n){return s&&s!=="mp4a"?s:n&&n.split(",")[0]}var Ln=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,An=/#EXT-X-MEDIA:(.*)/g,Hs=/^#EXT(?:INF|-X-TARGETDURATION):/m,Rn=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Vs=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Ue=function(){function s(){}return s.findGroup=function(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(r.id===t)return r}},s.resolve=function(n,t){return Fr.buildAbsoluteURL(t,n,{alwaysNormalize:!0})},s.isMediaPlaylist=function(n){return Hs.test(n)},s.parseMasterPlaylist=function(n,t){var e,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:pn(n)},i=[];for(Ln.lastIndex=0;(e=Ln.exec(n))!=null;)if(e[1]){var a,o=new dt(e[1]);It(r,o,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);var l=Jr(r,e[2]),h={attrs:o,bitrate:o.decimalInteger("BANDWIDTH")||o.decimalInteger("AVERAGE-BANDWIDTH"),name:o.NAME,url:s.resolve(l,t)},u=o.decimalResolution("RESOLUTION");u&&(h.width=u.width,h.height=u.height),Ys(o.CODECS,h),(a=h.unknownCodecs)!=null&&a.length||i.push(h),r.levels.push(h)}else if(e[3]){var d=e[3],f=e[4];switch(d){case"SESSION-DATA":var c=new dt(f);It(r,c,["DATA-ID","LANGUAGE","VALUE","URI"]);var v=c["DATA-ID"];v&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[v]=c);break;case"SESSION-KEY":var g=bn(f,t,r);g.encrypted&&g.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(g)):b.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+f+'"');break;case"DEFINE":var p=new dt(f);It(r,p,["NAME","VALUE","QUERYPARAM"]),yn(r,p,t);break;case"CONTENT-STEERING":var m=new dt(f);It(r,m,["SERVER-URI","PATHWAY-ID"]),r.contentSteering={uri:s.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=kn(f)}}var E=i.length>0&&i.length<r.levels.length;return r.levels=E?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},s.parseMasterPlaylistMedia=function(n,t,e){var r,i={},a=e.levels,o={AUDIO:a.map(function(S){return{id:S.attrs.AUDIO,audioCodec:S.audioCodec}}),SUBTITLES:a.map(function(S){return{id:S.attrs.SUBTITLES,textCodec:S.textCodec}}),"CLOSED-CAPTIONS":[]},l=0;for(An.lastIndex=0;(r=An.exec(n))!==null;){var h=new dt(r[1]),u=h.TYPE;if(u){var d=o[u],f=i[u]||[];i[u]=f,It(e,h,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);var c=h.LANGUAGE,v=h["ASSOC-LANGUAGE"],g=h.CHANNELS,p=h.CHARACTERISTICS,m=h["INSTREAM-ID"],E={attrs:h,bitrate:0,id:l++,groupId:h["GROUP-ID"]||"",name:h.NAME||c||"",type:u,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:c,url:h.URI?s.resolve(h.URI,t):""};if(v&&(E.assocLang=v),g&&(E.channels=g),p&&(E.characteristics=p),m&&(E.instreamId=m),d!=null&&d.length){var T=s.findGroup(d,E.groupId)||d[0];Dn(E,T,"audioCodec"),Dn(E,T,"textCodec")}f.push(E)}}return i},s.parseLevelPlaylist=function(n,t,e,r,i,a){var o,l,h,u=new Es(t),d=u.fragments,f=null,c=0,v=0,g=0,p=0,m=null,E=new Nr(r,t),T=-1,S=!1,R=null;for(Rn.lastIndex=0,u.m3u8=n,u.hasVariableRefs=pn(n);(o=Rn.exec(n))!==null;){S&&(S=!1,(E=new Nr(r,t)).start=g,E.sn=c,E.cc=p,E.level=e,f&&(E.initSegment=f,E.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null,R&&(E.setByteRange(R),R=null)));var A=o[1];if(A){E.duration=parseFloat(A);var L=(" "+o[2]).slice(1);E.title=L||null,E.tagList.push(L?["INF",A,L]:["INF",A])}else if(o[3]){if(N(E.duration)){E.start=g,h&&Cn(E,h,u),E.sn=c,E.level=e,E.cc=p,d.push(E);var w=(" "+o[3]).slice(1);E.relurl=Jr(u,w),wn(E,m),m=E,g+=E.duration,c++,v=0,S=!0}}else if(o[4]){var k=(" "+o[4]).slice(1);m?E.setByteRange(k,m):E.setByteRange(k)}else if(o[5])E.rawProgramDateTime=(" "+o[5]).slice(1),E.tagList.push(["PROGRAM-DATE-TIME",E.rawProgramDateTime]),T===-1&&(T=d.length);else{if(!(o=o[0].match(Vs))){b.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<o.length&&o[l]===void 0;l++);var C=(" "+o[l]).slice(1),D=(" "+o[l+1]).slice(1),_=o[l+2]?(" "+o[l+2]).slice(1):"";switch(C){case"PLAYLIST-TYPE":u.type=D.toUpperCase();break;case"MEDIA-SEQUENCE":c=u.startSN=parseInt(D);break;case"SKIP":var x=new dt(D);It(u,x,["RECENTLY-REMOVED-DATERANGES"]);var P=x.decimalInteger("SKIPPED-SEGMENTS");if(N(P)){u.skippedSegments=P;for(var M=P;M--;)d.unshift(null);c+=P}var U=x.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(u.recentlyRemovedDateranges=U.split("	"));break;case"TARGETDURATION":u.targetduration=Math.max(parseInt(D),1);break;case"VERSION":u.version=parseInt(D);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"#":(D||_)&&E.tagList.push(_?[D,_]:[D]);break;case"DISCONTINUITY":p++,E.tagList.push(["DIS"]);break;case"GAP":E.gap=!0,E.tagList.push([C]);break;case"BITRATE":E.tagList.push([C,D]);break;case"DATERANGE":var F=new dt(D);It(u,F,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),It(u,F,F.clientAttrs);var O=new $i(F,u.dateRanges[F.ID]);O.isValid||u.skippedSegments?u.dateRanges[O.id]=O:b.warn('Ignoring invalid DATERANGE tag: "'+D+'"'),E.tagList.push(["EXT-X-DATERANGE",D]);break;case"DEFINE":var B=new dt(D);It(u,B,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in B?Gs(u,B,a):yn(u,B,t);break;case"DISCONTINUITY-SEQUENCE":p=parseInt(D);break;case"KEY":var G=bn(D,t,u);if(G.isSupported()){if(G.method==="NONE"){h=void 0;break}h||(h={}),h[G.keyFormat]&&(h=gt({},h)),h[G.keyFormat]=G}else b.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+D+'"');break;case"START":u.startTimeOffset=kn(D);break;case"MAP":var V=new dt(D);if(It(u,V,["BYTERANGE","URI"]),E.duration){var Q=new Nr(r,t);In(Q,V,e,h),f=Q,E.initSegment=f,f.rawProgramDateTime&&!E.rawProgramDateTime&&(E.rawProgramDateTime=f.rawProgramDateTime)}else{var ot=E.byteRangeEndOffset;if(ot){var et=E.byteRangeStartOffset;R=ot-et+"@"+et}else R=null;In(E,V,e,h),f=E,S=!0}break;case"SERVER-CONTROL":var ft=new dt(D);u.canBlockReload=ft.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=ft.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&ft.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=ft.optionalFloat("PART-HOLD-BACK",0),u.holdBack=ft.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var st=new dt(D);u.partTarget=st.decimalFloatingPoint("PART-TARGET");break;case"PART":var rt=u.partList;rt||(rt=u.partList=[]);var Y=v>0?rt[rt.length-1]:void 0,z=v++,j=new dt(D);It(u,j,["BYTERANGE","URI"]);var it=new ys(j,E,t,z,Y);rt.push(it),E.duration+=it.duration;break;case"PRELOAD-HINT":var W=new dt(D);It(u,W,["URI"]),u.preloadHint=W;break;case"RENDITION-REPORT":var at=new dt(D);It(u,at,["URI"]),u.renditionReports=u.renditionReports||[],u.renditionReports.push(at);break;default:b.warn("line parsed but not handled: "+o)}}}m&&!m.relurl?(d.pop(),g-=m.duration,u.partList&&(u.fragmentHint=m)):u.partList&&(wn(E,m),E.cc=p,u.fragmentHint=E,h&&Cn(E,h,u));var J=d.length,Dt=d[0],bt=d[J-1];if((g+=u.skippedSegments*u.targetduration)>0&&J&&bt){u.averagetargetduration=g/J;var $=bt.sn;u.endSN=$!=="initSegment"?$:0,u.live||(bt.endList=!0),Dt&&(u.startCC=Dt.cc)}else u.endSN=0,u.startCC=0;return u.fragmentHint&&(g+=u.fragmentHint.duration),u.totalduration=g,u.endCC=p,T>0&&function(ht,vt){for(var kt=ht[vt],_t=vt;_t--;){var Et=ht[_t];if(!Et)return;Et.programDateTime=kt.programDateTime-1e3*Et.duration,kt=Et}}(d,T),u},s}();function bn(s,n,t){var e,r,i=new dt(s);It(t,i,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);var a=(e=i.METHOD)!=null?e:"",o=i.URI,l=i.hexadecimalInteger("IV"),h=i.KEYFORMATVERSIONS,u=(r=i.KEYFORMAT)!=null?r:"identity";o&&i.IV&&!l&&b.error("Invalid IV: "+i.IV);var d=o?Ue.resolve(o,n):"",f=(h||"1").split("/").map(Number).filter(Number.isFinite);return new Qr(a,d,u,f,l)}function kn(s){var n=new dt(s).decimalFloatingPoint("TIME-OFFSET");return N(n)?n:null}function Ys(s,n){var t=(s||"").split(/[ ,]+/).filter(function(e){return e});["video","audio","text"].forEach(function(e){var r=t.filter(function(i){return function(a,o){var l=nr[o];return!!l&&!!l[a.slice(0,4)]}(i,e)});r.length&&(n[e+"Codec"]=r.join(","),t=t.filter(function(i){return r.indexOf(i)===-1}))}),n.unknownCodecs=t}function Dn(s,n,t){var e=n[t];e&&(s[t]=e)}function wn(s,n){s.rawProgramDateTime?s.programDateTime=Date.parse(s.rawProgramDateTime):n!=null&&n.programDateTime&&(s.programDateTime=n.endProgramDateTime),N(s.programDateTime)||(s.programDateTime=null,s.rawProgramDateTime=null)}function In(s,n,t,e){s.relurl=n.URI,n.BYTERANGE&&s.setByteRange(n.BYTERANGE),s.level=t,s.sn="initSegment",e&&(s.levelkeys=e),s.initSegment=null}function Cn(s,n,t){s.levelkeys=n;var e=t.encryptedFragments;e.length&&e[e.length-1].levelkeys===n||!Object.keys(n).some(function(r){return n[r].isCommonEncryption})||e.push(s)}var ye="manifest",le="level",Bt="audioTrack",Vt="subtitleTrack",tt="main",Mt="audio",qt="subtitle";function _n(s){switch(s.type){case Bt:return Mt;case Vt:return qt;default:return tt}}function ti(s,n){var t=s.url;return t!==void 0&&t.indexOf("data:")!==0||(t=n.url),t}var Ws=function(){function s(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=t,this.registerListeners()}var n=s.prototype;return n.startLoad=function(t){},n.stopLoad=function(){this.destroyInternalLoaders()},n.registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.LEVEL_LOADING,this.onLevelLoading,this),t.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.unregisterListeners=function(){var t=this.hls;t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.LEVEL_LOADING,this.onLevelLoading,this),t.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},n.createInternalLoader=function(t){var e=this.hls.config,r=e.pLoader,i=e.loader,a=new(r||i)(e);return this.loaders[t.type]=a,a},n.getInternalLoader=function(t){return this.loaders[t.type]},n.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},n.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},n.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},n.onManifestLoading=function(t,e){var r=e.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ye,url:r,deliveryDirectives:null})},n.onLevelLoading=function(t,e){var r=e.id,i=e.level,a=e.pathwayId,o=e.url,l=e.deliveryDirectives;this.load({id:r,level:i,pathwayId:a,responseType:"text",type:le,url:o,deliveryDirectives:l})},n.onAudioTrackLoading=function(t,e){var r=e.id,i=e.groupId,a=e.url,o=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:Bt,url:a,deliveryDirectives:o})},n.onSubtitleTrackLoading=function(t,e){var r=e.id,i=e.groupId,a=e.url,o=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:Vt,url:a,deliveryDirectives:o})},n.load=function(t){var e,r,i,a=this,o=this.hls.config,l=this.getInternalLoader(t);if(l){var h=l.context;if(h&&h.url===t.url&&h.level===t.level)return void b.trace("[playlist-loader]: playlist request ongoing");b.log("[playlist-loader]: aborting previous loader for type: "+t.type),l.abort()}if(r=t.type===ye?o.manifestLoadPolicy.default:gt({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),l=this.createInternalLoader(t),N((e=t.deliveryDirectives)==null?void 0:e.part)&&(t.type===le&&t.level!==null?i=this.hls.levels[t.level].details:t.type===Bt&&t.id!==null?i=this.hls.audioTracks[t.id].details:t.type===Vt&&t.id!==null&&(i=this.hls.subtitleTracks[t.id].details),i)){var u=i.partTarget,d=i.targetduration;if(u&&d){var f=1e3*Math.max(3*u,.8*d);r=gt({},r,{maxTimeToFirstByteMs:Math.min(f,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,r.maxTimeToFirstByteMs)})}}var c=r.errorRetry||r.timeoutRetry||{},v={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},g={onSuccess:function(p,m,E,T){var S=a.getInternalLoader(E);a.resetInternalLoader(E.type);var R=p.data;R.indexOf("#EXTM3U")===0?(m.parsing.start=performance.now(),Ue.isMediaPlaylist(R)?a.handleTrackOrLevelPlaylist(p,m,E,T||null,S):a.handleMasterPlaylist(p,m,E,T)):a.handleManifestParsingError(p,E,new Error("no EXTM3U delimiter"),T||null,m)},onError:function(p,m,E,T){a.handleNetworkError(m,E,!1,p,T)},onTimeout:function(p,m,E){a.handleNetworkError(m,E,!0,void 0,p)}};l.load(t,v,g)},n.handleMasterPlaylist=function(t,e,r,i){var a=this.hls,o=t.data,l=ti(t,r),h=Ue.parseMasterPlaylist(o,l);if(h.playlistParsingError)this.handleManifestParsingError(t,r,h.playlistParsingError,i,e);else{var u=h.contentSteering,d=h.levels,f=h.sessionData,c=h.sessionKeys,v=h.startTimeOffset,g=h.variableList;this.variableList=g;var p=Ue.parseMasterPlaylistMedia(o,l,h),m=p.AUDIO,E=m===void 0?[]:m,T=p.SUBTITLES,S=p["CLOSED-CAPTIONS"];E.length&&(E.some(function(R){return!R.url})||!d[0].audioCodec||d[0].attrs.AUDIO||(b.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new dt({}),bitrate:0,url:""}))),a.trigger(y.MANIFEST_LOADED,{levels:d,audioTracks:E,subtitles:T,captions:S,contentSteering:u,url:l,stats:e,networkDetails:i,sessionData:f,sessionKeys:c,startTimeOffset:v,variableList:g})}},n.handleTrackOrLevelPlaylist=function(t,e,r,i,a){var o=this.hls,l=r.id,h=r.level,u=r.type,d=ti(t,r),f=N(h)?h:N(l)?l:0,c=_n(r),v=Ue.parseLevelPlaylist(t.data,d,f,c,0,this.variableList);if(u===ye){var g={attrs:new dt({}),bitrate:0,details:v,name:"",url:d};o.trigger(y.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:d,stats:e,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),r.levelDetails=v,this.handlePlaylistLoaded(v,t,e,r,i,a)},n.handleManifestParsingError=function(t,e,r,i,a){this.hls.trigger(y.ERROR,{type:K.NETWORK_ERROR,details:I.MANIFEST_PARSING_ERROR,fatal:e.type===ye,url:t.url,err:r,error:r,reason:r.message,response:t,context:e,networkDetails:i,stats:a})},n.handleNetworkError=function(t,e,r,i,a){r===void 0&&(r=!1);var o="A network "+(r?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+t.type;t.type===le?o+=": "+t.level+" id: "+t.id:t.type!==Bt&&t.type!==Vt||(o+=" id: "+t.id+' group-id: "'+t.groupId+'"');var l=new Error(o);b.warn("[playlist-loader]: "+o);var h=I.UNKNOWN,u=!1,d=this.getInternalLoader(t);switch(t.type){case ye:h=r?I.MANIFEST_LOAD_TIMEOUT:I.MANIFEST_LOAD_ERROR,u=!0;break;case le:h=r?I.LEVEL_LOAD_TIMEOUT:I.LEVEL_LOAD_ERROR,u=!1;break;case Bt:h=r?I.AUDIO_TRACK_LOAD_TIMEOUT:I.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Vt:h=r?I.SUBTITLE_TRACK_LOAD_TIMEOUT:I.SUBTITLE_LOAD_ERROR,u=!1}d&&this.resetInternalLoader(t.type);var f={type:K.NETWORK_ERROR,details:h,fatal:u,url:t.url,loader:d,context:t,error:l,networkDetails:e,stats:a};if(i){var c=(e==null?void 0:e.url)||t.url;f.response=yt({url:c,data:void 0},i)}this.hls.trigger(y.ERROR,f)},n.handlePlaylistLoaded=function(t,e,r,i,a,o){var l=this.hls,h=i.type,u=i.level,d=i.id,f=i.groupId,c=i.deliveryDirectives,v=ti(e,i),g=_n(i),p=typeof i.level=="number"&&g===tt?u:void 0;if(t.fragments.length){t.targetduration||(t.playlistParsingError=new Error("Missing Target Duration"));var m=t.playlistParsingError;if(m)l.trigger(y.ERROR,{type:K.NETWORK_ERROR,details:I.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:m,reason:m.message,response:e,context:i,level:p,parent:g,networkDetails:a,stats:r});else switch(t.live&&o&&(o.getCacheAge&&(t.ageHeader=o.getCacheAge()||0),o.getCacheAge&&!isNaN(t.ageHeader)||(t.ageHeader=0)),h){case ye:case le:l.trigger(y.LEVEL_LOADED,{details:t,level:p||0,id:d||0,stats:r,networkDetails:a,deliveryDirectives:c});break;case Bt:l.trigger(y.AUDIO_TRACK_LOADED,{details:t,id:d||0,groupId:f||"",stats:r,networkDetails:a,deliveryDirectives:c});break;case Vt:l.trigger(y.SUBTITLE_TRACK_LOADED,{details:t,id:d||0,groupId:f||"",stats:r,networkDetails:a,deliveryDirectives:c})}}else{var E=new Error("No Segments found in Playlist");l.trigger(y.ERROR,{type:K.NETWORK_ERROR,details:I.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:E,reason:E.message,response:e,context:i,level:p,parent:g,networkDetails:a,stats:r})}},s}();function xn(s,n){var t;try{t=new Event("addtrack")}catch{(t=document.createEvent("Event")).initEvent("addtrack",!1,!1)}t.track=s,n.dispatchEvent(t)}function Pn(s,n){var t=s.mode;if(t==="disabled"&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(n.id))try{if(s.addCue(n),!s.cues.getCueById(n.id))throw new Error("addCue is failed for: "+n)}catch(r){b.debug("[texttrack-utils]: "+r);try{var e=new self.TextTrackCue(n.startTime,n.endTime,n.text);e.id=n.id,s.addCue(e)}catch(i){b.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: "+i)}}t==="disabled"&&(s.mode=t)}function Ee(s){var n=s.mode;if(n==="disabled"&&(s.mode="hidden"),s.cues)for(var t=s.cues.length;t--;)s.removeCue(s.cues[t]);n==="disabled"&&(s.mode=n)}function ei(s,n,t,e){var r=s.mode;if(r==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var i=function(o,l,h){var u=[],d=function(g,p){if(p<g[0].startTime)return 0;var m=g.length-1;if(p>g[m].endTime)return-1;for(var E=0,T=m;E<=T;){var S=Math.floor((T+E)/2);if(p<g[S].startTime)T=S-1;else{if(!(p>g[S].startTime&&E<m))return S;E=S+1}}return g[E].startTime-p<p-g[T].startTime?E:T}(o,l);if(d>-1)for(var f=d,c=o.length;f<c;f++){var v=o[f];if(v.startTime>=l&&v.endTime<=h)u.push(v);else if(v.startTime>h)return u}return u}(s.cues,n,t),a=0;a<i.length;a++)e&&!e(i[a])||s.removeCue(i[a]);r==="disabled"&&(s.mode=r)}function or(s){for(var n=[],t=0;t<s.length;t++){var e=s[t];e.kind!=="subtitles"&&e.kind!=="captions"||!e.label||n.push(s[t])}return n}var Be="org.id3",js="com.apple.quicktime.HLS",Ge="https://aomedia.org/emsg/ID3";function ri(){if(typeof self<"u")return self.VTTCue||self.TextTrackCue}function Fn(s,n,t,e,r){var i=new s(n,t,"");try{i.value=e,r&&(i.type=r)}catch{i=new s(n,t,JSON.stringify(r?yt({type:r},e):e))}return i}var lr=function(){var s=ri();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function ii(s,n){return s.getTime()/1e3-n}var qs=function(){function s(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var n=s.prototype;return n.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},n._registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)},n._unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.LEVEL_UPDATED,this.onLevelUpdated,this)},n.onMediaAttached=function(t,e){this.media=e.media},n.onMediaDetaching=function(){this.id3Track&&(Ee(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},n.onManifestLoading=function(){this.dateRangeCuesAppended={}},n.createTrack=function(t){var e=this.getID3Track(t.textTracks);return e.mode="hidden",e},n.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var r=t[e];if(r.kind==="metadata"&&r.label==="id3")return xn(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},n.onFragParsingMetadata=function(t,e){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,a=r.enableID3MetadataCues;if(i||a){var o=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var l=ri();if(l)for(var h=0;h<o.length;h++){var u=o[h].type;if((u!==Ge||i)&&a){var d=sn(o[h].data);if(d){var f=o[h].pts,c=f+o[h].duration;c>lr&&(c=lr),c-f<=0&&(c=f+.25);for(var v=0;v<d.length;v++){var g=d[v];if(!an(g)){this.updateId3CueEnds(f,u);var p=Fn(l,f,c,g,u);p&&this.id3Track.addCue(p)}}}}}}}},n.updateId3CueEnds=function(t,e){var r,i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(var a=i.length;a--;){var o=i[a];o.type===e&&o.startTime<t&&o.endTime===lr&&(o.endTime=t)}},n.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,a=e.type,o=this.id3Track,l=this.hls;if(l){var h=l.config,u=h.enableEmsgMetadataCues,d=h.enableID3MetadataCues;o&&(u||d)&&ei(o,r,i,a==="audio"?function(f){return f.type===Be&&d}:a==="video"?function(f){return f.type===Ge&&u}:function(f){return f.type===Be&&d||f.type===Ge&&u})}},n.onLevelUpdated=function(t,e){var r=this,i=e.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,o=this.id3Track,l=i.dateRanges,h=Object.keys(l);if(o)for(var u=Object.keys(a).filter(function(E){return!h.includes(E)}),d=function(){var E=u[f];Object.keys(a[E].cues).forEach(function(T){o.removeCue(a[E].cues[T])}),delete a[E]},f=u.length;f--;)d();var c=i.fragments[i.fragments.length-1];if(h.length!==0&&N(c==null?void 0:c.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var v=c.programDateTime/1e3-c.start,g=ri(),p=function(){var E=h[m],T=l[E],S=ii(T.startDate,v),R=a[E],A=(R==null?void 0:R.cues)||{},L=(R==null?void 0:R.durationKnown)||!1,w=lr,k=T.endDate;if(k)w=ii(k,v),L=!0;else if(T.endOnNext&&!L){var C=h.reduce(function(B,G){if(G!==T.id){var V=l[G];if(V.class===T.class&&V.startDate>T.startDate&&(!B||T.startDate<B.startDate))return V}return B},null);C&&(w=ii(C.startDate,v),L=!0)}for(var D,_,x=Object.keys(T.attr),P=0;P<x.length;P++){var M=x[P];if((_=M)!=="ID"&&_!=="CLASS"&&_!=="START-DATE"&&_!=="DURATION"&&_!=="END-DATE"&&_!=="END-ON-NEXT"){var U=A[M];if(U)L&&!R.durationKnown&&(U.endTime=w);else if(g){var F=T.attr[M];ps(M)&&(D=F,F=Uint8Array.from(D.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);var O=Fn(g,S,w,{key:M,data:F},js);O&&(O.id=E,r.id3Track.addCue(O),A[M]=O)}}}a[E]={cues:A,dateRange:T,durationKnown:L}},m=0;m<h.length;m++)p()}}},s}(),Xs=function(){function s(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var n=s.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(y.ERROR,this.onError,this)},n.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},n.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},n.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},n.onLevelUpdated=function(t,e){var r=e.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},n.onError=function(t,e){var r;e.details===I.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&b.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},n.timeupdate=function(){var t=this.media,e=this.levelDetails;if(t&&e){this.currentTime=t.currentTime;var r=this.computeLatency();if(r!==null){this._latency=r;var i=this.config,a=i.lowLatencyMode,o=i.maxLiveSyncPlaybackRate;if(a&&o!==1&&e.live){var l=this.targetLatency;if(l!==null){var h=r-l;if(h<Math.min(this.maxLatency,l+e.targetduration)&&h>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,o)),d=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;t.playbackRate=Math.min(u,Math.max(1,d))}else t.playbackRate!==1&&t.playbackRate!==0&&(t.playbackRate=1)}}}}},n.estimateLiveEdge=function(){var t=this.levelDetails;return t===null?null:t.edge+t.age},n.computeLatency=function(){var t=this.estimateLiveEdge();return t===null?null:t-this.currentTime},ct(s,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(t===null)return null;var e=t.holdBack,r=t.partHoldBack,i=t.targetduration,a=this.config,o=a.liveSyncDuration,l=a.liveSyncDurationCount,h=a.lowLatencyMode,u=this.hls.userConfig,d=h&&r||e;(u.liveSyncDuration||u.liveSyncDurationCount||d===0)&&(d=o!==void 0?o:l*i);var f=i;return d+Math.min(1*this.stallCount,f)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,r=this.levelDetails;if(t===null||e===null||r===null)return null;var i=r.edge,a=t-e-this.edgeStalled,o=i-r.totalduration,l=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,a),l)}},{key:"drift",get:function(){var t=this.levelDetails;return t===null?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(t===null)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return(r?t.buffered.end(r-1):e.edge)-this.currentTime}}]),s}(),ni=["NONE","TYPE-0","TYPE-1",null],ur=["SDR","PQ","HLG"],Mn="",zs="YES",Qs="v2";function On(s){var n=s.canSkipUntil,t=s.canSkipDateRanges,e=s.age;return n&&e<n/2?t?Qs:zs:Mn}var Nn=function(){function s(n,t,e){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=n,this.part=t,this.skip=e}return s.prototype.addDirectives=function(n){var t=new self.URL(n);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},s}(),Te=function(){function s(t){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(function(e){return!!e}).map(function(e){return e.substring(0,4)}).join(","),this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}var n=s.prototype;return n.hasAudioGroup=function(t){return Un(this._audioGroups,t)},n.hasSubtitleGroup=function(t){return Un(this._subtitleGroups,t)},n.addGroupId=function(t,e){if(e){if(t==="audio"){var r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(e)===-1&&r.push(e)}else if(t==="text"){var i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(e)===-1&&i.push(e)}}},n.addFallback=function(){},ct(s,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"averageBitrate",get:function(){return this._avgBitrate||this.realBitrate||this.bitrate}},{key:"attrs",get:function(){return this._attrs[0]}},{key:"codecs",get:function(){return this.attrs.CODECS||""}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"videoRange",get:function(){return this.attrs["VIDEO-RANGE"]||"SDR"}},{key:"score",get:function(){return this.attrs.optionalFloat("SCORE",0)}},{key:"uri",get:function(){return this.url[0]||""}},{key:"audioGroups",get:function(){return this._audioGroups}},{key:"subtitleGroups",get:function(){return this._subtitleGroups}},{key:"urlId",get:function(){return 0},set:function(t){}},{key:"audioGroupIds",get:function(){return this.audioGroups?[this.audioGroupId]:void 0}},{key:"textGroupIds",get:function(){return this.subtitleGroups?[this.textGroupId]:void 0}},{key:"audioGroupId",get:function(){var t;return(t=this.audioGroups)==null?void 0:t[0]}},{key:"textGroupId",get:function(){var t;return(t=this.subtitleGroups)==null?void 0:t[0]}}]),s}();function Un(s,n){return!(!n||!s)&&s.indexOf(n)!==-1}function ai(s,n){var t=n.startPTS;if(N(t)){var e,r=0;n.sn>s.sn?(r=t-s.start,e=s):(r=s.start-t,e=n),e.duration!==r&&(e.duration=r)}else n.sn>s.sn?s.cc===n.cc&&s.minEndPTS?n.start=s.start+(s.minEndPTS-s.start):n.start=s.start+s.duration:n.start=Math.max(s.start-n.duration,0)}function Bn(s,n,t,e,r,i){e-t<=0&&(b.warn("Fragment should have a positive duration",n),e=t+n.duration,i=r+n.duration);var a=t,o=e,l=n.startPTS,h=n.endPTS;if(N(l)){var u=Math.abs(l-t);N(n.deltaPTS)?n.deltaPTS=Math.max(u,n.deltaPTS):n.deltaPTS=u,a=Math.max(t,l),t=Math.min(t,l),r=Math.min(r,n.startDTS),o=Math.min(e,h),e=Math.max(e,h),i=Math.max(i,n.endDTS)}var d=t-n.start;n.start!==0&&(n.start=t),n.duration=e-n.start,n.startPTS=t,n.maxStartPTS=a,n.startDTS=r,n.endPTS=e,n.minEndPTS=o,n.endDTS=i;var f,c=n.sn;if(!s||c<s.startSN||c>s.endSN)return 0;var v=c-s.startSN,g=s.fragments;for(g[v]=n,f=v;f>0;f--)ai(g[f],g[f-1]);for(f=v;f<g.length-1;f++)ai(g[f],g[f+1]);return s.fragmentHint&&ai(g[g.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,d}function Js(s,n){for(var t,e=null,r=s.fragments,i=r.length-1;i>=0;i--){var a=r[i].initSegment;if(a){e=a;break}}s.fragmentHint&&delete s.fragmentHint.endPTS,function(g,p,m){for(var E=p.skippedSegments,T=Math.max(g.startSN,p.startSN)-p.startSN,S=(g.fragmentHint?1:0)+(E?p.endSN:Math.min(g.endSN,p.endSN))-p.startSN,R=p.startSN-g.startSN,A=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,L=g.fragmentHint?g.fragments.concat(g.fragmentHint):g.fragments,w=T;w<=S;w++){var k=L[R+w],C=A[w];E&&!C&&w<E&&(C=p.fragments[w]=k),k&&C&&m(k,C,w,A)}}(s,n,function(g,p,m,E){if(n.skippedSegments&&p.cc!==g.cc)for(var T=g.cc-p.cc,S=m;S<E.length;S++)E[S].cc+=T;N(g.startPTS)&&N(g.endPTS)&&(p.start=p.startPTS=g.startPTS,p.startDTS=g.startDTS,p.maxStartPTS=g.maxStartPTS,p.endPTS=g.endPTS,p.endDTS=g.endDTS,p.minEndPTS=g.minEndPTS,p.duration=g.endPTS-g.startPTS,p.duration&&(t=p),n.PTSKnown=n.alignedSliding=!0),p.elementaryStreams=g.elementaryStreams,p.loader=g.loader,p.stats=g.stats,g.initSegment&&(p.initSegment=g.initSegment,e=g.initSegment)});var o,l,h,u,d=n.fragments;if(e&&(n.fragmentHint?d.concat(n.fragmentHint):d).forEach(function(g){var p;!g||g.initSegment&&g.initSegment.relurl!==((p=e)==null?void 0:p.relurl)||(g.initSegment=e)}),n.skippedSegments){if(n.deltaUpdateFailed=d.some(function(g){return!g}),n.deltaUpdateFailed){b.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var f=n.skippedSegments;f--;)d.shift();n.startSN=d[0].sn}else n.canSkipDateRanges&&(n.dateRanges=(o=s.dateRanges,l=n.dateRanges,h=n.recentlyRemovedDateranges,u=gt({},o),h&&h.forEach(function(g){delete u[g]}),Object.keys(l).forEach(function(g){var p=new $i(l[g].attr,u[g]);p.isValid?u[g]=p:b.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(l[g].attr)+'"')}),u));n.startCC=n.fragments[0].cc,n.endCC=d[d.length-1].cc}(function(g,p,m){if(g&&p)for(var E=0,T=0,S=g.length;T<=S;T++){var R=g[T],A=p[T+E];R&&A&&R.index===A.index&&R.fragment.sn===A.fragment.sn?m(R,A):E--}})(s.partList,n.partList,function(g,p){p.elementaryStreams=g.elementaryStreams,p.stats=g.stats}),t?Bn(n,t,t.startPTS,t.endPTS,t.startDTS,t.endDTS):Gn(s,n),d.length&&(n.totalduration=n.edge-d[0].start),n.driftStartTime=s.driftStartTime,n.driftStart=s.driftStart;var c=n.advancedDateTime;if(n.advanced&&c){var v=n.edge;n.driftStart||(n.driftStartTime=c,n.driftStart=v),n.driftEndTime=c,n.driftEnd=v}else n.driftEndTime=s.driftEndTime,n.driftEnd=s.driftEnd,n.advancedDateTime=s.advancedDateTime}function Gn(s,n){var t=n.startSN+n.skippedSegments-s.startSN,e=s.fragments;t<0||t>=e.length||si(n,e[t].start)}function si(s,n){if(n){for(var t=s.fragments,e=s.skippedSegments;e<t.length;e++)t[e].start+=n;s.fragmentHint&&(s.fragmentHint.start+=n)}}function Kn(s,n,t){var e;return s!=null&&s.details?Hn((e=s.details)==null?void 0:e.partList,n,t):null}function Hn(s,n,t){if(s)for(var e=s.length;e--;){var r=s[e];if(r.index===t&&r.fragment.sn===n)return r}return null}function Vn(s){s.forEach(function(n,t){var e=n.details;e!=null&&e.fragments&&e.fragments.forEach(function(r){r.level=t})})}function hr(s){switch(s.details){case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_TIMEOUT:case I.LEVEL_LOAD_TIMEOUT:case I.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Yn(s,n){var t=hr(n);return s.default[(t?"timeout":"error")+"Retry"]}function oi(s,n){var t=s.backoff==="linear"?1:Math.pow(2,n);return Math.min(t*s.retryDelayMs,s.maxRetryDelayMs)}function Wn(s){return yt(yt({},s),{errorRetry:null,timeoutRetry:null})}function dr(s,n,t,e){if(!s)return!1;var r=e==null?void 0:e.code,i=n<s.maxNumRetry&&(function(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}(r)||!!t);return s.shouldRetry?s.shouldRetry(s,n,t,e,i):i}var jn=function(s,n){for(var t=0,e=s.length-1,r=null,i=null;t<=e;){var a=n(i=s[r=(t+e)/2|0]);if(a>0)t=r+1;else{if(!(a<0))return i;e=r-1}}return null};function fr(s,n,t,e,r){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=.005);var i=null;if(s){i=n[s.sn-n[0].sn+1]||null;var a=s.endDTS-t;a>0&&a<15e-7&&(t+=15e-7)}else t===0&&n[0].start===0&&(i=n[0]);if(i&&((!s||s.level===i.level)&&li(t,e,i)===0||function(l,h,u){if(h&&h.start===0&&h.level<l.level&&(h.endPTS||0)>0){var d=h.tagList.reduce(function(f,c){return c[0]==="INF"&&(f+=parseFloat(c[1])),f},u);return l.start<=d}return!1}(i,s,Math.min(r,e))))return i;var o=jn(n,li.bind(null,t,e));return!o||o===s&&i?i:o}function li(s,n,t){if(s===void 0&&(s=0),n===void 0&&(n=0),t.start<=s&&t.start+t.duration>s)return 0;var e=Math.min(n,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-e<=s?1:t.start-e>s&&t.start?-1:0}function $s(s,n,t){var e=1e3*Math.min(n,t.duration+(t.deltaPTS?t.deltaPTS:0));return(t.endProgramDateTime||0)-e>s}var ui=0,Xt=2,Zs=3,cr=5,Se=0,hi=1,qn=2,to=function(){function s(t){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=t,this.log=b.log.bind(b,"[info]:"),this.warn=b.warn.bind(b,"[warning]:"),this.error=b.error.bind(b,"[error]:"),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var t=this.hls;t.on(y.ERROR,this.onError,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)},n.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.ERROR,this.onError,this),t.off(y.ERROR,this.onErrorOut,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))},n.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},n.startLoad=function(t){},n.stopLoad=function(){this.playlistError=0},n.getVariantLevelIndex=function(t){return(t==null?void 0:t.type)===tt?t.level:this.hls.loadLevel},n.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},n.onLevelUpdated=function(){this.playlistError=0},n.onError=function(t,e){var r,i;if(!e.fatal){var a=this.hls,o=e.context;switch(e.details){case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:return void(e.errorAction=this.getFragRetryOrSwitchAction(e));case I.FRAG_PARSING_ERROR:if((r=e.frag)!=null&&r.gap)return void(e.errorAction={action:ui,flags:Se});case I.FRAG_GAP:case I.FRAG_DECRYPT_ERROR:return e.errorAction=this.getFragRetryOrSwitchAction(e),void(e.errorAction.action=Xt);case I.LEVEL_EMPTY_ERROR:case I.LEVEL_PARSING_ERROR:var l,h,u=e.parent===tt?e.level:a.loadLevel;return void(e.details===I.LEVEL_EMPTY_ERROR&&(l=e.context)!=null&&(h=l.levelDetails)!=null&&h.live?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,u):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,u)));case I.LEVEL_LOAD_ERROR:case I.LEVEL_LOAD_TIMEOUT:return void(typeof(o==null?void 0:o.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,o.level)));case I.AUDIO_TRACK_LOAD_ERROR:case I.AUDIO_TRACK_LOAD_TIMEOUT:case I.SUBTITLE_LOAD_ERROR:case I.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){var d=a.levels[a.loadLevel];if(d&&(o.type===Bt&&d.hasAudioGroup(o.groupId)||o.type===Vt&&d.hasSubtitleGroup(o.groupId)))return e.errorAction=this.getPlaylistRetryOrSwitchAction(e,a.loadLevel),e.errorAction.action=Xt,void(e.errorAction.flags=hi)}return;case I.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var f=a.levels[a.loadLevel],c=f==null?void 0:f.attrs["HDCP-LEVEL"];return void(c?e.errorAction={action:Xt,flags:qn,hdcpLevel:c}:this.keySystemError(e));case I.BUFFER_ADD_CODEC_ERROR:case I.REMUX_ALLOC_ERROR:case I.BUFFER_APPEND_ERROR:return void(e.errorAction=this.getLevelSwitchAction(e,(i=e.level)!=null?i:a.loadLevel));case I.INTERNAL_EXCEPTION:case I.BUFFER_APPENDING_ERROR:case I.BUFFER_FULL_ERROR:case I.LEVEL_SWITCH_ERROR:case I.BUFFER_STALLED_ERROR:case I.BUFFER_SEEK_OVER_HOLE:case I.BUFFER_NUDGE_ON_STALL:return void(e.errorAction={action:ui,flags:Se})}e.type===K.KEY_SYSTEM_ERROR&&this.keySystemError(e)}},n.keySystemError=function(t){var e=this.getVariantLevelIndex(t.frag);t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e)},n.getPlaylistRetryOrSwitchAction=function(t,e){var r=Yn(this.hls.config.playlistLoadPolicy,t),i=this.playlistError++;if(dr(r,i,hr(t),t.response))return{action:cr,flags:Se,retryConfig:r,retryCount:i};var a=this.getLevelSwitchAction(t,e);return r&&(a.retryConfig=r,a.retryCount=i),a},n.getFragRetryOrSwitchAction=function(t){var e=this.hls,r=this.getVariantLevelIndex(t.frag),i=e.levels[r],a=e.config,o=a.fragLoadPolicy,l=a.keyLoadPolicy,h=Yn(t.details.startsWith("key")?l:o,t),u=e.levels.reduce(function(f,c){return f+c.fragmentError},0);if(i&&(t.details!==I.FRAG_GAP&&i.fragmentError++,dr(h,u,hr(t),t.response)))return{action:cr,flags:Se,retryConfig:h,retryCount:u};var d=this.getLevelSwitchAction(t,r);return h&&(d.retryConfig=h,d.retryCount=u),d},n.getLevelSwitchAction=function(t,e){var r=this.hls;e==null&&(e=r.loadLevel);var i=this.hls.levels[e];if(i){var a,o,l=t.details;i.loadError++,l===I.BUFFER_APPEND_ERROR&&i.fragmentError++;var h=-1,u=r.levels,d=r.loadLevel,f=r.minAutoLevel,c=r.maxAutoLevel;r.autoLevelEnabled||(r.loadLevel=-1);for(var v,g=(a=t.frag)==null?void 0:a.type,p=(g===Mt&&l===I.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(l===I.BUFFER_ADD_CODEC_ERROR||l===I.BUFFER_APPEND_ERROR))&&u.some(function(L){var w=L.audioCodec;return i.audioCodec!==w}),m=t.sourceBufferName==="video"&&(l===I.BUFFER_ADD_CODEC_ERROR||l===I.BUFFER_APPEND_ERROR)&&u.some(function(L){var w=L.codecSet,k=L.audioCodec;return i.codecSet!==w&&i.audioCodec===k}),E=(o=t.context)!=null?o:{},T=E.type,S=E.groupId,R=function(){var L=(A+d)%u.length;if(L!==d&&L>=f&&L<=c&&u[L].loadError===0){var w,k,C=u[L];if(l===I.FRAG_GAP&&g===tt&&t.frag){var D=u[L].details;if(D){var _=fr(t.frag,D.fragments,t.frag.start);if(_!=null&&_.gap)return 0}}else if(T===Bt&&C.hasAudioGroup(S)||T===Vt&&C.hasSubtitleGroup(S)||g===Mt&&(w=i.audioGroups)!=null&&w.some(function(x){return C.hasAudioGroup(x)})||g===qt&&(k=i.subtitleGroups)!=null&&k.some(function(x){return C.hasSubtitleGroup(x)})||p&&i.audioCodec===C.audioCodec||!p&&i.audioCodec!==C.audioCodec||m&&i.codecSet===C.codecSet)return 0;return h=L,1}},A=u.length;A--&&((v=R())===0||v!==1););if(h>-1&&r.loadLevel!==h)return t.levelRetry=!0,this.playlistError=0,{action:Xt,flags:Se,nextAutoLevel:h}}return{action:Xt,flags:hi}},n.onErrorOut=function(t,e){var r;switch((r=e.errorAction)==null?void 0:r.action){case ui:break;case Xt:this.sendAlternateToPenaltyBox(e),e.errorAction.resolved||e.details===I.FRAG_GAP?/MediaSource readyState: ended/.test(e.error.message)&&(this.warn('MediaSource ended after "'+e.sourceBufferName+'" sourceBuffer append error. Attempting to recover from media error.'),this.hls.recoverMediaError()):e.fatal=!0}e.fatal&&this.hls.stopLoad()},n.sendAlternateToPenaltyBox=function(t){var e=this.hls,r=t.errorAction;if(r){var i=r.flags,a=r.hdcpLevel,o=r.nextAutoLevel;switch(i){case Se:this.switchLevel(t,o);break;case qn:a&&(e.maxHdcpLevel=ni[ni.indexOf(a)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+e.maxHdcpLevel+'" or lower')}r.resolved||this.switchLevel(t,o)}},n.switchLevel=function(t,e){e!==void 0&&t.errorAction&&(this.warn("switching to level "+e+" after "+t.details),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},s}(),di=function(){function s(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=b.log.bind(b,e+":"),this.warn=b.warn.bind(b,e+":"),this.hls=t}var n=s.prototype;return n.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},n.clearTimer=function(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)},n.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},n.stopLoad=function(){this.canLoad=!1,this.clearTimer()},n.switchParams=function(t,e,r){var i=e==null?void 0:e.renditionReports;if(i){for(var a=-1,o=0;o<i.length;o++){var l=i[o],h=void 0;try{h=new self.URL(l.URI,e.url).href}catch(g){b.warn("Could not construct new URL for Rendition Report: "+g),h=l.URI||""}if(h===t){a=o;break}h===t.substring(0,h.length)&&(a=o)}if(a!==-1){var u=i[a],d=parseInt(u["LAST-MSN"])||(e==null?void 0:e.lastPartSn),f=parseInt(u["LAST-PART"])||(e==null?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){var c=Math.min(e.age-e.partTarget,e.targetduration);f>=0&&c>e.partTarget&&(f+=1)}var v=r&&On(r);return new Nn(d,f>=0?f:void 0,v)}}},n.loadPlaylist=function(t){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},n.shouldLoadPlaylist=function(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)},n.shouldReloadPlaylist=function(t){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(t)},n.playlistLoaded=function(t,e,r){var i=this,a=e.details,o=e.stats,l=self.performance.now(),h=o.loading.first?Math.max(0,l-o.loading.first):0;if(a.advancedDateTime=Date.now()-h,a.live||r!=null&&r.live){if(a.reloaded(r),r&&this.log("live playlist "+t+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:a.updated?"UPDATED":"MISSED")),r&&a.fragments.length>0&&Js(r,a),!this.canLoad||!a.live)return;var u,d=void 0,f=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var c=this.hls.config.lowLatencyMode,v=a.lastPartSn,g=a.endSN,p=a.lastPartIndex,m=v===g;p!==-1?(d=m?g+1:v,f=m?c?0:p:p+1):d=g+1;var E=a.age,T=E+a.ageHeader,S=Math.min(T-a.partTarget,1.5*a.targetduration);if(S>0){if(r&&S>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+S+" with playlist age: "+a.age),S=0;else{var R=Math.floor(S/a.targetduration);d+=R,f!==void 0&&(f+=Math.round(S%a.targetduration/a.partTarget)),this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+E.toFixed(2)+"s goal: "+S+" skip sn "+R+" to part "+f)}a.tuneInGoal=S}if(u=this.getDeliveryDirectives(a,e.deliveryDirectives,d,f),c||!m)return void this.loadPlaylist(u)}else(a.canBlockReload||a.canSkipUntil)&&(u=this.getDeliveryDirectives(a,e.deliveryDirectives,d,f));var A=this.hls.mainForwardBufferInfo,L=A?A.end-A.len:0,w=function(C,D){D===void 0&&(D=1/0);var _=1e3*C.targetduration;if(C.updated){var x=C.fragments;if(x.length&&4*_>D){var P=1e3*x[x.length-1].duration;P<_&&(_=P)}}else _/=2;return Math.round(_)}(a,1e3*(a.edge-L));a.updated&&l>this.requestScheduled+w&&(this.requestScheduled=o.loading.start),d!==void 0&&a.canBlockReload?this.requestScheduled=o.loading.first+w-(1e3*a.partTarget||1e3):this.requestScheduled===-1||this.requestScheduled+w<l?this.requestScheduled=l:this.requestScheduled-l<=0&&(this.requestScheduled+=w);var k=this.requestScheduled-l;k=Math.max(0,k),this.log("reload live playlist "+t+" in "+Math.round(k)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(u)},k)}else this.clearTimer()},n.getDeliveryDirectives=function(t,e,r,i){var a=On(t);return e!=null&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,i=e.part,a=Mn),new Nn(r,i,a)},n.checkRetry=function(t){var e=this,r=t.details,i=hr(t),a=t.errorAction,o=a||{},l=o.action,h=o.retryCount,u=h===void 0?0:h,d=o.retryConfig,f=!!a&&!!d&&(l===cr||!a.resolved&&l===Xt);if(f){var c;if(this.requestScheduled=-1,u>=d.maxNumRetry)return!1;if(i&&(c=t.context)!=null&&c.deliveryDirectives)this.warn("Retrying playlist loading "+(u+1)+"/"+d.maxNumRetry+' after "'+r+'" without delivery-directives'),this.loadPlaylist();else{var v=oi(d,u);this.timer=self.setTimeout(function(){return e.loadPlaylist()},v),this.warn("Retrying playlist loading "+(u+1)+"/"+d.maxNumRetry+' after "'+r+'" in '+v+"ms")}t.levelRetry=!0,a.resolved=!0}return f},s}(),Le=function(){function s(t,e,r){e===void 0&&(e=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}var n=s.prototype;return n.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},n.getTotalWeight=function(){return this.totalWeight_},n.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},s}(),eo=function(){function s(t,e,r,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Le(t),this.fast_=new Le(e),this.defaultTTFB_=i,this.ttfb_=new Le(t)}var n=s.prototype;return n.update=function(t,e){var r=this.slow_,i=this.fast_,a=this.ttfb_;r.halfLife!==t&&(this.slow_=new Le(t,r.getEstimate(),r.getTotalWeight())),i.halfLife!==e&&(this.fast_=new Le(e,i.getEstimate(),i.getTotalWeight())),a.halfLife!==t&&(this.ttfb_=new Le(t,a.getEstimate(),a.getTotalWeight()))},n.sample=function(t,e){var r=(t=Math.max(t,this.minDelayMs_))/1e3,i=8*e/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},n.sampleTTFB=function(t){var e=t/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(r,Math.max(t,5))},n.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},n.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},n.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},n.destroy=function(){},s}(),Xn={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},zn={};function ro(s,n,t){var e=s.videoCodec,r=s.audioCodec;if(!e||!r||!t)return Promise.resolve(Xn);var i={width:s.width,height:s.height,bitrate:Math.ceil(Math.max(.9*s.bitrate,s.averageBitrate)),framerate:s.frameRate||30},a=s.videoRange;a!=="SDR"&&(i.transferFunction=a.toLowerCase());var o=e.split(",").map(function(l){return{type:"media-source",video:yt(yt({},i),{},{contentType:Ne(l,"video")})}});return r&&s.audioGroups&&s.audioGroups.forEach(function(l){var h;l&&((h=n.groups[l])==null||h.tracks.forEach(function(u){if(u.groupId===l){var d=u.channels||"",f=parseFloat(d);N(f)&&f>2&&o.push.apply(o,r.split(",").map(function(c){return{type:"media-source",audio:{contentType:Ne(c,"audio"),channels:""+f}}}))}}))}),Promise.all(o.map(function(l){var h=function(u){var d=u.audio,f=u.video,c=f||d;if(c){var v=c.contentType.split('"')[1];if(f)return"r"+f.height+"x"+f.width+"f"+Math.ceil(f.framerate)+(f.transferFunction||"sd")+"_"+v+"_"+Math.ceil(f.bitrate/1e5);if(d)return"c"+d.channels+(d.spatialRendering?"s":"n")+"_"+v}return""}(l);return zn[h]||(zn[h]=t.decodingInfo(l))})).then(function(l){return{supported:!l.some(function(h){return!h.supported}),configurations:o,decodingInfoResults:l}}).catch(function(l){return{supported:!1,configurations:o,decodingInfoResults:[],error:l}})}function io(s,n){var t=!1,e=[];return s&&(t=s!=="SDR",e=[s]),n&&(e=n.allowedVideoRanges||ur.slice(0),e=(t=n.preferHDR!==void 0?n.preferHDR:function(){if(typeof matchMedia=="function"){var r=matchMedia("(dynamic-range: high)"),i=matchMedia("bad query");if(r.media!==i.media)return r.matches===!0}return!1}())?e.filter(function(r){return r!=="SDR"}):["SDR"]),{preferHDR:t,allowedVideoRanges:e}}function zt(s,n){b.log('[abr] start candidates with "'+s+'" ignored because '+n)}function Yt(s,n,t){if("attrs"in s){var e=n.indexOf(s);if(e!==-1)return e}for(var r=0;r<n.length;r++)if(ue(s,n[r],t))return r;return-1}function ue(s,n,t){var e=s.groupId,r=s.name,i=s.lang,a=s.assocLang,o=s.default,l=s.forced;return(e===void 0||n.groupId===e)&&(r===void 0||n.name===r)&&(i===void 0||n.lang===i)&&(i===void 0||n.assocLang===a)&&(o===void 0||n.default===o)&&(l===void 0||n.forced===l)&&(!("characteristics"in s)||function(h,u){u===void 0&&(u="");var d=h.split(","),f=u.split(",");return d.length===f.length&&!d.some(function(c){return f.indexOf(c)===-1})}(s.characteristics||"",n.characteristics))&&(t===void 0||t(s,n))}function he(s,n){var t=s.audioCodec,e=s.channels;return!(t!==void 0&&(n.audioCodec||"").substring(0,4)!==t.substring(0,4)||e!==void 0&&e!==(n.channels||"2"))}function Qn(s,n,t){for(var e=n;e>-1;e--)if(t(s[e]))return e;for(var r=n+1;r<s.length;r++)if(t(s[r]))return r;return-1}var no=function(){function s(t){var e=this;this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=function(){var r=e.fragCurrent,i=e.partCurrent,a=e.hls,o=a.autoLevelEnabled,l=a.media;if(r&&l){var h=performance.now(),u=i?i.stats:r.stats,d=i?i.duration:r.duration,f=h-u.loading.start,c=a.minAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||r.level<=c)return e.clearTimer(),void(e._nextAutoLevel=-1);if(o&&!l.paused&&l.playbackRate&&l.readyState){var v=a.mainForwardBufferInfo;if(v!==null){var g=e.bwEstimator.getEstimateTTFB(),p=Math.abs(l.playbackRate);if(!(f<=Math.max(g,d/(2*p)*1e3))){var m=v.len/p,E=u.loading.first?u.loading.first-u.loading.start:-1,T=u.loaded&&E>-1,S=e.getBwEstimate(),R=a.levels,A=R[r.level],L=u.total||Math.max(u.loaded,Math.round(d*A.averageBitrate/8)),w=T?f-E:f;w<1&&T&&(w=Math.min(f,8*u.loaded/S));var k=T?1e3*u.loaded/w:0,C=k?(L-u.loaded)/k:8*L/S+g/1e3;if(!(C<=m)){var D,_=k?8*k:S,x=Number.POSITIVE_INFINITY;for(D=r.level-1;D>c;D--){var P=R[D].maxBitrate;if((x=e.getTimeToLoadFrag(g/1e3,_,d*P,!R[D].details))<m)break}if(!(x>=C||x>10*d)){a.nextLoadLevel=a.nextAutoLevel=D,T?e.bwEstimator.sample(f-Math.min(g,E),u.loaded):e.bwEstimator.sampleTTFB(f);var M=R[D].maxBitrate;e.getBwEstimate()*e.hls.config.abrBandWidthUpFactor>M&&e.resetEstimator(M),e.clearTimer(),b.warn("[abr] Fragment "+r.sn+(i?" part "+i.index:"")+" of level "+r.level+` is loading too slowly;
      Time to underbuffer: `+m.toFixed(3)+` s
      Estimated load time for current fragment: `+C.toFixed(3)+` s
      Estimated load time for down switch fragment: `+x.toFixed(3)+` s
      TTFB estimate: `+(0|E)+` ms
      Current BW estimate: `+(N(S)?0|S:"Unknown")+` bps
      New BW estimate: `+(0|e.getBwEstimate())+` bps
      Switching to level `+D+" @ "+(0|M)+" bps"),a.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:i,stats:u})}}}}}}},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}var n=s.prototype;return n.resetEstimator=function(t){t&&(b.log("setting initial bwe to "+t),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()},n.initEstimator=function(){var t=this.hls.config;return new eo(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)},n.registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.FRAG_LOADING,this.onFragLoading,this),t.on(y.FRAG_LOADED,this.onFragLoaded,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this),t.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(y.LEVEL_LOADED,this.onLevelLoaded,this),t.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.FRAG_LOADING,this.onFragLoading,this),t.off(y.FRAG_LOADED,this.onFragLoaded,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this),t.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(y.LEVEL_LOADED,this.onLevelLoaded,this),t.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(y.ERROR,this.onError,this))},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null},n.onManifestLoading=function(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()},n.onLevelsUpdated=function(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null},n.onMaxAutoLevelUpdated=function(){this.firstSelection=-1,this.nextAutoLevelKey=""},n.onFragLoading=function(t,e){var r,i=e.frag;this.ignoreFragment(i)||(i.bitrateTest||(this.fragCurrent=i,this.partCurrent=(r=e.part)!=null?r:null),this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100))},n.onLevelSwitching=function(t,e){this.clearTimer()},n.onError=function(t,e){if(!e.fatal)switch(e.details){case I.BUFFER_ADD_CODEC_ERROR:case I.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case I.FRAG_LOAD_TIMEOUT:var r=e.frag,i=this.fragCurrent,a=this.partCurrent;if(r&&i&&r.sn===i.sn&&r.level===i.level){var o=performance.now(),l=a?a.stats:r.stats,h=o-l.loading.start,u=l.loading.first?l.loading.first-l.loading.start:-1;if(l.loaded&&u>-1){var d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(d,u),l.loaded)}else this.bwEstimator.sampleTTFB(h)}}},n.getTimeToLoadFrag=function(t,e,r,i){return t+r/e+(i?this.lastLevelLoadSec:0)},n.onLevelLoaded=function(t,e){var r=this.hls.config,i=e.stats.loading,a=i.end-i.start;N(a)&&(this.lastLevelLoadSec=a/1e3),e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},n.onFragLoaded=function(t,e){var r=e.frag,i=e.part,a=i?i.stats:r.stats;if(r.type===tt&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),r.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){var o=i?i.duration:r.duration,l=this.hls.levels[r.level],h=(l.loaded?l.loaded.bytes:0)+a.loaded,u=(l.loaded?l.loaded.duration:0)+o;l.loaded={bytes:h,duration:u},l.realBitrate=Math.round(8*h/u)}if(r.bitrateTest){var d={stats:a,frag:r,part:i,id:r.type};this.onFragBuffered(y.FRAG_BUFFERED,d),r.bitrateTest=!1}else this.lastLoadedFragLevel=r.level}},n.onFragBuffered=function(t,e){var r=e.frag,i=e.part,a=i!=null&&i.stats.loaded?i.stats:r.stats;if(!a.aborted&&!this.ignoreFragment(r)){var o=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,a.loaded),a.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},n.ignoreFragment=function(t){return t.type!==tt||t.sn==="initSegment"},n.clearTimer=function(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)},n.getAutoLevelKey=function(){return this.getBwEstimate()+"_"+this.getStarvationDelay().toFixed(2)},n.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.maxAutoLevel,a=r.config,o=r.minAutoLevel,l=e?e.duration:t?t.duration:0,h=this.getBwEstimate(),u=this.getStarvationDelay(),d=a.abrBandWidthFactor,f=a.abrBandWidthUpFactor;if(u){var c=this.findBestLevel(h,o,i,u,0,d,f);if(c>=0)return c}var v=l?Math.min(l,a.maxStarvationDelay):a.maxStarvationDelay;if(!u){var g=this.bitrateTestDelay;g&&(v=(l?Math.min(l,a.maxLoadingDelay):a.maxLoadingDelay)-g,b.info("[abr] bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),d=f=1)}var p=this.findBestLevel(h,o,i,u,v,d,f);if(b.info("[abr] "+(u?"rebuffering expected":"buffer is empty")+", optimal quality level "+p),p>-1)return p;var m=r.levels[o],E=r.levels[r.loadLevel];return(m==null?void 0:m.bitrate)<(E==null?void 0:E.bitrate)?o:r.loadLevel},n.getStarvationDelay=function(){var t=this.hls,e=t.media;if(!e)return 1/0;var r=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,i=t.mainForwardBufferInfo;return(i?i.len:0)/r},n.getBwEstimate=function(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate},n.findBestLevel=function(t,e,r,i,a,o,l){var h,u=this,d=i+a,f=this.lastLoadedFragLevel,c=f===-1?this.hls.firstLevel:f,v=this.fragCurrent,g=this.partCurrent,p=this.hls,m=p.levels,E=p.allAudioTracks,T=p.loadLevel,S=p.config;if(m.length===1)return 0;var R,A=m[c],L=!(A==null||(h=A.details)==null||!h.live),w=T===-1||f===-1,k="SDR",C=(A==null?void 0:A.frameRate)||0,D=S.audioPreference,_=S.videoPreference,x=this.audioTracksByGroup||(this.audioTracksByGroup=function(rt){return rt.reduce(function(Y,z){var j=Y.groups[z.groupId];j||(j=Y.groups[z.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),j.tracks.push(z);var it=z.channels||"2";return j.channels[it]=(j.channels[it]||0)+1,j.hasDefault=j.hasDefault||z.default,j.hasAutoSelect=j.hasAutoSelect||z.autoselect,j.hasDefault&&(Y.hasDefaultAudio=!0),j.hasAutoSelect&&(Y.hasAutoSelectAudio=!0),Y},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}(E));if(w){if(this.firstSelection!==-1)return this.firstSelection;var P=this.codecTiers||(this.codecTiers=function(rt,Y,z,j){return rt.slice(z,j+1).reduce(function(it,W){if(!W.codecSet)return it;var at=W.audioGroups,J=it[W.codecSet];J||(it[W.codecSet]=J={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!at,fragmentError:0}),J.minBitrate=Math.min(J.minBitrate,W.bitrate);var Dt=Math.min(W.height,W.width);return J.minHeight=Math.min(J.minHeight,Dt),J.minFramerate=Math.min(J.minFramerate,W.frameRate),J.maxScore=Math.max(J.maxScore,W.score),J.fragmentError+=W.fragmentError,J.videoRanges[W.videoRange]=(J.videoRanges[W.videoRange]||0)+1,at&&at.forEach(function(bt){if(bt){var $=Y.groups[bt];$&&(J.hasDefaultAudio=J.hasDefaultAudio||Y.hasDefaultAudio?$.hasDefault:$.hasAutoSelect||!Y.hasDefaultAudio&&!Y.hasAutoSelectAudio,Object.keys($.channels).forEach(function(ht){J.channels[ht]=(J.channels[ht]||0)+$.channels[ht]}))}}),it},{})}(m,x,e,r)),M=function(rt,Y,z,j,it){for(var W=Object.keys(rt),at=j==null?void 0:j.channels,J=j==null?void 0:j.audioCodec,Dt=at&&parseInt(at)===2,bt=!0,$=!1,ht=1/0,vt=1/0,kt=1/0,_t=0,Et=[],Ct=io(Y,it),ze=Ct.preferHDR,ne=Ct.allowedVideoRanges,Ce=function(){var nt=rt[W[te]];bt=nt.channels[2]>0,ht=Math.min(ht,nt.minHeight),vt=Math.min(vt,nt.minFramerate),kt=Math.min(kt,nt.minBitrate);var lt=ne.filter(function(pt){return nt.videoRanges[pt]>0});lt.length>0&&($=!0,Et=lt)},te=W.length;te--;)Ce();ht=N(ht)?ht:0,vt=N(vt)?vt:0;var xt=Math.max(1080,ht),Tt=Math.max(30,vt);return kt=N(kt)?kt:z,z=Math.max(kt,z),$||(Y=void 0,Et=[]),{codecSet:W.reduce(function(nt,lt){var pt=rt[lt];if(lt===nt)return nt;if(pt.minBitrate>z)return zt(lt,"min bitrate of "+pt.minBitrate+" > current estimate of "+z),nt;if(!pt.hasDefaultAudio)return zt(lt,"no renditions with default or auto-select sound found"),nt;if(J&&lt.indexOf(J.substring(0,4))%5!=0)return zt(lt,'audio codec preference "'+J+'" not found'),nt;if(at&&!Dt){if(!pt.channels[at])return zt(lt,"no renditions with "+at+" channel sound found (channels options: "+Object.keys(pt.channels)+")"),nt}else if((!J||Dt)&&bt&&pt.channels[2]===0)return zt(lt,"no renditions with stereo sound found"),nt;return pt.minHeight>xt?(zt(lt,"min resolution of "+pt.minHeight+" > maximum of "+xt),nt):pt.minFramerate>Tt?(zt(lt,"min framerate of "+pt.minFramerate+" > maximum of "+Tt),nt):Et.some(function(Yi){return pt.videoRanges[Yi]>0})?pt.maxScore<_t?(zt(lt,"max score of "+pt.maxScore+" < selected max of "+_t),nt):nt&&(ar(lt)>=ar(nt)||pt.fragmentError>rt[nt].fragmentError)?nt:(_t=pt.maxScore,lt):(zt(lt,"no variants with VIDEO-RANGE of "+JSON.stringify(Et)+" found"),nt)},void 0),videoRanges:Et,preferHDR:ze,minFramerate:vt,minBitrate:kt}}(P,k,t,D,_),U=M.codecSet,F=M.videoRanges,O=M.minFramerate,B=M.minBitrate,G=M.preferHDR;R=U,k=G?F[F.length-1]:F[0],C=O,t=Math.max(t,B),b.log("[abr] picked start tier "+JSON.stringify(M))}else R=A==null?void 0:A.codecSet,k=A==null?void 0:A.videoRange;for(var V,Q=g?g.duration:v?v.duration:0,ot=this.bwEstimator.getEstimateTTFB()/1e3,et=[],ft=function(){var rt,Y=m[st],z=st>c;if(!Y)return 0;if(S.useMediaCapabilities&&!Y.supportedResult&&!Y.supportedPromise){var j=navigator.mediaCapabilities;typeof(j==null?void 0:j.decodingInfo)=="function"&&function($,ht,vt,kt,_t,Et){var Ct=$.audioCodec?$.audioGroups:null,ze=Et==null?void 0:Et.audioCodec,ne=Et==null?void 0:Et.channels,Ce=ne?parseInt(ne):ze?1/0:2,te=null;if(Ct!=null&&Ct.length)try{te=Ct.length===1&&Ct[0]?ht.groups[Ct[0]].channels:Ct.reduce(function(xt,Tt){if(Tt){var nt=ht.groups[Tt];if(!nt)throw new Error("Audio track group "+Tt+" not found");Object.keys(nt.channels).forEach(function(lt){xt[lt]=(xt[lt]||0)+nt.channels[lt]})}return xt},{2:0})}catch{return!0}return $.videoCodec!==void 0&&($.width>1920&&$.height>1088||$.height>1920&&$.width>1088||$.frameRate>Math.max(kt,30)||$.videoRange!=="SDR"&&$.videoRange!==vt||$.bitrate>Math.max(_t,8e6))||!!te&&N(Ce)&&Object.keys(te).some(function(xt){return parseInt(xt)>Ce})}(Y,x,k,C,t,D)?(Y.supportedPromise=ro(Y,x,j),Y.supportedPromise.then(function($){if(u.hls){Y.supportedResult=$;var ht=u.hls.levels,vt=ht.indexOf(Y);$.error?b.warn('[abr] MediaCapabilities decodingInfo error: "'+$.error+'" for level '+vt+" "+JSON.stringify($)):$.supported||(b.warn("[abr] Unsupported MediaCapabilities decodingInfo result for level "+vt+" "+JSON.stringify($)),vt>-1&&ht.length>1&&(b.log("[abr] Removing unsupported level "+vt),u.hls.removeLevel(vt)))}})):Y.supportedResult=Xn}if(R&&Y.codecSet!==R||k&&Y.videoRange!==k||z&&C>Y.frameRate||!z&&C>0&&C<Y.frameRate||Y.supportedResult&&((rt=Y.supportedResult.decodingInfoResults)==null||!rt[0].smooth))return et.push(st),0;var it,W=Y.details,at=(g?W==null?void 0:W.partTarget:W==null?void 0:W.averagetargetduration)||Q;it=z?l*t:o*t;var J=Q&&i>=2*Q&&a===0?m[st].averageBitrate:m[st].maxBitrate,Dt=u.getTimeToLoadFrag(ot,it,J*at,W===void 0);if(it>=J&&(st===f||Y.loadError===0&&Y.fragmentError===0)&&(Dt<=ot||!N(Dt)||L&&!u.bitrateTestDelay||Dt<d)){var bt=u.forcedAutoLevel;return st===T||bt!==-1&&bt===T||(et.length&&b.trace("[abr] Skipped level(s) "+et.join(",")+" of "+r+' max with CODECS and VIDEO-RANGE:"'+m[et[0]].codecs+'" '+m[et[0]].videoRange+'; not compatible with "'+A.codecs+'" '+k),b.info("[abr] switch candidate:"+c+"->"+st+" adjustedbw("+Math.round(it)+")-bitrate="+Math.round(it-J)+" ttfb:"+ot.toFixed(1)+" avgDuration:"+at.toFixed(1)+" maxFetchDuration:"+d.toFixed(1)+" fetchDuration:"+Dt.toFixed(1)+" firstSelection:"+w+" codecSet:"+R+" videoRange:"+k+" hls.loadLevel:"+T)),w&&(u.firstSelection=st),{v:st}}},st=r;st>=e;st--)if((V=ft())!==0&&V)return V.v;return-1},ct(s,[{key:"firstAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,r=t.minAutoLevel,i=this.getBwEstimate(),a=this.hls.config.maxStarvationDelay,o=this.findBestLevel(i,r,e,0,a,1,1);if(o>-1)return o;var l=this.hls.firstLevel,h=Math.min(Math.max(l,r),e);return b.warn("[abr] Could not find best starting auto level. Defaulting to first in playlist "+l+" clamped to "+h),h}},{key:"forcedAutoLevel",get:function(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}},{key:"nextAutoLevel",get:function(){var t=this.forcedAutoLevel,e=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(!(t===-1||e&&r&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return t;var i=e&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){var a=this.hls.levels;if(a.length>Math.max(t,i)&&a[t].loadError<=a[i].loadError)return t}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i},set:function(t){var e=this.hls,r=e.maxAutoLevel,i=e.minAutoLevel,a=Math.min(Math.max(t,i),r);this._nextAutoLevel!==a&&(this.nextAutoLevelKey="",this._nextAutoLevel=a)}}]),s}(),ao=function(){function s(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var n=s.prototype;return n.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},n.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},n.onHandlerDestroyed=function(){},n.hasInterval=function(){return!!this._tickInterval},n.hasNextTick=function(){return!!this._tickTimer},n.setInterval=function(t){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)},n.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},n.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},n.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},n.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},n.doTick=function(){},s}(),Ke="NOT_LOADED",Jn="APPENDING",Ae="PARTIAL",He="OK",so=function(){function s(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}var n=s.prototype;return n._registerListeners=function(){var t=this.hls;t.on(y.BUFFER_APPENDED,this.onBufferAppended,this),t.on(y.FRAG_BUFFERED,this.onFragBuffered,this),t.on(y.FRAG_LOADED,this.onFragLoaded,this)},n._unregisterListeners=function(){var t=this.hls;t.off(y.BUFFER_APPENDED,this.onBufferAppended,this),t.off(y.FRAG_BUFFERED,this.onFragBuffered,this),t.off(y.FRAG_LOADED,this.onFragLoaded,this)},n.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},n.getAppendedFrag=function(t,e){var r=this.activePartLists[e];if(r)for(var i=r.length;i--;){var a=r[i];if(!a)break;var o=a.end;if(a.start<=t&&o!==null&&t<=o)return a}return this.getBufferedFrag(t,e)},n.getBufferedFrag=function(t,e){for(var r=this.fragments,i=Object.keys(r),a=i.length;a--;){var o=r[i[a]];if((o==null?void 0:o.body.type)===e&&o.buffered){var l=o.body;if(l.start<=t&&t<=l.end)return l}}return null},n.detectEvictedFragments=function(t,e,r,i){var a=this;this.timeRanges&&(this.timeRanges[t]=e);var o=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(l){var h=a.fragments[l];if(h&&!(o>=h.body.sn))if(h.buffered||h.loaded){var u=h.range[t];u&&u.time.some(function(d){var f=!a.isTimeBuffered(d.startPTS,d.endPTS,e);return f&&a.removeFragment(h.body),f})}else h.body.type===r&&a.removeFragment(h.body)})},n.detectPartialFragments=function(t){var e=this,r=this.timeRanges,i=t.frag,a=t.part;if(r&&i.sn!=="initSegment"){var o=Re(i),l=this.fragments[o];if(!(!l||l.buffered&&i.gap)){var h=!i.relurl;Object.keys(r).forEach(function(u){var d=i.elementaryStreams[u];if(d){var f=r[u],c=h||d.partial===!0;l.range[u]=e.getBufferedTimes(i,a,c,f)}}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,(l.body.endList=i.endList||l.body.endList)&&(this.endListFragments[l.body.type]=l),gr(l)||this.removeParts(i.sn-1,i.type)):this.removeFragment(l.body)}}},n.removeParts=function(t,e){var r=this.activePartLists[e];r&&(this.activePartLists[e]=r.filter(function(i){return i.fragment.sn>=t}))},n.fragBuffered=function(t,e){var r=Re(t),i=this.fragments[r];!i&&e&&(i=this.fragments[r]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},n.getBufferedTimes=function(t,e,r,i){for(var a={time:[],partial:r},o=t.start,l=t.end,h=t.minEndPTS||l,u=t.maxStartPTS||o,d=0;d<i.length;d++){var f=i.start(d)-this.bufferPadding,c=i.end(d)+this.bufferPadding;if(u>=f&&h<=c){a.time.push({startPTS:Math.max(o,i.start(d)),endPTS:Math.min(l,i.end(d))});break}if(o<c&&l>f){var v=Math.max(o,i.start(d)),g=Math.min(l,i.end(d));g>v&&(a.partial=!0,a.time.push({startPTS:v,endPTS:g}))}else if(l<=f)break}return a},n.getPartialFragment=function(t){var e,r,i,a=null,o=0,l=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(u){var d=h[u];d&&gr(d)&&(r=d.body.start-l,i=d.body.end+l,t>=r&&t<=i&&(e=Math.min(t-r,i-t),o<=e&&(a=d.body,o=e)))}),a},n.isEndListAppended=function(t){var e=this.endListFragments[t];return e!==void 0&&(e.buffered||gr(e))},n.getState=function(t){var e=Re(t),r=this.fragments[e];return r?r.buffered?gr(r)?Ae:He:Jn:Ke},n.isTimeBuffered=function(t,e,r){for(var i,a,o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,a=r.end(o)+this.bufferPadding,t>=i&&e<=a)return!0;if(e<=i)return!1}return!1},n.onFragLoaded=function(t,e){var r=e.frag,i=e.part;if(r.sn!=="initSegment"&&!r.bitrateTest){var a=i?null:e,o=Re(r);this.fragments[o]={body:r,appendedPTS:null,loaded:a,buffered:!1,range:Object.create(null)}}},n.onBufferAppended=function(t,e){var r=this,i=e.frag,a=e.part,o=e.timeRanges;if(i.sn!=="initSegment"){var l=i.type;if(a){var h=this.activePartLists[l];h||(this.activePartLists[l]=h=[]),h.push(a)}this.timeRanges=o,Object.keys(o).forEach(function(u){var d=o[u];r.detectEvictedFragments(u,d,l,a)})}},n.onFragBuffered=function(t,e){this.detectPartialFragments(e)},n.hasFragment=function(t){var e=Re(t);return!!this.fragments[e]},n.hasParts=function(t){var e;return!((e=this.activePartLists[t])==null||!e.length)},n.removeFragmentsInRange=function(t,e,r,i,a){var o=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(l){var h=o.fragments[l];if(h){var u=h.body;u.type!==r||i&&!u.gap||u.start<e&&u.end>t&&(h.buffered||a)&&o.removeFragment(u)}})},n.removeFragment=function(t){var e=Re(t);t.stats.loaded=0,t.clearElementaryStreamInfo();var r=this.activePartLists[t.type];if(r){var i=t.sn;this.activePartLists[t.type]=r.filter(function(a){return a.fragment.sn!==i})}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]},n.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},s}();function gr(s){var n,t,e;return s.buffered&&(s.body.gap||((n=s.range.video)==null?void 0:n.partial)||((t=s.range.audio)==null?void 0:t.partial)||((e=s.range.audiovideo)==null?void 0:e.partial))}function Re(s){return s.type+"_"+s.level+"_"+s.sn}var oo={length:0,start:function(){return 0},end:function(){return 0}},ut=function(){function s(){}return s.isBuffered=function(n,t){try{if(n){for(var e=s.getBuffered(n),r=0;r<e.length;r++)if(t>=e.start(r)&&t<=e.end(r))return!0}}catch{}return!1},s.bufferInfo=function(n,t,e){try{if(n){var r,i=s.getBuffered(n),a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,t,e)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}},s.bufferedInfo=function(n,t,e){t=Math.max(0,t),n.sort(function(g,p){var m=g.start-p.start;return m||p.end-g.end});var r=[];if(e)for(var i=0;i<n.length;i++){var a=r.length;if(a){var o=r[a-1].end;n[i].start-o<e?n[i].end>o&&(r[a-1].end=n[i].end):r.push(n[i])}else r.push(n[i])}else r=n;for(var l,h=0,u=t,d=t,f=0;f<r.length;f++){var c=r[f].start,v=r[f].end;if(t+e>=c&&t<v)u=c,h=(d=v)-t;else if(t+e<c){l=c;break}}return{len:h,start:u||0,end:d||0,nextStart:l}},s.getBuffered=function(n){try{return n.buffered}catch(t){return b.log("failed to get media.buffered",t),oo}},s}(),fi=function(s,n,t,e,r,i){e===void 0&&(e=0),r===void 0&&(r=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=s,this.sn=n,this.id=t,this.size=e,this.part=r,this.partial=i};function vr(s,n){for(var t=0,e=s.length;t<e;t++){var r;if(((r=s[t])==null?void 0:r.cc)===n)return s[t]}return null}function $n(s,n){if(s){var t=s.start+n;s.start=s.startPTS=t,s.endPTS=t+s.duration}}function Zn(s,n){for(var t=n.fragments,e=0,r=t.length;e<r;e++)$n(t[e],s);n.fragmentHint&&$n(n.fragmentHint,s),n.alignedSliding=!0}function lo(s,n,t){n&&(function(e,r,i){if(function(o,l,h){return!(!l||!(h.endCC>h.startCC||o&&o.cc<h.startCC))}(e,i,r)){var a=function(o,l){var h=o.fragments,u=l.fragments;if(u.length&&h.length){var d=vr(h,u[0].cc);if(d&&(!d||d.startPTS))return d;b.log("No frag in previous level to align on")}else b.log("No fragments to align")}(i,r);a&&N(a.start)&&(b.log("Adjusting PTS using last level due to CC increase within current level "+r.url),Zn(a.start,r))}}(s,t,n),!t.alignedSliding&&n&&mr(t,n),t.alignedSliding||!n||t.skippedSegments||Gn(n,t))}function mr(s,n){if(s.hasProgramDateTime&&n.hasProgramDateTime){var t=s.fragments,e=n.fragments;if(t.length&&e.length){var r,i,a=Math.min(n.endCC,s.endCC);n.startCC<a&&s.startCC<a&&(r=vr(e,a),i=vr(t,a)),r&&i||(i=vr(t,(r=e[Math.floor(e.length/2)]).cc)||t[Math.floor(t.length/2)]);var o=r.programDateTime,l=i.programDateTime;o&&l&&Zn((l-o)/1e3-(i.start-r.start),s)}}}var ta=Math.pow(2,17),uo=function(){function s(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var n=s.prototype;return n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.abort=function(){this.loader&&this.loader.abort()},n.load=function(t,e){var r=this,i=t.url;if(!i)return Promise.reject(new Qt({type:K.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var a=this.config,o=a.fLoader,l=a.loader;return new Promise(function(h,u){if(r.loader&&r.loader.destroy(),t.gap){if(t.tagList.some(function(g){return g[0]==="GAP"}))return void u(ra(t));t.gap=!1}var d=r.loader=t.loader=o?new o(a):new l(a),f=ea(t),c=Wn(a.fragLoadPolicy.default),v={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:ta};t.stats=d.stats,d.load(f,v,{onSuccess:function(g,p,m,E){r.resetLoader(t,d);var T=g.data;m.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(T.slice(0,16)),T=T.slice(16)),h({frag:t,part:null,payload:T,networkDetails:E})},onError:function(g,p,m,E){r.resetLoader(t,d),u(new Qt({type:K.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:yt({url:i,data:void 0},g),error:new Error("HTTP Error "+g.code+" "+g.text),networkDetails:m,stats:E}))},onAbort:function(g,p,m){r.resetLoader(t,d),u(new Qt({type:K.NETWORK_ERROR,details:I.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:m,stats:g}))},onTimeout:function(g,p,m){r.resetLoader(t,d),u(new Qt({type:K.NETWORK_ERROR,details:I.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error("Timeout after "+v.timeout+"ms"),networkDetails:m,stats:g}))},onProgress:function(g,p,m,E){e&&e({frag:t,part:null,payload:m,networkDetails:E})}})})},n.loadPart=function(t,e,r){var i=this;this.abort();var a=this.config,o=a.fLoader,l=a.loader;return new Promise(function(h,u){if(i.loader&&i.loader.destroy(),t.gap||e.gap)u(ra(t,e));else{var d=i.loader=t.loader=o?new o(a):new l(a),f=ea(t,e),c=Wn(a.fragLoadPolicy.default),v={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ta};e.stats=d.stats,d.load(f,v,{onSuccess:function(g,p,m,E){i.resetLoader(t,d),i.updateStatsFromPart(t,e);var T={frag:t,part:e,payload:g.data,networkDetails:E};r(T),h(T)},onError:function(g,p,m,E){i.resetLoader(t,d),u(new Qt({type:K.NETWORK_ERROR,details:I.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:yt({url:f.url,data:void 0},g),error:new Error("HTTP Error "+g.code+" "+g.text),networkDetails:m,stats:E}))},onAbort:function(g,p,m){t.stats.aborted=e.stats.aborted,i.resetLoader(t,d),u(new Qt({type:K.NETWORK_ERROR,details:I.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:m,stats:g}))},onTimeout:function(g,p,m){i.resetLoader(t,d),u(new Qt({type:K.NETWORK_ERROR,details:I.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error("Timeout after "+v.timeout+"ms"),networkDetails:m,stats:g}))}})}})},n.updateStatsFromPart=function(t,e){var r=t.stats,i=e.stats,a=i.total;if(r.loaded+=i.loaded,a){var o=Math.round(t.duration/e.duration),l=Math.min(Math.round(r.loaded/a),o),h=(o-l)*Math.round(r.loaded/l);r.total=r.loaded+h}else r.total=Math.max(r.loaded,r.total);var u=r.loading,d=i.loading;u.start?u.first+=d.first-d.start:(u.start=d.start,u.first=d.first),u.end=d.end},n.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},s}();function ea(s,n){n===void 0&&(n=null);var t=n||s,e={frag:s,part:n,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(N(r)&&N(i)){var a,o=r,l=i;if(s.sn==="initSegment"&&((a=s.decryptdata)==null?void 0:a.method)==="AES-128"){var h=i-r;h%16&&(l=i+(16-h%16)),r!==0&&(e.resetIV=!0,o=r-16)}e.rangeStart=o,e.rangeEnd=l}return e}function ra(s,n){var t=new Error("GAP "+(s.gap?"tag":"attribute")+" found"),e={type:K.MEDIA_ERROR,details:I.FRAG_GAP,fatal:!1,frag:s,error:t,networkDetails:null};return n&&(e.part=n),(n||s).stats.aborted=!0,new Qt(e)}var Qt=function(s){function n(t){var e;return(e=s.call(this,t.error.message)||this).data=void 0,e.data=t,e}return Lt(n,s),n}(Fe(Error)),ho=function(){function s(n,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=n,this.aesIV=t}return s.prototype.decrypt=function(n,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,n)},s}(),fo=function(){function s(n,t){this.subtle=void 0,this.key=void 0,this.subtle=n,this.key=t}return s.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},s}(),co=function(){function s(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var n=s.prototype;return n.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},n.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],a=r[1],o=r[2],l=r[3],h=this.invSubMix,u=h[0],d=h[1],f=h[2],c=h[3],v=new Uint32Array(256),g=0,p=0,m=0;for(m=0;m<256;m++)v[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var E=p^p<<1^p<<2^p<<3^p<<4;E=E>>>8^255&E^99,t[g]=E,e[E]=g;var T=v[g],S=v[T],R=v[S],A=257*v[E]^16843008*E;i[g]=A<<24|A>>>8,a[g]=A<<16|A>>>16,o[g]=A<<8|A>>>24,l[g]=A,A=16843009*R^65537*S^257*T^16843008*g,u[E]=A<<24|A>>>8,d[E]=A<<16|A>>>16,f[E]=A<<8|A>>>24,c[E]=A,g?(g=T^v[v[v[R^T]]],p^=v[v[p]]):g=p=1}},n.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var a=this.keySize=e.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);var o,l,h,u,d=this.ksRows=4*(a+6+1),f=this.keySchedule=new Uint32Array(d),c=this.invKeySchedule=new Uint32Array(d),v=this.sBox,g=this.rcon,p=this.invSubMix,m=p[0],E=p[1],T=p[2],S=p[3];for(o=0;o<d;o++)o<a?h=f[o]=e[o]:(u=h,o%a==0?(u=v[(u=u<<8|u>>>24)>>>24]<<24|v[u>>>16&255]<<16|v[u>>>8&255]<<8|v[255&u],u^=g[o/a|0]<<24):a>6&&o%a==4&&(u=v[u>>>24]<<24|v[u>>>16&255]<<16|v[u>>>8&255]<<8|v[255&u]),f[o]=h=(f[o-a]^u)>>>0);for(l=0;l<d;l++)o=d-l,u=3&l?f[o]:f[o-4],c[l]=l<4||o<=4?u:m[v[u>>>24]]^E[v[u>>>16&255]]^T[v[u>>>8&255]]^S[v[255&u]],c[l]=c[l]>>>0}},n.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},n.decrypt=function(t,e,r){for(var i,a,o,l,h,u,d,f,c,v,g,p,m,E,T=this.keySize+6,S=this.invKeySchedule,R=this.invSBox,A=this.invSubMix,L=A[0],w=A[1],k=A[2],C=A[3],D=this.uint8ArrayToUint32Array_(r),_=D[0],x=D[1],P=D[2],M=D[3],U=new Int32Array(t),F=new Int32Array(U.length),O=this.networkToHostOrderSwap;e<U.length;){for(c=O(U[e]),v=O(U[e+1]),g=O(U[e+2]),p=O(U[e+3]),h=c^S[0],u=p^S[1],d=g^S[2],f=v^S[3],m=4,E=1;E<T;E++)i=L[h>>>24]^w[u>>16&255]^k[d>>8&255]^C[255&f]^S[m],a=L[u>>>24]^w[d>>16&255]^k[f>>8&255]^C[255&h]^S[m+1],o=L[d>>>24]^w[f>>16&255]^k[h>>8&255]^C[255&u]^S[m+2],l=L[f>>>24]^w[h>>16&255]^k[u>>8&255]^C[255&d]^S[m+3],h=i,u=a,d=o,f=l,m+=4;i=R[h>>>24]<<24^R[u>>16&255]<<16^R[d>>8&255]<<8^R[255&f]^S[m],a=R[u>>>24]<<24^R[d>>16&255]<<16^R[f>>8&255]<<8^R[255&h]^S[m+1],o=R[d>>>24]<<24^R[f>>16&255]<<16^R[h>>8&255]<<8^R[255&u]^S[m+2],l=R[f>>>24]<<24^R[h>>16&255]<<16^R[u>>8&255]<<8^R[255&d]^S[m+3],F[e]=O(i^_),F[e+1]=O(l^x),F[e+2]=O(o^P),F[e+3]=O(a^M),_=c,x=v,P=g,M=p,e+=4}return F.buffer},s}(),ci=function(){function s(t,e){var r=(e===void 0?{}:e).removePKCS7Padding,i=r===void 0||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.useSoftware=!this.subtle}var n=s.prototype;return n.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},n.isSync=function(){return this.useSoftware},n.flush=function(){var t=this.currentResult,e=this.remainderData;if(!t||e)return this.reset(),null;var r,i,a,o=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?(i=(r=o).byteLength,(a=i&&new DataView(r.buffer).getUint8(i-1))?se(r,0,i-a):r):o},n.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},n.decrypt=function(t,e,r){var i=this;return this.useSoftware?new Promise(function(a,o){i.softwareDecrypt(new Uint8Array(t),e,r);var l=i.flush();l?a(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,r)},n.softwareDecrypt=function(t,e,r){var i=this.currentIV,a=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(t=Ft(o,t),this.remainderData=null);var l=this.getValidChunk(t);if(!l.length)return null;i&&(r=i);var h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new co),h.expandKey(e);var u=a;return this.currentResult=h.decrypt(l.buffer,0,r),this.currentIV=se(l,-16).buffer,u||null},n.webCryptoDecrypt=function(t,e,r){var i=this;if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,r));this.key=e,this.fastAesKey=new fo(this.subtle,e)}return this.fastAesKey.expandKey().then(function(a){return i.subtle?(i.logOnce("WebCrypto AES decrypt"),new ho(i.subtle,new Uint8Array(r)).decrypt(t.buffer,a)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(a){return b.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+a.name+": "+a.message),i.onWebCryptoError(t,e,r)})},n.onWebCryptoError=function(t,e,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},n.getValidChunk=function(t){var e=t,r=t.length-t.length%16;return r!==t.length&&(e=se(t,0,r),this.remainderData=se(t,r)),e},n.logOnce=function(t){this.logEnabled&&(b.log("[decrypter]: "+t),this.logEnabled=!1)},s}(),go=function(s){for(var n="",t=s.length,e=0;e<t;e++)n+="["+s.start(e).toFixed(3)+"-"+s.end(e).toFixed(3)+"]";return n},Ot="STOPPED",X="IDLE",gi="KEY_LOADING",be="FRAG_LOADING",ke="FRAG_LOADING_WAITING_RETRY",Ve="WAITING_TRACK",Jt="PARSING",pr="PARSED",Ye="ENDED",De="ERROR",We="WAITING_INIT_PTS",de="WAITING_LEVEL",vi=function(s){function n(e,r,i,a,o){var l;return(l=s.call(this)||this).hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=Ot,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.loadedmetadata=!1,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.buffering=!0,l.onvseeking=null,l.onvended=null,l.logPrefix="",l.log=void 0,l.warn=void 0,l.playlistType=o,l.logPrefix=a,l.log=b.log.bind(b,a+":"),l.warn=b.warn.bind(b,a+":"),l.hls=e,l.fragmentLoader=new uo(e.config),l.keyLoader=i,l.fragmentTracker=r,l.config=e.config,l.decrypter=new ci(e.config),e.on(y.MANIFEST_LOADED,l.onManifestLoaded,function(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}(l)),l}Lt(n,s);var t=n.prototype;return t.doTick=function(){this.onTickEnd()},t.onTickEnd=function(){},t.startLoad=function(e){},t.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ot},t.pauseBuffering=function(){this.buffering=!1},t.resumeBuffering=function(){this.buffering=!0},t._streamEnded=function(e,r){if(r.live||e.nextStart||!e.end||!this.media)return!1;var i=r.partList;if(i!=null&&i.length){var a=i[i.length-1];return ut.isBuffered(this.media,a.start+a.duration/2)}var o=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)},t.getLevelDetails=function(){var e;if(this.levels&&this.levelLastLoaded!==null)return(e=this.levelLastLoaded)==null?void 0:e.details},t.onMediaAttached=function(e,r){var i=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.state===Ot&&this.startLoad(a.startPosition)},t.onMediaDetaching=function(){var e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},t.onMediaSeeking=function(){var e=this.config,r=this.fragCurrent,i=this.media,a=this.mediaBuffer,o=this.state,l=i?i.currentTime:0,h=ut.bufferInfo(a||i,l,e.maxBufferHole);if(this.log("media seeking to "+(N(l)?l.toFixed(3):l)+", state: "+o),this.state===Ye)this.resetLoadingState();else if(r){var u=e.maxFragLookUpTolerance,d=r.start-u,f=r.start+r.duration+u;if(!h.len||f<h.start||d>h.end){var c=l>f;(l<d||c)&&(c&&r.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),r.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),this.loadedmetadata||h.len||(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()},t.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},t.onManifestLoaded=function(e,r){this.startTimeOffset=r.startTimeOffset,this.initPTS=[]},t.onHandlerDestroying=function(){this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),s.prototype.onHandlerDestroying.call(this),this.hls=null},t.onHandlerDestroyed=function(){this.state=Ot,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},t.loadFragment=function(e,r,i){this._loadFragForPlayback(e,r,i)},t._loadFragForPlayback=function(e,r,i){var a=this;this._doFragLoad(e,r,i,function(o){if(a.fragContextChanged(e))return a.warn("Fragment "+e.sn+(o.part?" p: "+o.part.index:"")+" of level "+e.level+" was dropped during download."),void a.fragmentTracker.removeFragment(e);e.stats.chunkCount++,a._handleFragmentLoadProgress(o)}).then(function(o){if(o){var l=a.state;a.fragContextChanged(e)?(l===be||!a.fragCurrent&&l===Jt)&&(a.fragmentTracker.removeFragment(e),a.state=X):("payload"in o&&(a.log("Loaded fragment "+e.sn+" of level "+e.level),a.hls.trigger(y.FRAG_LOADED,o)),a._handleFragmentLoadComplete(o))}}).catch(function(o){a.state!==Ot&&a.state!==De&&(a.warn("Frag error: "+((o==null?void 0:o.message)||o)),a.resetFragmentLoading(e))})},t.clearTrackerIfNeeded=function(e){var r,i=this.fragmentTracker;if(i.getState(e)===Jn){var a=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,a),l=Math.max(e.duration,o?o.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)==1||this.reduceMaxBufferLength(l,e.duration))&&i.removeFragment(e)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===Ae&&i.removeFragment(e))},t.checkLiveUpdate=function(e){if(e.updated&&!e.live){var r=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:r,part:null,stats:r.stats,id:r.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},t.flushMainBuffer=function(e,r,i){if(i===void 0&&(i=null),e-r){var a={startOffset:e,endOffset:r,type:i};this.hls.trigger(y.BUFFER_FLUSHING,a)}},t._loadInitSegment=function(e,r){var i=this;this._doFragLoad(e,r).then(function(a){if(!a||i.fragContextChanged(e)||!i.levels)throw new Error("init load aborted");return a}).then(function(a){var o=i.hls,l=a.payload,h=e.decryptdata;if(l&&l.byteLength>0&&h!=null&&h.key&&h.iv&&h.method==="AES-128"){var u=self.performance.now();return i.decrypter.decrypt(new Uint8Array(l),h.key.buffer,h.iv.buffer).catch(function(d){throw o.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:e}),d}).then(function(d){var f=self.performance.now();return o.trigger(y.FRAG_DECRYPTED,{frag:e,payload:d,stats:{tstart:u,tdecrypt:f}}),a.payload=d,i.completeInitSegmentLoad(a)})}return i.completeInitSegmentLoad(a)}).catch(function(a){i.state!==Ot&&i.state!==De&&(i.warn(a),i.resetFragmentLoading(e))})},t.completeInitSegmentLoad=function(e){if(!this.levels)throw new Error("init load aborted, missing levels");var r=e.frag.stats;this.state=X,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()},t.fragContextChanged=function(e){var r=this.fragCurrent;return!e||!r||e.sn!==r.sn||e.level!==r.level},t.fragBufferedComplete=function(e,r){var i,a,o,l,h=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log("Buffered "+e.type+" sn: "+e.sn+(r?" part: "+r.index:"")+" of "+(this.playlistType===tt?"level":"track")+" "+e.level+" (frag:["+((i=e.startPTS)!=null?i:NaN).toFixed(3)+"-"+((a=e.endPTS)!=null?a:NaN).toFixed(3)+"] > buffer:"+(h?go(ut.getBuffered(h)):"(detached)")+")"),e.sn!=="initSegment"){var u;if(e.type!==qt){var d=e.elementaryStreams;if(!Object.keys(d).some(function(c){return!!d[c]}))return void(this.state=X)}var f=(u=this.levels)==null?void 0:u[e.level];f!=null&&f.fragmentError&&(this.log("Resetting level fragment error count of "+f.fragmentError+" on frag buffered"),f.fragmentError=0)}this.state=X,h&&(!this.loadedmetadata&&e.type==tt&&h.buffered.length&&((o=this.fragCurrent)==null?void 0:o.sn)===((l=this.fragPrevious)==null?void 0:l.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},t.seekToStartPos=function(){},t._handleFragmentLoadComplete=function(e){var r=this.transmuxer;if(r){var i=e.frag,a=e.part,o=e.partsLoaded,l=!o||o.length===0||o.some(function(u){return!u}),h=new fi(i.level,i.sn,i.stats.chunkCount+1,0,a?a.index:-1,!l);r.flush(h)}},t._handleFragmentLoadProgress=function(e){},t._doFragLoad=function(e,r,i,a){var o,l=this;i===void 0&&(i=null);var h=r==null?void 0:r.details;if(!this.levels||!h)throw new Error("frag load aborted, missing level"+(h?"":" detail")+"s");var u=null;if(!e.encrypted||(o=e.decryptdata)!=null&&o.key?!e.encrypted&&h.encryptedFragments.length&&this.keyLoader.loadClear(e,h.encryptedFragments):(this.log("Loading key for "+e.sn+" of ["+h.startSN+"-"+h.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+e.level),this.state=gi,this.fragCurrent=e,u=this.keyLoader.load(e).then(function(m){if(!l.fragContextChanged(m.frag))return l.hls.trigger(y.KEY_LOADED,m),l.state===gi&&(l.state=X),m}),this.hls.trigger(y.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(u=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){var d=h.partList;if(d&&a){i>e.end&&h.fragmentHint&&(e=h.fragmentHint);var f=this.getNextPart(d,e,i);if(f>-1){var c,v=d[f];return this.log("Loading part sn: "+e.sn+" p: "+v.index+" cc: "+e.cc+" of playlist ["+h.startSN+"-"+h.endSN+"] parts [0-"+f+"-"+(d.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=v.start+v.duration,this.state=be,c=u?u.then(function(m){return!m||l.fragContextChanged(m.frag)?null:l.doFragPartsLoad(e,v,r,a)}).catch(function(m){return l.handleFragLoadError(m)}):this.doFragPartsLoad(e,v,r,a).catch(function(m){return l.handleFragLoadError(m)}),this.hls.trigger(y.FRAG_LOADING,{frag:e,part:v,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(d,i))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(h?"of ["+h.startSN+"-"+h.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),N(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=be;var g,p=this.config.progressive;return g=p&&u?u.then(function(m){return!m||l.fragContextChanged(m==null?void 0:m.frag)?null:l.fragmentLoader.load(e,a)}).catch(function(m){return l.handleFragLoadError(m)}):Promise.all([this.fragmentLoader.load(e,p?a:void 0),u]).then(function(m){var E=m[0];return!p&&E&&a&&a(E),E}).catch(function(m){return l.handleFragLoadError(m)}),this.hls.trigger(y.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g},t.doFragPartsLoad=function(e,r,i,a){var o=this;return new Promise(function(l,h){var u,d=[],f=(u=i.details)==null?void 0:u.partList;(function c(v){o.fragmentLoader.loadPart(e,v,a).then(function(g){d[v.index]=g;var p=g.part;o.hls.trigger(y.FRAG_LOADED,g);var m=Kn(i,e.sn,v.index+1)||Hn(f,e.sn,v.index+1);if(!m)return l({frag:e,part:p,partsLoaded:d});c(m)}).catch(h)})(r)})},t.handleFragLoadError=function(e){if("data"in e){var r=e.data;e.data&&r.details===I.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(y.ERROR,r)}else this.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},t._handleTransmuxerFlush=function(e){var r=this.getCurrentContext(e);if(r&&this.state===Jt){var i=r.frag,a=r.part,o=r.level,l=self.performance.now();i.stats.parsing.end=l,a&&(a.stats.parsing.end=l),this.updateLevelTiming(i,a,o,e.partial)}else this.fragCurrent||this.state===Ot||this.state===De||(this.state=X)},t.getCurrentContext=function(e){var r=this.levels,i=this.fragCurrent,a=e.level,o=e.sn,l=e.part;if(r==null||!r[a])return this.warn("Levels object was unset while buffering fragment "+o+" of level "+a+". The current chunk will not be buffered."),null;var h=r[a],u=l>-1?Kn(h,o,l):null,d=u?u.fragment:function(f,c,v){if(f==null||!f.details)return null;var g=f.details,p=g.fragments[c-g.startSN];return p||((p=g.fragmentHint)&&p.sn===c?p:c<g.startSN&&v&&v.sn===c?v:null)}(h,o,i);return d?(i&&i!==d&&(d.stats=i.stats),{frag:d,part:u,level:h}):null},t.bufferFragmentData=function(e,r,i,a,o){var l;if(e&&this.state===Jt){var h=e.data1,u=e.data2,d=h;if(h&&u&&(d=Ft(h,u)),(l=d)!=null&&l.length){var f={type:e.type,frag:r,part:i,chunkMeta:a,parent:r.type,data:d};if(this.hls.trigger(y.BUFFER_APPENDING,f),e.dropped&&e.independent&&!i){if(o)return;this.flushBufferGap(r)}}}},t.flushBufferGap=function(e){var r=this.media;if(r)if(ut.isBuffered(r,r.currentTime)){var i=r.currentTime,a=ut.bufferInfo(r,i,0),o=e.duration,l=Math.min(2*this.config.maxFragLookUpTolerance,.25*o),h=Math.max(Math.min(e.start-l,a.end-l),i+l);e.start-h>l&&this.flushMainBuffer(h,e.start)}else this.flushMainBuffer(0,e.start)},t.getFwdBufferInfo=function(e,r){var i=this.getLoadPosition();return N(i)?this.getFwdBufferInfoAtPos(e,i,r):null},t.getFwdBufferInfoAtPos=function(e,r,i){var a=this.config.maxBufferHole,o=ut.bufferInfo(e,r,a);if(o.len===0&&o.nextStart!==void 0){var l=this.fragmentTracker.getBufferedFrag(r,i);if(l&&o.nextStart<l.end)return ut.bufferInfo(e,r,Math.max(o.nextStart,a))}return o},t.getMaxBufferLength=function(e){var r,i=this.config;return r=e?Math.max(8*i.maxBufferSize/e,i.maxBufferLength):i.maxBufferLength,Math.min(r,i.maxMaxBufferLength)},t.reduceMaxBufferLength=function(e,r){var i=this.config,a=Math.max(Math.min(e-r,i.maxBufferLength),r),o=Math.max(e-3*r,i.maxMaxBufferLength/2,a);return o>=a&&(i.maxMaxBufferLength=o,this.warn("Reduce max buffer length to "+o+"s"),!0)},t.getAppendedFrag=function(e,r){var i=this.fragmentTracker.getAppendedFrag(e,tt);return i&&"fragment"in i?i.fragment:i},t.getNextFragment=function(e,r){var i=r.fragments,a=i.length;if(!a)return null;var o,l=this.config,h=i[0].start;if(r.live){var u=l.initialLiveManifestSize;if(a<u)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+u+")"),null;(!r.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<h)&&(o=this.getInitialLiveFragment(r,i),this.startPosition=this.nextLoadPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=h&&(o=i[0]);if(!o){var d=l.lowLatencyMode?r.partEnd:r.fragmentEnd;o=this.getFragmentAtPosition(e,d,r)}return this.mapToInitFragWhenRequired(o)},t.isLoopLoading=function(e,r){var i=this.fragmentTracker.getState(e);return(i===He||i===Ae&&!!e.gap)&&this.nextLoadPosition>r},t.getNextFragmentLoopLoading=function(e,r,i,a,o){var l=e.gap,h=this.getNextFragment(this.nextLoadPosition,r);if(h===null)return h;if(e=h,l&&e&&!e.gap&&i.nextStart){var u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,a);if(u!==null&&i.len+u.len>=o)return this.log('buffer full after gaps in "'+a+'" playlist starting at sn: '+e.sn),null}return e},t.mapToInitFragWhenRequired=function(e){return e==null||!e.initSegment||e!=null&&e.initSegment.data||this.bitrateTest?e:e.initSegment},t.getNextPart=function(e,r,i){for(var a=-1,o=!1,l=!0,h=0,u=e.length;h<u;h++){var d=e[h];if(l=l&&!d.independent,a>-1&&i<d.start)break;var f=d.loaded;f?a=-1:(o||d.independent||l)&&d.fragment===r&&(a=h),o=f}return a},t.loadedEndOfParts=function(e,r){var i=e[e.length-1];return i&&r>i.start&&i.loaded},t.getInitialLiveFragment=function(e,r){var i=this.fragPrevious,a=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),a=function(u,d,f){if(d===null||!Array.isArray(u)||!u.length||!N(d)||d<(u[0].programDateTime||0)||d>=(u[u.length-1].endProgramDateTime||0))return null;f=f||0;for(var c=0;c<u.length;++c){var v=u[c];if($s(d,f,v))return v}return null}(r,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){var o=i.sn+1;if(o>=e.startSN&&o<=e.endSN){var l=r[o-e.startSN];i.cc===l.cc&&(a=l,this.log("Live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=function(u,d){return jn(u,function(f){return f.cc<d?1:f.cc>d?-1:0})}(r,i.cc),a&&this.log("Live playlist, switching playlist, load frag with same CC: "+a.sn))}}else{var h=this.hls.liveSyncPosition;h!==null&&(a=this.getFragmentAtPosition(h,this.bitrateTest?e.fragmentEnd:e.edge,e))}return a},t.getFragmentAtPosition=function(e,r,i){var a,o=this.config,l=this.fragPrevious,h=i.fragments,u=i.endSN,d=i.fragmentHint,f=o.maxFragLookUpTolerance,c=i.partList,v=!!(o.lowLatencyMode&&c!=null&&c.length&&d);if(v&&d&&!this.bitrateTest&&(h=h.concat(d),u=d.sn),a=e<r?fr(l,h,e,e>r-f?0:f):h[h.length-1]){var g=a.sn-i.startSN,p=this.fragmentTracker.getState(a);if((p===He||p===Ae&&a.gap)&&(l=a),l&&a.sn===l.sn&&(!v||c[0].fragment.sn>a.sn)&&l&&a.level===l.level){var m=h[g+1];a=a.sn<u&&this.fragmentTracker.getState(m)!==He?m:null}}return a},t.synchronizeToLiveEdge=function(e){var r=this.config,i=this.media;if(i){var a=this.hls.liveSyncPosition,o=i.currentTime,l=e.fragments[0].start,h=e.edge,u=o>=l-r.maxFragLookUpTolerance&&o<=h;if(a!==null&&i.duration>a&&(o<a||!u)){var d=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*e.targetduration;(!u&&i.readyState<4||o<h-d)&&(this.loadedmetadata||(this.nextLoadPosition=a),i.readyState&&(this.warn("Playback: "+o.toFixed(3)+" is located too far from the end of live sliding playlist: "+h+", reset currentTime to : "+a.toFixed(3)),i.currentTime=a))}}},t.alignPlaylists=function(e,r,i){var a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;var o=e.fragments[0].start,l=!r,h=e.alignedSliding&&N(o);if(l||!h&&!o){var u=this.fragPrevious;lo(u,i,e);var d=e.fragments[0].start;return this.log("Live playlist sliding: "+d.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+e.startSN+" prev-sn: "+(u?u.sn:"na")+" fragments: "+a),d}return o},t.waitForCdnTuneIn=function(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)},t.setStartPosition=function(e,r){var i=this.startPosition;if(i<r&&(i=-1),i===-1||this.lastCurrentTime===-1){var a=this.startTimeOffset!==null,o=a?this.startTimeOffset:e.startTimeOffset;o!==null&&N(o)?(i=r+o,o<0&&(i+=e.totalduration),i=Math.min(Math.max(r,i),r+e.totalduration),this.log("Start time offset "+o+" found in "+(a?"multivariant":"media")+" playlist, adjust startPosition to "+i),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||r:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},t.getLoadPosition=function(){var e=this.media,r=0;return this.loadedmetadata&&e?r=e.currentTime:this.nextLoadPosition&&(r=this.nextLoadPosition),r},t.handleFragLoadAborted=function(e,r){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(r?" part "+r.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},t.resetFragmentLoading=function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===ke)||(this.state=X)},t.onFragmentOrKeyLoadError=function(e,r){if(r.chunkMeta&&!r.frag){var i=this.getCurrentContext(r.chunkMeta);i&&(r.frag=i.frag)}var a=r.frag;if(a&&a.type===e&&this.levels)if(this.fragContextChanged(a)){var o;this.warn("Frag load error must match current frag to retry "+a.url+" > "+((o=this.fragCurrent)==null?void 0:o.url))}else{var l=r.details===I.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(a,!0);var h=r.errorAction,u=h||{},d=u.action,f=u.retryCount,c=f===void 0?0:f,v=u.retryConfig;if(h&&d===cr&&v){this.resetStartWhenNotLoaded(this.levelLastLoaded);var g=oi(v,c);this.warn("Fragment "+a.sn+" of "+e+" "+a.level+" errored with "+r.details+", retrying loading "+(c+1)+"/"+v.maxNumRetry+" in "+g+"ms"),h.resolved=!0,this.retryDate=self.performance.now()+g,this.state=ke}else if(v&&h){if(this.resetFragmentErrors(e),!(c<v.maxNumRetry))return void b.warn(r.details+" reached or exceeded max retry ("+c+")");l||d===Zs||(h.resolved=!0)}else(h==null?void 0:h.action)===Xt?this.state=de:this.state=De;this.tickImmediate()}},t.reduceLengthAndFlushBuffer=function(e){if(this.state===Jt||this.state===pr){var r=e.frag,i=e.parent,a=this.getFwdBufferInfo(this.mediaBuffer,i),o=a&&a.len>.5;o&&this.reduceMaxBufferLength(a.len,(r==null?void 0:r.duration)||10);var l=!o;return l&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+i+" buffer"),r&&(this.fragmentTracker.removeFragment(r),this.nextLoadPosition=r.start),this.resetLoadingState(),l}return!1},t.resetFragmentErrors=function(e){e===Mt&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Ot&&(this.state=X)},t.afterBufferFlushed=function(e,r,i){if(e){var a=ut.getBuffered(e);this.fragmentTracker.detectEvictedFragments(r,a,i),this.state===Ye&&this.resetLoadingState()}},t.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=X},t.resetStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var r=e?e.details:null;r!=null&&r.live?(this.startPosition=-1,this.setStartPosition(r,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},t.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of level "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()},t.removeUnbufferedFrags=function(e){e===void 0&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},t.updateLevelTiming=function(e,r,i,a){var o,l=this,h=i.details;if(h){if(!Object.keys(e.elementaryStreams).reduce(function(d,f){var c=e.elementaryStreams[f];if(c){var v=c.endPTS-c.startPTS;if(v<=0)return l.warn("Could not parse fragment "+e.sn+" "+f+" duration reliably ("+v+")"),d||!1;var g=a?0:Bn(h,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return l.hls.trigger(y.LEVEL_PTS_UPDATED,{details:h,level:i,drift:g,type:f,frag:e,start:c.startPTS,end:c.endPTS}),!0}return d},!1)&&((o=this.transmuxer)==null?void 0:o.error)===null){var u=new Error("Found no media in fragment "+e.sn+" of level "+e.level+" resetting transmuxer to fallback to playlist timing");if(i.fragmentError===0&&(i.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(u.message),this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:"Found no media in msn "+e.sn+' of level "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=pr,this.hls.trigger(y.FRAG_PARSED,{frag:e,part:r})}else this.warn("level.details undefined")},t.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},t.recoverWorkerError=function(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())},ct(n,[{key:"state",get:function(){return this._state},set:function(e){var r=this._state;r!==e&&(this._state=e,this.log(r+"->"+e))}}]),n}(ao),ia=function(){function s(){this.chunks=[],this.dataLength=0}var n=s.prototype;return n.push=function(t){this.chunks.push(t),this.dataLength+=t.length},n.flush=function(){var t,e=this.chunks,r=this.dataLength;return e.length?(t=e.length===1?e[0]:function(i,a){for(var o=new Uint8Array(a),l=0,h=0;h<i.length;h++){var u=i[h];o.set(u,l),l+=u.length}return o}(e,r),this.reset(),t):new Uint8Array(0)},n.reset=function(){this.chunks.length=0,this.dataLength=0},s}();function Wt(s,n){return s===void 0&&(s=""),n===void 0&&(n=9e4),{type:s,id:-1,pid:-1,inputTimeScale:n,sequenceNumber:-1,samples:[],dropped:0}}var mi=function(){function s(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var n=s.prototype;return n.resetInitSegment=function(t,e,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},n.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},n.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},n.canParse=function(t,e){return!1},n.appendFrame=function(t,e,r){},n.demux=function(t,e){this.cachedData&&(t=Ft(this.cachedData,t),this.cachedData=null);var r,i=Oe(t,0),a=i?i.length:0,o=this._audioTrack,l=this._id3Track,h=i?qr(i):void 0,u=t.length;for((this.basePTS===null||this.frameIndex===0&&N(h))&&(this.basePTS=vo(h,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Be,duration:Number.POSITIVE_INFINITY});a<u;){if(this.canParse(t,a)){var d=this.appendFrame(o,t,a);d?(this.frameIndex++,this.lastPTS=d.sample.pts,r=a+=d.length):a=u}else bs(t,a)?(i=Oe(t,a),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:Be,duration:Number.POSITIVE_INFINITY}),r=a+=i.length):a++;if(a===u&&r!==u){var f=se(t,r);this.cachedData?this.cachedData=Ft(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:Wt(),id3Track:l,textTrack:Wt()}},n.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},n.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Wt(),id3Track:this._id3Track,textTrack:Wt()}},n.destroy=function(){},s}(),vo=function(s,n,t){return N(s)?90*s:9e4*n+(t?9e4*t.baseTime/t.timescale:0)};function na(s,n){return s[n]===255&&(246&s[n+1])==240}function aa(s,n){return 1&s[n+1]?7:9}function pi(s,n){return(3&s[n+3])<<11|s[n+4]<<3|(224&s[n+5])>>>5}function yr(s,n){return n+1<s.length&&na(s,n)}function mo(s,n){if(yr(s,n)){var t=aa(s,n);if(n+t>=s.length)return!1;var e=pi(s,n);if(e<=t)return!1;var r=n+e;return r===s.length||yr(s,r)}return!1}function sa(s,n,t,e,r){if(!s.samplerate){var i=function(a,o,l,h){var u,d,f,c,v=navigator.userAgent.toLowerCase(),g=h,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];u=1+((192&o[l+2])>>>6);var m=(60&o[l+2])>>>2;if(!(m>p.length-1))return f=(1&o[l+2])<<2,f|=(192&o[l+3])>>>6,b.log("manifest codec:"+h+", ADTS type:"+u+", samplingIndex:"+m),/firefox/i.test(v)?m>=6?(u=5,c=new Array(4),d=m-3):(u=2,c=new Array(2),d=m):v.indexOf("android")!==-1?(u=2,c=new Array(2),d=m):(u=5,c=new Array(4),h&&(h.indexOf("mp4a.40.29")!==-1||h.indexOf("mp4a.40.5")!==-1)||!h&&m>=6?d=m-3:((h&&h.indexOf("mp4a.40.2")!==-1&&(m>=6&&f===1||/vivaldi/i.test(v))||!h&&f===1)&&(u=2,c=new Array(2)),d=m)),c[0]=u<<3,c[0]|=(14&m)>>1,c[1]|=(1&m)<<7,c[1]|=f<<3,u===5&&(c[1]|=(14&d)>>1,c[2]=(1&d)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:p[m],channelCount:f,codec:"mp4a.40."+u,manifestCodec:g};var E=new Error("invalid ADTS sampling index:"+m);a.emit(y.ERROR,y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message})}(n,t,e,r);if(!i)return;s.config=i.config,s.samplerate=i.samplerate,s.channelCount=i.channelCount,s.codec=i.codec,s.manifestCodec=i.manifestCodec,b.log("parsed codec:"+s.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function oa(s){return 9216e4/s}function la(s,n,t,e,r){var i,a=e+r*oa(s.samplerate),o=function(v,g){var p=aa(v,g);if(g+p<=v.length){var m=pi(v,g)-p;if(m>0)return{headerLength:p,frameLength:m}}}(n,t);if(o){var l=o.frameLength,h=o.headerLength,u=h+l,d=Math.max(0,t+u-n.length);d?(i=new Uint8Array(u-h)).set(n.subarray(t+h,n.length),0):i=n.subarray(t+h,t+u);var f={unit:i,pts:a};return d||s.samples.push(f),{sample:f,length:u,missing:d}}var c=n.length-t;return(i=new Uint8Array(c)).set(n.subarray(t,n.length),0),{sample:{unit:i,pts:a},length:c,missing:-1}}var Er=null,po=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],yo=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Eo=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],To=[0,1,1,4];function ua(s,n,t,e,r){if(!(t+24>n.length)){var i=ha(n,t);if(i&&t+i.frameLength<=n.length){var a=e+r*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:n.subarray(t,t+i.frameLength),pts:a,dts:a};return s.config=[],s.channelCount=i.channelCount,s.samplerate=i.sampleRate,s.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}}function ha(s,n){var t=s[n+1]>>3&3,e=s[n+1]>>1&3,r=s[n+2]>>4&15,i=s[n+2]>>2&3;if(t!==1&&r!==0&&r!==15&&i!==3){var a=s[n+2]>>1&1,o=s[n+3]>>6,l=1e3*po[14*(t===3?3-e:e===3?3:4)+r-1],h=yo[3*(t===3?0:t===2?1:2)+i],u=o===3?1:2,d=Eo[t][e],f=To[e],c=8*d*f,v=Math.floor(d*l/h+a)*f;if(Er===null){var g=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Er=g?parseInt(g[1]):0}return Er&&Er<=87&&e===2&&l>=224e3&&o===0&&(s[n+3]=128|s[n+3]),{sampleRate:h,channelCount:u,frameLength:v,samplesPerFrame:c}}}function yi(s,n){return s[n]===255&&(224&s[n+1])==224&&(6&s[n+1])!=0}function da(s,n){return n+1<s.length&&yi(s,n)}function fa(s,n){if(n+1<s.length&&yi(s,n)){var t=ha(s,n),e=4;t!=null&&t.frameLength&&(e=t.frameLength);var r=n+e;return r===s.length||da(s,r)}return!1}var So=function(s){function n(e,r){var i;return(i=s.call(this)||this).observer=void 0,i.config=void 0,i.observer=e,i.config=r,i}Lt(n,s);var t=n.prototype;return t.resetInitSegment=function(e,r,i,a){s.prototype.resetInitSegment.call(this,e,r,i,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:a,inputTimeScale:9e4,dropped:0}},n.probe=function(e){if(!e)return!1;var r=Oe(e,0),i=(r==null?void 0:r.length)||0;if(fa(e,i))return!1;for(var a=e.length;i<a;i++)if(mo(e,i))return b.log("ADTS sync word found !"),!0;return!1},t.canParse=function(e,r){return function(i,a){return function(o,l){return l+5<o.length}(i,a)&&na(i,a)&&pi(i,a)<=i.length-a}(e,r)},t.appendFrame=function(e,r,i){sa(e,this.observer,r,i,e.manifestCodec);var a=la(e,r,i,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a},n}(mi),Lo=/\/emsg[-/]ID3/i,Ao=function(){function s(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}var n=s.prototype;return n.resetTimeStamp=function(){},n.resetInitSegment=function(t,e,r,i){var a=this.videoTrack=Wt("video",1),o=this.audioTrack=Wt("audio",1),l=this.txtTrack=Wt("text",1);if(this.id3Track=Wt("id3",1),this.timeOffset=0,t!=null&&t.byteLength){var h=dn(t);if(h.video){var u=h.video,d=u.id,f=u.timescale,c=u.codec;a.id=d,a.timescale=l.timescale=f,a.codec=c}if(h.audio){var v=h.audio,g=v.id,p=v.timescale,m=v.codec;o.id=g,o.timescale=p,o.codec=m}l.id=on.text,a.sampleDuration=0,a.duration=o.duration=i}},n.resetContiguity=function(){this.remainderData=null},s.probe=function(t){return function(e){for(var r=e.byteLength,i=0;i<r;){var a=H(e,i);if(a>8&&e[i+4]===109&&e[i+5]===111&&e[i+6]===111&&e[i+7]===102)return!0;i=a>1?i+a:r}return!1}(t)},n.demux=function(t,e){this.timeOffset=e;var r=t,i=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ft(this.remainderData,t));var o=function(h){var u={valid:null,remainder:null},d=q(h,["moof"]);if(d.length<2)return u.remainder=h,u;var f=d[d.length-1];return u.valid=se(h,0,f.byteOffset-8),u.remainder=se(h,f.byteOffset-8),u}(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;var l=this.extractID3Track(i,e);return a.samples=cn(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},n.flush=function(){var t=this.timeOffset,e=this.videoTrack,r=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(e,this.timeOffset);return r.samples=cn(t,e),{videoTrack:e,audioTrack:Wt(),id3Track:i,textTrack:Wt()}},n.extractID3Track=function(t,e){var r=this.id3Track;if(t.samples.length){var i=q(t.samples,["emsg"]);i&&i.forEach(function(a){var o=function(d){var f=d[0],c="",v="",g=0,p=0,m=0,E=0,T=0,S=0;if(f===0){for(;mt(d.subarray(S,S+1))!=="\0";)c+=mt(d.subarray(S,S+1)),S+=1;for(c+=mt(d.subarray(S,S+1)),S+=1;mt(d.subarray(S,S+1))!=="\0";)v+=mt(d.subarray(S,S+1)),S+=1;v+=mt(d.subarray(S,S+1)),S+=1,g=H(d,12),p=H(d,16),E=H(d,20),T=H(d,24),S=28}else if(f===1){g=H(d,S+=4);var R=H(d,S+=4),A=H(d,S+=4);for(S+=4,m=Math.pow(2,32)*R+A,cs(m)||(m=Number.MAX_SAFE_INTEGER,b.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),E=H(d,S),T=H(d,S+=4),S+=4;mt(d.subarray(S,S+1))!=="\0";)c+=mt(d.subarray(S,S+1)),S+=1;for(c+=mt(d.subarray(S,S+1)),S+=1;mt(d.subarray(S,S+1))!=="\0";)v+=mt(d.subarray(S,S+1)),S+=1;v+=mt(d.subarray(S,S+1)),S+=1}return{schemeIdUri:c,value:v,timeScale:g,presentationTime:m,presentationTimeDelta:p,eventDuration:E,id:T,payload:d.subarray(S,d.byteLength)}}(a);if(Lo.test(o.schemeIdUri)){var l=N(o.presentationTime)?o.presentationTime/o.timeScale:e+o.presentationTimeDelta/o.timeScale,h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);var u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:l,pts:l,type:Ge,duration:h})}})}return r},n.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},n.destroy=function(){},s}(),ca=function(s,n){var t=0,e=5;n+=e;for(var r=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);e>0;){a[0]=s[n];var o=Math.min(e,8),l=8-o;i[0]=4278190080>>>24+l<<l,r[0]=(a[0]&i[0])>>l,t=t?t<<o|r[0]:r[0],n+=1,e-=o}return t},Ro=function(s){function n(e){var r;return(r=s.call(this)||this).observer=void 0,r.observer=e,r}Lt(n,s);var t=n.prototype;return t.resetInitSegment=function(e,r,i,a){s.prototype.resetInitSegment.call(this,e,r,i,a),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:r,duration:a,inputTimeScale:9e4,dropped:0}},t.canParse=function(e,r){return r+64<e.length},t.appendFrame=function(e,r,i){var a=ga(e,r,i,this.basePTS,this.frameIndex);if(a!==-1)return{sample:e.samples[e.samples.length-1],length:a,missing:0}},n.probe=function(e){if(!e)return!1;var r=Oe(e,0);if(!r)return!1;var i=r.length;return e[i]===11&&e[i+1]===119&&qr(r)!==void 0&&ca(e,i)<16},n}(mi);function ga(s,n,t,e,r){if(t+8>n.length||n[t]!==11||n[t+1]!==119)return-1;var i=n[t+4]>>6;if(i>=3)return-1;var a=[48e3,44100,32e3][i],o=63&n[t+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+i];if(t+l>n.length)return-1;var h=n[t+6]>>5,u=0;h===2?u+=2:(1&h&&h!==1&&(u+=2),4&h&&(u+=2));var d=(n[t+6]<<8|n[t+7])>>12-u&1,f=[2,1,2,3,3,4,4,5][h]+d,c=n[t+5]>>3,v=7&n[t+5],g=new Uint8Array([i<<6|c<<1|v>>2,(3&v)<<6|h<<3|d<<2|o>>4,o<<4&224]),p=e+r*(1536/a*9e4),m=n.subarray(t,t+l);return s.config=g,s.channelCount=f,s.samplerate=a,s.samples.push({unit:m,pts:p}),l}var bo=function(){function s(){this.VideoSample=null}var n=s.prototype;return n.createVideoSample=function(t,e,r,i){return{key:t,frame:!1,pts:e,dts:r,units:[],debug:i,length:0}},n.getLastNalUnit=function(t){var e,r,i=this.VideoSample;if(i&&i.units.length!==0||(i=t[t.length-1]),(e=i)!=null&&e.units){var a=i.units;r=a[a.length-1]}return r},n.pushAccessUnit=function(t,e){if(t.units.length&&t.frame){if(t.pts===void 0){var r=e.samples,i=r.length;if(!i)return void e.dropped++;var a=r[i-1];t.pts=a.pts,t.dts=a.dts}e.samples.push(t)}t.debug.length&&b.log(t.pts+"/"+t.dts+":"+t.debug)},s}(),va=function(){function s(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var n=s.prototype;return n.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),a=Math.min(4,e);if(a===0)throw new Error("no bytes available");i.set(t.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},n.skipBits=function(t){var e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},n.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;if(t>32&&b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(e=t-e)>0&&this.bitsAvailable?r<<e|this.readBits(e):r},n.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(this.word&2147483648>>>t)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},n.skipUEG=function(){this.skipBits(1+this.skipLZ())},n.skipEG=function(){this.skipBits(1+this.skipLZ())},n.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},n.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},n.readBoolean=function(){return this.readBits(1)===1},n.readUByte=function(){return this.readBits(8)},n.readUShort=function(){return this.readBits(16)},n.readUInt=function(){return this.readBits(32)},n.skipScalingList=function(t){for(var e=8,r=8,i=0;i<t;i++)r!==0&&(r=(e+this.readEG()+256)%256),e=r===0?e:r},n.readSPS=function(){var t,e,r,i=0,a=0,o=0,l=0,h=this.readUByte.bind(this),u=this.readBits.bind(this),d=this.readUEG.bind(this),f=this.readBoolean.bind(this),c=this.skipBits.bind(this),v=this.skipEG.bind(this),g=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);h();var m=h();if(u(5),c(3),h(),g(),m===100||m===110||m===122||m===244||m===44||m===83||m===86||m===118||m===128){var E=d();if(E===3&&c(1),g(),g(),c(1),f())for(e=E!==3?8:12,r=0;r<e;r++)f()&&p(r<6?16:64)}g();var T=d();if(T===0)d();else if(T===1)for(c(1),v(),v(),t=d(),r=0;r<t;r++)v();g(),c(1);var S=d(),R=d(),A=u(1);A===0&&c(1),c(1),f()&&(i=d(),a=d(),o=d(),l=d());var L=[1,1];if(f()&&f())switch(h()){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:L=[h()<<8|h(),h()<<8|h()]}return{width:Math.ceil(16*(S+1)-2*i-2*a),height:(2-A)*(R+1)*16-(A?2:4)*(o+l),pixelRatio:L}},n.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},s}(),ko=function(s){function n(){return s.apply(this,arguments)||this}Lt(n,s);var t=n.prototype;return t.parseAVCPES=function(e,r,i,a,o){var l,h=this,u=this.parseAVCNALu(e,i.data),d=this.VideoSample,f=!1;i.data=null,d&&u.length&&!e.audFound&&(this.pushAccessUnit(d,e),d=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts,"")),u.forEach(function(c){var v;switch(c.type){case 1:var g=!1;l=!0;var p,m=c.data;if(f&&m.length>4){var E=new va(m).readSliceType();E!==2&&E!==4&&E!==7&&E!==9||(g=!0)}g&&(p=d)!=null&&p.frame&&!d.key&&(h.pushAccessUnit(d,e),d=h.VideoSample=null),d||(d=h.VideoSample=h.createVideoSample(!0,i.pts,i.dts,"")),d.frame=!0,d.key=g;break;case 5:l=!0,(v=d)!=null&&v.frame&&!d.key&&(h.pushAccessUnit(d,e),d=h.VideoSample=null),d||(d=h.VideoSample=h.createVideoSample(!0,i.pts,i.dts,"")),d.key=!0,d.frame=!0;break;case 6:l=!0,gn(c.data,1,i.pts,r.samples);break;case 7:var T,S;l=!0,f=!0;var R=c.data,A=new va(R).readSPS();if(!e.sps||e.width!==A.width||e.height!==A.height||((T=e.pixelRatio)==null?void 0:T[0])!==A.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==A.pixelRatio[1]){e.width=A.width,e.height=A.height,e.pixelRatio=A.pixelRatio,e.sps=[R],e.duration=o;for(var L=R.subarray(1,4),w="avc1.",k=0;k<3;k++){var C=L[k].toString(16);C.length<2&&(C="0"+C),w+=C}e.codec=w}break;case 8:l=!0,e.pps=[c.data];break;case 9:l=!0,e.audFound=!0,d&&h.pushAccessUnit(d,e),d=h.VideoSample=h.createVideoSample(!1,i.pts,i.dts,"");break;case 12:l=!0;break;default:l=!1,d&&(d.debug+="unknown NAL "+c.type+" ")}d&&l&&d.units.push(c)}),a&&d&&(this.pushAccessUnit(d,e),this.VideoSample=null)},t.parseAVCNALu=function(e,r){var i,a,o=r.byteLength,l=e.naluState||0,h=l,u=[],d=0,f=-1,c=0;for(l===-1&&(f=0,c=31&r[0],l=0,d=1);d<o;)if(i=r[d++],l)if(l!==1)if(i)if(i===1){if(a=d-l-1,f>=0){var v={data:r.subarray(f,a),type:c};u.push(v)}else{var g=this.getLastNalUnit(e.samples);g&&(h&&d<=4-h&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-h)),a>0&&(g.data=Ft(g.data,r.subarray(0,a)),g.state=0))}d<o?(f=d,c=31&r[d],l=0):l=-1}else l=0;else l=3;else l=i?0:2;else l=i?0:1;if(f>=0&&l>=0){var p={data:r.subarray(f,o),type:c,state:l};u.push(p)}if(u.length===0){var m=this.getLastNalUnit(e.samples);m&&(m.data=Ft(m.data,r))}return e.naluState=l,u},n}(bo),Do=function(){function s(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new ci(e,{removePKCS7Padding:!1})}var n=s.prototype;return n.decryptBuffer=function(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)},n.decryptAacSample=function(t,e,r){var i=this,a=t[e].unit;if(!(a.length<=16)){var o=a.subarray(16,a.length-a.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then(function(h){var u=new Uint8Array(h);a.set(u,16),i.decrypter.isSync()||i.decryptAacSamples(t,e+1,r)})}},n.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32||(this.decryptAacSample(t,e,r),this.decrypter.isSync())))return}},n.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,a=32;a<t.length-16;a+=160,i+=16)r.set(t.subarray(a,a+16),i);return r},n.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),i=0,a=32;a<t.length-16;a+=160,i+=16)t.set(r.subarray(i,i+16),a);return t},n.decryptAvcSample=function(t,e,r,i,a){var o=this,l=vn(a.data),h=this.getAvcEncryptedData(l);this.decryptBuffer(h.buffer).then(function(u){a.data=o.getAvcDecryptedUnit(l,u),o.decrypter.isSync()||o.decryptAvcSamples(t,e,r+1,i)})},n.decryptAvcSamples=function(t,e,r,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void i();for(var a=t[e].units;!(r>=a.length);r++){var o=a[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5||(this.decryptAvcSample(t,e,r,i,o),this.decrypter.isSync())))return}}},s}(),At=188,wo=function(){function s(t,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=r,this.videoParser=new ko}s.probe=function(t){var e=s.syncOffset(t);return e>0&&b.warn("MPEG2-TS detected but first sync word found @ offset "+e),e!==-1},s.syncOffset=function(t){for(var e=t.length,r=Math.min(940,e-At)+1,i=0;i<r;){for(var a=!1,o=-1,l=0,h=i;h<e;h+=At){if(t[h]!==71||e-h!==At&&t[h+At]!==71){if(l)return-1;break}if(l++,o===-1&&(o=h)!==0&&(r=Math.min(o+18612,t.length-At)+1),a||(a=Ei(t,h)===0),a&&l>1&&(o===0&&l>2||h+At>r))return o}i++}return-1},s.createTrack=function(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:on[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}};var n=s.prototype;return n.resetInitSegment=function(t,e,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=s.createTrack("video"),this._audioTrack=s.createTrack("audio",i),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=r,this._duration=i},n.resetTimeStamp=function(){},n.resetContiguity=function(){var t=this._audioTrack,e=this._videoTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null},n.demux=function(t,e,r,i){var a;r===void 0&&(r=!1),i===void 0&&(i=!1),r||(this.sampleAes=null);var o=this._videoTrack,l=this._audioTrack,h=this._id3Track,u=this._txtTrack,d=o.pid,f=o.pesData,c=l.pid,v=h.pid,g=l.pesData,p=h.pesData,m=null,E=this.pmtParsed,T=this._pmtId,S=t.length;if(this.remainderData&&(S=(t=Ft(this.remainderData,t)).length,this.remainderData=null),S<At&&!i)return this.remainderData=t,{audioTrack:l,videoTrack:o,id3Track:h,textTrack:u};var R=Math.max(0,s.syncOffset(t));(S-=(S-R)%At)<t.byteLength&&!i&&(this.remainderData=new Uint8Array(t.buffer,S,t.buffer.byteLength-S));for(var A=0,L=R;L<S;L+=At)if(t[L]===71){var w=!!(64&t[L+1]),k=Ei(t,L),C=void 0;if((48&t[L+3])>>4>1){if((C=L+5+t[L+4])===L+At)continue}else C=L+4;switch(k){case d:w&&(f&&(a=we(f))&&this.videoParser.parseAVCPES(o,u,a,!1,this._duration),f={data:[],size:0}),f&&(f.data.push(t.subarray(C,L+At)),f.size+=L+At-C);break;case c:if(w){if(g&&(a=we(g)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,a);break;case"mp3":this.parseMPEGPES(l,a);break;case"ac3":this.parseAC3PES(l,a)}g={data:[],size:0}}g&&(g.data.push(t.subarray(C,L+At)),g.size+=L+At-C);break;case v:w&&(p&&(a=we(p))&&this.parseID3PES(h,a),p={data:[],size:0}),p&&(p.data.push(t.subarray(C,L+At)),p.size+=L+At-C);break;case 0:w&&(C+=t[C]+1),T=this._pmtId=Io(t,C);break;case T:w&&(C+=t[C]+1);var D=Co(t,C,this.typeSupported,r,this.observer);(d=D.videoPid)>0&&(o.pid=d,o.segmentCodec=D.segmentVideoCodec),(c=D.audioPid)>0&&(l.pid=c,l.segmentCodec=D.segmentAudioCodec),(v=D.id3Pid)>0&&(h.pid=v),m===null||E||(b.warn("MPEG-TS PMT found at "+L+" after unknown PID '"+m+"'. Backtracking to sync byte @"+R+" to parse all TS packets."),m=null,L=R-188),E=this.pmtParsed=!0;break;case 17:case 8191:break;default:m=k}}else A++;A>0&&Tr(this.observer,new Error("Found "+A+" TS packet/s that do not start with 0x47")),o.pesData=f,l.pesData=g,h.pesData=p;var _={audioTrack:l,videoTrack:o,id3Track:h,textTrack:u};return i&&this.extractRemainingSamples(_),_},n.flush=function(){var t,e=this.remainderData;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},n.extractRemainingSamples=function(t){var e,r=t.audioTrack,i=t.videoTrack,a=t.id3Track,o=t.textTrack,l=i.pesData,h=r.pesData,u=a.pesData;if(l&&(e=we(l))?(this.videoParser.parseAVCPES(i,o,e,!0,this._duration),i.pesData=null):i.pesData=l,h&&(e=we(h))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,e);break;case"mp3":this.parseMPEGPES(r,e);break;case"ac3":this.parseAC3PES(r,e)}r.pesData=null}else h!=null&&h.size&&b.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=h;u&&(e=we(u))?(this.parseID3PES(a,e),a.pesData=null):a.pesData=u},n.demuxSampleAes=function(t,e,r){var i=this.demux(t,r,!0,!this.config.progressive),a=this.sampleAes=new Do(this.observer,this.config,e);return this.decrypt(i,a)},n.decrypt=function(t,e){return new Promise(function(r){var i=t.audioTrack,a=t.videoTrack;i.samples&&i.segmentCodec==="aac"?e.decryptAacSamples(i.samples,0,function(){a.samples?e.decryptAvcSamples(a.samples,0,0,function(){r(t)}):r(t)}):a.samples&&e.decryptAvcSamples(a.samples,0,0,function(){r(t)})})},n.destroy=function(){this._duration=0},n.parseAACPES=function(t,e){var r,i,a,o=0,l=this.aacOverFlow,h=e.data;if(l){this.aacOverFlow=null;var u=l.missing,d=l.sample.unit.byteLength;if(u===-1)h=Ft(l.sample.unit,h);else{var f=d-u;l.sample.unit.set(h.subarray(0,u),f),t.samples.push(l.sample),o=l.missing}}for(r=o,i=h.length;r<i-1&&!yr(h,r);r++);if(r!==o){var c,v=r<i-1;if(c=v?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES",Tr(this.observer,new Error(c),v),!v)return}if(sa(t,this.observer,h,r,this.audioCodec),e.pts!==void 0)a=e.pts;else{if(!l)return void b.warn("[tsdemuxer]: AAC PES unknown PTS");var g=oa(t.samplerate);a=l.sample.pts+g}for(var p,m=0;r<i;){if(r+=(p=la(t,h,r,a,m)).length,p.missing){this.aacOverFlow=p;break}for(m++;r<i-1&&!yr(h,r);r++);}},n.parseMPEGPES=function(t,e){var r=e.data,i=r.length,a=0,o=0,l=e.pts;if(l!==void 0)for(;o<i;)if(da(r,o)){var h=ua(t,r,o,l,a);if(!h)break;o+=h.length,a++}else o++;else b.warn("[tsdemuxer]: MPEG PES unknown PTS")},n.parseAC3PES=function(t,e){var r=e.data,i=e.pts;if(i!==void 0)for(var a,o=r.length,l=0,h=0;h<o&&(a=ga(t,r,h,i,l++))>0;)h+=a;else b.warn("[tsdemuxer]: AC3 PES unknown PTS")},n.parseID3PES=function(t,e){if(e.pts!==void 0){var r=gt({},e,{type:this._videoTrack?Ge:Be,duration:Number.POSITIVE_INFINITY});t.samples.push(r)}else b.warn("[tsdemuxer]: ID3 PES unknown PTS")},s}();function Ei(s,n){return((31&s[n+1])<<8)+s[n+2]}function Io(s,n){return(31&s[n+10])<<8|s[n+11]}function Co(s,n,t,e,r){var i={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},a=n+3+((15&s[n+1])<<8|s[n+2])-4;for(n+=12+((15&s[n+10])<<8|s[n+11]);n<a;){var o=Ei(s,n),l=(15&s[n+3])<<8|s[n+4];switch(s[n]){case 207:if(!e){Ti("ADTS AAC");break}case 15:i.audioPid===-1&&(i.audioPid=o);break;case 21:i.id3Pid===-1&&(i.id3Pid=o);break;case 219:if(!e){Ti("H.264");break}case 27:i.videoPid===-1&&(i.videoPid=o,i.segmentVideoCodec="avc");break;case 3:case 4:t.mpeg||t.mp3?i.audioPid===-1&&(i.audioPid=o,i.segmentAudioCodec="mp3"):b.log("MPEG audio found, not supported in this browser");break;case 193:if(!e){Ti("AC-3");break}case 129:t.ac3?i.audioPid===-1&&(i.audioPid=o,i.segmentAudioCodec="ac3"):b.log("AC-3 audio found, not supported in this browser");break;case 6:if(i.audioPid===-1&&l>0)for(var h=n+5,u=l;u>2;){s[h]===106&&(t.ac3!==!0?b.log("AC-3 audio found, not supported in this browser for now"):(i.audioPid=o,i.segmentAudioCodec="ac3"));var d=s[h+1]+2;h+=d,u-=d}break;case 194:case 135:return Tr(r,new Error("Unsupported EC-3 in M2TS found")),i;case 36:return Tr(r,new Error("Unsupported HEVC in M2TS found")),i}n+=l+5}return i}function Tr(s,n,t){b.warn("parsing error: "+n.message),s.emit(y.ERROR,y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:n,reason:n.message})}function Ti(s){b.log(s+" with AES-128-CBC encryption found in unencrypted stream")}function we(s){var n,t,e,r,i,a=0,o=s.data;if(!s||s.size===0)return null;for(;o[0].length<19&&o.length>1;)o[0]=Ft(o[0],o[1]),o.splice(1,1);if(((n=o[0])[0]<<16)+(n[1]<<8)+n[2]===1){if((t=(n[4]<<8)+n[5])&&t>s.size-6)return null;var l=n[7];192&l&&(r=536870912*(14&n[9])+4194304*(255&n[10])+16384*(254&n[11])+128*(255&n[12])+(254&n[13])/2,64&l?r-(i=536870912*(14&n[14])+4194304*(255&n[15])+16384*(254&n[16])+128*(255&n[17])+(254&n[18])/2)>54e5&&(b.warn(Math.round((r-i)/9e4)+"s delta between PTS and DTS, align them"),r=i):i=r);var h=(e=n[8])+9;if(s.size<=h)return null;s.size-=h;for(var u=new Uint8Array(s.size),d=0,f=o.length;d<f;d++){var c=(n=o[d]).byteLength;if(h){if(h>c){h-=c;continue}n=n.subarray(h),c-=h,h=0}u.set(n,a),a+=c}return t&&(t-=e+3),{data:u,pts:r,dts:i,len:t}}return null}var _o=function(s){function n(){return s.apply(this,arguments)||this}Lt(n,s);var t=n.prototype;return t.resetInitSegment=function(e,r,i,a){s.prototype.resetInitSegment.call(this,e,r,i,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:a,inputTimeScale:9e4,dropped:0}},n.probe=function(e){if(!e)return!1;var r=Oe(e,0),i=(r==null?void 0:r.length)||0;if(r&&e[i]===11&&e[i+1]===119&&qr(r)!==void 0&&ca(e,i)<=16)return!1;for(var a=e.length;i<a;i++)if(fa(e,i))return b.log("MPEG Audio sync word found !"),!0;return!1},t.canParse=function(e,r){return function(i,a){return yi(i,a)&&4<=i.length-a}(e,r)},t.appendFrame=function(e,r,i){if(this.basePTS!==null)return ua(e,r,i,this.basePTS,this.frameIndex)},n}(mi),ma=function(){function s(){}return s.getSilentFrame=function(n,t){if(n==="mp4a.40.2"){if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},s}(),ie=Math.pow(2,32)-1,St=function(){function s(){}return s.init=function(){var n;for(n in s.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},s.types)s.types.hasOwnProperty(n)&&(s.types[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);var t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),e=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);s.HDLR_TYPES={video:t,audio:e};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);s.STTS=s.STSC=s.STCO=i,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);s.FTYP=s.box(s.types.ftyp,a,l,a,o),s.DINF=s.box(s.types.dinf,s.box(s.types.dref,r))},s.box=function(n){for(var t=8,e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];for(var a=r.length,o=a;a--;)t+=r[a].byteLength;var l=new Uint8Array(t);for(l[0]=t>>24&255,l[1]=t>>16&255,l[2]=t>>8&255,l[3]=255&t,l.set(n,4),a=0,t=8;a<o;a++)l.set(r[a],t),t+=r[a].byteLength;return l},s.hdlr=function(n){return s.box(s.types.hdlr,s.HDLR_TYPES[n])},s.mdat=function(n){return s.box(s.types.mdat,n)},s.mdhd=function(n,t){t*=n;var e=Math.floor(t/(ie+1)),r=Math.floor(t%(ie+1));return s.box(s.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},s.mdia=function(n){return s.box(s.types.mdia,s.mdhd(n.timescale,n.duration),s.hdlr(n.type),s.minf(n))},s.mfhd=function(n){return s.box(s.types.mfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]))},s.minf=function(n){return n.type==="audio"?s.box(s.types.minf,s.box(s.types.smhd,s.SMHD),s.DINF,s.stbl(n)):s.box(s.types.minf,s.box(s.types.vmhd,s.VMHD),s.DINF,s.stbl(n))},s.moof=function(n,t,e){return s.box(s.types.moof,s.mfhd(n),s.traf(e,t))},s.moov=function(n){for(var t=n.length,e=[];t--;)e[t]=s.trak(n[t]);return s.box.apply(null,[s.types.moov,s.mvhd(n[0].timescale,n[0].duration)].concat(e).concat(s.mvex(n)))},s.mvex=function(n){for(var t=n.length,e=[];t--;)e[t]=s.trex(n[t]);return s.box.apply(null,[s.types.mvex].concat(e))},s.mvhd=function(n,t){t*=n;var e=Math.floor(t/(ie+1)),r=Math.floor(t%(ie+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.box(s.types.mvhd,i)},s.sdtp=function(n){var t,e,r=n.samples||[],i=new Uint8Array(4+r.length);for(t=0;t<r.length;t++)e=r[t].flags,i[t+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return s.box(s.types.sdtp,i)},s.stbl=function(n){return s.box(s.types.stbl,s.stsd(n),s.box(s.types.stts,s.STTS),s.box(s.types.stsc,s.STSC),s.box(s.types.stsz,s.STSZ),s.box(s.types.stco,s.STCO))},s.avc1=function(n){var t,e,r,i=[],a=[];for(t=0;t<n.sps.length;t++)r=(e=n.sps[t]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(e));for(t=0;t<n.pps.length;t++)r=(e=n.pps[t]).byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(e));var o=s.box(s.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|n.sps.length].concat(i).concat([n.pps.length]).concat(a))),l=n.width,h=n.height,u=n.pixelRatio[0],d=n.pixelRatio[1];return s.box(s.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,h>>8&255,255&h,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},s.esds=function(n){var t=n.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(n.config).concat([6,1,2]))},s.audioStsd=function(n){var t=n.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n.channelCount,0,16,0,0,0,0,t>>8&255,255&t,0,0])},s.mp4a=function(n){return s.box(s.types.mp4a,s.audioStsd(n),s.box(s.types.esds,s.esds(n)))},s.mp3=function(n){return s.box(s.types[".mp3"],s.audioStsd(n))},s.ac3=function(n){return s.box(s.types["ac-3"],s.audioStsd(n),s.box(s.types.dac3,n.config))},s.stsd=function(n){return n.type==="audio"?n.segmentCodec==="mp3"&&n.codec==="mp3"?s.box(s.types.stsd,s.STSD,s.mp3(n)):n.segmentCodec==="ac3"?s.box(s.types.stsd,s.STSD,s.ac3(n)):s.box(s.types.stsd,s.STSD,s.mp4a(n)):s.box(s.types.stsd,s.STSD,s.avc1(n))},s.tkhd=function(n){var t=n.id,e=n.duration*n.timescale,r=n.width,i=n.height,a=Math.floor(e/(ie+1)),o=Math.floor(e%(ie+1));return s.box(s.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))},s.traf=function(n,t){var e=s.sdtp(n),r=n.id,i=Math.floor(t/(ie+1)),a=Math.floor(t%(ie+1));return s.box(s.types.traf,s.box(s.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),s.box(s.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a])),s.trun(n,e.length+16+20+8+16+8+8),e)},s.trak=function(n){return n.duration=n.duration||4294967295,s.box(s.types.trak,s.tkhd(n),s.mdia(n))},s.trex=function(n){var t=n.id;return s.box(s.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},s.trun=function(n,t){var e,r,i,a,o,l,h=n.samples||[],u=h.length,d=12+16*u,f=new Uint8Array(d);for(t+=8+d,f.set([n.type==="video"?1:0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),e=0;e<u;e++)i=(r=h[e]).duration,a=r.size,o=r.flags,l=r.cts,f.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*e);return s.box(s.types.trun,f)},s.initSegment=function(n){s.types||s.init();var t=s.moov(n);return Ft(s.FTYP,t)},s}();St.types=void 0,St.HDLR_TYPES=void 0,St.STTS=void 0,St.STSC=void 0,St.STCO=void 0,St.STSZ=void 0,St.VMHD=void 0,St.SMHD=void 0,St.STSD=void 0,St.FTYP=void 0,St.DINF=void 0;var pa=9e4;function Si(s,n,t,e){t===void 0&&(t=1),e===void 0&&(e=!1);var r=s*n*t;return e?Math.round(r):r}function je(s,n){return Si(s,1e3,1/pa,n)}var Ie=null,Li=null,Sr=function(){function s(t,e,r,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,Ie===null){var a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ie=a?parseInt(a[1]):0}if(Li===null){var o=navigator.userAgent.match(/Safari\/(\d+)/i);Li=o?parseInt(o[1]):0}}var n=s.prototype;return n.destroy=function(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null},n.resetTimeStamp=function(t){b.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},n.resetNextTimestamp=function(){b.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},n.resetInitSegment=function(){b.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0},n.getVideoStartPts=function(t){var e=!1,r=t[0].pts,i=t.reduce(function(a,o){var l=o.pts,h=l-a;return h<-4294967296&&(e=!0,h=(l=Nt(l,r))-a),h>0?a:l},r);return e&&b.debug("PTS rollover detected"),i},n.remux=function(t,e,r,i,a,o,l,h){var u,d,f,c,v,g,p=a,m=a,E=t.pid>-1,T=e.pid>-1,S=e.samples.length,R=t.samples.length>0,A=l&&S>0||S>1;if((!E||R)&&(!T||A)||this.ISGenerated||l){if(this.ISGenerated){var L,w,k,C,D=this.videoTrackConfig;!D||e.width===D.width&&e.height===D.height&&((L=e.pixelRatio)==null?void 0:L[0])===((w=D.pixelRatio)==null?void 0:w[0])&&((k=e.pixelRatio)==null?void 0:k[1])===((C=D.pixelRatio)==null?void 0:C[1])||this.resetInitSegment()}else f=this.generateIS(t,e,a,o);var _,x=this.isVideoContiguous,P=-1;if(A&&(P=function(B){for(var G=0;G<B.length;G++)if(B[G].key)return G;return-1}(e.samples),!x&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,P>0){b.warn("[mp4-remuxer]: Dropped "+P+" out of "+S+" video samples due to a missing keyframe");var M=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(P),e.dropped+=P,_=m+=(e.samples[0].pts-M)/e.inputTimeScale}else P===-1&&(b.warn("[mp4-remuxer]: No keyframe found out of "+S+" video samples"),g=!1);if(this.ISGenerated){if(R&&A){var U=this.getVideoStartPts(e.samples),F=(Nt(t.samples[0].pts,U)-U)/e.inputTimeScale;p+=Math.max(0,F),m+=Math.max(0,-F)}if(R){if(t.samplerate||(b.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(t,e,a,o)),d=this.remuxAudio(t,p,this.isAudioContiguous,o,T||A||h===Mt?m:void 0),A){var O=d?d.endPTS-d.startPTS:0;e.inputTimeScale||(b.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(t,e,a,o)),u=this.remuxVideo(e,m,x,O)}}else A&&(u=this.remuxVideo(e,m,x,0));u&&(u.firstKeyFrame=P,u.independent=P!==-1,u.firstKeyFramePTS=_)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(v=ya(r,a,this._initPTS,this._initDTS)),i.samples.length&&(c=Ea(i,a,this._initPTS))),{audio:d,video:u,initSegment:f,independent:g,text:c,id3:v}},n.generateIS=function(t,e,r,i){var a,o,l,h=t.samples,u=e.samples,d=this.typeSupported,f={},c=this._initPTS,v=!c||i,g="audio/mp4";if(v&&(a=o=1/0),t.config&&h.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":d.mpeg?(g="audio/mpeg",t.codec=""):d.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3"}f.audio={id:"audio",container:g,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&d.mpeg?new Uint8Array(0):St.initSegment([t]),metadata:{channelCount:t.channelCount}},v&&(l=t.inputTimeScale,c&&l===c.timescale?v=!1:a=o=h[0].pts-Math.round(l*r))}if(e.sps&&e.pps&&u.length){if(e.timescale=e.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:St.initSegment([e]),metadata:{width:e.width,height:e.height}},v)if(l=e.inputTimeScale,c&&l===c.timescale)v=!1;else{var p=this.getVideoStartPts(u),m=Math.round(l*r);o=Math.min(o,Nt(u[0].dts,p)-m),a=Math.min(a,p-m)}this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,v?(this._initPTS={baseTime:a,timescale:l},this._initDTS={baseTime:o,timescale:l}):a=l=void 0,{tracks:f,initPTS:a,timescale:l}},n.remuxVideo=function(t,e,r,i){var a,o,l=t.inputTimeScale,h=t.samples,u=[],d=h.length,f=this._initPTS,c=this.nextAvcDts,v=8,g=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,E=!1;if(!r||c===null){var T=e*l,S=h[0].pts-Nt(h[0].dts,h[0].pts);Ie&&c!==null&&Math.abs(T-S-c)<15e3?r=!0:c=T-S}for(var R=f.baseTime*l/f.timescale,A=0;A<d;A++){var L=h[A];L.pts=Nt(L.pts-R,c),L.dts=Nt(L.dts-R,c),L.dts<h[A>0?A-1:A].dts&&(E=!0)}E&&h.sort(function(Cr,ls){var Gl=Cr.dts-ls.dts,Kl=Cr.pts-ls.pts;return Gl||Kl}),a=h[0].dts;var w=(o=h[h.length-1].dts)-a,k=w?Math.round(w/(d-1)):g||t.inputTimeScale/30;if(r){var C=a-c,D=C>k,_=C<-1;if((D||_)&&(D?b.warn("AVC: "+je(C,!0)+" ms ("+C+"dts) hole between fragments detected at "+e.toFixed(3)):b.warn("AVC: "+je(-C,!0)+" ms ("+C+"dts) overlapping between fragments detected at "+e.toFixed(3)),!_||c>=h[0].pts||Ie)){a=c;var x=h[0].pts-C;if(D)h[0].dts=a,h[0].pts=x;else for(var P=0;P<h.length&&!(h[P].dts>x);P++)h[P].dts-=C,h[P].pts-=C;b.log("Video: Initial PTS/DTS adjusted: "+je(x,!0)+"/"+je(a,!0)+", delta: "+je(C,!0)+" ms")}}for(var M=0,U=0,F=a=Math.max(0,a),O=0;O<d;O++){for(var B=h[O],G=B.units,V=G.length,Q=0,ot=0;ot<V;ot++)Q+=G[ot].data.length;U+=Q,M+=V,B.length=Q,B.dts<F?(B.dts=F,F+=k/4|0||1):F=B.dts,p=Math.min(B.pts,p),m=Math.max(B.pts,m)}o=h[d-1].dts;var et,ft=U+4*M+8;try{et=new Uint8Array(ft)}catch(Cr){return void this.observer.emit(y.ERROR,y.ERROR,{type:K.MUX_ERROR,details:I.REMUX_ALLOC_ERROR,fatal:!1,error:Cr,bytes:ft,reason:"fail allocating video mdat "+ft})}var st=new DataView(et.buffer);st.setUint32(0,ft),et.set(St.types.mdat,4);for(var rt=!1,Y=Number.POSITIVE_INFINITY,z=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,it=Number.NEGATIVE_INFINITY,W=0;W<d;W++){for(var at=h[W],J=at.units,Dt=0,bt=0,$=J.length;bt<$;bt++){var ht=J[bt],vt=ht.data,kt=ht.data.byteLength;st.setUint32(v,kt),v+=4,et.set(vt,v),v+=kt,Dt+=4+kt}var _t=void 0;if(W<d-1)g=h[W+1].dts-at.dts,_t=h[W+1].pts-at.pts;else{var Et=this.config,Ct=W>0?at.dts-h[W-1].dts:k;if(_t=W>0?at.pts-h[W-1].pts:k,Et.stretchShortVideoTrack&&this.nextAudioPts!==null){var ze=Math.floor(Et.maxBufferHole*l),ne=(i?p+i*l:this.nextAudioPts)-at.pts;ne>ze?((g=ne-Ct)<0?g=Ct:rt=!0,b.log("[mp4-remuxer]: It is approximately "+ne/90+" ms to the next segment; using duration "+g/90+" ms for the last video frame.")):g=Ct}else g=Ct}var Ce=Math.round(at.pts-at.dts);Y=Math.min(Y,g),j=Math.max(j,g),z=Math.min(z,_t),it=Math.max(it,_t),u.push(new Ta(at.key,g,Dt,Ce))}if(u.length){if(Ie){if(Ie<70){var te=u[0].flags;te.dependsOn=2,te.isNonSync=0}}else if(Li&&it-z<j-Y&&k/j<.025&&u[0].cts===0){b.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var xt=a,Tt=0,nt=u.length;Tt<nt;Tt++){var lt=xt+u[Tt].duration,pt=xt+u[Tt].cts;if(Tt<nt-1){var Yi=lt+u[Tt+1].cts;u[Tt].duration=Yi-pt}else u[Tt].duration=Tt?u[Tt-1].duration:k;u[Tt].cts=0,xt=lt}}}g=rt||!g?k:g,this.nextAvcDts=c=o+g,this.videoSampleDuration=g,this.isVideoContiguous=!0;var Bl={data1:St.moof(t.sequenceNumber++,a,gt({},t,{samples:u})),data2:et,startPTS:p/l,endPTS:(m+g)/l,startDTS:a/l,endDTS:c/l,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:t.dropped};return t.samples=[],t.dropped=0,Bl},n.getSamplesPerFrame=function(t){switch(t.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}},n.remuxAudio=function(t,e,r,i,a){var o=t.inputTimeScale,l=o/(t.samplerate?t.samplerate:o),h=this.getSamplesPerFrame(t),u=h*l,d=this._initPTS,f=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,c=[],v=a!==void 0,g=t.samples,p=f?0:8,m=this.nextAudioPts||-1,E=e*o,T=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||g.length&&m>0&&(i&&Math.abs(E-m)<9e3||Math.abs(Nt(g[0].pts-T,E)-m)<20*u),g.forEach(function(W){W.pts=Nt(W.pts-T,E)}),!r||m<0){if(g=g.filter(function(W){return W.pts>=0}),!g.length)return;m=a===0?0:i&&!v?Math.max(0,E):g[0].pts}if(t.segmentCodec==="aac")for(var S=this.config.maxAudioFramesDrift,R=0,A=m;R<g.length;R++){var L=g[R],w=L.pts,k=w-A,C=Math.abs(1e3*k/o);if(k<=-S*u&&v)R===0&&(b.warn("Audio frame @ "+(w/o).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*k/o)+" ms."),this.nextAudioPts=m=A=w);else if(k>=S*u&&C<1e4&&v){var D=Math.round(k/u);(A=w-D*u)<0&&(D--,A+=u),R===0&&(this.nextAudioPts=m=A),b.warn("[mp4-remuxer]: Injecting "+D+" audio frame @ "+(A/o).toFixed(3)+"s due to "+Math.round(1e3*k/o)+" ms gap.");for(var _=0;_<D;_++){var x=Math.max(A,0),P=ma.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);P||(b.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),P=L.unit.subarray()),g.splice(R,0,{unit:P,pts:x}),A+=u,R++}}L.pts=A,A+=u}for(var M,U=null,F=null,O=0,B=g.length;B--;)O+=g[B].unit.byteLength;for(var G=0,V=g.length;G<V;G++){var Q=g[G],ot=Q.unit,et=Q.pts;if(F!==null)c[G-1].duration=Math.round((et-F)/l);else{if(r&&t.segmentCodec==="aac"&&(et=m),U=et,!(O>0))return;O+=p;try{M=new Uint8Array(O)}catch(W){return void this.observer.emit(y.ERROR,y.ERROR,{type:K.MUX_ERROR,details:I.REMUX_ALLOC_ERROR,fatal:!1,error:W,bytes:O,reason:"fail allocating audio mdat "+O})}f||(new DataView(M.buffer).setUint32(0,O),M.set(St.types.mdat,4))}M.set(ot,p);var ft=ot.byteLength;p+=ft,c.push(new Ta(!0,h,ft,0)),F=et}var st=c.length;if(st){var rt=c[c.length-1];this.nextAudioPts=m=F+l*rt.duration;var Y=f?new Uint8Array(0):St.moof(t.sequenceNumber++,U/l,gt({},t,{samples:c}));t.samples=[];var z=U/o,j=m/o,it={data1:Y,data2:M,startPTS:z,endPTS:j,startDTS:z,endDTS:j,type:"audio",hasAudio:!0,hasVideo:!1,nb:st};return this.isAudioContiguous=!0,it}},n.remuxEmptyAudio=function(t,e,r,i){var a=t.inputTimeScale,o=a/(t.samplerate?t.samplerate:a),l=this.nextAudioPts,h=this._initDTS,u=9e4*h.baseTime/h.timescale,d=(l!==null?l:i.startDTS*a)+u,f=i.endDTS*a+u,c=1024*o,v=Math.ceil((f-d)/c),g=ma.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(b.warn("[mp4-remuxer]: remux empty Audio"),g){for(var p=[],m=0;m<v;m++){var E=d+m*c;p.push({unit:g,pts:E,dts:E})}return t.samples=p,this.remuxAudio(t,e,r,!1)}b.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},s}();function Nt(s,n){var t;if(n===null)return s;for(t=n<s?-8589934592:8589934592;Math.abs(s-n)>4294967296;)s+=t;return s}function ya(s,n,t,e){var r=s.samples.length;if(r){for(var i=s.inputTimeScale,a=0;a<r;a++){var o=s.samples[a];o.pts=Nt(o.pts-t.baseTime*i/t.timescale,n*i)/i,o.dts=Nt(o.dts-e.baseTime*i/e.timescale,n*i)/i}var l=s.samples;return s.samples=[],{samples:l}}}function Ea(s,n,t){var e=s.samples.length;if(e){for(var r=s.inputTimeScale,i=0;i<e;i++){var a=s.samples[i];a.pts=Nt(a.pts-t.baseTime*r/t.timescale,n*r)/r}s.samples.sort(function(l,h){return l.pts-h.pts});var o=s.samples;return s.samples=[],{samples:o}}}var $t,Ta=function(s,n,t,e){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=n,this.size=t,this.cts=e,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:s?2:1,isNonSync:s?0:1}},xo=function(){function s(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var n=s.prototype;return n.destroy=function(){},n.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},n.resetNextTimestamp=function(){this.lastEndTime=null},n.resetInitSegment=function(t,e,r,i){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(function(a,o){if(!a||!o)return a;var l=o.keyId;return l&&o.isCommonEncryption&&q(a,["moov","trak"]).forEach(function(h){var u=q(h,["mdia","minf","stbl","stsd"])[0].subarray(8),d=q(u,["enca"]),f=d.length>0;f||(d=q(u,["encv"])),d.forEach(function(c){q(f?c.subarray(28):c.subarray(78),["sinf"]).forEach(function(v){var g=fn(v);if(g){var p=g.subarray(8,24);p.some(function(m){return m!==0})||(b.log("[eme] Patching keyId in 'enc"+(f?"a":"v")+">sinf>>tenc' box: "+Kt.hexDump(p)+" -> "+Kt.hexDump(l)),g.set(l,8))}})})}),a}(t,i)),this.emitInitSegment=!0},n.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(t==null||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=dn(t);i.audio&&(e=Sa(i.audio,wt)),i.video&&(r=Sa(i.video,Pt));var a={};i.audio&&i.video?a.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:t,id:"main"}:i.audio?a.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:i.video?a.video={container:"video/mp4",codec:r,initSegment:t,id:"main"}:b.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},n.remux=function(t,e,r,i,a,o){var l,h,u=this.initPTS,d=this.lastEndTime,f={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};N(d)||(d=this.lastEndTime=a||0);var c=e.samples;if(c==null||!c.length)return f;var v={initPTS:void 0,timescale:1},g=this.initData;if((l=g)!=null&&l.length||(this.generateInitSegment(c),g=this.initData),(h=g)==null||!h.length)return b.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);var p=function(k,C){for(var D=0,_=0,x=0,P=q(k,["moof","traf"]),M=0;M<P.length;M++){var U=P[M],F=q(U,["tfhd"])[0],O=C[H(F,4)];if(O){var B=O.default,G=H(F,0)|(B==null?void 0:B.flags),V=B==null?void 0:B.duration;8&G&&(V=H(F,2&G?12:8));for(var Q=O.timescale||9e4,ot=q(U,["trun"]),et=0;et<ot.length;et++)!(D=Os(ot[et]))&&V&&(D=V*H(ot[et],4)),O.type===Pt?_+=D/Q:O.type===wt&&(x+=D/Q)}}if(_===0&&x===0){for(var ft=1/0,st=0,rt=0,Y=q(k,["sidx"]),z=0;z<Y.length;z++){var j=Fs(Y[z]);if(j!=null&&j.references){ft=Math.min(ft,j.earliestPresentationTime/j.timescale);var it=j.references.reduce(function(W,at){return W+at.info.duration||0},0);rt=(st=Math.max(st,it+j.earliestPresentationTime/j.timescale))-ft}}if(rt&&N(rt))return rt}return _||x}(c,g),m=function(k,C){return q(C,["moof","traf"]).reduce(function(D,_){var x=q(_,["tfdt"])[0],P=x[0],M=q(_,["tfhd"]).reduce(function(U,F){var O=H(F,4),B=k[O];if(B){var G=H(x,4);if(P===1){if(G===er)return b.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),U;G*=er+1,G+=H(x,8)}var V=G/(B.timescale||9e4);if(N(V)&&(U===null||V<U))return V}return U},null);return M!==null&&N(M)&&(D===null||M<D)?M:D},null)}(g,c),E=m===null?a:m;(function(k,C,D,_){if(k===null)return!0;var x=Math.max(_,1),P=C-k.baseTime/k.timescale;return Math.abs(P-D)>x}(u,E,a,p)||v.timescale!==u.timescale&&o)&&(v.initPTS=E-a,u&&u.timescale===1&&b.warn("Adjusting initPTS by "+(v.initPTS-u.baseTime)),this.initPTS=u={baseTime:v.initPTS,timescale:1});var T=t?E-u.baseTime/u.timescale:d,S=T+p;(function(k,C,D){q(C,["moof","traf"]).forEach(function(_){q(_,["tfhd"]).forEach(function(x){var P=H(x,4),M=k[P];if(M){var U=M.timescale||9e4;q(_,["tfdt"]).forEach(function(F){var O=F[0],B=D*U;if(B){var G=H(F,4);if(O===0)G-=B,Xr(F,4,G=Math.max(G,0));else{G*=Math.pow(2,32),G+=H(F,8),G-=B,G=Math.max(G,0);var V=Math.floor(G/(er+1)),Q=Math.floor(G%(er+1));Xr(F,4,V),Xr(F,8,Q)}}})}})})})(g,c,u.baseTime/u.timescale),p>0?this.lastEndTime=S:(b.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var R=!!g.audio,A=!!g.video,L="";R&&(L+="audio"),A&&(L+="video");var w={data1:c,startPTS:T,startDTS:T,endPTS:S,endDTS:S,type:L,hasAudio:R,hasVideo:A,nb:1,dropped:0};return f.audio=w.type==="audio"?w:void 0,f.video=w.type!=="audio"?w:void 0,f.initSegment=v,f.id3=ya(r,a,u,u),i.samples.length&&(f.text=Ea(i,a,u)),f},s}();function Sa(s,n){var t=s==null?void 0:s.codec;if(t&&t.length>4)return t;if(n===wt){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return sr(t,!1);var e="mp4a.40.5";return b.info('Parsed audio codec "'+t+'" or audio object type not handled. Using "'+e+'"'),e}return b.warn('Unhandled video codec "'+t+'"'),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}try{$t=self.performance.now.bind(self.performance)}catch{b.debug("Unable to use Performance API on this environment"),$t=pe==null?void 0:pe.Date.now}var Lr=[{demux:Ao,remux:xo},{demux:wo,remux:Sr},{demux:So,remux:Sr},{demux:_o,remux:Sr}];Lr.splice(2,0,{demux:Ro,remux:Sr});var Ai=function(){function s(t,e,r,i,a){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i,this.id=a}var n=s.prototype;return n.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},n.push=function(t,e,r,i){var a=this,o=r.transmuxing;o.executeStart=$t();var l=new Uint8Array(t),h=this.currentTransmuxState,u=this.transmuxConfig;i&&(this.currentTransmuxState=i);var d=i||h,f=d.contiguous,c=d.discontinuity,v=d.trackSwitch,g=d.accurateTimeOffset,p=d.timeOffset,m=d.initSegmentChange,E=u.audioCodec,T=u.videoCodec,S=u.defaultInitPts,R=u.duration,A=u.initSegmentData,L=function(P,M){var U=null;return P.byteLength>0&&(M==null?void 0:M.key)!=null&&M.iv!==null&&M.method!=null&&(U=M),U}(l,e);if(L&&L.method==="AES-128"){var w=this.getDecrypter();if(!w.isSync())return this.decryptionPromise=w.webCryptoDecrypt(l,L.key.buffer,L.iv.buffer).then(function(P){var M=a.push(P,null,r);return a.decryptionPromise=null,M}),this.decryptionPromise;var k=w.softwareDecrypt(l,L.key.buffer,L.iv.buffer);if(r.part>-1&&(k=w.flush()),!k)return o.executeEnd=$t(),Ri(r);l=new Uint8Array(k)}var C=this.needsProbing(c,v);if(C){var D=this.configureTransmuxer(l);if(D)return b.warn("[transmuxer] "+D.message),this.observer.emit(y.ERROR,y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,fatal:!1,error:D,reason:D.message}),o.executeEnd=$t(),Ri(r)}(c||v||m||C)&&this.resetInitSegment(A,E,T,R,e),(c||m||C)&&this.resetInitialTimestamp(S),f||this.resetContiguity();var _=this.transmux(l,L,p,g,r),x=this.currentTransmuxState;return x.contiguous=!0,x.discontinuity=!1,x.trackSwitch=!1,o.executeEnd=$t(),_},n.flush=function(t){var e=this,r=t.transmuxing;r.executeStart=$t();var i=this.decrypter,a=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then(function(){return e.flush(t)});var l=[],h=a.timeOffset;if(i){var u=i.flush();u&&l.push(this.push(u,null,t))}var d=this.demuxer,f=this.remuxer;if(!d||!f)return r.executeEnd=$t(),[Ri(t)];var c=d.flush(h);return fe(c)?c.then(function(v){return e.flushRemux(l,v,t),l}):(this.flushRemux(l,c,t),l)},n.flushRemux=function(t,e,r){var i=e.audioTrack,a=e.videoTrack,o=e.id3Track,l=e.textTrack,h=this.currentTransmuxState,u=h.accurateTimeOffset,d=h.timeOffset;b.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var f=this.remuxer.remux(i,a,o,l,d,u,!0,this.id);t.push({remuxResult:f,chunkMeta:r}),r.transmuxing.executeEnd=$t()},n.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))},n.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},n.resetInitSegment=function(t,e,r,i,a){var o=this.demuxer,l=this.remuxer;o&&l&&(o.resetInitSegment(t,e,r,i),l.resetInitSegment(t,e,r,a))},n.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},n.transmux=function(t,e,r,i,a){return e&&e.method==="SAMPLE-AES"?this.transmuxSampleAes(t,e,r,i,a):this.transmuxUnencrypted(t,r,i,a)},n.transmuxUnencrypted=function(t,e,r,i){var a=this.demuxer.demux(t,e,!1,!this.config.progressive),o=a.audioTrack,l=a.videoTrack,h=a.id3Track,u=a.textTrack;return{remuxResult:this.remuxer.remux(o,l,h,u,e,r,!1,this.id),chunkMeta:i}},n.transmuxSampleAes=function(t,e,r,i,a){var o=this;return this.demuxer.demuxSampleAes(t,e,r).then(function(l){return{remuxResult:o.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,r,i,!1,o.id),chunkMeta:a}})},n.configureTransmuxer=function(t){for(var e,r=this.config,i=this.observer,a=this.typeSupported,o=this.vendor,l=0,h=Lr.length;l<h;l++){var u;if((u=Lr[l].demux)!=null&&u.probe(t)){e=Lr[l];break}}if(!e)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,f=this.remuxer,c=e.remux,v=e.demux;f&&f instanceof c||(this.remuxer=new c(i,r,a,o)),d&&d instanceof v||(this.demuxer=new v(i,r,a),this.probe=v.probe)},n.needsProbing=function(t,e){return!this.demuxer||!this.remuxer||t||e},n.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new ci(this.config)),t},s}(),Ri=function(s){return{remuxResult:{},chunkMeta:s}};function fe(s){return"then"in s&&s.then instanceof Function}var Po=function(s,n,t,e,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=n,this.initSegmentData=t,this.duration=e,this.defaultInitPts=r||null},Fo=function(s,n,t,e,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=n,this.accurateTimeOffset=t,this.trackSwitch=e,this.timeOffset=r,this.initSegmentChange=i},La={exports:{}};(function(s){var n=Object.prototype.hasOwnProperty,t="~";function e(){}function r(l,h,u){this.fn=l,this.context=h,this.once=u||!1}function i(l,h,u,d,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var c=new r(u,d||l,f),v=t?t+h:h;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],c]:l._events[v].push(c):(l._events[v]=c,l._eventsCount++),l}function a(l,h){--l._eventsCount==0?l._events=new e:delete l._events[h]}function o(){this._events=new e,this._eventsCount=0}Object.create&&(e.prototype=Object.create(null),new e().__proto__||(t=!1)),o.prototype.eventNames=function(){var l,h,u=[];if(this._eventsCount===0)return u;for(h in l=this._events)n.call(l,h)&&u.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(l){var h=t?t+l:l,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,c=new Array(f);d<f;d++)c[d]=u[d].fn;return c},o.prototype.listenerCount=function(l){var h=t?t+l:l,u=this._events[h];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,h,u,d,f,c){var v=t?t+l:l;if(!this._events[v])return!1;var g,p,m=this._events[v],E=arguments.length;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),E){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,u),!0;case 4:return m.fn.call(m.context,h,u,d),!0;case 5:return m.fn.call(m.context,h,u,d,f),!0;case 6:return m.fn.call(m.context,h,u,d,f,c),!0}for(p=1,g=new Array(E-1);p<E;p++)g[p-1]=arguments[p];m.fn.apply(m.context,g)}else{var T,S=m.length;for(p=0;p<S;p++)switch(m[p].once&&this.removeListener(l,m[p].fn,void 0,!0),E){case 1:m[p].fn.call(m[p].context);break;case 2:m[p].fn.call(m[p].context,h);break;case 3:m[p].fn.call(m[p].context,h,u);break;case 4:m[p].fn.call(m[p].context,h,u,d);break;default:if(!g)for(T=1,g=new Array(E-1);T<E;T++)g[T-1]=arguments[T];m[p].fn.apply(m[p].context,g)}}return!0},o.prototype.on=function(l,h,u){return i(this,l,h,u,!1)},o.prototype.once=function(l,h,u){return i(this,l,h,u,!0)},o.prototype.removeListener=function(l,h,u,d){var f=t?t+l:l;if(!this._events[f])return this;if(!h)return a(this,f),this;var c=this._events[f];if(c.fn)c.fn!==h||d&&!c.once||u&&c.context!==u||a(this,f);else{for(var v=0,g=[],p=c.length;v<p;v++)(c[v].fn!==h||d&&!c[v].once||u&&c[v].context!==u)&&g.push(c[v]);g.length?this._events[f]=g.length===1?g[0]:g:a(this,f)}return this},o.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&a(this,h)):(this._events=new e,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,s.exports=o})(La);var Ar=fs(La.exports);function bi(s,n){if(!((t=n.remuxResult).audio||t.video||t.text||t.id3||t.initSegment))return!1;var t,e=[],r=n.remuxResult,i=r.audio,a=r.video;return i&&Aa(e,i),a&&Aa(e,a),s.postMessage({event:"transmuxComplete",data:n},e),!0}function Aa(s,n){n.data1&&s.push(n.data1.buffer),n.data2&&s.push(n.data2.buffer)}function Ra(s,n,t){n.reduce(function(e,r){return bi(s,r)||e},!1)||s.postMessage({event:"transmuxComplete",data:n[0]}),s.postMessage({event:"flush",data:t})}ee!==void 0&&ee&&function(s){var n=new Ar,t=function(r,i){s.postMessage({event:r,data:i})};n.on(y.FRAG_DECRYPTED,t),n.on(y.ERROR,t);var e=function(){var r=function(a){var o=function(l){t("workerLog",{logType:a,message:l})};b[a]=o};for(var i in b)r(i)};s.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var a=JSON.parse(i.config);s.transmuxer=new Ai(n,i.typeSupported,a,"",i.id),Qi(a.debug,i.id),e(),t("init",null);break;case"configure":s.transmuxer.configure(i.config);break;case"demux":var o=s.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);fe(o)?(s.transmuxer.async=!0,o.then(function(u){bi(s,u)}).catch(function(u){t(y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:u,err:u,reason:"transmuxer-worker push error"})})):(s.transmuxer.async=!1,bi(s,o));break;case"flush":var l=i.chunkMeta,h=s.transmuxer.flush(l);fe(h)||s.transmuxer.async?(fe(h)||(h=Promise.resolve(h)),h.then(function(u){Ra(s,u,l)}).catch(function(u){t(y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:u,err:u,reason:"transmuxer-worker flush error"})})):Ra(s,h,l)}})}(self);var ba=function(){function s(t,e,r,i){var a=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var o=t.config;this.hls=t,this.id=e,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var l=function(p,m){(m=m||{}).frag=a.frag,m.id=a.id,p===y.ERROR&&(a.error=m.error),a.hls.trigger(p,m)};this.observer=new Ar,this.observer.on(y.FRAG_DECRYPTED,l),this.observer.on(y.ERROR,l);var h,u,d,f,c=oe(o.preferManagedMediaSource)||{isTypeSupported:function(){return!1}},v={mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:c.isTypeSupported('audio/mp4; codecs="ac-3"')};if(!this.useWorker||typeof Worker>"u"||(o.workerPath,0))this.transmuxer=new Ai(this.observer,v,o,"",e);else try{o.workerPath?(b.log("loading Web Worker "+o.workerPath+' for "'+e+'"'),this.workerContext=(d=o.workerPath,f=new self.URL(d,self.location.href).href,{worker:new self.Worker(f),scriptURL:f})):(b.log('injecting Web Worker for "'+e+'"'),this.workerContext=(h=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+xe.toString()+")(true);"],{type:"text/javascript"}),u=self.URL.createObjectURL(h),{worker:new self.Worker(u),objectURL:u})),this.onwmsg=function(p){return a.onWorkerMessage(p)};var g=this.workerContext.worker;g.addEventListener("message",this.onwmsg),g.onerror=function(p){var m=new Error(p.message+"  ("+p.filename+":"+p.lineno+")");o.enableWorker=!1,b.warn('Error in "'+e+'" Web Worker, fallback to inline'),a.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:m})},g.postMessage({cmd:"init",typeSupported:v,vendor:"",id:e,config:JSON.stringify(o)})}catch(p){b.warn('Error setting up "'+e+'" Web Worker, fallback to inline',p),this.resetWorker(),this.error=null,this.transmuxer=new Ai(this.observer,v,o,"",e)}}var n=s.prototype;return n.resetWorker=function(){if(this.workerContext){var t=this.workerContext,e=t.worker,r=t.objectURL;r&&self.URL.revokeObjectURL(r),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}},n.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},n.push=function(t,e,r,i,a,o,l,h,u,d){var f,c,v=this;u.transmuxing.start=self.performance.now();var g=this.transmuxer,p=o?o.start:a.start,m=a.decryptdata,E=this.frag,T=!(E&&a.cc===E.cc),S=!(E&&u.level===E.level),R=E?u.sn-E.sn:-1,A=this.part?u.part-this.part.index:-1,L=R===0&&u.id>1&&u.id===(E==null?void 0:E.stats.chunkCount),w=!S&&(R===1||R===0&&(A===1||L&&A<=0)),k=self.performance.now();(S||R||a.stats.parsing.start===0)&&(a.stats.parsing.start=k),!o||!A&&w||(o.stats.parsing.start=k);var C=!(E&&((f=a.initSegment)==null?void 0:f.url)===((c=E.initSegment)==null?void 0:c.url)),D=new Fo(T,w,h,S,p,C);if(!w||T||C){b.log("[transmuxer-interface, "+a.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+`
        discontinuity: `+T+`
        trackSwitch: `+S+`
        contiguous: `+w+`
        accurateTimeOffset: `+h+`
        timeOffset: `+p+`
        initSegmentChange: `+C);var _=new Po(r,i,e,l,d);this.configureTransmuxer(_)}if(this.frag=a,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:t,decryptdata:m,chunkMeta:u,state:D},t instanceof ArrayBuffer?[t]:[]);else if(g){var x=g.push(t,m,u,D);fe(x)?(g.async=!0,x.then(function(P){v.handleTransmuxComplete(P)}).catch(function(P){v.transmuxerError(P,u,"transmuxer-interface push error")})):(g.async=!1,this.handleTransmuxComplete(x))}},n.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:t});else if(r){var i=r.flush(t);fe(i)||r.async?(fe(i)||(i=Promise.resolve(i)),i.then(function(a){e.handleFlushResult(a,t)}).catch(function(a){e.transmuxerError(a,t,"transmuxer-interface flush error")})):this.handleFlushResult(i,t)}},n.transmuxerError=function(t,e,r){this.hls&&(this.error=t,this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,fatal:!1,error:t,err:t,reason:r}))},n.handleFlushResult=function(t,e){var r=this;t.forEach(function(i){r.handleTransmuxComplete(i)}),this.onFlush(e)},n.onWorkerMessage=function(t){var e=t.data;if(e!=null&&e.event){var r=this.hls;if(this.hls)switch(e.event){case"init":var i,a=(i=this.workerContext)==null?void 0:i.objectURL;a&&self.URL.revokeObjectURL(a);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":b[e.data.logType]&&b[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}}else b.warn("worker message received with no "+(e?"event name":"data"))},n.configureTransmuxer=function(t){var e=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:t}):e&&e.configure(t)},n.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},s}(),Mo=function(s){function n(e,r,i){var a;return(a=s.call(this,e,r,i,"[audio-stream-controller]",Mt)||this).videoBuffer=null,a.videoTrackCC=-1,a.waitingVideoCC=-1,a.bufferedTrack=null,a.switchingTrack=null,a.trackId=-1,a.waitingData=null,a.mainDetails=null,a.flushing=!1,a.bufferFlushed=!1,a.cachedTrackLoadedData=null,a._registerListeners(),a}Lt(n,s);var t=n.prototype;return t.onHandlerDestroying=function(){this._unregisterListeners(),s.prototype.onHandlerDestroying.call(this),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null},t._registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},t._unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},t.onInitPtsFound=function(e,r){var i=r.frag,a=r.id,o=r.initPTS,l=r.timescale;if(a==="main"){var h=i.cc;this.initPTS[i.cc]={baseTime:o,timescale:l},this.log("InitPTS for cc: "+h+" found from main: "+o),this.videoTrackCC=h,this.state===We&&this.tick()}},t.startLoad=function(e){if(!this.levels)return this.startPosition=e,void(this.state=Ot);var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&e===-1?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),e=r,this.state=X):(this.loadedmetadata=!1,this.state=Ve),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},t.doTick=function(){switch(this.state){case X:this.doTickIdle();break;case Ve:var e,r=this.levels,i=this.trackId,a=r==null||(e=r[i])==null?void 0:e.details;if(a){if(this.waitForCdnTuneIn(a))break;this.state=We}break;case ke:var o,l=performance.now(),h=this.retryDate;if(!h||l>=h||(o=this.media)!=null&&o.seeking){var u=this.levels,d=this.trackId;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((u==null?void 0:u[d])||null),this.state=X}break;case We:var f=this.waitingData;if(f){var c=f.frag,v=f.part,g=f.cache,p=f.complete;if(this.initPTS[c.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=be;var m={frag:c,part:v,payload:g.flush(),networkDetails:null};this._handleFragmentLoadProgress(m),p&&s.prototype._handleFragmentLoadComplete.call(this,m)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+c.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var E=this.getLoadPosition(),T=ut.bufferInfo(this.mediaBuffer,E,this.config.maxBufferHole);li(T.end,this.config.maxFragLookUpTolerance,c)<0&&(this.log("Waiting fragment cc ("+c.cc+") @ "+c.start+" cancelled because another fragment at "+T.end+" is needed"),this.clearWaitingFragment())}}else this.state=X}this.onTickEnd()},t.clearWaitingFragment=function(){var e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=X)},t.resetLoadingState=function(){this.clearWaitingFragment(),s.prototype.resetLoadingState.call(this)},t.onTickEnd=function(){var e=this.media;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)},t.doTickIdle=function(){var e=this.hls,r=this.levels,i=this.media,a=this.trackId,o=e.config;if(this.buffering&&(i||!this.startFragRequested&&o.startFragPrefetch)&&r!=null&&r[a]){var l=r[a],h=l.details;if(!h||h.live&&this.levelLastLoaded!==l||this.waitForCdnTuneIn(h))this.state=Ve;else{var u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,wt,Mt));var d=this.getFwdBufferInfo(u,Mt);if(d!==null){if(!this.switchingTrack&&this._streamEnded(d,h))return e.trigger(y.BUFFER_EOS,{type:"audio"}),void(this.state=Ye);var f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,tt),c=d.len,v=this.getMaxBufferLength(f==null?void 0:f.len),g=h.fragments,p=g[0].start,m=this.getLoadPosition(),E=this.flushing?m:d.end;if(this.switchingTrack&&i){var T=m;h.PTSKnown&&T<p&&(d.end>p||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=p+.05)}if(!(c>=v&&!this.switchingTrack&&E<g[g.length-1].start)){var S=this.getNextFragment(E,h),R=!1;if(S&&this.isLoopLoading(S,E)&&(R=!!S.gap,S=this.getNextFragmentLoopLoading(S,h,d,tt,v)),S){var A=f&&S.start>f.end+h.targetduration;if(A||(f==null||!f.len)&&d.len){var L=this.getAppendedFrag(S.start,tt);if(L===null||(R||(R=!!L.gap||!!A&&f.len===0),A&&!R||R&&d.nextStart&&d.nextStart<L.end))return}this.loadFragment(S,l,E)}else this.bufferFlushed=!0}}}}},t.getMaxBufferLength=function(e){var r=s.prototype.getMaxBufferLength.call(this);return e?Math.min(Math.max(r,e),this.config.maxMaxBufferLength):r},t.onMediaDetaching=function(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,s.prototype.onMediaDetaching.call(this)},t.onAudioTracksUpdated=function(e,r){var i=r.audioTracks;this.resetTransmuxer(),this.levels=i.map(function(a){return new Te(a)})},t.onAudioTrackSwitching=function(e,r){var i=!!r.url;this.trackId=r.id;var a=this.fragCurrent;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.switchingTrack=r,this.state=X,this.flushAudioIfNeeded(r)):(this.switchingTrack=null,this.bufferedTrack=r,this.state=Ot),this.tick()},t.onManifestLoading=function(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1},t.onLevelLoaded=function(e,r){this.mainDetails=r.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(y.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},t.onAudioTrackLoaded=function(e,r){var i;if(this.mainDetails!=null){var a=this.levels,o=r.details,l=r.id;if(a){this.log("Audio track "+l+" loaded ["+o.startSN+","+o.endSN+"]"+(o.lastPartSn?"[part-"+o.lastPartSn+"-"+o.lastPartIndex+"]":"")+",duration:"+o.totalduration);var h=a[l],u=0;if(o.live||(i=h.details)!=null&&i.live){this.checkLiveUpdate(o);var d,f=this.mainDetails;if(o.deltaUpdateFailed||!f)return;!h.details&&o.hasProgramDateTime&&f.hasProgramDateTime?(mr(o,f),u=o.fragments[0].start):u=this.alignPlaylists(o,h.details,(d=this.levelLastLoaded)==null?void 0:d.details)}h.details=o,this.levelLastLoaded=h,this.startFragRequested||!this.mainDetails&&o.live||this.setStartPosition(this.mainDetails||o,u),this.state!==Ve||this.waitForCdnTuneIn(o)||(this.state=X),this.tick()}else this.warn("Audio tracks were reset while loading level "+l)}else this.cachedTrackLoadedData=r},t._handleFragmentLoadProgress=function(e){var r,i=e.frag,a=e.part,o=e.payload,l=this.config,h=this.trackId,u=this.levels;if(u){var d=u[h];if(d){var f=d.details;if(!f)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(i.start);var c=l.defaultAudioCodec||d.audioCodec||"mp4a.40.2",v=this.transmuxer;v||(v=this.transmuxer=new ba(this.hls,Mt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var g=this.initPTS[i.cc],p=(r=i.initSegment)==null?void 0:r.data;if(g!==void 0){var m=a?a.index:-1,E=m!==-1,T=new fi(i.level,i.sn,i.stats.chunkCount,o.byteLength,m,E);v.push(o,p,c,"",i,a,f.totalduration,!1,T,g)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+f.startSN+" ,"+f.endSN+"],track "+h),(this.waitingData=this.waitingData||{frag:i,part:a,cache:new ia,complete:!1}).cache.push(new Uint8Array(o)),this.waitingVideoCC=this.videoTrackCC,this.state=We}else this.warn("Audio track is undefined on fragment load progress")}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},t._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:s.prototype._handleFragmentLoadComplete.call(this,e)},t.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},t.onBufferCreated=function(e,r){var i=r.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer||null)},t.onFragBuffered=function(e,r){var i=r.frag,a=r.part;if(i.type===Mt)if(this.fragContextChanged(i))this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+(this.switchingTrack?this.switchingTrack.name:"false"));else{if(i.sn!=="initSegment"){this.fragPrevious=i;var o=this.switchingTrack;o&&(this.bufferedTrack=o,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,yt({},o)))}this.fragBufferedComplete(i,a)}else if(!this.loadedmetadata&&i.type===tt){var l=this.videoBuffer||this.media;l&&ut.getBuffered(l).length&&(this.loadedmetadata=!0)}},t.onError=function(e,r){var i;if(r.fatal)this.state=De;else switch(r.details){case I.FRAG_GAP:case I.FRAG_PARSING_ERROR:case I.FRAG_DECRYPT_ERROR:case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Mt,r);break;case I.AUDIO_TRACK_LOAD_ERROR:case I.AUDIO_TRACK_LOAD_TIMEOUT:case I.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==Ve||((i=r.context)==null?void 0:i.type)!==Bt||(this.state=X);break;case I.BUFFER_APPEND_ERROR:case I.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="audio")return;if(r.details===I.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(r)&&(this.bufferedTrack=null,s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"));break;case I.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},t.onBufferFlushing=function(e,r){r.type!==Pt&&(this.flushing=!0)},t.onBufferFlushed=function(e,r){var i=r.type;if(i!==Pt){this.flushing=!1,this.bufferFlushed=!0,this.state===Ye&&(this.state=X);var a=this.mediaBuffer||this.media;a&&(this.afterBufferFlushed(a,i,Mt),this.tick())}},t._handleTransmuxComplete=function(e){var r,i="audio",a=this.hls,o=e.remuxResult,l=e.chunkMeta,h=this.getCurrentContext(l);if(h){var u=h.frag,d=h.part,f=h.level,c=f.details,v=o.audio,g=o.text,p=o.id3,m=o.initSegment;if(!this.fragContextChanged(u)&&c){if(this.state=Jt,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){var E=u.initSegment||u;this._bufferInitSegment(f,m.tracks,E,l),a.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:i,tracks:m.tracks})}if(v){var T=v.startPTS,S=v.endPTS,R=v.startDTS,A=v.endDTS;d&&(d.elementaryStreams[wt]={startPTS:T,endPTS:S,startDTS:R,endDTS:A}),u.setElementaryStreamInfo(wt,T,S,R,A),this.bufferFragmentData(v,u,d,l)}if(p!=null&&(r=p.samples)!=null&&r.length){var L=gt({id:i,frag:u,details:c},p);a.trigger(y.FRAG_PARSING_METADATA,L)}if(g){var w=gt({id:i,frag:u,details:c},g);a.trigger(y.FRAG_PARSING_USERDATA,w)}}else this.fragmentTracker.removeFragment(u)}else this.resetWhenMissingContext(l)},t._bufferInitSegment=function(e,r,i,a){if(this.state===Jt){r.video&&delete r.video;var o=r.audio;if(o){o.id="audio";var l=e.audioCodec;this.log("Init audio buffer, container:"+o.container+", codecs[level/parsed]=["+l+"/"+o.codec+"]"),l&&l.split(",").length===1&&(o.levelCodec=l),this.hls.trigger(y.BUFFER_CODECS,r);var h=o.initSegment;if(h!=null&&h.byteLength){var u={type:"audio",frag:i,part:null,chunkMeta:a,parent:i.type,data:h};this.hls.trigger(y.BUFFER_APPENDING,u)}this.tickImmediate()}}},t.loadFragment=function(e,r,i){var a,o=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||o===Ke||o===Ae)if(e.sn==="initSegment")this._loadInitSegment(e,r);else if((a=r.details)!=null&&a.live&&!this.initPTS[e.cc]){this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=We;var l=this.mainDetails;l&&l.fragments[0].start!==r.details.fragments[0].start&&mr(r.details,l)}else this.startFragRequested=!0,s.prototype.loadFragment.call(this,e,r,i);else this.clearTrackerIfNeeded(e)},t.flushAudioIfNeeded=function(e){if(this.media&&this.bufferedTrack){var r=this.bufferedTrack;ue({name:r.name,lang:r.lang,assocLang:r.assocLang,characteristics:r.characteristics,audioCodec:r.audioCodec,channels:r.channels},e,he)||(this.log("Switching audio track : flushing all audio"),s.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}},t.completeAudioSwitch=function(e){var r=this.hls;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,r.trigger(y.AUDIO_TRACK_SWITCHED,yt({},e))},n}(vi);function ka(s,n){if(s.length!==n.length)return!1;for(var t=0;t<s.length;t++)if(!qe(s[t].attrs,n[t].attrs))return!1;return!0}function qe(s,n,t){var e=s["STABLE-RENDITION-ID"];return e&&!t?e===n["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(function(r){return s[r]!==n[r]})}function ki(s,n){return n.label.toLowerCase()===s.name.toLowerCase()&&(!n.language||n.language.toLowerCase()===(s.lang||"").toLowerCase())}var Oo=function(s){function n(e){var r;return(r=s.call(this,e,"[audio-track-controller]")||this).tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.registerListeners(),r}Lt(n,s);var t=n.prototype;return t.registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,s.prototype.destroy.call(this)},t.onManifestLoading=function(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0},t.onManifestParsed=function(e,r){this.tracks=r.audioTracks||[]},t.onAudioTrackLoaded=function(e,r){var i=r.id,a=r.groupId,o=r.details,l=this.tracksInGroup[i];if(l&&l.groupId===a){var h=l.details;l.details=r.details,this.log("Audio track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+a+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,h)}else this.warn("Audio track with id:"+i+" and group:"+a+" not found in active group "+(l==null?void 0:l.groupId))},t.onLevelLoading=function(e,r){this.switchLevel(r.level)},t.onLevelSwitching=function(e,r){this.switchLevel(r.level)},t.switchLevel=function(e){var r=this.hls.levels[e];if(r){var i=r.audioGroups||null,a=this.groupIds,o=this.currentTrack;if(!i||(a==null?void 0:a.length)!==(i==null?void 0:i.length)||i!=null&&i.some(function(m){return(a==null?void 0:a.indexOf(m))===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var l=this.tracks.filter(function(m){return!i||i.indexOf(m.groupId)!==-1});if(l.length)this.selectDefaultTrack&&!l.some(function(m){return m.default})&&(this.selectDefaultTrack=!1),l.forEach(function(m,E){m.id=E});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=l;var h=this.hls.config.audioPreference;if(!o&&h){var u=Yt(h,l,he);if(u>-1)o=l[u];else{var d=Yt(h,this.tracks);o=this.tracks[d]}}var f=this.findTrackId(o);f===-1&&o&&(f=this.findTrackId(null));var c={audioTracks:l};this.log("Updating audio tracks, "+l.length+" track(s) found in group(s): "+(i==null?void 0:i.join(","))),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,c);var v=this.trackId;if(f!==-1&&v===-1)this.setAudioTrack(f);else if(l.length&&v===-1){var g,p=new Error("No audio track selected for current audio group-ID(s): "+((g=this.groupIds)==null?void 0:g.join(","))+" track count: "+l.length);this.warn(p.message),this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}else this.shouldReloadPlaylist(o)&&this.setAudioTrack(this.trackId)}},t.onError=function(e,r){!r.fatal&&r.context&&(r.context.type!==Bt||r.context.id!==this.trackId||this.groupIds&&this.groupIds.indexOf(r.context.groupId)===-1||(this.requestScheduled=-1,this.checkRetry(r)))},t.setAudioOption=function(e){var r=this.hls;if(r.config.audioPreference=e,e){var i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){var a=this.currentTrack;if(a&&ue(e,a,he))return a;var o=Yt(e,this.tracksInGroup,he);if(o>-1){var l=this.tracksInGroup[o];return this.setAudioTrack(o),l}if(a){var h=r.loadLevel;h===-1&&(h=r.firstAutoLevel);var u=function(f,c,v,g,p){var m=c[g],E=c.reduce(function(L,w,k){var C=w.uri;return(L[C]||(L[C]=[])).push(k),L},{})[m.uri];E.length>1&&(g=Math.max.apply(Math,E));var T=m.videoRange,S=m.frameRate,R=m.codecSet.substring(0,4),A=Qn(c,g,function(L){if(L.videoRange!==T||L.frameRate!==S||L.codecSet.substring(0,4)!==R)return!1;var w=L.audioGroups,k=v.filter(function(C){return!w||w.indexOf(C.groupId)!==-1});return Yt(f,k,p)>-1});return A>-1?A:Qn(c,g,function(L){var w=L.audioGroups,k=v.filter(function(C){return!w||w.indexOf(C.groupId)!==-1});return Yt(f,k,p)>-1})}(e,r.levels,i,h,he);if(u===-1)return null;r.nextLoadLevel=u}if(e.channels||e.audioCodec){var d=Yt(e,i);if(d>-1)return i[d]}}}return null},t.setAudioTrack=function(e){var r=this.tracksInGroup;if(e<0||e>=r.length)this.warn("Invalid audio track id: "+e);else{this.clearTimer(),this.selectDefaultTrack=!1;var i=this.currentTrack,a=r[e],o=a.details&&!a.details.live;if(!(e===this.trackId&&a===i&&o||(this.log("Switching to audio-track "+e+' "'+a.name+'" lang:'+a.lang+" group:"+a.groupId+" channels:"+a.channels),this.trackId=e,this.currentTrack=a,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,yt({},a)),o))){var l=this.switchParams(a.url,i==null?void 0:i.details,a.details);this.loadPlaylist(l)}}},t.findTrackId=function(e){for(var r=this.tracksInGroup,i=0;i<r.length;i++){var a=r[i];if((!this.selectDefaultTrack||a.default)&&(!e||ue(e,a,he)))return i}if(e){for(var o=e.name,l=e.lang,h=e.assocLang,u=e.characteristics,d=e.audioCodec,f=e.channels,c=0;c<r.length;c++)if(ue({name:o,lang:l,assocLang:h,characteristics:u,audioCodec:d,channels:f},r[c],he))return c;for(var v=0;v<r.length;v++){var g=r[v];if(qe(e.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return v}for(var p=0;p<r.length;p++){var m=r[p];if(qe(e.attrs,m.attrs,["LANGUAGE"]))return p}}return-1},t.loadPlaylist=function(e){var r=this.currentTrack;if(this.shouldLoadPlaylist(r)&&r){s.prototype.loadPlaylist.call(this);var i=r.id,a=r.groupId,o=r.url;if(e)try{o=e.addDirectives(o)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist "+i+' "'+r.name+'" lang:'+r.lang+" group:"+a),this.clearTimer(),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:o,id:i,groupId:a,deliveryDirectives:e||null})}},ct(n,[{key:"allAudioTracks",get:function(){return this.tracks}},{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}}]),n}(di),No=function(s){function n(e,r,i){var a;return(a=s.call(this,e,r,i,"[subtitle-stream-controller]",qt)||this).currentTrackId=-1,a.tracksBuffered=[],a.mainDetails=null,a._registerListeners(),a}Lt(n,s);var t=n.prototype;return t.onHandlerDestroying=function(){this._unregisterListeners(),s.prototype.onHandlerDestroying.call(this),this.mainDetails=null},t._registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.ERROR,this.onError,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},t._unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.ERROR,this.onError,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},t.startLoad=function(e){this.stopLoad(),this.state=X,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()},t.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},t.onMediaDetaching=function(){this.tracksBuffered=[],s.prototype.onMediaDetaching.call(this)},t.onLevelLoaded=function(e,r){this.mainDetails=r.details},t.onSubtitleFragProcessed=function(e,r){var i=r.frag,a=r.success;if(this.fragPrevious=i,this.state=X,a){var o=this.tracksBuffered[this.currentTrackId];if(o){for(var l,h=i.start,u=0;u<o.length;u++)if(h>=o[u].start&&h<=o[u].end){l=o[u];break}var d=i.start+i.duration;l?l.end=d:(l={start:h,end:d},o.push(l)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null)}}},t.onBufferFlushing=function(e,r){var i=r.startOffset,a=r.endOffset;if(i===0&&a!==Number.POSITIVE_INFINITY){var o=a-1;if(o<=0)return;r.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach(function(l){for(var h=0;h<l.length;)if(l[h].end<=o)l.shift();else{if(!(l[h].start<o))break;l[h].start=o,h++}}),this.fragmentTracker.removeFragmentsInRange(i,o,qt)}},t.onFragBuffered=function(e,r){var i;this.loadedmetadata||r.frag.type!==tt||(i=this.media)!=null&&i.buffered.length&&(this.loadedmetadata=!0)},t.onError=function(e,r){var i=r.frag;(i==null?void 0:i.type)===qt&&(r.details===I.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Ot&&(this.state=X))},t.onSubtitleTracksUpdated=function(e,r){var i=this,a=r.subtitleTracks;this.levels&&ka(this.levels,a)?this.levels=a.map(function(o){return new Te(o)}):(this.tracksBuffered=[],this.levels=a.map(function(o){var l=new Te(o);return i.tracksBuffered[l.id]=[],l}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,qt),this.fragPrevious=null,this.mediaBuffer=null)},t.onSubtitleTrackSwitch=function(e,r){var i;if(this.currentTrackId=r.id,(i=this.levels)!=null&&i.length&&this.currentTrackId!==-1){var a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.setInterval(500)}else this.clearInterval()},t.onSubtitleTrackLoaded=function(e,r){var i,a=this.currentTrackId,o=this.levels,l=r.details,h=r.id;if(o){var u=o[h];if(!(h>=o.length)&&u){this.log("Subtitle track "+h+" loaded ["+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+",duration:"+l.totalduration),this.mediaBuffer=this.mediaBufferTimeRanges;var d=0;if(l.live||(i=u.details)!=null&&i.live){var f=this.mainDetails;if(l.deltaUpdateFailed||!f)return;var c,v=f.fragments[0];u.details?(d=this.alignPlaylists(l,u.details,(c=this.levelLastLoaded)==null?void 0:c.details))===0&&v&&si(l,d=v.start):l.hasProgramDateTime&&f.hasProgramDateTime?(mr(l,f),d=l.fragments[0].start):v&&si(l,d=v.start)}u.details=l,this.levelLastLoaded=u,h===a&&(this.startFragRequested||!this.mainDetails&&l.live||this.setStartPosition(this.mainDetails||l,d),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===X&&(fr(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}}else this.warn("Subtitle tracks were reset while loading level "+h)},t._handleFragmentLoadComplete=function(e){var r=this,i=e.frag,a=e.payload,o=i.decryptdata,l=this.hls;if(!this.fragContextChanged(i)&&a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&o.method==="AES-128"){var h=performance.now();this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer).catch(function(u){throw l.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:i}),u}).then(function(u){var d=performance.now();l.trigger(y.FRAG_DECRYPTED,{frag:i,payload:u,stats:{tstart:h,tdecrypt:d}})}).catch(function(u){r.warn(u.name+": "+u.message),r.state=X})}},t.doTick=function(){if(this.media){if(this.state===X){var e=this.currentTrackId,r=this.levels,i=r==null?void 0:r[e];if(!i||!r.length||!i.details)return;var a=this.config,o=this.getLoadPosition(),l=ut.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o,a.maxBufferHole),h=l.end,u=l.len,d=this.getFwdBufferInfo(this.media,tt),f=i.details;if(u>this.getMaxBufferLength(d==null?void 0:d.len)+f.levelTargetDuration)return;var c=f.fragments,v=c.length,g=f.edge,p=null,m=this.fragPrevious;if(h<g){var E=a.maxFragLookUpTolerance,T=h>g-E?0:E;!(p=fr(m,c,Math.max(c[0].start,h),T))&&m&&m.start<c[0].start&&(p=c[0])}else p=c[v-1];if(!p)return;if((p=this.mapToInitFragWhenRequired(p)).sn!=="initSegment"){var S=c[p.sn-f.startSN-1];S&&S.cc===p.cc&&this.fragmentTracker.getState(S)===Ke&&(p=S)}this.fragmentTracker.getState(p)===Ke&&this.loadFragment(p,i,h)}}else this.state=X},t.getMaxBufferLength=function(e){var r=s.prototype.getMaxBufferLength.call(this);return e?Math.max(r,e):r},t.loadFragment=function(e,r,i){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,r):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,e,r,i))},ct(n,[{key:"mediaBufferTimeRanges",get:function(){return new Uo(this.tracksBuffered[this.currentTrackId]||[])}}]),n}(vi),Uo=function(s){this.buffered=void 0;var n=function(t,e,r){if((e>>>=0)>r-1)throw new DOMException("Failed to execute '"+t+"' on 'TimeRanges': The index provided ("+e+") is greater than the maximum bound ("+r+")");return s[e][t]};this.buffered={get length(){return s.length},end:function(t){return n("end",t,s.length)},start:function(t){return n("start",t,s.length)}}},Bo=function(s){function n(e){var r;return(r=s.call(this,e,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupIds=null,r.tracksInGroup=[],r.trackId=-1,r.currentTrack=null,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.onTextTracksChanged=function(){if(r.useTextTrackPolling||self.clearInterval(r.subtitlePollingInterval),r.media&&r.hls.config.renderTextTracksNatively){for(var i=null,a=or(r.media.textTracks),o=0;o<a.length;o++)if(a[o].mode==="hidden")i=a[o];else if(a[o].mode==="showing"){i=a[o];break}var l=r.findTrackForTextTrack(i);r.subtitleTrack!==l&&r.setSubtitleTrack(l)}},r.registerListeners(),r}Lt(n,s);var t=n.prototype;return t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,s.prototype.destroy.call(this)},t.registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.ERROR,this.onError,this)},t.unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.ERROR,this.onError,this)},t.onMediaAttached=function(e,r){this.media=r.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},t.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)},t.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),or(this.media.textTracks).forEach(function(e){Ee(e)}),this.subtitleTrack=-1,this.media=null)},t.onManifestLoading=function(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0},t.onManifestParsed=function(e,r){this.tracks=r.subtitleTracks},t.onSubtitleTrackLoaded=function(e,r){var i=r.id,a=r.groupId,o=r.details,l=this.tracksInGroup[i];if(l&&l.groupId===a){var h=l.details;l.details=r.details,this.log("Subtitle track "+i+' "'+l.name+'" lang:'+l.lang+" group:"+a+" loaded ["+o.startSN+"-"+o.endSN+"]"),i===this.trackId&&this.playlistLoaded(i,r,h)}else this.warn("Subtitle track with id:"+i+" and group:"+a+" not found in active group "+(l==null?void 0:l.groupId))},t.onLevelLoading=function(e,r){this.switchLevel(r.level)},t.onLevelSwitching=function(e,r){this.switchLevel(r.level)},t.switchLevel=function(e){var r=this.hls.levels[e];if(r){var i=r.subtitleGroups||null,a=this.groupIds,o=this.currentTrack;if(!i||(a==null?void 0:a.length)!==(i==null?void 0:i.length)||i!=null&&i.some(function(v){return(a==null?void 0:a.indexOf(v))===-1})){this.groupIds=i,this.trackId=-1,this.currentTrack=null;var l=this.tracks.filter(function(v){return!i||i.indexOf(v.groupId)!==-1});if(l.length)this.selectDefaultTrack&&!l.some(function(v){return v.default})&&(this.selectDefaultTrack=!1),l.forEach(function(v,g){v.id=g});else if(!o&&!this.tracksInGroup.length)return;this.tracksInGroup=l;var h=this.hls.config.subtitlePreference;if(!o&&h){this.selectDefaultTrack=!1;var u=Yt(h,l);if(u>-1)o=l[u];else{var d=Yt(h,this.tracks);o=this.tracks[d]}}var f=this.findTrackId(o);f===-1&&o&&(f=this.findTrackId(null));var c={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+(i==null?void 0:i.join(","))+'" group-id'),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,c),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}else this.shouldReloadPlaylist(o)&&this.setSubtitleTrack(this.trackId)}},t.findTrackId=function(e){for(var r=this.tracksInGroup,i=this.selectDefaultTrack,a=0;a<r.length;a++){var o=r[a];if((!i||o.default)&&(i||e)&&(!e||ue(o,e)))return a}if(e){for(var l=0;l<r.length;l++){var h=r[l];if(qe(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(var u=0;u<r.length;u++){var d=r[u];if(qe(e.attrs,d.attrs,["LANGUAGE"]))return u}}return-1},t.findTrackForTextTrack=function(e){if(e){for(var r=this.tracksInGroup,i=0;i<r.length;i++)if(ki(r[i],e))return i}return-1},t.onError=function(e,r){!r.fatal&&r.context&&(r.context.type!==Vt||r.context.id!==this.trackId||this.groupIds&&this.groupIds.indexOf(r.context.groupId)===-1||this.checkRetry(r))},t.setSubtitleOption=function(e){if(this.hls.config.subtitlePreference=e,e){var r=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,r.length){var i=this.currentTrack;if(i&&ue(e,i))return i;var a=Yt(e,this.tracksInGroup);if(a>-1){var o=this.tracksInGroup[a];return this.setSubtitleTrack(a),o}if(i)return null;var l=Yt(e,r);if(l>-1)return r[l]}}return null},t.loadPlaylist=function(e){s.prototype.loadPlaylist.call(this);var r=this.currentTrack;if(this.shouldLoadPlaylist(r)&&r){var i=r.id,a=r.groupId,o=r.url;if(e)try{o=e.addDirectives(o)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:o,id:i,groupId:a,deliveryDirectives:e||null})}},t.toggleTrackModes=function(){var e=this.media;if(e){var r,i=or(e.textTracks),a=this.currentTrack;if(a&&((r=i.filter(function(l){return ki(a,l)})[0])||this.warn('Unable to find subtitle TextTrack with name "'+a.name+'" and language "'+a.lang+'"')),[].slice.call(i).forEach(function(l){l.mode!=="disabled"&&l!==r&&(l.mode="disabled")}),r){var o=this.subtitleDisplay?"showing":"hidden";r.mode!==o&&(r.mode=o)}}},t.setSubtitleTrack=function(e){var r=this.tracksInGroup;if(this.media)if(e<-1||e>=r.length||!N(e))this.warn("Invalid subtitle track id: "+e);else{this.clearTimer(),this.selectDefaultTrack=!1;var i=this.currentTrack,a=r[e]||null;if(this.trackId=e,this.currentTrack=a,this.toggleTrackModes(),a){var o=!!a.details&&!a.details.live;if(e!==this.trackId||a!==i||!o){this.log("Switching to subtitle-track "+e+(a?' "'+a.name+'" lang:'+a.lang+" group:"+a.groupId:""));var l=a.id,h=a.groupId,u=h===void 0?"":h,d=a.name,f=a.type,c=a.url;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:l,groupId:u,name:d,type:f,url:c});var v=this.switchParams(a.url,i==null?void 0:i.details,a.details);this.loadPlaylist(v)}}else this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:e})}else this.queuedDefaultTrack=e},ct(n,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}},{key:"allSubtitleTracks",get:function(){return this.tracks}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}}]),n}(di),Go=function(){function s(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var n=s.prototype;return n.append=function(t,e,r){var i=this.queues[e];i.push(t),i.length!==1||r||this.executeNext(e)},n.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},n.appendBlocker=function(t){var e,r=new Promise(function(a){e=a}),i={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,t),r},n.executeNext=function(t){var e=this.queues[t];if(e.length){var r=e[0];try{r.execute()}catch(a){b.warn('[buffer-operation-queue]: Exception executing "'+t+'" SourceBuffer operation: '+a),r.onError(a);var i=this.buffers[t];i!=null&&i.updating||this.shiftAndExecuteNext(t)}}},n.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},n.current=function(t){return this.queues[t][0]},s}(),Da=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Ko=function(){function s(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=function(a){e.hls&&e.hls.pauseBuffering()},this._onStartStreaming=function(a){e.hls&&e.hls.resumeBuffering()},this._onMediaSourceOpen=function(){var a=e.media,o=e.mediaSource;e.log("Media source opened"),a&&(a.removeEventListener("emptied",e._onMediaEmptied),e.updateMediaElementDuration(),e.hls.trigger(y.MEDIA_ATTACHED,{media:a,mediaSource:o})),o&&o.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){e.log("Media source closed")},this._onMediaSourceEnded=function(){e.log("Media source ended")},this._onMediaEmptied=function(){var a=e.mediaSrc,o=e._objectUrl;a!==o&&b.error("Media element src was set while attaching MediaSource ("+o+" > "+a+")")},this.hls=t;var r,i="[buffer-controller]";this.appendSource=(r=oe(t.config.preferManagedMediaSource),typeof self<"u"&&r===self.ManagedMediaSource),this.log=b.log.bind(b,i),this.warn=b.warn.bind(b,i),this.error=b.error.bind(b,i),this._initSourceBuffer(),this.registerListeners()}var n=s.prototype;return n.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},n.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null},n.registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.BUFFER_RESET,this.onBufferReset,this),t.on(y.BUFFER_APPENDING,this.onBufferAppending,this),t.on(y.BUFFER_CODECS,this.onBufferCodecs,this),t.on(y.BUFFER_EOS,this.onBufferEos,this),t.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(y.FRAG_PARSED,this.onFragParsed,this),t.on(y.FRAG_CHANGED,this.onFragChanged,this)},n.unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.BUFFER_RESET,this.onBufferReset,this),t.off(y.BUFFER_APPENDING,this.onBufferAppending,this),t.off(y.BUFFER_CODECS,this.onBufferCodecs,this),t.off(y.BUFFER_EOS,this.onBufferEos,this),t.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(y.FRAG_PARSED,this.onFragParsed,this),t.off(y.FRAG_CHANGED,this.onFragChanged,this)},n._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Go(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null},n.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},n.onManifestParsed=function(t,e){var r=2;(e.audio&&!e.video||!e.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},n.onMediaAttaching=function(t,e){var r=this.media=e.media,i=oe(this.appendSource);if(r&&i){var a,o=this.mediaSource=new i;this.log("created media source: "+((a=o.constructor)==null?void 0:a.name)),o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming));var l=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");var h=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||h&&o instanceof h,wa(r),function(u,d){var f=self.document.createElement("source");f.type="video/mp4",f.src=d,u.appendChild(f)}(r,l),r.load()}catch{r.src=l}else r.src=l;r.addEventListener("emptied",this._onMediaEmptied)}},n.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,r=this._objectUrl;if(e){if(this.log("media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(i){this.warn("onMediaDetaching: "+i.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.removeEventListener("startstreaming",this._onStartStreaming),e.removeEventListener("endstreaming",this._onEndStreaming)),t&&(t.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(t.removeAttribute("src"),this.appendSource&&wa(t),t.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.MEDIA_DETACHED,void 0)},n.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(e){t.resetBuffer(e)}),this._initSourceBuffer(),this.hls.resumeBuffering()},n.resetBuffer=function(t){var e=this.sourceBuffer[t];try{var r;e&&(this.removeBufferListeners(t),this.sourceBuffer[t]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(e))}catch(i){this.warn("onBufferReset "+t,i)}},n.onBufferCodecs=function(t,e){var r=this,i=this.getSourceBufferTypes().length,a=Object.keys(e);if(a.forEach(function(l){if(i){var h=r.tracks[l];if(h&&typeof h.buffer.changeType=="function"){var u,d=e[l],f=d.id,c=d.codec,v=d.levelCodec,g=d.container,p=d.metadata,m=Sn(h.codec,h.levelCodec),E=m==null?void 0:m.replace(Da,"$1"),T=Sn(c,v),S=(u=T)==null?void 0:u.replace(Da,"$1");if(T&&E!==S){l.slice(0,5)==="audio"&&(T=sr(T,r.appendSource));var R=g+";codecs="+T;r.appendChangeType(l,R),r.log("switching codec "+m+" to "+T),r.tracks[l]={buffer:h.buffer,codec:c,container:g,levelCodec:v,metadata:p,id:f}}}}else r.pendingTracks[l]=e[l]}),!i){var o=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==o&&(this.log(o+" bufferCodec event(s) expected "+a.join(",")),this.bufferCodecEventsExpected=o),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}},n.appendChangeType=function(t,e){var r=this,i=this.operationQueue,a={execute:function(){var o=r.sourceBuffer[t];o&&(r.log("changing "+t+" sourceBuffer type to "+e),o.changeType(e)),i.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(o){r.warn("Failed to change "+t+" SourceBuffer type",o)}};i.append(a,t,!!this.pendingTracks[t])},n.onBufferAppending=function(t,e){var r=this,i=this.hls,a=this.operationQueue,o=this.tracks,l=e.data,h=e.type,u=e.frag,d=e.part,f=e.chunkMeta,c=f.buffering[h],v=self.performance.now();c.start=v;var g=u.stats.buffering,p=d?d.stats.buffering:null;g.start===0&&(g.start=v),p&&p.start===0&&(p.start=v);var m=o.audio,E=!1;h==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);var T=u.start,S={execute:function(){if(c.executeStart=self.performance.now(),E){var R=r.sourceBuffer[h];if(R){var A=T-R.timestampOffset;Math.abs(A)>=.1&&(r.log("Updating audio SourceBuffer timestampOffset to "+T+" (delta: "+A+") sn: "+u.sn+")"),R.timestampOffset=T)}}r.appendExecutor(l,h)},onStart:function(){},onComplete:function(){var R=self.performance.now();c.executeEnd=c.end=R,g.first===0&&(g.first=R),p&&p.first===0&&(p.first=R);var A=r.sourceBuffer,L={};for(var w in A)L[w]=ut.getBuffered(A[w]);r.appendErrors[h]=0,h==="audio"||h==="video"?r.appendErrors.audiovideo=0:(r.appendErrors.audio=0,r.appendErrors.video=0),r.hls.trigger(y.BUFFER_APPENDED,{type:h,frag:u,part:d,chunkMeta:f,parent:u.type,timeRanges:L})},onError:function(R){var A={type:K.MEDIA_ERROR,parent:u.type,details:I.BUFFER_APPEND_ERROR,sourceBufferName:h,frag:u,part:d,chunkMeta:f,error:R,err:R,fatal:!1};if(R.code===DOMException.QUOTA_EXCEEDED_ERR)A.details=I.BUFFER_FULL_ERROR;else{var L=++r.appendErrors[h];A.details=I.BUFFER_APPEND_ERROR,r.warn("Failed "+L+"/"+i.config.appendErrorMaxRetry+' times to append segment in "'+h+'" sourceBuffer'),L>=i.config.appendErrorMaxRetry&&(A.fatal=!0)}i.trigger(y.ERROR,A)}};a.append(S,h,!!this.pendingTracks[h])},n.onBufferFlushing=function(t,e){var r=this,i=this.operationQueue,a=function(o){return{execute:r.removeExecutor.bind(r,o,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(y.BUFFER_FLUSHED,{type:o})},onError:function(l){r.warn("Failed to remove from "+o+" SourceBuffer",l)}}};e.type?i.append(a(e.type),e.type):this.getSourceBufferTypes().forEach(function(o){i.append(a(o),o)})},n.onFragParsed=function(t,e){var r=this,i=e.frag,a=e.part,o=[],l=a?a.elementaryStreams:i.elementaryStreams;l[Or]?o.push("audiovideo"):(l[wt]&&o.push("audio"),l[Pt]&&o.push("video")),o.length===0&&this.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var h=self.performance.now();i.stats.buffering.end=h,a&&(a.stats.buffering.end=h);var u=a?a.stats:i.stats;r.hls.trigger(y.FRAG_BUFFERED,{frag:i,part:a,stats:u,id:i.type})},o)},n.onFragChanged=function(t,e){this.trimBuffers()},n.onBufferEos=function(t,e){var r=this;this.getSourceBufferTypes().reduce(function(i,a){var o=r.sourceBuffer[a];return!o||e.type&&e.type!==a||(o.ending=!0,o.ended||(o.ended=!0,r.log(a+" sourceBuffer now EOS"))),i&&!(o&&!o.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(a){var o=r.sourceBuffer[a];o&&(o.ending=!1)});var i=r.mediaSource;i&&i.readyState==="open"?(r.log("Calling mediaSource.endOfStream()"),i.endOfStream()):i&&r.log("Could not call mediaSource.endOfStream(). mediaSource.readyState: "+i.readyState)}))},n.onLevelUpdated=function(t,e){var r=e.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},n.trimBuffers=function(){var t=this.hls,e=this.details,r=this.media;if(r&&e!==null&&this.getSourceBufferTypes().length){var i=t.config,a=r.currentTime,o=e.levelTargetDuration,l=e.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(N(l)&&l>0){var h=Math.max(l,o),u=Math.floor(a/o)*o-h;this.flushBackBuffer(a,o,u)}if(N(i.frontBufferFlushThreshold)&&i.frontBufferFlushThreshold>0){var d=Math.max(i.maxBufferLength,i.frontBufferFlushThreshold),f=Math.max(d,o),c=Math.floor(a/o)*o+f;this.flushFrontBuffer(a,o,c)}}},n.flushBackBuffer=function(t,e,r){var i=this,a=this.details,o=this.sourceBuffer;this.getSourceBufferTypes().forEach(function(l){var h=o[l];if(h){var u=ut.getBuffered(h);if(u.length>0&&r>u.start(0)){if(i.hls.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:r}),a!=null&&a.live)i.hls.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(h.ended&&u.end(u.length-1)-t<2*e)return void i.log("Cannot flush "+l+" back buffer while SourceBuffer is in ended state");i.hls.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:l})}}})},n.flushFrontBuffer=function(t,e,r){var i=this,a=this.sourceBuffer;this.getSourceBufferTypes().forEach(function(o){var l=a[o];if(l){var h=ut.getBuffered(l),u=h.length;if(u<2)return;var d=h.start(u-1),f=h.end(u-1);if(r>d||t>=d&&t<=f)return;if(l.ended&&t-f<2*e)return void i.log("Cannot flush "+o+" front buffer while SourceBuffer is in ended state");i.hls.trigger(y.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:o})}})},n.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var t=this.details,e=this.hls,r=this.media,i=this.mediaSource,a=t.fragments[0].start+t.totalduration,o=r.duration,l=N(i.duration)?i.duration:0;t.live&&e.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(t)):(a>l&&a>o||!N(o))&&(this.log("Updating Media Source duration to "+a.toFixed(3)),i.duration=a)}},n.updateSeekableRange=function(t){var e=this.mediaSource,r=t.fragments;if(r.length&&t.live&&e!=null&&e.setLiveSeekableRange){var i=Math.max(0,r[0].start),a=Math.max(i,i+t.totalduration);this.log("Media Source duration is set to "+e.duration+". Setting seekable range to "+i+"-"+a+"."),e.setLiveSeekableRange(i,a)}},n.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&(!t||i===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};var a=this.getSourceBufferTypes();if(a.length)this.hls.trigger(y.BUFFER_CREATED,{tracks:this.tracks}),a.forEach(function(l){e.executeNext(l)});else{var o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}},n.createSourceBuffers=function(t){var e=this,r=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var a=function(l){if(!r[l]){var h,u=t[l];if(!u)throw Error("source buffer exists for track "+l+", however track does not");var d=((h=u.levelCodec)==null?void 0:h.indexOf(","))===-1?u.levelCodec:u.codec;d&&l.slice(0,5)==="audio"&&(d=sr(d,e.appendSource));var f=u.container+";codecs="+d;e.log("creating sourceBuffer("+f+")");try{var c=r[l]=i.addSourceBuffer(f),v=l;e.addBufferListener(v,"updatestart",e._onSBUpdateStart),e.addBufferListener(v,"updateend",e._onSBUpdateEnd),e.addBufferListener(v,"error",e._onSBUpdateError),e.appendSource&&e.addBufferListener(v,"bufferedchange",function(g,p){var m=p.removedRanges;m!=null&&m.length&&e.hls.trigger(y.BUFFER_FLUSHED,{type:l})}),e.tracks[l]={buffer:c,codec:d,container:u.container,levelCodec:u.levelCodec,metadata:u.metadata,id:u.id}}catch(g){e.error("error while trying to add sourceBuffer: "+g.message),e.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:l,mimeType:f})}}};for(var o in t)a(o)},n._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},n._onSBUpdateEnd=function(t){var e;if(((e=this.mediaSource)==null?void 0:e.readyState)!=="closed"){var r=this.operationQueue;r.current(t).onComplete(),r.shiftAndExecuteNext(t)}else this.resetBuffer(t)},n._onSBUpdateError=function(t,e){var r,i=new Error(t+" SourceBuffer error. MediaSource readyState: "+((r=this.mediaSource)==null?void 0:r.readyState));this.error(""+i,e),this.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:i,fatal:!1});var a=this.operationQueue.current(t);a&&a.onError(i)},n.removeExecutor=function(t,e,r){var i=this.media,a=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer[t];if(!i||!a||!l)return this.warn("Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(t);var h=N(i.duration)?i.duration:1/0,u=N(a.duration)?a.duration:1/0,d=Math.max(0,e),f=Math.min(r,h,u);f>d&&(!l.ending||l.ended)?(l.ended=!1,this.log("Removing ["+d+","+f+"] from the "+t+" SourceBuffer"),l.remove(d,f)):o.shiftAndExecuteNext(t)},n.appendExecutor=function(t,e){var r=this.sourceBuffer[e];if(r)r.ended=!1,r.appendBuffer(t);else if(!this.pendingTracks[e])throw new Error("Attempting to append to the "+e+" SourceBuffer, but it does not exist")},n.blockBuffers=function(t,e){var r=this;if(e===void 0&&(e=this.getSourceBufferTypes()),!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);var i=this.operationQueue,a=e.map(function(o){return i.appendBlocker(o)});Promise.all(a).then(function(){t(),e.forEach(function(o){var l=r.sourceBuffer[o];l!=null&&l.updating||i.shiftAndExecuteNext(o)})})},n.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},n.addBufferListener=function(t,e,r){var i=this.sourceBuffer[t];if(i){var a=r.bind(this,t);this.listeners[t].push({event:e,listener:a}),i.addEventListener(e,a)}},n.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach(function(r){e.removeEventListener(r.event,r.listener)})},ct(s,[{key:"mediaSrc",get:function(){var t,e,r=((t=this.media)==null||(e=t.querySelector)==null?void 0:e.call(t,"source"))||this.media;return r==null?void 0:r.src}}]),s}();function wa(s){var n=s.querySelectorAll("source");[].slice.call(n).forEach(function(t){s.removeChild(t)})}var Ho={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Ia=function(s){return String.fromCharCode(Ho[s]||s)},ce=15,Zt=100,Vo={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Yo={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Wo={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},jo={25:2,26:4,29:6,30:8,31:10,27:13,28:15},qo=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],Xo=function(){function s(){this.time=null,this.verboseLevel=0}return s.prototype.log=function(n,t){if(this.verboseLevel>=n){var e=typeof t=="function"?t():t;b.log(this.time+" ["+n+"] "+e)}},s}(),ge=function(s){for(var n=[],t=0;t<s.length;t++)n.push(s[t].toString(16));return n},Ca=function(){function s(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}var n=s.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},n.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},s}(),zo=function(){function s(){this.uchar=" ",this.penState=new Ca}var n=s.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},n.setPenState=function(t){this.penState.copy(t)},n.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},n.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},s}(),Qo=function(){function s(t){this.chars=[],this.pos=0,this.currPenState=new Ca,this.cueStartTime=null,this.logger=void 0;for(var e=0;e<Zt;e++)this.chars.push(new zo);this.logger=t}var n=s.prototype;return n.equals=function(t){for(var e=0;e<Zt;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0},n.copy=function(t){for(var e=0;e<Zt;e++)this.chars[e].copy(t.chars[e])},n.isEmpty=function(){for(var t=!0,e=0;e<Zt;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},n.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Zt&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Zt)},n.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(t){var e=this;t>=144&&this.backSpace();var r=Ia(t);this.pos>=Zt?this.logger.log(0,function(){return"Cannot insert "+t.toString(16)+" ("+r+") at position "+e.pos+". Skipping it!"}):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},n.clearFromPos=function(t){var e;for(e=t;e<Zt;e++)this.chars[e].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var t=[],e=!0,r=0;r<Zt;r++){var i=this.chars[r].uchar;i!==" "&&(e=!1),t.push(i)}return e?"":t.join("")},n.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},s}(),Di=function(){function s(t){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(var e=0;e<ce;e++)this.rows.push(new Qo(t));this.logger=t}var n=s.prototype;return n.reset=function(){for(var t=0;t<ce;t++)this.rows[t].clear();this.currRow=14},n.equals=function(t){for(var e=!0,r=0;r<ce;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},n.copy=function(t){for(var e=0;e<ce;e++)this.rows[e].copy(t.rows[e])},n.isEmpty=function(){for(var t=!0,e=0;e<ce;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},n.backSpace=function(){this.rows[this.currRow].backSpace()},n.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},n.insertChar=function(t){this.rows[this.currRow].insertChar(t)},n.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},n.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},n.setCursor=function(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},n.setPAC=function(t){this.logger.log(2,function(){return"pacData = "+JSON.stringify(t)});var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<ce;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var o=a.rows[i].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(var h=0;h<this.nrRollUpRows;h++)this.rows[e-this.nrRollUpRows+h+1].copy(a.rows[i+h])}}this.currRow=e;var u=this.rows[this.currRow];if(t.indent!==null){var d=t.indent,f=Math.max(d-1,0);u.setCursor(t.indent),t.color=u.chars[f].penState.foreground}var c={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(c)},n.setBkgData=function(t){this.logger.log(2,function(){return"bkgData = "+JSON.stringify(t)}),this.backSpace(),this.setPen(t),this.insertChar(32)},n.setRollUpRows=function(t){this.nrRollUpRows=t},n.rollUp=function(){var t=this;if(this.nrRollUpRows!==null){this.logger.log(1,function(){return t.getDisplayText()});var e=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(e,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(2,"Rolling up")}else this.logger.log(3,"roll_up but nrRollUpRows not set yet")},n.getDisplayText=function(t){t=t||!1;for(var e=[],r="",i=-1,a=0;a<ce;a++){var o=this.rows[a].getTextString();o&&(i=a+1,t?e.push("Row "+i+": '"+o+"'"):e.push(o.trim()))}return e.length>0&&(r=t?"["+e.join(" | ")+"]":e.join(`
`)),r},n.getTextAndFormat=function(){return this.rows},s}(),_a=function(){function s(t,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Di(r),this.nonDisplayedMemory=new Di(r),this.lastOutputScreen=new Di(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var n=s.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(t){this.outputFilter=t},n.setPAC=function(t){this.writeScreen.setPAC(t)},n.setBkgData=function(t){this.writeScreen.setBkgData(t)},n.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(2,function(){return"MODE="+t}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},n.insertChars=function(t){for(var e=this,r=0;r<t.length;r++)this.writeScreen.insertChar(t[r]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,function(){return i+": "+e.writeScreen.getDisplayText(!0)}),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(1,function(){return"DISPLAYED: "+e.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},n.ccFON=function(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){var t=this;if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,function(){return"DISP: "+t.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},n.ccTO=function(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},n.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var r=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},n.outputDataUpdate=function(t){t===void 0&&(t=!1);var e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},s}(),xa=function(){function s(t,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;var i=this.logger=new Xo;this.channels=[null,new _a(t,e,i),new _a(t+1,r,i)]}var n=s.prototype;return n.getHandler=function(t){return this.channels[t].getHandler()},n.setHandler=function(t,e){this.channels[t].setHandler(e)},n.addData=function(t,e){var r=this;this.logger.time=t;for(var i=function(o){var l=127&e[o],h=127&e[o+1],u=!1,d=null;if(l===0&&h===0)return 0;r.logger.log(3,function(){return"["+ge([e[o],e[o+1]])+"] -> ("+ge([l,h])+")"});var f=r.cmdHistory;if(l>=16&&l<=31){if(function(v,g,p){return p.a===v&&p.b===g}(l,h,f))return Rr(null,null,f),r.logger.log(3,function(){return"Repeated command ("+ge([l,h])+") is dropped"}),0;Rr(l,h,r.cmdHistory),(u=r.parseCmd(l,h))||(u=r.parseMidrow(l,h)),u||(u=r.parsePAC(l,h)),u||(u=r.parseBackgroundAttributes(l,h))}else Rr(null,null,f);if(!u&&(d=r.parseChars(l,h))){var c=r.currentChannel;c&&c>0?r.channels[c].insertChars(d):r.logger.log(2,"No channel found yet. TEXT-MODE?")}u||d||r.logger.log(2,function(){return"Couldn't parse cleaned data "+ge([l,h])+" orig: "+ge([e[o],e[o+1]])})},a=0;a<e.length;a+=2)i(a)},n.parseCmd=function(t,e){if(!((t===20||t===28||t===21||t===29)&&e>=32&&e<=47||(t===23||t===31)&&e>=33&&e<=35))return!1;var r=t===20||t===21||t===23?1:2,i=this.channels[r];return t===20||t===21||t===28||t===29?e===32?i.ccRCL():e===33?i.ccBS():e===34?i.ccAOF():e===35?i.ccAON():e===36?i.ccDER():e===37?i.ccRU(2):e===38?i.ccRU(3):e===39?i.ccRU(4):e===40?i.ccFON():e===41?i.ccRDC():e===42?i.ccTR():e===43?i.ccRTD():e===44?i.ccEDM():e===45?i.ccCR():e===46?i.ccENM():e===47&&i.ccEOC():i.ccTO(e-32),this.currentChannel=r,!0},n.parseMidrow=function(t,e){var r=0;if((t===17||t===25)&&e>=32&&e<=47){if((r=t===17?1:2)!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(e),this.logger.log(3,function(){return"MIDROW ("+ge([t,e])+")"}),!0)}return!1},n.parsePAC=function(t,e){var r;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(t===16||t===24)&&e>=64&&e<=95))return!1;var i=t<=23?1:2;r=e>=64&&e<=95?i===1?Vo[t]:Wo[t]:i===1?Yo[t]:jo[t];var a=this.channels[i];return!!a&&(a.setPAC(this.interpretPAC(r,e)),this.currentChannel=i,!0)},n.interpretPAC=function(t,e){var r,i={color:null,italics:!1,indent:null,underline:!1,row:t};return r=e>95?e-96:e-64,i.underline=(1&r)==1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},n.parseChars=function(t,e){var r,i,a=null,o=null;return t>=25?(r=2,o=t-8):(r=1,o=t),o>=17&&o<=19?(i=o===17?e+80:o===18?e+112:e+144,this.logger.log(2,function(){return"Special char '"+Ia(i)+"' in channel "+r}),a=[i]):t>=32&&t<=127&&(a=e===0?[t]:[t,e]),a&&this.logger.log(3,function(){return"Char codes =  "+ge(a).join(",")}),a},n.parseBackgroundAttributes=function(t,e){var r;if(!((t===16||t===24)&&e>=32&&e<=47||(t===23||t===31)&&e>=45&&e<=47))return!1;var i={};t===16||t===24?(r=Math.floor((e-32)/2),i.background=qo[r],e%2==1&&(i.background=i.background+"_semi")):e===45?i.background="transparent":(i.foreground="black",e===47&&(i.underline=!0));var a=t<=23?1:2;return this.channels[a].setBkgData(i),!0},n.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}Rr(null,null,this.cmdHistory)},n.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var r=this.channels[e];r&&r.cueSplitAtTime(t)}},s}();function Rr(s,n,t){t.a=s,t.b=n}var br=function(){function s(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var n=s.prototype;return n.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},n.newCue=function(t,e,r){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},n.reset=function(){this.cueRanges=[],this.startTime=null},s}(),wi=function(){if(pe!=null&&pe.VTTCue)return self.VTTCue;var s=["","lr","rl"],n=["start","middle","end","left","right"];function t(a,o){if(typeof o!="string"||!Array.isArray(a))return!1;var l=o.toLowerCase();return!!~a.indexOf(l)&&l}function e(a){return t(n,a)}function r(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),h=1;h<o;h++)l[h-1]=arguments[h];for(var u=1;u<arguments.length;u++){var d=arguments[u];for(var f in d)a[f]=d[f]}return a}function i(a,o,l){var h=this,u={enumerable:!0};h.hasBeenReset=!1;var d="",f=!1,c=a,v=o,g=l,p=null,m="",E=!0,T="auto",S="start",R=50,A="middle",L=50,w="middle";Object.defineProperty(h,"id",r({},u,{get:function(){return d},set:function(k){d=""+k}})),Object.defineProperty(h,"pauseOnExit",r({},u,{get:function(){return f},set:function(k){f=!!k}})),Object.defineProperty(h,"startTime",r({},u,{get:function(){return c},set:function(k){if(typeof k!="number")throw new TypeError("Start time must be set to a number.");c=k,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",r({},u,{get:function(){return v},set:function(k){if(typeof k!="number")throw new TypeError("End time must be set to a number.");v=k,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",r({},u,{get:function(){return g},set:function(k){g=""+k,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",r({},u,{get:function(){return p},set:function(k){p=k,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",r({},u,{get:function(){return m},set:function(k){var C=function(D){return t(s,D)}(k);if(C===!1)throw new SyntaxError("An invalid or illegal string was specified.");m=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",r({},u,{get:function(){return E},set:function(k){E=!!k,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",r({},u,{get:function(){return T},set:function(k){if(typeof k!="number"&&k!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=k,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",r({},u,{get:function(){return S},set:function(k){var C=e(k);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");S=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",r({},u,{get:function(){return R},set:function(k){if(k<0||k>100)throw new Error("Position must be between 0 and 100.");R=k,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",r({},u,{get:function(){return A},set:function(k){var C=e(k);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");A=C,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",r({},u,{get:function(){return L},set:function(k){if(k<0||k>100)throw new Error("Size must be between 0 and 100.");L=k,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",r({},u,{get:function(){return w},set:function(k){var C=e(k);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");w=C,this.hasBeenReset=!0}})),h.displayState=void 0}return i.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},i}(),Jo=function(){function s(){}return s.prototype.decode=function(n,t){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},s}();function Pa(s){function n(e,r,i,a){return 3600*(0|e)+60*(0|r)+(0|i)+parseFloat(a||0)}var t=s.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?n(t[2],t[3],0,t[4]):n(t[1],t[2],t[3],t[4]):null}var $o=function(){function s(){this.values=Object.create(null)}var n=s.prototype;return n.set=function(t,e){this.get(t)||e===""||(this.values[t]=e)},n.get=function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},n.has=function(t){return t in this.values},n.alt=function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},n.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},n.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(r>=0&&r<=100)return this.set(t,r),!0}return!1},s}();function Fa(s,n,t,e){var r=e?s.split(e):[s];for(var i in r)if(typeof r[i]=="string"){var a=r[i].split(t);a.length===2&&n(a[0],a[1])}}var Ii=new wi(0,0,""),kr=Ii.align==="middle"?"middle":"center";function Zo(s,n,t){var e=s;function r(){var a=Pa(s);if(a===null)throw new Error("Malformed timestamp: "+e);return s=s.replace(/^[^\sa-zA-Z-]+/,""),a}function i(){s=s.replace(/^\s+/,"")}if(i(),n.startTime=r(),i(),s.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);s=s.slice(3),i(),n.endTime=r(),i(),function(a,o){var l=new $o;Fa(a,function(d,f){var c;switch(d){case"region":for(var v=t.length-1;v>=0;v--)if(t[v].id===f){l.set(d,t[v].region);break}break;case"vertical":l.alt(d,f,["rl","lr"]);break;case"line":c=f.split(","),l.integer(d,c[0]),l.percent(d,c[0])&&l.set("snapToLines",!1),l.alt(d,c[0],["auto"]),c.length===2&&l.alt("lineAlign",c[1],["start",kr,"end"]);break;case"position":c=f.split(","),l.percent(d,c[0]),c.length===2&&l.alt("positionAlign",c[1],["start",kr,"end","line-left","line-right","auto"]);break;case"size":l.percent(d,f);break;case"align":l.alt(d,f,["start",kr,"end","left","right"])}},/:/,/\s/),o.region=l.get("region",null),o.vertical=l.get("vertical","");var h=l.get("line","auto");h==="auto"&&Ii.line===-1&&(h=-1),o.line=h,o.lineAlign=l.get("lineAlign","start"),o.snapToLines=l.get("snapToLines",!0),o.size=l.get("size",100),o.align=l.get("align",kr);var u=l.get("position","auto");u==="auto"&&Ii.position===50&&(u=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=u}(s,n)}function Ma(s){return s.replace(/<br(?: \/)?>/gi,`
`)}var tl=function(){function s(){this.state="INITIAL",this.buffer="",this.decoder=new Jo,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var n=s.prototype;return n.parse=function(t){var e=this;function r(){var h=e.buffer,u=0;for(h=Ma(h);u<h.length&&h[u]!=="\r"&&h[u]!==`
`;)++u;var d=h.slice(0,u);return h[u]==="\r"&&++u,h[u]===`
`&&++u,e.buffer=h.slice(u),d}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var i="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var a=(i=r()).match(/^()?WEBVTT([ \t].*)?$/);if(a==null||!a[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var o=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:i=r(),e.state){case"HEADER":/:/.test(i)?Fa(i,function(h,u){},/:/):i||(e.state="ID");continue;case"NOTE":i||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){e.state="NOTE";break}if(!i)continue;if(e.cue=new wi(0,0,""),e.state="CUE",i.indexOf("-->")===-1){e.cue.id=i;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{Zo(i,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var l=i.indexOf("-->")!==-1;if(!i||l&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=i;continue;case"BADCUE":i||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},n.flush=function(){var t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},s}(),el=/\r\n|\n\r|\n|\r/g,Ci=function(s,n,t){return t===void 0&&(t=0),s.slice(t,t+n.length)===n},_i=function(s){for(var n=5381,t=s.length;t;)n=33*n^s.charCodeAt(--t);return(n>>>0).toString()};function xi(s,n,t){return _i(s.toString())+_i(n.toString())+_i(t)}function rl(s,n,t,e,r,i,a){var o,l,h,u=new tl,d=Gt(new Uint8Array(s)).trim().replace(el,`
`).split(`
`),f=[],c=n?(o=n.baseTime,(l=n.timescale)===void 0&&(l=1),Si(o,pa,1/l)):0,v="00:00.000",g=0,p=0,m=!0;u.oncue=function(E){var T=t[e],S=t.ccOffset,R=(g-c)/9e4;if(T!=null&&T.new&&(p!==void 0?S=t.ccOffset=T.start:function(k,C,D){var _=k[C],x=k[_.prevCC];if(!x||!x.new&&_.new)return k.ccOffset=k.presentationOffset=_.start,void(_.new=!1);for(;(P=x)!=null&&P.new;){var P;k.ccOffset+=_.start-x.start,_.new=!1,x=k[(_=x).prevCC]}k.presentationOffset=D}(t,e,R)),R){if(!n)return void(h=new Error("Missing initPTS for VTT MPEGTS"));S=R-t.presentationOffset}var A=E.endTime-E.startTime,L=Nt(9e4*(E.startTime+S-p),9e4*r)/9e4;E.startTime=Math.max(L,0),E.endTime=Math.max(L+A,0);var w=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(w)),E.id||(E.id=xi(E.startTime,E.endTime,w)),E.endTime>0&&f.push(E)},u.onparsingerror=function(E){h=E},u.onflush=function(){h?a(h):i(f)},d.forEach(function(E){if(m){if(Ci(E,"X-TIMESTAMP-MAP=")){m=!1,E.slice(16).split(",").forEach(function(T){Ci(T,"LOCAL:")?v=T.slice(6):Ci(T,"MPEGTS:")&&(g=parseInt(T.slice(7)))});try{p=function(T){var S=parseInt(T.slice(-3)),R=parseInt(T.slice(-6,-4)),A=parseInt(T.slice(-9,-7)),L=T.length>9?parseInt(T.substring(0,T.indexOf(":"))):0;if(!(N(S)&&N(R)&&N(A)&&N(L)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+T);return S+=1e3*R,(S+=6e4*A)+36e5*L}(v)/1e3}catch(T){h=T}return}E===""&&(m=!1)}u.parse(E+`
`)}),u.flush()}var Pi="stpp.ttml.im1t",Oa=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Na=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,il={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ua(s,n,t,e){var r=q(new Uint8Array(s),["mdat"]);if(r.length!==0){var i,a,o,l,h=r.map(function(d){return Gt(d)}),u=(i=n.baseTime,a=1,(o=n.timescale)===void 0&&(o=1),l===void 0&&(l=!1),Si(i,a,1/o,l));try{h.forEach(function(d){return t(function(f,c){var v=new DOMParser().parseFromString(f,"text/xml"),g=v.getElementsByTagName("tt")[0];if(!g)throw new Error("Invalid ttml");var p={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},m=Object.keys(p).reduce(function(A,L){return A[L]=g.getAttribute("ttp:"+L)||p[L],A},{}),E=g.getAttribute("xml:space")!=="preserve",T=Ba(Fi(g,"styling","style")),S=Ba(Fi(g,"layout","region")),R=Fi(g,"body","[begin]");return[].map.call(R,function(A){var L=Ga(A,E);if(!L||!A.hasAttribute("begin"))return null;var w=Oi(A.getAttribute("begin"),m),k=Oi(A.getAttribute("dur"),m),C=Oi(A.getAttribute("end"),m);if(w===null)throw Ka(A);if(C===null){if(k===null)throw Ka(A);C=w+k}var D=new wi(w-c,C-c,L);D.id=xi(D.startTime,D.endTime,D.text);var _=function(M,U,F){var O="http://www.w3.org/ns/ttml#styling",B=null,G=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],V=M!=null&&M.hasAttribute("style")?M.getAttribute("style"):null;return V&&F.hasOwnProperty(V)&&(B=F[V]),G.reduce(function(Q,ot){var et=Mi(U,O,ot)||Mi(M,O,ot)||Mi(B,O,ot);return et&&(Q[ot]=et),Q},{})}(S[A.getAttribute("region")],T[A.getAttribute("style")],T),x=_.textAlign;if(x){var P=il[x];P&&(D.lineAlign=P),D.align=x}return gt(D,_),D}).filter(function(A){return A!==null})}(d,u))})}catch(d){e(d)}}else e(new Error("Could not parse IMSC1 mdat"))}function Fi(s,n,t){var e=s.getElementsByTagName(n)[0];return e?[].slice.call(e.querySelectorAll(t)):[]}function Ba(s){return s.reduce(function(n,t){var e=t.getAttribute("xml:id");return e&&(n[e]=t),n},{})}function Ga(s,n){return[].slice.call(s.childNodes).reduce(function(t,e,r){var i;return e.nodeName==="br"&&r?t+`
`:(i=e.childNodes)!=null&&i.length?Ga(e,n):n?t+e.textContent.trim().replace(/\s+/g," "):t+e.textContent},"")}function Mi(s,n,t){return s&&s.hasAttributeNS(n,t)?s.getAttributeNS(n,t):null}function Ka(s){return new Error("Could not parse ttml timestamp "+s)}function Oi(s,n){if(!s)return null;var t=Pa(s);return t===null&&(Oa.test(s)?t=function(e,r){var i=Oa.exec(e),a=(0|i[4])+(0|i[5])/r.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+a/r.frameRate}(s,n):Na.test(s)&&(t=function(e,r){var i=Na.exec(e),a=Number(i[1]);switch(i[2]){case"h":return 3600*a;case"m":return 60*a;case"ms":return 1e3*a;case"f":return a/r.frameRate;case"t":return a/r.tickRate}return a}(s,n))),t}var nl=function(){function s(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(y.FRAG_LOADING,this.onFragLoading,this),t.on(y.FRAG_LOADED,this.onFragLoaded,this),t.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}var n=s.prototype;return n.destroy=function(){var t=this.hls;t.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(y.FRAG_LOADING,this.onFragLoading,this),t.off(y.FRAG_LOADED,this.onFragLoaded,this),t.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0},n.initCea608Parsers=function(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){var t=new br(this,"textTrack1"),e=new br(this,"textTrack2"),r=new br(this,"textTrack3"),i=new br(this,"textTrack4");this.cea608Parser1=new xa(1,t,e),this.cea608Parser2=new xa(3,r,i)}},n.addCues=function(t,e,r,i,a){for(var o,l,h,u,d=!1,f=a.length;f--;){var c=a[f],v=(o=c[0],l=c[1],h=e,u=r,Math.min(l,u)-Math.max(o,h));if(v>=0&&(c[0]=Math.min(c[0],e),c[1]=Math.max(c[1],r),d=!0,v/(r-e)>.5))return}if(d||a.push([e,r]),this.config.renderTextTracksNatively){var g=this.captionsTracks[t];this.Cues.newCue(g,e,r,i)}else{var p=this.Cues.newCue(null,e,r,i);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:p,track:t})}},n.onInitPtsFound=function(t,e){var r=this,i=e.frag,a=e.id,o=e.initPTS,l=e.timescale,h=this.unparsedVttFrags;a==="main"&&(this.initPTS[i.cc]={baseTime:o,timescale:l}),h.length&&(this.unparsedVttFrags=[],h.forEach(function(u){r.onFragLoaded(y.FRAG_LOADED,u)}))},n.getExistingTrack=function(t,e){var r=this.media;if(r)for(var i=0;i<r.textTracks.length;i++){var a=r.textTracks[i];if(Va(a,{name:t,lang:e}))return a}return null},n.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},n.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,r=this.captionsTracks,i=this.media,a=e[t],o=a.label,l=a.languageCode,h=this.getExistingTrack(o,l);if(h)r[t]=h,Ee(r[t]),xn(r[t],i);else{var u=this.createTextTrack("captions",o,l);u&&(u[t]=!0,r[t]=u)}}},n.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var r={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},n.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},n.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},n.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(e){Ee(t[e]),delete t[e]}),this.nonNativeCaptionsTracks={}},n.onManifestLoading=function(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},n._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)Ee(e[r])}},n.onSubtitleTracksUpdated=function(t,e){var r=this,i=e.subtitleTracks||[],a=i.some(function(d){return d.textCodec===Pi});if(this.config.enableWebVTT||a&&this.config.enableIMSC1){if(ka(this.tracks,i))return void(this.tracks=i);if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){var o=this.media,l=o?or(o.textTracks):null;if(this.tracks.forEach(function(d,f){var c;if(l){for(var v=null,g=0;g<l.length;g++)if(l[g]&&Va(l[g],d)){v=l[g],l[g]=null;break}v&&(c=v)}if(c)Ee(c);else{var p=Ha(d);(c=r.createTextTrack(p,d.name,d.lang))&&(c.mode="disabled")}c&&r.textTracks.push(c)}),l!=null&&l.length){var h=l.filter(function(d){return d!==null}).map(function(d){return d.label});h.length&&b.warn("Media element contains unused subtitle tracks: "+h.join(", ")+". Replace media element for each source to clear TextTracks and captions menu.")}}else if(this.tracks.length){var u=this.tracks.map(function(d){return{label:d.name,kind:d.type.toLowerCase(),default:d.default,subtitleTrack:d}});this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},n.onManifestLoaded=function(t,e){var r=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(i){var a=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(a){var o="textTrack"+a[1],l=r.captionsProperties[o];l&&(l.label=i.name,i.lang&&(l.languageCode=i.lang),l.media=i)}})},n.closedCaptionsForLevel=function(t){var e=this.hls.levels[t.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]},n.onFragLoading=function(t,e){if(this.enabled&&e.frag.type===tt){var r,i,a=this.cea608Parser1,o=this.cea608Parser2,l=this.lastSn,h=e.frag,u=h.cc,d=h.sn,f=(r=(i=e.part)==null?void 0:i.index)!=null?r:-1;a&&o&&(d!==l+1||d===l&&f!==this.lastPartIndex+1||u!==this.lastCc)&&(a.reset(),o.reset()),this.lastCc=u,this.lastSn=d,this.lastPartIndex=f}},n.onFragLoaded=function(t,e){var r=e.frag,i=e.payload;if(r.type===qt)if(i.byteLength){var a=r.decryptdata,o="stats"in e;if(a==null||!a.encrypted||o){var l=this.tracks[r.level],h=this.vttCCs;h[r.cc]||(h[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),l&&l.textCodec===Pi?this._parseIMSC1(r,i):this._parseVTTs(e)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},n._parseIMSC1=function(t,e){var r=this,i=this.hls;Ua(e,this.initPTS[t.cc],function(a){r._appendCues(a,t.level),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(a){b.log("Failed to parse IMSC1: "+a),i.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:a})})},n._parseVTTs=function(t){var e,r=this,i=t.frag,a=t.payload,o=this.initPTS,l=this.unparsedVttFrags,h=o.length-1;if(o[i.cc]||h!==-1){var u=this.hls;rl((e=i.initSegment)!=null&&e.data?Ft(i.initSegment.data,new Uint8Array(a)):a,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,function(d){r._appendCues(d,i.level),u.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(d){var f=d.message==="Missing initPTS for VTT MPEGTS";f?l.push(t):r._fallbackToIMSC1(i,a),b.log("Failed to parse VTT cue: "+d),f&&h>i.cc||u.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:d})})}else l.push(t)},n._fallbackToIMSC1=function(t,e){var r=this,i=this.tracks[t.level];i.textCodec||Ua(e,this.initPTS[t.cc],function(){i.textCodec=Pi,r._parseIMSC1(t,e)},function(){i.textCodec="wvtt"})},n._appendCues=function(t,e){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||i.mode==="disabled")return;t.forEach(function(l){return Pn(i,l)})}else{var a=this.tracks[e];if(!a)return;var o=a.default?"default":"subtitles"+e;r.trigger(y.CUES_PARSED,{type:"subtitles",cues:t,track:o})}},n.onFragDecrypted=function(t,e){e.frag.type===qt&&this.onFragLoaded(y.FRAG_LOADED,e)},n.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},n.onFragParsingUserdata=function(t,e){this.initCea608Parsers();var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var a=e.frag,o=e.samples;if(a.type!==tt||this.closedCaptionsForLevel(a)!=="NONE")for(var l=0;l<o.length;l++){var h=o[l].bytes;if(h){var u=this.extractCea608Data(h);r.addData(o[l].pts,u[0]),i.addData(o[l].pts,u[1])}}}},n.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,a=e.endOffsetSubtitles,o=e.type,l=this.media;if(l&&!(l.currentTime<i)){if(!o||o==="video"){var h=this.captionsTracks;Object.keys(h).forEach(function(d){return ei(h[d],r,i)})}if(this.config.renderTextTracksNatively&&r===0&&a!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(d){return ei(u[d],r,a)})}}},n.extractCea608Data=function(t){for(var e=[[],[]],r=31&t[0],i=2,a=0;a<r;a++){var o=t[i++],l=127&t[i++],h=127&t[i++];if((l!==0||h!==0)&&4&o){var u=3&o;u!==0&&u!==1||(e[u].push(l),e[u].push(h))}}return e},s}();function Ha(s){return s.characteristics&&/transcribes-spoken-dialog/gi.test(s.characteristics)&&/describes-music-and-sound/gi.test(s.characteristics)?"captions":"subtitles"}function Va(s,n){return!!s&&s.kind===Ha(n)&&ki(n,s)}var al=function(){function s(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var n=s.prototype;return n.setStreamController=function(t){this.streamController=t},n.destroy=function(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},n.registerListeners=function(){var t=this.hls;t.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(y.BUFFER_CODECS,this.onBufferCodecs,this),t.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)},n.unregisterListener=function(){var t=this.hls;t.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(y.BUFFER_CODECS,this.onBufferCodecs,this),t.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)},n.onFpsDropLevelCapping=function(t,e){var r=this.hls.levels[e.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},n.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()},n.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},n.onLevelsUpdated=function(t,e){this.timer&&N(this.autoLevelCapping)&&this.detectPlayerSize()},n.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},n.onMediaDetaching=function(){this.stopCapping()},n.detectPlayerSize=function(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);var t=this.hls.levels;if(t.length){var e=this.hls,r=this.getMaxLevel(t.length-1);r!==this.autoLevelCapping&&b.log("Setting autoLevelCapping to "+r+": "+t[r].height+"p@"+t[r].bitrate+" for media "+this.mediaWidth+"x"+this.mediaHeight),e.autoLevelCapping=r,e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},n.getMaxLevel=function(t){var e=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter(function(a,o){return e.isLevelAllowed(a)&&o<=t});return this.clientRect=null,s.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},n.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},n.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},n.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var r=t.getBoundingClientRect();e.width=r.width,e.height=r.height,e.width||e.height||(e.width=r.right-r.left||t.width||0,e.height=r.bottom-r.top||t.height||0)}return this.clientRect=e,e},n.isLevelAllowed=function(t){return!this.restrictedLevels.some(function(e){return t.bitrate===e.bitrate&&t.width===e.width&&t.height===e.height})},s.getMaxLevelByMediaSize=function(t,e,r){if(t==null||!t.length)return-1;for(var i,a,o=t.length-1,l=Math.max(e,r),h=0;h<t.length;h+=1){var u=t[h];if((u.width>=l||u.height>=l)&&(i=u,!(a=t[h+1])||i.width!==a.width||i.height!==a.height)){o=h;break}}return o},ct(s,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return t}}]),s}(),sl=function(){function s(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var n=s.prototype;return n.setStreamController=function(t){this.streamController=t},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this)},n.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},n.onMediaAttaching=function(t,e){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},n.checkFPS=function(t,e,r){var i=performance.now();if(e){if(this.lastTime){var a=i-this.lastTime,o=r-this.lastDroppedFrames,l=e-this.lastDecodedFrames,h=1e3*o/a,u=this.hls;if(u.trigger(y.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),h>0&&o>u.config.fpsDroppedMonitoringThreshold*l){var d=u.currentLevel;b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=d)&&(d-=1,u.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:u.currentLevel}),u.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=e}},n.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},s}(),Dr="[eme]",Ya=function(){function s(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=s.CDMCleanupPromise?[s.CDMCleanupPromise]:[],this.debug=b.debug.bind(b,Dr),this.log=b.log.bind(b,Dr),this.warn=b.warn.bind(b,Dr),this.error=b.error.bind(b,Dr),this.onMediaEncrypted=function(r){var i=r.initDataType,a=r.initData,o='"'+r.type+'" event: init data type: "'+i+'"';if(e.debug(o),a!==null){if(!e.keyFormatPromise){var l=Object.keys(e.keySystemAccessPromises);l.length||(l=Ze(e.config));var h=l.map(Yr).filter(function(u){return!!u});e.keyFormatPromise=e.getKeyFormatPromise(h)}e.keyFormatPromise.then(function(u){var d,f,c=Hr(u);if(i==="sinf"){if(c!==Z.FAIRPLAY)return void e.warn('Ignoring unexpected "'+r.type+'" event with init data type: "'+i+'" for selected key-system '+c);var v=mt(new Uint8Array(a));try{var g=fn(Ur(JSON.parse(v).sinf));if(!g)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=g.subarray(8,24),f=Z.FAIRPLAY}catch(D){return void e.warn(o+" Failed to parse sinf: "+D)}}else{if(c!==Z.WIDEVINE&&c!==Z.PLAYREADY)return void e.warn('Ignoring unexpected "'+r.type+'" event with init data type: "'+i+'" for selected key-system '+c);var p=function(D){var _=[];if(D instanceof ArrayBuffer)for(var x=D.byteLength,P=0;P+32<x;){var M=Bs(new DataView(D,P));_.push(M),P+=M.size}return _}(a),m=p.filter(function(D){return!!D.systemId&&Vr(D.systemId)===c});m.length>1&&e.warn(o+" Using first of "+m.length+" pssh found for selected key-system "+c);var E=m[0];if(!E)return void(p.length===0||p.some(function(D){return!D.systemId})?e.warn(o+" contains incomplete or invalid pssh data"):e.log("ignoring "+o+" for "+p.map(function(D){return Vr(D.systemId)}).join(",")+" pssh data in favor of playlist keys"));if(f=Vr(E.systemId),E.version===0&&E.data)if(f===Z.WIDEVINE){var T=E.data.length-22;d=E.data.subarray(T,T+16)}else f===Z.PLAYREADY&&(d=rn(E.data))}if(f&&d){for(var S,R=Kt.hexDump(d),A=e.keyIdToKeySessionPromise,L=e.mediaKeySessions,w=A[R],k=function(){var D=L[C],_=D.decryptdata;if(!_.keyId)return 0;var x=Kt.hexDump(_.keyId);return R===x||_.uri.replace(/-/g,"").indexOf(R)!==-1?(w=A[x],_.pssh||(delete A[x],_.pssh=new Uint8Array(a),_.keyId=d,(w=A[R]=w.then(function(){return e.generateRequestWithPreferredKeySession(D,i,a,"encrypted-event-key-match")})).catch(function(P){return e.handleError(P)})),1):void 0},C=0;C<L.length&&((S=k())===0||S!==1);C++);if(!w){if(f!==c)return void e.log('Ignoring "'+o+'" with '+f+" init data for selected key-system "+c);w=A[R]=e.getKeySystemSelectionPromise([f]).then(function(D){var _,x=D.keySystem,P=D.mediaKeys;e.throwIfDestroyed();var M=new Qr("ISO-23001-7",R,(_=Yr(x))!=null?_:"");return M.pssh=new Uint8Array(a),M.keyId=d,e.attemptSetMediaKeys(x,P).then(function(){e.throwIfDestroyed();var U=e.createMediaKeySessionContext({decryptdata:M,keySystem:x,mediaKeys:P});return e.generateRequestWithPreferredKeySession(U,i,a,"encrypted-event-no-match")})}),w.catch(function(D){return e.handleError(D)})}}else e.log("Unable to handle "+o+" with key-system "+c)})}},this.onWaitingForKey=function(r){e.log('"'+r.type+'" event')},this.hls=t,this.config=t.config,this.registerListeners()}var n=s.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetached();var t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null},n.registerListeners=function(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this)},n.unregisterListeners=function(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this)},n.getLicenseServerUrl=function(t){var e=this.config,r=e.drmSystems,i=e.widevineLicenseUrl,a=r[t];return a?a.licenseUrl:t===Z.WIDEVINE&&i?i:void 0},n.getLicenseServerUrlOrThrow=function(t){var e=this.getLicenseServerUrl(t);if(e===void 0)throw new Error('no license server URL configured for key-system "'+t+'"');return e},n.getServerCertificateUrl=function(t){var e=this.config.drmSystems[t];if(e)return e.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+t+'"]')},n.attemptKeySystemAccess=function(t){var e=this,r=this.hls.levels,i=function(l,h,u){return!!l&&u.indexOf(l)===h},a=r.map(function(l){return l.audioCodec}).filter(i),o=r.map(function(l){return l.videoCodec}).filter(i);return a.length+o.length===0&&o.push("avc1.42e01e"),new Promise(function(l,h){(function u(d){var f=d.shift();e.getMediaKeysPromise(f,a,o).then(function(c){return l({keySystem:f,mediaKeys:c})}).catch(function(c){d.length?u(d):h(c instanceof Ut?c:new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_ACCESS,error:c,fatal:!0},c.message))})})(t)})},n.requestMediaKeySystemAccess=function(t,e){var r=this.config.requestMediaKeySystemAccessFunc;if(typeof r!="function"){var i="Configured requestMediaKeySystemAccess is not a function "+r;return en===null&&self.location.protocol==="http:"&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(i))}return r(t,e)},n.getMediaKeysPromise=function(t,e,r){var i=this,a=function(u,d,f,c){var v;switch(u){case Z.FAIRPLAY:v=["cenc","sinf"];break;case Z.WIDEVINE:case Z.PLAYREADY:v=["cenc"];break;case Z.CLEARKEY:v=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+u)}return function(g,p,m,E){return[{initDataTypes:g,persistentState:E.persistentState||"optional",distinctiveIdentifier:E.distinctiveIdentifier||"optional",sessionTypes:E.sessionTypes||[E.sessionType||"temporary"],audioCapabilities:p.map(function(T){return{contentType:'audio/mp4; codecs="'+T+'"',robustness:E.audioRobustness||"",encryptionScheme:E.audioEncryptionScheme||null}}),videoCapabilities:m.map(function(T){return{contentType:'video/mp4; codecs="'+T+'"',robustness:E.videoRobustness||"",encryptionScheme:E.videoEncryptionScheme||null}})}]}(v,d,f,c)}(t,e,r,this.config.drmSystemOptions),o=this.keySystemAccessPromises[t],l=o==null?void 0:o.keySystemAccess;if(!l){this.log('Requesting encrypted media "'+t+'" key-system access with config: '+JSON.stringify(a)),l=this.requestMediaKeySystemAccess(t,a);var h=this.keySystemAccessPromises[t]={keySystemAccess:l};return l.catch(function(u){i.log('Failed to obtain access to key-system "'+t+'": '+u)}),l.then(function(u){i.log('Access for key-system "'+u.keySystem+'" obtained');var d=i.fetchServerCertificate(t);return i.log('Create media-keys for "'+t+'"'),h.mediaKeys=u.createMediaKeys().then(function(f){return i.log('Media-keys created for "'+t+'"'),d.then(function(c){return c?i.setMediaKeysServerCertificate(f,t,c):f})}),h.mediaKeys.catch(function(f){i.error('Failed to create media-keys for "'+t+'"}: '+f)}),h.mediaKeys})}return l.then(function(){return o.mediaKeys})},n.createMediaKeySessionContext=function(t){var e=t.decryptdata,r=t.keySystem,i=t.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+Kt.hexDump(e.keyId||[]));var a=i.createSession(),o={decryptdata:e,keySystem:r,mediaKeys:i,mediaKeysSession:a,keyStatus:"status-pending"};return this.mediaKeySessions.push(o),o},n.renewKeySession=function(t){var e=t.decryptdata;if(e.pssh){var r=this.createMediaKeySessionContext(t),i=this.getKeyIdString(e);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)},n.getKeyIdString=function(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return Kt.hexDump(t.keyId)},n.updateKeySession=function(t,e){var r,i=t.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyID '+Kt.hexDump(((r=t.decryptdata)==null?void 0:r.keyId)||[])+`
      } (data length: `+(e&&e.byteLength)+")"),i.update(e)},n.selectKeySystemFormat=function(t){var e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+t.sn+" "+t.type+": "+t.level+") key formats "+e.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise},n.getKeyFormatPromise=function(t){var e=this;return new Promise(function(r,i){var a=Ze(e.config),o=t.map(Hr).filter(function(l){return!!l&&a.indexOf(l)!==-1});return e.getKeySystemSelectionPromise(o).then(function(l){var h=l.keySystem,u=Yr(h);u?r(u):i(new Error('Unable to find format for key-system "'+h+'"'))}).catch(i)})},n.loadKey=function(t){var e=this,r=t.keyInfo.decryptdata,i=this.getKeyIdString(r),a="(keyId: "+i+' format: "'+r.keyFormat+'" method: '+r.method+" uri: "+r.uri+")";this.log("Starting session for key "+a);var o=this.keyIdToKeySessionPromise[i];return o||(o=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then(function(l){var h=l.keySystem,u=l.mediaKeys;return e.throwIfDestroyed(),e.log("Handle encrypted media sn: "+t.frag.sn+" "+t.frag.type+": "+t.frag.level+" using key "+a),e.attemptSetMediaKeys(h,u).then(function(){e.throwIfDestroyed();var d=e.createMediaKeySessionContext({keySystem:h,mediaKeys:u,decryptdata:r});return e.generateRequestWithPreferredKeySession(d,"cenc",r.pssh,"playlist-key")})})).catch(function(l){return e.handleError(l)}),o},n.throwIfDestroyed=function(t){if(!this.hls)throw new Error("invalid state")},n.handleError=function(t){this.hls&&(this.error(t.message),t instanceof Ut?this.hls.trigger(y.ERROR,t.data):this.hls.trigger(y.ERROR,{type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))},n.getKeySystemForKeyPromise=function(t){var e=this.getKeyIdString(t),r=this.keyIdToKeySessionPromise[e];if(!r){var i=Hr(t.keyFormat),a=i?[i]:Ze(this.config);return this.attemptKeySystemAccess(a)}return r},n.getKeySystemSelectionPromise=function(t){if(t.length||(t=Ze(this.config)),t.length===0)throw new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(t)},n.attemptSetMediaKeys=function(t,e){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+t+'"');var a=Promise.all(i).then(function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(a),a.then(function(){r.log('Media-keys set for "'+t+'"'),i.push(a),r.setMediaKeysQueue=r.setMediaKeysQueue.filter(function(o){return i.indexOf(o)===-1})})},n.generateRequestWithPreferredKeySession=function(t,e,r,i){var a,o,l=this,h=(a=this.config.drmSystems)==null||(o=a[t.keySystem])==null?void 0:o.generateRequest;if(h)try{var u=h.call(this.hls,e,r,t);if(!u)throw new Error("Invalid response from configured generateRequest filter");e=u.initDataType,r=t.decryptdata.pssh=u.initData?new Uint8Array(u.initData):null}catch(m){var d;if(this.warn(m.message),(d=this.hls)!=null&&d.config.debug)throw m}if(r===null)return this.log('Skipping key-session request for "'+i+'" (no initData)'),Promise.resolve(t);var f=this.getKeyIdString(t.decryptdata);this.log('Generating key-session request for "'+i+'": '+f+" (init data type: "+e+" length: "+(r?r.byteLength:null)+")");var c=new Ar,v=t._onmessage=function(m){var E=t.mediaKeysSession;if(E){var T=m.messageType,S=m.message;l.log('"'+T+'" message event for session "'+E.sessionId+'" message size: '+S.byteLength),T==="license-request"||T==="license-renewal"?l.renewLicense(t,S).catch(function(R){l.handleError(R),c.emit("error",R)}):T==="license-release"?t.keySystem===Z.FAIRPLAY&&(l.updateKeySession(t,Br("acknowledged")),l.removeSession(t)):l.warn('unhandled media key message type "'+T+'"')}else c.emit("error",new Error("invalid state"))},g=t._onkeystatuseschange=function(m){if(t.mediaKeysSession){l.onKeyStatusChange(t);var E=t.keyStatus;c.emit("keyStatus",E),E==="expired"&&(l.warn(t.keySystem+" expired for key "+f),l.renewKeySession(t))}else c.emit("error",new Error("invalid state"))};t.mediaKeysSession.addEventListener("message",v),t.mediaKeysSession.addEventListener("keystatuseschange",g);var p=new Promise(function(m,E){c.on("error",E),c.on("keyStatus",function(T){T.startsWith("usable")?m():T==="output-restricted"?E(new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):T==="internal-error"?E(new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+T+'"')):T==="expired"?E(new Error("key expired while generating request")):l.warn('unhandled key status change "'+T+'"')})});return t.mediaKeysSession.generateRequest(e,r).then(function(){var m;l.log('Request generated for key-session "'+((m=t.mediaKeysSession)==null?void 0:m.sessionId)+'" keyId: '+f)}).catch(function(m){throw new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_NO_SESSION,error:m,fatal:!1},"Error generating key-session request: "+m)}).then(function(){return p}).catch(function(m){throw c.removeAllListeners(),l.removeSession(t),m}).then(function(){return c.removeAllListeners(),t})},n.onKeyStatusChange=function(t){var e=this;t.mediaKeysSession.keyStatuses.forEach(function(r,i){e.log('key status change "'+r+'" for keyStatuses keyId: '+Kt.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))+" session keyId: "+Kt.hexDump(new Uint8Array(t.decryptdata.keyId||[]))+" uri: "+t.decryptdata.uri),t.keyStatus=r})},n.fetchServerCertificate=function(t){var e=this.config,r=new e.loader(e),i=this.getServerCertificateUrl(t);return i?(this.log('Fetching server certificate for "'+t+'"'),new Promise(function(a,o){var l={responseType:"arraybuffer",url:i},h=e.certLoadPolicy.default,u={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:function(f,c,v,g){a(f.data)},onError:function(f,c,v,g){o(new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:yt({url:l.url,data:void 0},f)},'"'+t+'" certificate request failed ('+i+"). Status: "+f.code+" ("+f.text+")"))},onTimeout:function(f,c,v){o(new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:v,response:{url:l.url,data:void 0}},'"'+t+'" certificate request timed out ('+i+")"))},onAbort:function(f,c,v){o(new Error("aborted"))}};r.load(l,u,d)})):Promise.resolve()},n.setMediaKeysServerCertificate=function(t,e,r){var i=this;return new Promise(function(a,o){t.setServerCertificate(r).then(function(l){i.log("setServerCertificate "+(l?"success":"not supported by CDM")+" ("+(r==null?void 0:r.byteLength)+') on "'+e+'"'),a(t)}).catch(function(l){o(new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})},n.renewLicense=function(t,e){var r=this;return this.requestLicense(t,new Uint8Array(e)).then(function(i){return r.updateKeySession(t,new Uint8Array(i)).catch(function(a){throw new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:a,fatal:!0},a.message)})})},n.unpackPlayReadyKeyMessage=function(t,e){var r=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!r.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;var i=new DOMParser().parseFromString(r,"application/xml"),a=i.querySelectorAll("HttpHeader");if(a.length>0)for(var o,l=0,h=a.length;l<h;l++){var u,d,f=(u=(o=a[l]).querySelector("name"))==null?void 0:u.textContent,c=(d=o.querySelector("value"))==null?void 0:d.textContent;f&&c&&t.setRequestHeader(f,c)}var v=i.querySelector("Challenge"),g=v==null?void 0:v.textContent;if(!g)throw new Error("Cannot find <Challenge> in key message");return Br(atob(g))},n.setupLicenseXHR=function(t,e,r,i){var a=this,o=this.config.licenseXhrSetup;return o?Promise.resolve().then(function(){if(!r.decryptdata)throw new Error("Key removed");return o.call(a.hls,t,e,r,i)}).catch(function(l){if(!r.decryptdata)throw l;return t.open("POST",e,!0),o.call(a.hls,t,e,r,i)}).then(function(l){return t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:l||i}}):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:i}))},n.requestLicense=function(t,e){var r=this,i=this.config.keyLoadPolicy.default;return new Promise(function(a,o){var l=r.getLicenseServerUrlOrThrow(t.keySystem);r.log("Sending license request to URL: "+l);var h=new XMLHttpRequest;h.responseType="arraybuffer",h.onreadystatechange=function(){if(!r.hls||!t.mediaKeysSession)return o(new Error("invalid state"));if(h.readyState===4)if(h.status===200){r._requestLicenseFailureCount=0;var u=h.response;r.log("License received "+(u instanceof ArrayBuffer?u.byteLength:u));var d=r.config.licenseResponseCallback;if(d)try{u=d.call(r.hls,h,l,t)}catch(g){r.error(g)}a(u)}else{var f=i.errorRetry,c=f?f.maxNumRetry:0;if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>c||h.status>=400&&h.status<500)o(new Ut({type:K.KEY_SYSTEM_ERROR,details:I.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:{url:l,data:void 0,code:h.status,text:h.statusText}},"License Request XHR failed ("+l+"). Status: "+h.status+" ("+h.statusText+")"));else{var v=c-r._requestLicenseFailureCount+1;r.warn("Retrying license request, "+v+" attempts left"),r.requestLicense(t,e).then(a,o)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=h,r.setupLicenseXHR(h,l,t,e).then(function(u){var d=u.xhr,f=u.licenseChallenge;t.keySystem==Z.PLAYREADY&&(f=r.unpackPlayReadyKeyMessage(d,f)),d.send(f)})})},n.onMediaAttached=function(t,e){if(this.config.emeEnabled){var r=e.media;this.media=r,r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var t=this,e=this.media,r=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Qr.clearKeyUriToKeyIdMap();var i=r.length;s.CDMCleanupPromise=Promise.all(r.map(function(a){return t.removeSession(a)}).concat(e==null?void 0:e.setMediaKeys(null).catch(function(a){t.log("Could not clear media keys: "+a)}))).then(function(){i&&(t.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(function(a){t.log("Could not close sessions and clear media keys: "+a)})},n.onManifestLoading=function(){this.keyFormatPromise=null},n.onManifestLoaded=function(t,e){var r=e.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var i=r.reduce(function(a,o){return a.indexOf(o.keyFormat)===-1&&a.push(o.keyFormat),a},[]);this.log("Selecting key-system from session-keys "+i.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(i)}},n.removeSession=function(t){var e=this,r=t.mediaKeysSession,i=t.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),t._onmessage&&(r.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(r.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;var a=this.mediaKeySessions.indexOf(t);return a>-1&&this.mediaKeySessions.splice(a,1),r.remove().catch(function(o){e.log("Could not remove session: "+o)}).then(function(){return r.close()}).catch(function(o){e.log("Could not close session: "+o)})}},s}();Ya.CDMCleanupPromise=void 0;var Rt,Ni,ve,Xe,Ut=function(s){function n(t,e){var r;return(r=s.call(this,e)||this).data=void 0,t.error||(t.error=new Error(e)),r.data=t,t.err=t.error,r}return Lt(n,s),n}(Fe(Error));(function(s){s.MANIFEST="m",s.AUDIO="a",s.VIDEO="v",s.MUXED="av",s.INIT="i",s.CAPTION="c",s.TIMED_TEXT="tt",s.KEY="k",s.OTHER="o"})(Rt||(Rt={})),function(s){s.DASH="d",s.HLS="h",s.SMOOTH="s",s.OTHER="o"}(Ni||(Ni={})),function(s){s.OBJECT="CMCD-Object",s.REQUEST="CMCD-Request",s.SESSION="CMCD-Session",s.STATUS="CMCD-Status"}(ve||(ve={}));var ol=((Xe={})[ve.OBJECT]=["br","d","ot","tb"],Xe[ve.REQUEST]=["bl","dl","mtp","nor","nrr","su"],Xe[ve.SESSION]=["cid","pr","sf","sid","st","v"],Xe[ve.STATUS]=["bs","rtp"],Xe),Ui=function s(n,t){this.value=void 0,this.params=void 0,Array.isArray(n)&&(n=n.map(function(e){return e instanceof s?e:new s(e)})),this.value=n,this.params=t},Wa=function(s){this.description=void 0,this.description=s},ll="Dict";function ul(s,n,t,e){return new Error("failed to "+s+' "'+(r=n,(Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r))+'" as ')+t,{cause:e});var r}var ja="Bare Item",hl="Boolean",dl="Byte Sequence",fl="Decimal",cl="Integer",gl=/[\x00-\x1f\x7f]+/,vl="Token",ml="Key";function jt(s,n,t){return ul("serialize",s,n,t)}function pl(s){if(ArrayBuffer.isView(s)===!1)throw jt(s,dl);return":"+(n=s,btoa(String.fromCharCode.apply(String,n))+":");var n}function qa(s){if(function(n){return n<-999999999999999||999999999999999<n}(s))throw jt(s,cl);return s.toString()}function Xa(s,n){if(s<0)return-Xa(-s,n);var t=Math.pow(10,n);if(Math.abs(s*t%1-.5)<Number.EPSILON){var e=Math.floor(s*t);return(e%2==0?e:e+1)/t}return Math.round(s*t)/t}function yl(s){var n=Xa(s,3);if(Math.floor(Math.abs(n)).toString().length>12)throw jt(s,fl);var t=n.toString();return t.includes(".")?t:t+".0"}var El="String";function za(s){var n,t=(n=s).description||n.toString().slice(7,-1);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t)===!1)throw jt(t,vl);return t}function Bi(s){switch(typeof s){case"number":if(!N(s))throw jt(s,ja);return Number.isInteger(s)?qa(s):yl(s);case"string":return function(n){if(gl.test(n))throw jt(n,El);return'"'+n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}(s);case"symbol":return za(s);case"boolean":return function(n){if(typeof n!="boolean")throw jt(n,hl);return n?"?1":"?0"}(s);case"object":if(s instanceof Date)return function(n){return"@"+qa(n.getTime()/1e3)}(s);if(s instanceof Uint8Array)return pl(s);if(s instanceof Wa)return za(s);default:throw jt(s,ja)}}function Gi(s){if(/^[a-z*][a-z0-9\-_.*]*$/.test(s)===!1)throw jt(s,ml);return s}function Ki(s){return s==null?"":Object.entries(s).map(function(n){var t=n[0],e=n[1];return e===!0?";"+Gi(t):";"+Gi(t)+"="+Bi(e)}).join("")}function Qa(s){return s instanceof Ui?""+Bi(s.value)+Ki(s.params):Bi(s)}function Tl(s,n){var t;if(n===void 0&&(n={whitespace:!0}),typeof s!="object")throw jt(s,ll);var e=s instanceof Map?s.entries():Object.entries(s),r=(t=n)!=null&&t.whitespace?" ":"";return Array.from(e).map(function(i){var a=i[0],o=i[1];o instanceof Ui==0&&(o=new Ui(o));var l,h=Gi(a);return o.value===!0?h+=Ki(o.params):(h+="=",Array.isArray(o.value)?h+="("+(l=o).value.map(Qa).join(" ")+")"+Ki(l.params):h+=Qa(o)),h}).join(","+r)}var Sl=function(s){return s==="ot"||s==="sf"||s==="st"},Ll=function(s){return typeof s=="number"?N(s):s!=null&&s!==""&&s!==!1},wr=function(s){return Math.round(s)},Ir=function(s){return 100*wr(s/100)},Al={br:wr,d:wr,bl:Ir,dl:Ir,mtp:Ir,nor:function(s,n){return n!=null&&n.baseUrl&&(s=function(t,e){var r=new URL(t),i=new URL(e);if(r.origin!==i.origin)return t;for(var a=r.pathname.split("/").slice(1),o=i.pathname.split("/").slice(1,-1);a[0]===o[0];)a.shift(),o.shift();for(;o.length;)o.shift(),a.unshift("..");return a.join("/")}(s,n.baseUrl)),encodeURIComponent(s)},rtp:Ir,tb:wr};function Ja(s,n){return n===void 0&&(n={}),s?function(t,e){return Tl(t,e)}(function(t,e){var r={};if(t==null||typeof t!="object")return r;var i=Object.keys(t).sort(),a=gt({},Al,e==null?void 0:e.formatters),o=e==null?void 0:e.filter;return i.forEach(function(l){if(o==null||!o(l)){var h=t[l],u=a[l];u&&(h=u(h,e)),l==="v"&&h===1||l=="pr"&&h===1||Ll(h)&&(Sl(l)&&typeof h=="string"&&(h=new Wa(h)),r[l]=h)}}),r}(s,n),gt({whitespace:!1},n)):""}function Rl(s,n,t){return gt(s,function(e,r){var i;if(r===void 0&&(r={}),!e)return{};var a=Object.entries(e),o=Object.entries(ol).concat(Object.entries(((i=r)==null?void 0:i.customHeaderMap)||{})),l=a.reduce(function(h,u){var d,f=u[0],c=u[1],v=((d=o.find(function(g){return g[1].includes(f)}))==null?void 0:d[0])||ve.REQUEST;return h[v]!=null||(h[v]={}),h[v][f]=c,h},{});return Object.entries(l).reduce(function(h,u){var d=u[0],f=u[1];return h[d]=Ja(f,r),h},{})}(n,t))}var bl="CMCD",$a=/CMCD=[^&#]+/;function kl(s,n,t){var e=function(i,a){if(a===void 0&&(a={}),!i)return"";var o=Ja(i,a);return bl+"="+encodeURIComponent(o)}(n,t);if(!e)return s;if($a.test(s))return s.replace($a,e);var r=s.includes("?")?"&":"?";return""+s+r+e}var Dl=function(){function s(t){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(a){try{e.apply(a,{ot:Rt.MANIFEST,su:!e.initialized})}catch(o){b.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(a){try{var o=a.frag,l=e.hls.levels[o.level],h=e.getObjectType(o),u={d:1e3*o.duration,ot:h};h!==Rt.VIDEO&&h!==Rt.AUDIO&&h!=Rt.MUXED||(u.br=l.bitrate/1e3,u.tb=e.getTopBandwidth(h)/1e3,u.bl=e.getBufferLength(h)),e.apply(a,u)}catch(d){b.warn("Could not generate segment CMCD data.",d)}},this.hls=t;var r=this.config=t.config,i=r.cmcd;i!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||function(){try{return crypto.randomUUID()}catch{try{var a=URL.createObjectURL(new Blob),o=a.toString();return URL.revokeObjectURL(a),o.slice(o.lastIndexOf("/")+1)}catch{var l=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var f=(l+16*Math.random())%16|0;return l=Math.floor(l/16),(d=="x"?f:3&f|8).toString(16)})}}}(),this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}var n=s.prototype;return n.registerListeners=function(){var t=this.hls;t.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(y.MEDIA_DETACHED,this.onMediaDetached,this),t.on(y.BUFFER_CREATED,this.onBufferCreated,this)},n.unregisterListeners=function(){var t=this.hls;t.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(y.MEDIA_DETACHED,this.onMediaDetached,this),t.off(y.BUFFER_CREATED,this.onBufferCreated,this)},n.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null},n.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},n.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},n.onBufferCreated=function(t,e){var r,i;this.audioBuffer=(r=e.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=e.tracks.video)==null?void 0:i.buffer},n.createData=function(){var t;return{v:1,sf:Ni.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},n.apply=function(t,e){e===void 0&&(e={}),gt(e,this.createData());var r=e.ot===Rt.INIT||e.ot===Rt.VIDEO||e.ot===Rt.MUXED;this.starved&&r&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);var i=this.includeKeys;i&&(e=Object.keys(e).reduce(function(a,o){return i.includes(o)&&(a[o]=e[o]),a},{})),this.useHeaders?(t.headers||(t.headers={}),Rl(t.headers,e)):t.url=kl(t.url,e)},n.getObjectType=function(t){var e=t.type;return e==="subtitle"?Rt.TIMED_TEXT:t.sn==="initSegment"?Rt.INIT:e==="audio"?Rt.AUDIO:e==="main"?this.hls.audioTracks.length?Rt.VIDEO:Rt.MUXED:void 0},n.getTopBandwidth=function(t){var e,r=0,i=this.hls;if(t===Rt.AUDIO)e=i.audioTracks;else{var a=i.maxAutoLevel,o=a>-1?a+1:i.levels.length;e=i.levels.slice(0,o)}for(var l,h=ds(e);!(l=h()).done;){var u=l.value;u.bitrate>r&&(r=u.bitrate)}return r>0?r:NaN},n.getBufferLength=function(t){var e=this.hls.media,r=t===Rt.AUDIO?this.audioBuffer:this.videoBuffer;return r&&e?1e3*ut.bufferInfo(r,e.currentTime,this.config.maxBufferHole).len:NaN},n.createPlaylistLoader=function(){var t=this.config.pLoader,e=this.applyPlaylistData,r=t||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(o,l,h){e(o),this.loader.load(o,l,h)},ct(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},n.createFragmentLoader=function(){var t=this.config.fLoader,e=this.applyFragmentData,r=t||this.config.loader;return function(){function i(o){this.loader=void 0,this.loader=new r(o)}var a=i.prototype;return a.destroy=function(){this.loader.destroy()},a.abort=function(){this.loader.abort()},a.load=function(o,l,h){e(o),this.loader.load(o,l,h)},ct(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},s}(),wl=function(){function s(t){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.log=b.log.bind(b,"[content-steering]:"),this.registerListeners()}var n=s.prototype;return n.registerListeners=function(){var t=this.hls;t.on(y.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t&&(t.off(y.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.ERROR,this.onError,this))},n.startLoad=function(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){var t=1e3*this.timeToLoad-(performance.now()-this.updated);if(t>0)return void this.scheduleRefresh(this.uri,t)}this.loadSteeringManifest(this.uri)}},n.stopLoad=function(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()},n.clearTimeout=function(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)},n.destroy=function(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null},n.removeLevel=function(t){var e=this.levels;e&&(this.levels=e.filter(function(r){return r!==t}))},n.onManifestLoading=function(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null},n.onManifestLoaded=function(t,e){var r=e.contentSteering;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())},n.onManifestParsed=function(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks},n.onError=function(t,e){var r=e.errorAction;if((r==null?void 0:r.action)===Xt&&r.flags===hi){var i=this.levels,a=this.pathwayPriority,o=this.pathwayId;if(e.context){var l=e.context,h=l.groupId,u=l.pathwayId,d=l.type;h&&i?o=this.getPathwayForGroupId(h,d,o):u&&(o=u)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!a&&i&&(a=i.reduce(function(f,c){return f.indexOf(c.pathwayId)===-1&&f.push(c.pathwayId),f},[])),a&&a.length>1&&(this.updatePathwayPriority(a),r.resolved=this.pathwayId!==o),r.resolved||b.warn("Could not resolve "+e.details+' ("'+e.error.message+'") with content-steering for Pathway: '+o+" levels: "+(i&&i.length)+" priorities: "+JSON.stringify(a)+" penalized: "+JSON.stringify(this.penalizedPathways))}},n.filterParsedLevels=function(t){this.levels=t;var e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){var r=t[0].pathwayId;this.log("No levels found in Pathway "+this.pathwayId+'. Setting initial Pathway to "'+r+'"'),e=this.getLevelsForPathway(r),this.pathwayId=r}return e.length!==t.length&&this.log("Found "+e.length+"/"+t.length+' levels in Pathway "'+this.pathwayId+'"'),e},n.getLevelsForPathway=function(t){return this.levels===null?[]:this.levels.filter(function(e){return t===e.pathwayId})},n.updatePathwayPriority=function(t){var e;this.pathwayPriority=t;var r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(function(d){i-r[d]>3e5&&delete r[d]});for(var a=0;a<t.length;a++){var o=t[a];if(!(o in r)){if(o===this.pathwayId)return;var l=this.hls.nextLoadLevel,h=this.hls.levels[l];if((e=this.getLevelsForPathway(o)).length>0){this.log('Setting Pathway to "'+o+'"'),this.pathwayId=o,Vn(e),this.hls.trigger(y.LEVELS_UPDATED,{levels:e});var u=this.hls.levels[l];h&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==h.bitrate&&this.log("Unstable Pathways change from bitrate "+h.bitrate+" to "+u.bitrate),this.hls.nextLoadLevel=l);break}}}},n.getPathwayForGroupId=function(t,e,r){for(var i=this.getLevelsForPathway(r).concat(this.levels||[]),a=0;a<i.length;a++)if(e===Bt&&i[a].hasAudioGroup(t)||e===Vt&&i[a].hasSubtitleGroup(t))return i[a].pathwayId;return r},n.clonePathways=function(t){var e=this,r=this.levels;if(r){var i={},a={};t.forEach(function(o){var l=o.ID,h=o["BASE-ID"],u=o["URI-REPLACEMENT"];if(!r.some(function(f){return f.pathwayId===l})){var d=e.getLevelsForPathway(h).map(function(f){var c=new dt(f.attrs);c["PATHWAY-ID"]=l;var v=c.AUDIO&&c.AUDIO+"_clone_"+l,g=c.SUBTITLES&&c.SUBTITLES+"_clone_"+l;v&&(i[c.AUDIO]=v,c.AUDIO=v),g&&(a[c.SUBTITLES]=g,c.SUBTITLES=g);var p=ts(f.uri,c["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),m=new Te({attrs:c,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:p,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(var E=1;E<f.audioGroups.length;E++)m.addGroupId("audio",f.audioGroups[E]+"_clone_"+l);if(f.subtitleGroups)for(var T=1;T<f.subtitleGroups.length;T++)m.addGroupId("text",f.subtitleGroups[T]+"_clone_"+l);return m});r.push.apply(r,d),Za(e.audioTracks,i,u,l),Za(e.subtitleTracks,a,u,l)}})}},n.loadSteeringManifest=function(t){var e,r=this,i=this.hls.config,a=i.loader;this.loader&&this.loader.destroy(),this.loader=new a(i);try{e=new self.URL(t)}catch{return this.enabled=!1,void this.log("Failed to parse Steering Manifest URI: "+t)}if(e.protocol!=="data:"){var o=0|(this.hls.bandwidthEstimate||i.abrEwmaDefaultEstimate);e.searchParams.set("_HLS_pathway",this.pathwayId),e.searchParams.set("_HLS_throughput",""+o)}var l={responseType:"json",url:e.href},h=i.steeringManifestLoadPolicy.default,u=h.errorRetry||h.timeoutRetry||{},d={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},f={onSuccess:function(c,v,g,p){r.log('Loaded steering manifest: "'+e+'"');var m=c.data;if(m.VERSION===1){r.updated=performance.now(),r.timeToLoad=m.TTL;var E=m["RELOAD-URI"],T=m["PATHWAY-CLONES"],S=m["PATHWAY-PRIORITY"];if(E)try{r.uri=new self.URL(E,e).href}catch{return r.enabled=!1,void r.log("Failed to parse Steering Manifest RELOAD-URI: "+E)}r.scheduleRefresh(r.uri||g.url),T&&r.clonePathways(T);var R={steeringManifest:m,url:e.toString()};r.hls.trigger(y.STEERING_MANIFEST_LOADED,R),S&&r.updatePathwayPriority(S)}else r.log("Steering VERSION "+m.VERSION+" not supported!")},onError:function(c,v,g,p){if(r.log("Error loading steering manifest: "+c.code+" "+c.text+" ("+v.url+")"),r.stopLoad(),c.code===410)return r.enabled=!1,void r.log("Steering manifest "+v.url+" no longer available");var m=1e3*r.timeToLoad;if(c.code!==429)r.scheduleRefresh(r.uri||v.url,m);else{var E=r.loader;if(typeof(E==null?void 0:E.getResponseHeader)=="function"){var T=E.getResponseHeader("Retry-After");T&&(m=1e3*parseFloat(T))}r.log("Steering manifest "+v.url+" rate limited")}},onTimeout:function(c,v,g){r.log("Timeout loading steering manifest ("+v.url+")"),r.scheduleRefresh(r.uri||v.url)}};this.log("Requesting steering manifest: "+e),this.loader.load(l,d,f)},n.scheduleRefresh=function(t,e){var r=this;e===void 0&&(e=1e3*this.timeToLoad),this.clearTimeout(),this.reloadTimer=self.setTimeout(function(){var i,a=(i=r.hls)==null?void 0:i.media;!a||a.ended?r.scheduleRefresh(t,1e3*r.timeToLoad):r.loadSteeringManifest(t)},e)},s}();function Za(s,n,t,e){s&&Object.keys(n).forEach(function(r){var i=s.filter(function(a){return a.groupId===r}).map(function(a){var o=gt({},a);return o.details=void 0,o.attrs=new dt(o.attrs),o.url=o.attrs.URI=ts(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=n[r],o.attrs["PATHWAY-ID"]=e,o});s.push.apply(s,i)})}function ts(s,n,t,e){var r,i=e.HOST,a=e.PARAMS,o=e[t];n&&(r=o==null?void 0:o[n])&&(s=r);var l=new self.URL(s);return i&&!r&&(l.host=i),a&&Object.keys(a).sort().forEach(function(h){h&&l.searchParams.set(h,a[h])}),l.href}var Il=/^age:\s*[\d.]+\s*$/im,es=function(){function s(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new Qe,this.retryDelay=0}var n=s.prototype;return n.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null},n.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))},n.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},n.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.loadInternal()},n.loadInternal=function(){var t=this,e=this.config,r=this.context;if(e&&r){var i=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0,a.aborted=!1;var o=this.xhrSetup;o?Promise.resolve().then(function(){if(t.loader===i&&!t.stats.aborted)return o(i,r.url)}).catch(function(l){if(t.loader===i&&!t.stats.aborted)return i.open("GET",r.url,!0),o(i,r.url)}).then(function(){t.loader!==i||t.stats.aborted||t.openAndSendXhr(i,r,e)}).catch(function(l){t.callbacks.onError({code:i.status,text:l.message},r,i,a)}):this.openAndSendXhr(i,r,e)}},n.openAndSendXhr=function(t,e,r){t.readyState||t.open("GET",e.url,!0);var i=e.headers,a=r.loadPolicy,o=a.maxTimeToFirstByteMs,l=a.maxLoadTimeMs;if(i)for(var h in i)t.setRequestHeader(h,i[h]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),r.timeout=o&&N(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),t.send()},n.readystatechange=function(){var t=this.context,e=this.loader,r=this.stats;if(t&&e){var i=e.readyState,a=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;var o=e.status,l=e.responseType==="text"?e.responseText:null;if(o>=200&&o<300){var h=l??e.response;if(h!=null){r.loading.end=Math.max(self.performance.now(),r.loading.first);var u=e.responseType==="arraybuffer"?h.byteLength:h.length;if(r.loaded=r.total=u,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(r,t,h,e),!this.callbacks)return;var f={url:e.responseURL,data:h,code:o};return void this.callbacks.onSuccess(f,r,t,e)}}var c=a.loadPolicy.errorRetry;dr(c,r.retry,!1,{url:t.url,data:void 0,code:o})?this.retry(c):(b.error(o+" while loading "+t.url),this.callbacks.onError({code:o,text:e.statusText},t,e,r))}}},n.loadtimeout=function(){if(this.config){var t=this.config.loadPolicy.timeoutRetry;if(dr(t,this.stats.retry,!0))this.retry(t);else{var e;b.warn("timeout while loading "+((e=this.context)==null?void 0:e.url));var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}},n.retry=function(t){var e=this.context,r=this.stats;this.retryDelay=oi(t,r.retry),r.retry++,b.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+(e==null?void 0:e.url)+", retrying "+r.retry+"/"+t.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},n.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},n.getCacheAge=function(){var t=null;if(this.loader&&Il.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},n.getResponseHeader=function(t){return this.loader&&new RegExp("^"+t+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null},s}(),Cl=/(\d+)-(\d+)\/(\d+)/,rs=function(){function s(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||_l,this.controller=new self.AbortController,this.stats=new Qe}var n=s.prototype;return n.destroy=function(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null},n.abortInternal=function(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())},n.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},n.load=function(t,e,r){var i=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var o=function(v,g){var p={method:"GET",mode:"cors",credentials:"same-origin",signal:g,headers:new self.Headers(gt({},v.headers))};return v.rangeEnd&&p.headers.set("Range","bytes="+v.rangeStart+"-"+String(v.rangeEnd-1)),p}(t,this.controller.signal),l=r.onProgress,h=t.responseType==="arraybuffer",u=h?"byteLength":"length",d=e.loadPolicy,f=d.maxTimeToFirstByteMs,c=d.maxLoadTimeMs;this.context=t,this.config=e,this.callbacks=r,this.request=this.fetchSetup(t,o),self.clearTimeout(this.requestTimeout),e.timeout=f&&N(f)?f:c,this.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(a,t,i.response)},e.timeout),self.fetch(this.request).then(function(v){i.response=i.loader=v;var g=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(i.requestTimeout),e.timeout=c,i.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(a,t,i.response)},c-(g-a.loading.start)),!v.ok){var p=v.status,m=v.statusText;throw new xl(m||"fetch, bad network response",p,v)}return a.loading.first=g,a.total=function(E){var T=E.get("Content-Range");if(T){var S=function(A){var L=Cl.exec(A);if(L)return parseInt(L[2])-parseInt(L[1])+1}(T);if(N(S))return S}var R=E.get("Content-Length");if(R)return parseInt(R)}(v.headers)||a.total,l&&N(e.highWaterMark)?i.loadProgressively(v,a,t,e.highWaterMark,l):h?v.arrayBuffer():t.responseType==="json"?v.json():v.text()}).then(function(v){var g=i.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(i.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var p=v[u];p&&(a.loaded=a.total=p);var m={url:g.url,data:v,code:g.status};l&&!N(e.highWaterMark)&&l(a,t,v,g),r.onSuccess(m,a,t,g)}).catch(function(v){if(self.clearTimeout(i.requestTimeout),!a.aborted){var g=v&&v.code||0,p=v?v.message:null;r.onError({code:g,text:p},t,v?v.details:null,a)}})},n.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},n.getResponseHeader=function(t){return this.response?this.response.headers.get(t):null},n.loadProgressively=function(t,e,r,i,a){i===void 0&&(i=0);var o=new ia,l=t.body.getReader();return function h(){return l.read().then(function(u){if(u.done)return o.dataLength&&a(e,r,o.flush(),t),Promise.resolve(new ArrayBuffer(0));var d=u.value,f=d.length;return e.loaded+=f,f<i||o.dataLength?(o.push(d),o.dataLength>=i&&a(e,r,o.flush(),t)):a(e,r,d,t),h()}).catch(function(){return Promise.reject()})}()},s}();function _l(s,n){return new self.Request(s.url,n)}var Hi,xl=function(s){function n(t,e,r){var i;return(i=s.call(this,t)||this).code=void 0,i.details=void 0,i.code=e,i.details=r,i}return Lt(n,s),n}(Fe(Error)),Pl=/\s/,is=yt(yt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:es,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:no,bufferController:Ko,capLevelController:al,errorController:to,fpsController:sl,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:en,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:{newCue:function(s,n,t,e){for(var r,i,a,o,l,h=[],u=self.VTTCue||self.TextTrackCue,d=0;d<e.rows.length;d++)if(a=!0,o=0,l="",!(r=e.rows[d]).isEmpty()){for(var f,c=0;c<r.chars.length;c++)Pl.test(r.chars[c].uchar)&&a?o++:(l+=r.chars[c].uchar,a=!1);r.cueStartTime=n,n===t&&(t+=1e-4),o>=16?o--:o++;var v=Ma(l.trim()),g=xi(n,t,v);s!=null&&(f=s.cues)!=null&&f.getCueById(g)||((i=new u(n,t,v)).id=g,i.line=d+1,i.align="left",i.position=10+Math.min(80,10*Math.floor(8*o/32)),h.push(i))}return s&&h.length&&(h.sort(function(p,m){return p.line==="auto"||m.line==="auto"?0:p.line>8&&m.line>8?m.line-p.line:p.line-m.line}),h.forEach(function(p){return Pn(s,p)})),h}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:No,subtitleTrackController:Bo,timelineController:nl,audioStreamController:Mo,audioTrackController:Oo,emeController:Ya,cmcdController:Dl,contentSteeringController:wl});function Vi(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(Vi):Object.keys(s).reduce(function(n,t){return n[t]=Vi(s[t]),n},{}):s}function Fl(s){var n=s.loader;n!==rs&&n!==es?(b.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(s.loader=rs,s.progressive=!0,s.enableSoftwareAES=!0,b.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Ml=function(s){function n(e,r){var i;return(i=s.call(this,e,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._maxAutoLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}Lt(n,s);var t=n.prototype;return t._registerListeners=function(){var e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.ERROR,this.onError,this)},t._unregisterListeners=function(){var e=this.hls;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.ERROR,this.onError,this)},t.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s.prototype.destroy.call(this)},t.stopLoad=function(){this._levels.forEach(function(e){e.loadError=0,e.fragmentError=0}),s.prototype.stopLoad.call(this)},t.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1},t.onManifestLoading=function(e,r){this.resetLevels()},t.onManifestLoaded=function(e,r){var i=this.hls.config.preferManagedMediaSource,a=[],o={},l={},h=!1,u=!1,d=!1;r.levels.forEach(function(f){var c,v,g=f.attrs,p=f.audioCodec,m=f.videoCodec;((c=p)==null?void 0:c.indexOf("mp4a.40.34"))!==-1&&(Hi||(Hi=/chrome|firefox/i.test(navigator.userAgent)),Hi&&(f.audioCodec=p=void 0)),p&&(f.audioCodec=p=sr(p,i)),((v=m)==null?void 0:v.indexOf("avc1"))===0&&(m=f.videoCodec=function(M){for(var U=M.split(","),F=0;F<U.length;F++){var O=U[F].split(".");if(O.length>2){var B=O.shift()+".";B+=parseInt(O.shift()).toString(16),B+=("000"+parseInt(O.shift()).toString(16)).slice(-4),U[F]=B}}return U.join(",")}(m));var E=f.width,T=f.height,S=f.unknownCodecs;if(h||(h=!(!E||!T)),u||(u=!!m),d||(d=!!p),!(S!=null&&S.length||p&&!$r(p,"audio",i)||m&&!$r(m,"video",i))){var R=g.CODECS,A=g["FRAME-RATE"],L=g["HDCP-LEVEL"],w=g["PATHWAY-ID"],k=g.RESOLUTION,C=g["VIDEO-RANGE"],D=(w||".")+"-"+f.bitrate+"-"+k+"-"+A+"-"+R+"-"+C+"-"+L;if(o[D])if(o[D].uri===f.url||f.attrs["PATHWAY-ID"])o[D].addGroupId("audio",g.AUDIO),o[D].addGroupId("text",g.SUBTITLES);else{var _=l[D]+=1;f.attrs["PATHWAY-ID"]=new Array(_+1).join(".");var x=new Te(f);o[D]=x,a.push(x)}else{var P=new Te(f);o[D]=P,l[D]=1,a.push(P)}}}),this.filterAndSortMediaOptions(a,r,h,u,d)},t.filterAndSortMediaOptions=function(e,r,i,a,o){var l=this,h=[],u=[],d=e;if((i||a)&&o&&(d=d.filter(function(L){var w,k=L.videoCodec,C=L.videoRange,D=L.width,_=L.height;return(!!k||!(!D||!_))&&!!(w=C)&&ur.indexOf(w)>-1})),d.length!==0){if(r.audioTracks){var f=this.hls.config.preferManagedMediaSource;ns(h=r.audioTracks.filter(function(L){return!L.audioCodec||$r(L.audioCodec,"audio",f)}))}r.subtitles&&ns(u=r.subtitles);var c=d.slice(0);d.sort(function(L,w){if(L.attrs["HDCP-LEVEL"]!==w.attrs["HDCP-LEVEL"])return(L.attrs["HDCP-LEVEL"]||"")>(w.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&L.height!==w.height)return L.height-w.height;if(L.frameRate!==w.frameRate)return L.frameRate-w.frameRate;if(L.videoRange!==w.videoRange)return ur.indexOf(L.videoRange)-ur.indexOf(w.videoRange);if(L.videoCodec!==w.videoCodec){var k=Tn(L.videoCodec),C=Tn(w.videoCodec);if(k!==C)return C-k}if(L.uri===w.uri&&L.codecSet!==w.codecSet){var D=ar(L.codecSet),_=ar(w.codecSet);if(D!==_)return _-D}return L.averageBitrate!==w.averageBitrate?L.averageBitrate-w.averageBitrate:0});var v=c[0];if(this.steering&&(d=this.steering.filterParsedLevels(d)).length!==c.length){for(var g=0;g<c.length;g++)if(c[g].pathwayId===d[0].pathwayId){v=c[g];break}}this._levels=d;for(var p=0;p<d.length;p++)if(d[p]===v){var m;this._firstLevel=p;var E=v.bitrate,T=this.hls.bandwidthEstimate;if(this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+E),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){var S=Math.min(E,this.hls.config.abrEwmaDefaultEstimateMax);S>T&&T===is.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=S)}break}var R=o&&!a,A={levels:d,audioTracks:h,subtitleTracks:u,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:o,video:a,altAudio:!R&&h.some(function(L){return!!L.url})};this.hls.trigger(y.MANIFEST_PARSED,A),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then(function(){if(l.hls){r.levels.length&&l.warn("One or more CODECS in variant not supported: "+JSON.stringify(r.levels[0].attrs));var L=new Error("no level with compatible codecs found in manifest");l.hls.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:L,reason:L.message})}})},t.onError=function(e,r){!r.fatal&&r.context&&r.context.type===le&&r.context.level===this.level&&this.checkRetry(r)},t.onFragBuffered=function(e,r){var i=r.frag;if(i!==void 0&&i.type===tt){var a=i.elementaryStreams;if(!Object.keys(a).some(function(l){return!!a[l]}))return;var o=this._levels[i.level];o!=null&&o.loadError&&(this.log("Resetting level error count of "+o.loadError+" on frag buffered"),o.loadError=0)}},t.onLevelLoaded=function(e,r){var i,a,o=r.level,l=r.details,h=this._levels[o];if(!h)return this.warn("Invalid level index "+o),void((a=r.deliveryDirectives)!=null&&a.skip&&(l.deltaUpdateFailed=!0));o===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0),this.playlistLoaded(o,r,h.details)):(i=r.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},t.loadPlaylist=function(e){s.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var a=i.uri;if(e)try{a=e.addDirectives(a)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}var o=i.attrs["PATHWAY-ID"];this.log("Loading level index "+r+((e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:"")+" with"+(o?" Pathway "+o:"")+" "+a),this.clearTimer(),this.hls.trigger(y.LEVEL_LOADING,{url:a,level:r,pathwayId:i.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}},t.removeLevel=function(e){var r,i=this,a=this._levels.filter(function(o,l){return l!==e||(i.steering&&i.steering.removeLevel(o),o===i.currentLevel&&(i.currentLevel=null,i.currentLevelIndex=-1,o.details&&o.details.fragments.forEach(function(h){return h.level=-1})),!1)});Vn(a),this._levels=a,this.currentLevelIndex>-1&&(r=this.currentLevel)!=null&&r.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(y.LEVELS_UPDATED,{levels:a})},t.onLevelsUpdated=function(e,r){var i=r.levels;this._levels=i},t.checkMaxAutoUpdated=function(){var e=this.hls,r=e.autoLevelCapping,i=e.maxAutoLevel,a=e.maxHdcpLevel;this._maxAutoLevel!==i&&(this._maxAutoLevel=i,this.hls.trigger(y.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:r,levels:this.levels,maxAutoLevel:i,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:a}))},ct(n,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var r=this._levels;if(r.length!==0){if(e<0||e>=r.length){var i=new Error("invalid level idx"),a=e<0;if(this.hls.trigger(y.ERROR,{type:K.OTHER_ERROR,details:I.LEVEL_SWITCH_ERROR,level:e,fatal:a,error:i,reason:i.message}),a)return;e=Math.min(e,r.length-1)}var o=this.currentLevelIndex,l=this.currentLevel,h=l?l.attrs["PATHWAY-ID"]:void 0,u=r[e],d=u.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=u,o!==e||!u.details||!l||h!==d){this.log("Switching to level "+e+" ("+(u.height?u.height+"p ":"")+(u.videoRange?u.videoRange+" ":"")+(u.codecSet?u.codecSet+" ":"")+"@"+u.bitrate+")"+(d?" with Pathway "+d:"")+" from level "+o+(h?" with Pathway "+h:""));var f={level:e,attrs:u.attrs,details:u.details,bitrate:u.bitrate,averageBitrate:u.averageBitrate,maxBitrate:u.maxBitrate,realBitrate:u.realBitrate,width:u.width,height:u.height,codecSet:u.codecSet,audioCodec:u.audioCodec,videoCodec:u.videoCodec,audioGroups:u.audioGroups,subtitleGroups:u.subtitleGroups,loaded:u.loaded,loadError:u.loadError,fragmentError:u.fragmentError,name:u.name,id:u.id,uri:u.uri,url:u.url,urlId:0,audioGroupIds:u.audioGroupIds,textGroupIds:u.textGroupIds};this.hls.trigger(y.LEVEL_SWITCHING,f);var c=u.details;if(!c||c.live){var v=this.switchParams(u.uri,l==null?void 0:l.details,c);this.loadPlaylist(v)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}]),n}(di);function ns(s){var n={};s.forEach(function(t){var e=t.groupId||"";t.id=n[e]=n[e]||0,n[e]++})}var Ol=function(){function s(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}var n=s.prototype;return n.abort=function(t){for(var e in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[e].loader;if(r){var i;if(t&&t!==((i=r.context)==null?void 0:i.frag.type))return;r.abort()}}},n.detach=function(){for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}},n.destroy=function(){for(var t in this.detach(),this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},n.createKeyLoadError=function(t,e,r,i,a){return e===void 0&&(e=I.KEY_LOAD_ERROR),new Qt({type:K.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:a,error:r,networkDetails:i})},n.loadClear=function(t,e){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=t.sn,a=t.cc,o=function(){var h=e[l];if(a<=h.cc&&(i==="initSegment"||h.sn==="initSegment"||i<h.sn))return r.emeController.selectKeySystemFormat(h).then(function(u){h.setKeyFormat(u)}),1},l=0;l<e.length&&!o();l++);},n.load=function(t){var e=this;return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(function(r){return e.loadInternal(t,r)}):this.loadInternal(t)},n.loadInternal=function(t,e){var r,i;e&&t.setKeyFormat(e);var a=t.decryptdata;if(!a){var o=new Error(e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(t,I.KEY_LOAD_ERROR,o))}var l=a.uri;if(!l)return Promise.reject(this.createKeyLoadError(t,I.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+l+'"')));var h,u=this.keyUriToKeyInfo[l];if((r=u)!=null&&r.decryptdata.key)return a.key=u.decryptdata.key,Promise.resolve({frag:t,keyInfo:u});if((i=u)!=null&&i.keyLoadPromise)switch((h=u.mediaKeySessionContext)==null?void 0:h.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then(function(d){return a.key=d.keyInfo.decryptdata.key,{frag:t,keyInfo:u}})}switch(u=this.keyUriToKeyInfo[l]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(u,t):this.loadKeyEME(u,t);case"AES-128":return this.loadKeyHTTP(u,t);default:return Promise.reject(this.createKeyLoadError(t,I.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+a.method+'"')))}},n.loadKeyEME=function(t,e){var r={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(t.keyLoadPromise=i.then(function(a){return t.mediaKeySessionContext=a,r})).catch(function(a){throw t.keyLoadPromise=null,a})}return Promise.resolve(r)},n.loadKeyHTTP=function(t,e){var r=this,i=this.config,a=new i.loader(i);return e.keyLoader=t.loader=a,t.keyLoadPromise=new Promise(function(o,l){var h={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},u=i.keyLoadPolicy.default,d={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:function(c,v,g,p){var m=g.frag,E=g.keyInfo,T=g.url;if(!m.decryptdata||E!==r.keyUriToKeyInfo[T])return l(r.createKeyLoadError(m,I.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));E.decryptdata.key=m.decryptdata.key=new Uint8Array(c.data),m.keyLoader=null,E.loader=null,o({frag:m,keyInfo:E})},onError:function(c,v,g,p){r.resetLoader(v),l(r.createKeyLoadError(e,I.KEY_LOAD_ERROR,new Error("HTTP Error "+c.code+" loading key "+c.text),g,yt({url:h.url,data:void 0},c)))},onTimeout:function(c,v,g){r.resetLoader(v),l(r.createKeyLoadError(e,I.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:function(c,v,g){r.resetLoader(v),l(r.createKeyLoadError(e,I.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};a.load(h,d,f)})},n.resetLoader=function(t){var e=t.frag,r=t.keyInfo,i=t.url,a=r.loader;e.keyLoader===a&&(e.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],a&&a.destroy()},s}();function as(){return self.SourceBuffer||self.WebKitSourceBuffer}function ss(){if(!oe())return!1;var s=as();return!s||s.prototype&&typeof s.prototype.appendBuffer=="function"&&typeof s.prototype.remove=="function"}var Nl=function(){function s(t,e,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=r,this.hls=i}var n=s.prototype;return n.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},n.poll=function(t,e){var r=this.config,i=this.media,a=this.stalled;if(i!==null){var o=i.currentTime,l=i.seeking,h=this.seeking&&!l,u=!this.seeking&&l;if(this.seeking=l,o===t)if(u||h)this.stalled=null;else if(i.paused&&!l||i.ended||i.playbackRate===0||!ut.getBuffered(i).length)this.nudgeRetry=0;else{var d=ut.bufferInfo(i,o,0),f=d.nextStart||0;if(l){var c=d.len>2,v=!f||e&&e.start<=o||f-o>2&&!this.fragmentTracker.getPartialFragment(o);if(c||v)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var g;if(!(d.len>0||f))return;var p=Math.max(f,d.start||0)-o,m=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,E=!(m==null||(g=m.details)==null)&&g.live?2*m.details.targetduration:2,T=this.fragmentTracker.getPartialFragment(o);if(p>0&&(p<=E||T))return void(i.paused||this._trySkipBufferHole(T))}var S=self.performance.now();if(a!==null){var R=S-a;if(l||!(R>=250)||(this._reportStall(d),this.media)){var A=ut.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(A,R)}}else this.stalled=S}else if(this.moved=!0,l||(this.nudgeRetry=0),a!==null){if(this.stallReported){var L=self.performance.now()-a;b.warn("playback not stuck anymore @"+o+", after "+Math.round(L)+"ms"),this.stallReported=!1}this.stalled=null}}},n._tryFixBufferStall=function(t,e){var r=this.config,i=this.fragmentTracker,a=this.media;if(a!==null){var o=a.currentTime,l=i.getPartialFragment(o);if(l&&(this._trySkipBufferHole(l)||!this.media))return;(t.len>r.maxBufferHole||t.nextStart&&t.nextStart-o<r.maxBufferHole)&&e>1e3*r.highBufferWatchdogPeriod&&(b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},n._reportStall=function(t){var e=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var i=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(t)+")");b.warn(i.message),e.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:t.len})}},n._trySkipBufferHole=function(t){var e=this.config,r=this.hls,i=this.media;if(i===null)return 0;var a=i.currentTime,o=ut.bufferInfo(i,a,0),l=a<o.start?o.start:o.nextStart;if(l){var h=o.len<=e.maxBufferHole,u=o.len>0&&o.len<1&&i.readyState<3,d=l-a;if(d>0&&(h||u)){if(d>e.maxBufferHole){var f=this.fragmentTracker,c=!1;if(a===0){var v=f.getAppendedFrag(0,tt);v&&l<v.end&&(c=!0)}if(!c){var g=t||f.getAppendedFrag(a,tt);if(g){for(var p=!1,m=g.end;m<l;){var E=f.getPartialFragment(m);if(!E){p=!0;break}m+=E.duration}if(p)return 0}}}var T=Math.max(l+.05,a+.1);if(b.warn("skipping hole, adjusting currentTime from "+a+" to "+T),this.moved=!0,this.stalled=null,i.currentTime=T,t&&!t.gap){var S=new Error("fragment loaded with buffer holes, seeking from "+a+" to "+T);r.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,frag:t})}return T}}return 0},n._tryNudgeBuffer=function(){var t=this.config,e=this.hls,r=this.media,i=this.nudgeRetry;if(r!==null){var a=r.currentTime;if(this.nudgeRetry++,i<t.nudgeMaxRetry){var o=a+(i+1)*t.nudgeOffset,l=new Error("Nudging 'currentTime' from "+a+" to "+o);b.warn(l.message),r.currentTime=o,e.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1})}else{var h=new Error("Playhead still not moving while enough data buffered @"+a+" after "+t.nudgeMaxRetry+" nudges");b.error(h.message),e.trigger(y.ERROR,{type:K.MEDIA_ERROR,details:I.BUFFER_STALLED_ERROR,error:h,fatal:!0})}}},s}(),Ul=function(s){function n(e,r,i){var a;return(a=s.call(this,e,r,i,"[stream-controller]",tt)||this).audioCodecSwap=!1,a.gapController=null,a.level=-1,a._forceStartLoad=!1,a.altAudio=!1,a.audioOnly=!1,a.fragPlaying=null,a.onvplaying=null,a.onvseeked=null,a.fragLastKbps=0,a.couldBacktrack=!1,a.backtrackFragment=null,a.audioCodecSwitch=!1,a.videoBuffer=null,a._registerListeners(),a}Lt(n,s);var t=n.prototype;return t._registerListeners=function(){var e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(y.ERROR,this.onError,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)},t._unregisterListeners=function(){var e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(y.ERROR,this.onError,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)},t.onHandlerDestroying=function(){this._unregisterListeners(),s.prototype.onHandlerDestroying.call(this)},t.startLoad=function(e){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var a=i.startLevel;a===-1&&(i.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=i.firstAutoLevel),i.nextLoadLevel=a,this.level=i.loadLevel,this.loadedmetadata=!1}r>0&&e===-1&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),e=r),this.state=X,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Ot},t.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},t.doTick=function(){switch(this.state){case de:var e=this.levels,r=this.level,i=e==null?void 0:e[r],a=i==null?void 0:i.details;if(a&&(!a.live||this.levelLastLoaded===i)){if(this.waitForCdnTuneIn(a))break;this.state=X;break}if(this.hls.nextLoadLevel!==this.level){this.state=X;break}break;case ke:var o,l=self.performance.now(),h=this.retryDate;if(!h||l>=h||(o=this.media)!=null&&o.seeking){var u=this.levels,d=this.level,f=u==null?void 0:u[d];this.resetStartWhenNotLoaded(f||null),this.state=X}}this.state===X&&this.doTickIdle(),this.onTickEnd()},t.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},t.doTickIdle=function(){var e=this.hls,r=this.levelLastLoaded,i=this.levels,a=this.media;if(r!==null&&(a||!this.startFragRequested&&e.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)){var o=this.buffering?e.nextLoadLevel:e.loadLevel;if(i!=null&&i[o]){var l=i[o],h=this.getMainFwdBufferInfo();if(h!==null){var u=this.getLevelDetails();if(u&&this._streamEnded(h,u)){var d={};return this.altAudio&&(d.type="video"),this.hls.trigger(y.BUFFER_EOS,d),void(this.state=Ye)}if(this.buffering){e.loadLevel!==o&&e.manualLevel===-1&&this.log("Adapting to level "+o+" from level "+this.level),this.level=e.nextLoadLevel=o;var f=l.details;if(!f||this.state===de||f.live&&this.levelLastLoaded!==l)return this.level=o,void(this.state=de);var c=h.len,v=this.getMaxBufferLength(l.maxBitrate);if(!(c>=v)){this.backtrackFragment&&this.backtrackFragment.start>h.end&&(this.backtrackFragment=null);var g=this.backtrackFragment?this.backtrackFragment.start:h.end,p=this.getNextFragment(g,f);if(this.couldBacktrack&&!this.fragPrevious&&p&&p.sn!=="initSegment"&&this.fragmentTracker.getState(p)!==He){var m,E=((m=this.backtrackFragment)!=null?m:p).sn-f.startSN,T=f.fragments[E-1];T&&p.cc===T.cc&&(p=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&h.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,g)){if(!p.gap){var S=this.audioOnly&&!this.altAudio?wt:Pt,R=(S===Pt?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,S,tt)}p=this.getNextFragmentLoopLoading(p,f,h,tt,v)}p&&(!p.initSegment||p.initSegment.data||this.bitrateTest||(p=p.initSegment),this.loadFragment(p,l,g))}}}}}},t.loadFragment=function(e,r,i){var a=this.fragmentTracker.getState(e);this.fragCurrent=e,a===Ke||a===Ae?e.sn==="initSegment"?this._loadInitSegment(e,r):this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,e,r,i)):this.clearTrackerIfNeeded(e)},t.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,tt)},t.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},t.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},t.nextLevelSwitch=function(){var e=this.levels,r=this.media;if(r!=null&&r.readyState){var i,a=this.getAppendedFrag(r.currentTime);a&&a.start>1&&this.flushMainBuffer(0,a.start-1);var o=this.getLevelDetails();if(o!=null&&o.live){var l=this.getMainFwdBufferInfo();if(!l||l.len<2*o.targetduration)return}if(!r.paused&&e){var h=e[this.hls.nextLoadLevel],u=this.fragLastKbps;i=u&&this.fragCurrent?this.fragCurrent.duration*h.maxBitrate/(1e3*u)+1:0}else i=0;var d=this.getBufferedFrag(r.currentTime+i);if(d){var f=this.followingBufferedFrag(d);if(f){this.abortCurrentFrag();var c=f.maxStartPTS?f.maxStartPTS:f.start,v=f.duration,g=Math.max(d.end,c+Math.min(Math.max(v-this.config.maxFragLookUpTolerance,v*(this.couldBacktrack?.5:.125)),v*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}},t.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case gi:case be:case ke:case Jt:case pr:this.state=X}this.nextLoadPosition=this.getLoadPosition()},t.flushMainBuffer=function(e,r){s.prototype.flushMainBuffer.call(this,e,r,this.altAudio?"video":null)},t.onMediaAttached=function(e,r){s.prototype.onMediaAttached.call(this,e,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new Nl(this.config,i,this.fragmentTracker,this.hls)},t.onMediaDetaching=function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},t.onMediaPlaying=function(){this.tick()},t.onMediaSeeked=function(){var e=this.media,r=e?e.currentTime:null;N(r)&&this.log("Media seeked to "+r.toFixed(3));var i=this.getMainFwdBufferInfo();i!==null&&i.len!==0?this.tick():this.warn('Main forward buffer length on "seeked" event '+(i?i.len:"empty")+")")},t.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1},t.onManifestParsed=function(e,r){var i,a,o=!1,l=!1;r.levels.forEach(function(h){var u=h.audioCodec;u&&(o=o||u.indexOf("mp4a.40.2")!==-1,l=l||u.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=o&&l&&typeof((a=as())==null||(i=a.prototype)==null?void 0:i.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},t.onLevelLoading=function(e,r){var i=this.levels;if(i&&this.state===X){var a=i[r.level];(!a.details||a.details.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(a.details))&&(this.state=de)}},t.onLevelLoaded=function(e,r){var i,a=this.levels,o=r.level,l=r.details,h=l.totalduration;if(a){this.log("Level "+o+" loaded ["+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+", cc ["+l.startCC+", "+l.endCC+"] duration:"+h);var u=a[o],d=this.fragCurrent;!d||this.state!==be&&this.state!==ke||d.level!==r.level&&d.loader&&this.abortCurrentFrag();var f=0;if(l.live||(i=u.details)!=null&&i.live){var c;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;f=this.alignPlaylists(l,u.details,(c=this.levelLastLoaded)==null?void 0:c.details)}if(u.details=l,this.levelLastLoaded=u,this.hls.trigger(y.LEVEL_UPDATED,{details:l,level:o}),this.state===de){if(this.waitForCdnTuneIn(l))return;this.state=X}this.startFragRequested?l.live&&this.synchronizeToLiveEdge(l):this.setStartPosition(l,f),this.tick()}else this.warn("Levels were reset while loading level "+o)},t._handleFragmentLoadProgress=function(e){var r,i=e.frag,a=e.part,o=e.payload,l=this.levels;if(l){var h=l[i.level],u=h.details;if(!u)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var d=h.videoCodec,f=u.PTSKnown||!u.live,c=(r=i.initSegment)==null?void 0:r.data,v=this._getAudioCodec(h),g=this.transmuxer=this.transmuxer||new ba(this.hls,tt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=a?a.index:-1,m=p!==-1,E=new fi(i.level,i.sn,i.stats.chunkCount,o.byteLength,p,m),T=this.initPTS[i.cc];g.push(o,c,v,d,i,a,u.totalduration,f,E,T)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},t.onAudioTrackSwitching=function(e,r){var i=this.altAudio;if(!r.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;i&&(o.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),o.trigger(y.AUDIO_TRACK_SWITCHED,r)}},t.onAudioTrackSwitched=function(e,r){var i=r.id,a=!!this.hls.audioTracks[i].url;if(a){var o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=a,this.tick()},t.onBufferCreated=function(e,r){var i,a,o=r.tracks,l=!1;for(var h in o){var u=o[h];if(u.id==="main"){if(a=h,i=u,h==="video"){var d=o[h];d&&(this.videoBuffer=d.buffer)}}else l=!0}l&&i?(this.log("Alternate track found, use "+a+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},t.onFragBuffered=function(e,r){var i=r.frag,a=r.part;if(!i||i.type===tt){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(a?" p: "+a.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===pr&&(this.state=X));var o=a?a.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,a)}},t.onError=function(e,r){var i;if(r.fatal)this.state=De;else switch(r.details){case I.FRAG_GAP:case I.FRAG_PARSING_ERROR:case I.FRAG_DECRYPT_ERROR:case I.FRAG_LOAD_ERROR:case I.FRAG_LOAD_TIMEOUT:case I.KEY_LOAD_ERROR:case I.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(tt,r);break;case I.LEVEL_LOAD_ERROR:case I.LEVEL_LOAD_TIMEOUT:case I.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==de||((i=r.context)==null?void 0:i.type)!==le||(this.state=X);break;case I.BUFFER_APPEND_ERROR:case I.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="main")return;if(r.details===I.BUFFER_APPEND_ERROR)return void this.resetLoadingState();this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case I.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},t.checkBuffer=function(){var e=this.media,r=this.gapController;if(e&&r&&e.readyState){if(this.loadedmetadata||!ut.getBuffered(e).length){var i=this.state!==X?this.fragCurrent:null;r.poll(this.lastCurrentTime,i)}this.lastCurrentTime=e.currentTime}},t.onFragLoadEmergencyAborted=function(){this.state=X,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},t.onBufferFlushed=function(e,r){var i=r.type;if(i!==wt||this.audioOnly&&!this.altAudio){var a=(i===Pt?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(a,i,tt),this.tick()}},t.onLevelsUpdated=function(e,r){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=r.levels},t.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},t.seekToStartPos=function(){var e=this.media;if(e){var r=e.currentTime,i=this.startPosition;if(i>=0&&r<i){if(e.seeking)return void this.log("could not seek to "+i+", already seeking at "+r);var a=ut.getBuffered(e),o=(a.length?a.start(0):0)-i;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+o+" to match buffer start"),i+=o,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),e.currentTime=i}}},t._getAudioCodec=function(e){var r=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r=r.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),r},t._loadBitrateTestFrag=function(e,r){var i=this;e.bitrateTest=!0,this._doFragLoad(e,r).then(function(a){var o=i.hls;if(a&&!i.fragContextChanged(e)){r.fragmentError=0,i.state=X,i.startFragRequested=!1,i.bitrateTest=!1;var l=e.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),o.trigger(y.FRAG_LOADED,a),e.bitrateTest=!1}})},t._handleTransmuxComplete=function(e){var r,i="main",a=this.hls,o=e.remuxResult,l=e.chunkMeta,h=this.getCurrentContext(l);if(h){var u=h.frag,d=h.part,f=h.level,c=o.video,v=o.text,g=o.id3,p=o.initSegment,m=f.details,E=this.altAudio?void 0:o.audio;if(this.fragContextChanged(u))this.fragmentTracker.removeFragment(u);else{if(this.state=Jt,p){if(p!=null&&p.tracks){var T=u.initSegment||u;this._bufferInitSegment(f,p.tracks,T,l),a.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:p.tracks})}var S=p.initPTS,R=p.timescale;N(S)&&(this.initPTS[u.cc]={baseTime:S,timescale:R},a.trigger(y.INIT_PTS_FOUND,{frag:u,id:i,initPTS:S,timescale:R}))}if(c&&m&&u.sn!=="initSegment"){var A=m.fragments[u.sn-1-m.startSN],L=u.sn===m.startSN,w=!A||u.cc>A.cc;if(o.independent!==!1){var k=c.startPTS,C=c.endPTS,D=c.startDTS,_=c.endDTS;if(d)d.elementaryStreams[c.type]={startPTS:k,endPTS:C,startDTS:D,endDTS:_};else if(c.firstKeyFrame&&c.independent&&l.id===1&&!w&&(this.couldBacktrack=!0),c.dropped&&c.independent){var x=this.getMainFwdBufferInfo(),P=(x?x.end:this.getLoadPosition())+this.config.maxBufferHole,M=c.firstKeyFramePTS?c.firstKeyFramePTS:k;if(!L&&P<M-this.config.maxBufferHole&&!w)return void this.backtrack(u);w&&(u.gap=!0),u.setElementaryStreamInfo(c.type,u.start,C,u.start,_,!0)}else L&&k>2&&(u.gap=!0);u.setElementaryStreamInfo(c.type,k,C,D,_),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(c,u,d,l,L||w)}else{if(!L&&!w)return void this.backtrack(u);u.gap=!0}}if(E){var U=E.startPTS,F=E.endPTS,O=E.startDTS,B=E.endDTS;d&&(d.elementaryStreams[wt]={startPTS:U,endPTS:F,startDTS:O,endDTS:B}),u.setElementaryStreamInfo(wt,U,F,O,B),this.bufferFragmentData(E,u,d,l)}if(m&&g!=null&&(r=g.samples)!=null&&r.length){var G={id:i,frag:u,details:m,samples:g.samples};a.trigger(y.FRAG_PARSING_METADATA,G)}if(m&&v){var V={id:i,frag:u,details:m,samples:v.samples};a.trigger(y.FRAG_PARSING_USERDATA,V)}}}else this.resetWhenMissingContext(l)},t._bufferInitSegment=function(e,r,i,a){var o=this;if(this.state===Jt){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var l=r.audio,h=r.video,u=r.audiovideo;if(l){var d=e.audioCodec,f=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){d&&(d=d.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5");var c=l.metadata;c&&"channelCount"in c&&(c.channelCount||1)!==1&&f.indexOf("firefox")===-1&&(d="mp4a.40.5")}d&&d.indexOf("mp4a.40.5")!==-1&&f.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log("Android: force audio codec to "+d)),e.audioCodec&&e.audioCodec!==d&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+d+'"'),l.levelCodec=d,l.id="main",this.log("Init audio buffer, container:"+l.container+", codecs[selected/level/parsed]=["+(d||"")+"/"+(e.audioCodec||"")+"/"+l.codec+"]")}h&&(h.levelCodec=e.videoCodec,h.id="main",this.log("Init video buffer, container:"+h.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+h.codec+"]")),u&&this.log("Init audiovideo buffer, container:"+u.container+", codecs[level/parsed]=["+e.codecs+"/"+u.codec+"]"),this.hls.trigger(y.BUFFER_CODECS,r),Object.keys(r).forEach(function(v){var g=r[v].initSegment;g!=null&&g.byteLength&&o.hls.trigger(y.BUFFER_APPENDING,{type:v,data:g,frag:i,part:null,chunkMeta:a,parent:i.type})}),this.tickImmediate()}},t.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,tt)},t.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=X},t.checkFragmentChanged=function(){var e=this.media,r=null;if(e&&e.readyState>1&&e.seeking===!1){var i=e.currentTime;if(ut.isBuffered(e,i)?r=this.getAppendedFrag(i):ut.isBuffered(e,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){this.backtrackFragment=null;var a=this.fragPlaying,o=r.level;a&&r.sn===a.sn&&a.level===o||(this.fragPlaying=r,this.hls.trigger(y.FRAG_CHANGED,{frag:r}),a&&a.level===o||this.hls.trigger(y.LEVEL_SWITCHED,{level:o}))}}},ct(n,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var r=e.currentTime,i=this.currentFrag;if(i&&N(r)&&N(i.programDateTime)){var a=i.programDateTime+1e3*(r-i.start);return new Date(a)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),n}(vi),os=function(){function s(t){t===void 0&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Ar,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,Qi(t.debug||!1,"Hls instance");var e=this.config=function(D,_){if((_.liveSyncDurationCount||_.liveMaxLatencyDurationCount)&&(_.liveSyncDuration||_.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(_.liveMaxLatencyDurationCount!==void 0&&(_.liveSyncDurationCount===void 0||_.liveMaxLatencyDurationCount<=_.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(_.liveMaxLatencyDuration!==void 0&&(_.liveSyncDuration===void 0||_.liveMaxLatencyDuration<=_.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var x=Vi(D),P=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(M){var U=(M==="level"?"playlist":M)+"LoadPolicy",F=_[U]===void 0,O=[];P.forEach(function(B){var G=M+"Loading"+B,V=_[G];if(V!==void 0&&F){O.push(G);var Q=x[U].default;switch(_[U]={default:Q},B){case"TimeOut":Q.maxLoadTimeMs=V,Q.maxTimeToFirstByteMs=V;break;case"MaxRetry":Q.errorRetry.maxNumRetry=V,Q.timeoutRetry.maxNumRetry=V;break;case"RetryDelay":Q.errorRetry.retryDelayMs=V,Q.timeoutRetry.retryDelayMs=V;break;case"MaxRetryTimeout":Q.errorRetry.maxRetryDelayMs=V,Q.timeoutRetry.maxRetryDelayMs=V}}}),O.length&&b.warn('hls.js config: "'+O.join('", "')+'" setting(s) are deprecated, use "'+U+'": '+JSON.stringify(_[U]))}),yt(yt({},x),_)}(s.DefaultConfig,t);this.userConfig=t,e.progressive&&Fl(e);var r=e.abrController,i=e.bufferController,a=e.capLevelController,o=e.errorController,l=e.fpsController,h=new o(this),u=this.abrController=new r(this),d=this.bufferController=new i(this),f=this.capLevelController=new a(this),c=new l(this),v=new Ws(this),g=new qs(this),p=e.contentSteeringController,m=p?new p(this):null,E=this.levelController=new Ml(this,m),T=new so(this),S=new Ol(this.config),R=this.streamController=new Ul(this,T,S);f.setStreamController(R),c.setStreamController(R);var A=[v,E,R];m&&A.splice(1,0,m),this.networkControllers=A;var L=[u,d,f,c,g,T];this.audioTrackController=this.createController(e.audioTrackController,A);var w=e.audioStreamController;w&&A.push(new w(this,T,S)),this.subtitleTrackController=this.createController(e.subtitleTrackController,A);var k=e.subtitleStreamController;k&&A.push(new k(this,T,S)),this.createController(e.timelineController,L),S.emeController=this.emeController=this.createController(e.emeController,L),this.cmcdController=this.createController(e.cmcdController,L),this.latencyController=this.createController(Xs,L),this.coreComponents=L,A.push(h);var C=h.onErrorOut;typeof C=="function"&&this.on(y.ERROR,C,h)}s.isMSESupported=function(){return ss()},s.isSupported=function(){return function(){if(!ss())return!1;var t=oe();return typeof(t==null?void 0:t.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(function(e){return t.isTypeSupported(Ne(e,"video"))})||["mp4a.40.2","fLaC"].some(function(e){return t.isTypeSupported(Ne(e,"audio"))}))}()},s.getMediaSource=function(){return oe()};var n=s.prototype;return n.createController=function(t,e){if(t){var r=new t(this);return e&&e.push(r),r}return null},n.on=function(t,e,r){r===void 0&&(r=this),this._emitter.on(t,e,r)},n.once=function(t,e,r){r===void 0&&(r=this),this._emitter.once(t,e,r)},n.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},n.off=function(t,e,r,i){r===void 0&&(r=this),this._emitter.off(t,e,r,i)},n.listeners=function(t){return this._emitter.listeners(t)},n.emit=function(t,e,r){return this._emitter.emit(t,e,r)},n.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(i){if(b.error("An internal error happened while handling event "+t+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;var r=t===y.ERROR;this.trigger(y.ERROR,{type:K.OTHER_ERROR,details:I.INTERNAL_EXCEPTION,fatal:r,event:t,error:i}),this.triggeringException=!1}}return!1},n.listenerCount=function(t){return this._emitter.listenerCount(t)},n.destroy=function(){b.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null},n.attachMedia=function(t){b.log("attachMedia"),this._media=t,this.trigger(y.MEDIA_ATTACHING,{media:t})},n.detachMedia=function(){b.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,void 0),this._media=null},n.loadSource=function(t){this.stopLoad();var e=this.media,r=this.url,i=this.url=Fr.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,b.log("loadSource:"+i),e&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(y.MANIFEST_LOADING,{url:t})},n.startLoad=function(t){t===void 0&&(t=-1),b.log("startLoad("+t+")"),this.started=!0,this.resumeBuffering();for(var e=0;e<this.networkControllers.length&&(this.networkControllers[e].startLoad(t),this.started&&this.networkControllers);e++);},n.stopLoad=function(){b.log("stopLoad"),this.started=!1;for(var t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!this.started&&this.networkControllers);t++);},n.resumeBuffering=function(){b.log("resume buffering"),this.networkControllers.forEach(function(t){t.resumeBuffering&&t.resumeBuffering()})},n.pauseBuffering=function(){b.log("pause buffering"),this.networkControllers.forEach(function(t){t.pauseBuffering&&t.pauseBuffering()})},n.swapAudioCodec=function(){b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},n.recoverMediaError=function(){b.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},n.removeLevel=function(t){this.levelController.removeLevel(t)},n.setAudioOption=function(t){var e;return(e=this.audioTrackController)==null?void 0:e.setAudioOption(t)},n.setSubtitleOption=function(t){var e;return(e=this.subtitleTrackController)==null||e.setSubtitleOption(t),null},ct(s,[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){b.log("set currentLevel:"+t),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){var t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t},set:function(t){b.log("set startLevel:"+t),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN},set:function(t){this.abrController.resetEstimator(t)}},{key:"ttfbEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(t){(function(e){return ni.indexOf(e)>-1})(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,i=0;i<r;i++)if(t[i].maxBitrate>=e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t,e=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(t=r===-1&&e!=null&&e.length?e.length-1:r,i)for(var a=t;a--;){var o=e[a].attrs["HDCP-LEVEL"];if(o&&o<=i)return a}return t}},{key:"firstAutoLevel",get:function(){return this.abrController.firstAutoLevel}},{key:"nextAutoLevel",get:function(){return this.abrController.nextAutoLevel},set:function(t){this.abrController.nextAutoLevel=t}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"allAudioTracks",get:function(){var t=this.audioTrackController;return t?t.allAudioTracks:[]}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"allSubtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.5.20"}},{key:"Events",get:function(){return y}},{key:"ErrorTypes",get:function(){return K}},{key:"ErrorDetails",get:function(){return I}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:is},set:function(t){s.defaultConfig=t}}]),s}();return os.defaultConfig=void 0,os},_e.exports=re()})(!1)}(Wi)),Wi.exports}var hs=Yl();const Wl=Hl(hs),ql=Vl({__proto__:null,default:Wl},[hs]);export{ql as h};
